<?php
 declare(strict_types=1); namespace voku\helper; final class AntiXSS { private static $entitiesFallback = [ "\t" => '&Tab;', "\n" => '&NewLine;', '!' => '&excl;', '"' => '&quot;', '#' => '&num;', '$' => '&dollar;', '%' => '&percnt;', '&' => '&amp;', "'" => '&apos;', '(' => '&lpar;', ')' => '&rpar;', '*' => '&ast;', '+' => '&plus;', ',' => '&comma;', '.' => '&period;', '/' => '&sol;', ':' => '&colon;', ';' => '&semi;', '<' => '&lt;', '<âƒ’' => '&nvlt;', '=' => '&equals;', '=âƒ¥' => '&bne;', '>' => '&gt;', '>âƒ’' => '&nvgt', '?' => '&quest;', '@' => '&commat;', '[' => '&lbrack;', ']' => '&rsqb;', '^' => '&Hat;', '_' => '&lowbar;', '`' => '&grave;', 'fj' => '&fjlig;', '{' => '&lbrace;', '|' => '&vert;', '}' => '&rcub;', ' ' => '&nbsp;', 'Â¡' => '&iexcl;', 'Â¢' => '&cent;', 'Â£' => '&pound;', 'Â¤' => '&curren;', 'Â¥' => '&yen;', 'Â¦' => '&brvbar;', 'Â§' => '&sect;', 'Â¨' => '&DoubleDot;', 'Â©' => '&copy;', 'Âª' => '&ordf;', 'Â«' => '&laquo;', 'Â¬' => '&not;', 'Â­' => '&shy;', 'Â®' => '&reg;', 'Â¯' => '&macr;', 'Â°' => '&deg;', 'Â±' => '&plusmn;', 'Â²' => '&sup2;', 'Â³' => '&sup3;', 'Â´' => '&DiacriticalAcute;', 'Âµ' => '&micro;', 'Â¶' => '&para;', 'Â·' => '&CenterDot;', 'Â¸' => '&Cedilla;', 'Â¹' => '&sup1;', 'Âº' => '&ordm;', 'Â»' => '&raquo;', 'Â¼' => '&frac14;', 'Â½' => '&half;', 'Â¾' => '&frac34;', 'Â¿' => '&iquest;', 'Ã€' => '&Agrave;', 'Ã' => '&Aacute;', 'Ã‚' => '&Acirc;', 'Ãƒ' => '&Atilde;', 'Ã„' => '&Auml;', 'Ã…' => '&Aring;', 'Ã†' => '&AElig;', 'Ã‡' => '&Ccedil;', 'Ãˆ' => '&Egrave;', 'Ã‰' => '&Eacute;', 'ÃŠ' => '&Ecirc;', 'Ã‹' => '&Euml;', 'ÃŒ' => '&Igrave;', 'Ã' => '&Iacute;', 'ÃŽ' => '&Icirc;', 'Ã' => '&Iuml;', 'Ã' => '&ETH;', 'Ã‘' => '&Ntilde;', 'Ã’' => '&Ograve;', 'Ã“' => '&Oacute;', 'Ã”' => '&Ocirc;', 'Ã•' => '&Otilde;', 'Ã–' => '&Ouml;', 'Ã—' => '&times;', 'Ã˜' => '&Oslash;', 'Ã™' => '&Ugrave;', 'Ãš' => '&Uacute;', 'Ã›' => '&Ucirc;', 'Ãœ' => '&Uuml;', 'Ã' => '&Yacute;', 'Ãž' => '&THORN;', 'ÃŸ' => '&szlig;', 'Ã ' => '&agrave;', 'Ã¡' => '&aacute;', 'Ã¢' => '&acirc;', 'Ã£' => '&atilde;', 'Ã¤' => '&auml;', 'Ã¥' => '&aring;', 'Ã¦' => '&aelig;', 'Ã§' => '&ccedil;', 'Ã¨' => '&egrave;', 'Ã©' => '&eacute;', 'Ãª' => '&ecirc;', 'Ã«' => '&euml;', 'Ã¬' => '&igrave;', 'Ã­' => '&iacute;', 'Ã®' => '&icirc;', 'Ã¯' => '&iuml;', 'Ã°' => '&eth;', 'Ã±' => '&ntilde;', 'Ã²' => '&ograve;', 'Ã³' => '&oacute;', 'Ã´' => '&ocirc;', 'Ãµ' => '&otilde;', 'Ã¶' => '&ouml;', 'Ã·' => '&divide;', 'Ã¸' => '&oslash;', 'Ã¹' => '&ugrave;', 'Ãº' => '&uacute;', 'Ã»' => '&ucirc;', 'Ã¼' => '&uuml;', 'Ã½' => '&yacute;', 'Ã¾' => '&thorn;', 'Ã¿' => '&yuml;', 'Ä€' => '&Amacr;', 'Ä' => '&amacr;', 'Ä‚' => '&Abreve;', 'Äƒ' => '&abreve;', 'Ä„' => '&Aogon;', 'Ä…' => '&aogon;', 'Ä†' => '&Cacute;', 'Ä‡' => '&cacute;', 'Äˆ' => '&Ccirc;', 'Ä‰' => '&ccirc;', 'ÄŠ' => '&Cdot;', 'Ä‹' => '&cdot;', 'ÄŒ' => '&Ccaron;', 'Ä' => '&ccaron;', 'ÄŽ' => '&Dcaron;', 'Ä' => '&dcaron;', 'Ä' => '&Dstrok;', 'Ä‘' => '&dstrok;', 'Ä’' => '&Emacr;', 'Ä“' => '&emacr;', 'Ä–' => '&Edot;', 'Ä—' => '&edot;', 'Ä˜' => '&Eogon;', 'Ä™' => '&eogon;', 'Äš' => '&Ecaron;', 'Ä›' => '&ecaron;', 'Äœ' => '&Gcirc;', 'Ä' => '&gcirc;', 'Äž' => '&Gbreve;', 'ÄŸ' => '&gbreve;', 'Ä ' => '&Gdot;', 'Ä¡' => '&gdot;', 'Ä¢' => '&Gcedil;', 'Ä¤' => '&Hcirc;', 'Ä¥' => '&hcirc;', 'Ä¦' => '&Hstrok;', 'Ä§' => '&hstrok;', 'Ä¨' => '&Itilde;', 'Ä©' => '&itilde;', 'Äª' => '&Imacr;', 'Ä«' => '&imacr;', 'Ä®' => '&Iogon;', 'Ä¯' => '&iogon;', 'Ä°' => '&Idot;', 'Ä±' => '&inodot;', 'Ä²' => '&IJlig;', 'Ä³' => '&ijlig;', 'Ä´' => '&Jcirc;', 'Äµ' => '&jcirc;', 'Ä¶' => '&Kcedil;', 'Ä·' => '&kcedil;', 'Ä¸' => '&kgreen;', 'Ä¹' => '&Lacute;', 'Äº' => '&lacute;', 'Ä»' => '&Lcedil;', 'Ä¼' => '&lcedil;', 'Ä½' => '&Lcaron;', 'Ä¾' => '&lcaron;', 'Ä¿' => '&Lmidot;', 'Å€' => '&lmidot;', 'Å' => '&Lstrok;', 'Å‚' => '&lstrok;', 'Åƒ' => '&Nacute;', 'Å„' => '&nacute;', 'Å…' => '&Ncedil;', 'Å†' => '&ncedil;', 'Å‡' => '&Ncaron;', 'Åˆ' => '&ncaron;', 'Å‰' => '&napos;', 'ÅŠ' => '&ENG;', 'Å‹' => '&eng;', 'ÅŒ' => '&Omacr;', 'Å' => '&omacr;', 'Å' => '&Odblac;', 'Å‘' => '&odblac;', 'Å’' => '&OElig;', 'Å“' => '&oelig;', 'Å”' => '&Racute;', 'Å•' => '&racute;', 'Å–' => '&Rcedil;', 'Å—' => '&rcedil;', 'Å˜' => '&Rcaron;', 'Å™' => '&rcaron;', 'Åš' => '&Sacute;', 'Å›' => '&sacute;', 'Åœ' => '&Scirc;', 'Å' => '&scirc;', 'Åž' => '&Scedil;', 'ÅŸ' => '&scedil;', 'Å ' => '&Scaron;', 'Å¡' => '&scaron;', 'Å¢' => '&Tcedil;', 'Å£' => '&tcedil;', 'Å¤' => '&Tcaron;', 'Å¥' => '&tcaron;', 'Å¦' => '&Tstrok;', 'Å§' => '&tstrok;', 'Å¨' => '&Utilde;', 'Å©' => '&utilde;', 'Åª' => '&Umacr;', 'Å«' => '&umacr;', 'Å¬' => '&Ubreve;', 'Å­' => '&ubreve;', 'Å®' => '&Uring;', 'Å¯' => '&uring;', 'Å°' => '&Udblac;', 'Å±' => '&udblac;', 'Å²' => '&Uogon;', 'Å³' => '&uogon;', 'Å´' => '&Wcirc;', 'Åµ' => '&wcirc;', 'Å¶' => '&Ycirc;', 'Å·' => '&ycirc;', 'Å¸' => '&Yuml;', 'Å¹' => '&Zacute;', 'Åº' => '&zacute;', 'Å»' => '&Zdot;', 'Å¼' => '&zdot;', 'Å½' => '&Zcaron;', 'Å¾' => '&zcaron;', 'Æ’' => '&fnof;', 'Æµ' => '&imped;', 'Çµ' => '&gacute;', 'È·' => '&jmath;', 'Ë†' => '&circ;', 'Ë‡' => '&Hacek;', 'Ë˜' => '&Breve;', 'Ë™' => '&dot;', 'Ëš' => '&ring;', 'Ë›' => '&ogon;', 'Ëœ' => '&DiacriticalTilde;', 'Ë' => '&DiacriticalDoubleAcute;', 'Ì‘' => '&DownBreve;', 'Î‘' => '&Alpha;', 'Î’' => '&Beta;', 'Î“' => '&Gamma;', 'Î”' => '&Delta;', 'Î•' => '&Epsilon;', 'Î–' => '&Zeta;', 'Î—' => '&Eta;', 'Î˜' => '&Theta;', 'Î™' => '&Iota;', 'Îš' => '&Kappa;', 'Î›' => '&Lambda;', 'Îœ' => '&Mu;', 'Î' => '&Nu;', 'Îž' => '&Xi;', 'ÎŸ' => '&Omicron;', 'Î ' => '&Pi;', 'Î¡' => '&Rho;', 'Î£' => '&Sigma;', 'Î¤' => '&Tau;', 'Î¥' => '&Upsilon;', 'Î¦' => '&Phi;', 'Î§' => '&Chi;', 'Î¨' => '&Psi;', 'Î©' => '&Omega;', 'Î±' => '&alpha;', 'Î²' => '&beta;', 'Î³' => '&gamma;', 'Î´' => '&delta;', 'Îµ' => '&epsi;', 'Î¶' => '&zeta;', 'Î·' => '&eta;', 'Î¸' => '&theta;', 'Î¹' => '&iota;', 'Îº' => '&kappa;', 'Î»' => '&lambda;', 'Î¼' => '&mu;', 'Î½' => '&nu;', 'Î¾' => '&xi;', 'Î¿' => '&omicron;', 'Ï€' => '&pi;', 'Ï' => '&rho;', 'Ï‚' => '&sigmav;', 'Ïƒ' => '&sigma;', 'Ï„' => '&tau;', 'Ï…' => '&upsi;', 'Ï†' => '&phi;', 'Ï‡' => '&chi;', 'Ïˆ' => '&psi;', 'Ï‰' => '&omega;', 'Ï‘' => '&thetasym;', 'Ï’' => '&upsih;', 'Ï•' => '&straightphi;', 'Ï–' => '&piv;', 'Ïœ' => '&Gammad;', 'Ï' => '&gammad;', 'Ï°' => '&varkappa;', 'Ï±' => '&rhov;', 'Ïµ' => '&straightepsilon;', 'Ï¶' => '&backepsilon;', 'Ð' => '&IOcy;', 'Ð‚' => '&DJcy;', 'Ðƒ' => '&GJcy;', 'Ð„' => '&Jukcy;', 'Ð…' => '&DScy;', 'Ð†' => '&Iukcy;', 'Ð‡' => '&YIcy;', 'Ðˆ' => '&Jsercy;', 'Ð‰' => '&LJcy;', 'ÐŠ' => '&NJcy;', 'Ð‹' => '&TSHcy;', 'ÐŒ' => '&KJcy;', 'ÐŽ' => '&Ubrcy;', 'Ð' => '&DZcy;', 'Ð' => '&Acy;', 'Ð‘' => '&Bcy;', 'Ð’' => '&Vcy;', 'Ð“' => '&Gcy;', 'Ð”' => '&Dcy;', 'Ð•' => '&IEcy;', 'Ð–' => '&ZHcy;', 'Ð—' => '&Zcy;', 'Ð˜' => '&Icy;', 'Ð™' => '&Jcy;', 'Ðš' => '&Kcy;', 'Ð›' => '&Lcy;', 'Ðœ' => '&Mcy;', 'Ð' => '&Ncy;', 'Ðž' => '&Ocy;', 'ÐŸ' => '&Pcy;', 'Ð ' => '&Rcy;', 'Ð¡' => '&Scy;', 'Ð¢' => '&Tcy;', 'Ð£' => '&Ucy;', 'Ð¤' => '&Fcy;', 'Ð¥' => '&KHcy;', 'Ð¦' => '&TScy;', 'Ð§' => '&CHcy;', 'Ð¨' => '&SHcy;', 'Ð©' => '&SHCHcy;', 'Ðª' => '&HARDcy;', 'Ð«' => '&Ycy;', 'Ð¬' => '&SOFTcy;', 'Ð­' => '&Ecy;', 'Ð®' => '&YUcy;', 'Ð¯' => '&YAcy;', 'Ð°' => '&acy;', 'Ð±' => '&bcy;', 'Ð²' => '&vcy;', 'Ð³' => '&gcy;', 'Ð´' => '&dcy;', 'Ðµ' => '&iecy;', 'Ð¶' => '&zhcy;', 'Ð·' => '&zcy;', 'Ð¸' => '&icy;', 'Ð¹' => '&jcy;', 'Ðº' => '&kcy;', 'Ð»' => '&lcy;', 'Ð¼' => '&mcy;', 'Ð½' => '&ncy;', 'Ð¾' => '&ocy;', 'Ð¿' => '&pcy;', 'Ñ€' => '&rcy;', 'Ñ' => '&scy;', 'Ñ‚' => '&tcy;', 'Ñƒ' => '&ucy;', 'Ñ„' => '&fcy;', 'Ñ…' => '&khcy;', 'Ñ†' => '&tscy;', 'Ñ‡' => '&chcy;', 'Ñˆ' => '&shcy;', 'Ñ‰' => '&shchcy;', 'ÑŠ' => '&hardcy;', 'Ñ‹' => '&ycy;', 'ÑŒ' => '&softcy;', 'Ñ' => '&ecy;', 'ÑŽ' => '&yucy;', 'Ñ' => '&yacy;', 'Ñ‘' => '&iocy;', 'Ñ’' => '&djcy;', 'Ñ“' => '&gjcy;', 'Ñ”' => '&jukcy;', 'Ñ•' => '&dscy;', 'Ñ–' => '&iukcy;', 'Ñ—' => '&yicy;', 'Ñ˜' => '&jsercy;', 'Ñ™' => '&ljcy;', 'Ñš' => '&njcy;', 'Ñ›' => '&tshcy;', 'Ñœ' => '&kjcy;', 'Ñž' => '&ubrcy;', 'ÑŸ' => '&dzcy;', 'â€‚' => '&ensp;', 'â€ƒ' => '&emsp;', 'â€„' => '&emsp13;', 'â€…' => '&emsp14;', 'â€‡' => '&numsp;', 'â€ˆ' => '&puncsp;', 'â€‰' => '&ThinSpace;', 'â€Š' => '&hairsp;', 'â€‹' => '&ZeroWidthSpace;', 'â€Œ' => '&zwnj;', 'â€' => '&zwj;', 'â€Ž' => '&lrm;', 'â€' => '&rlm;', 'â€' => '&hyphen;', 'â€“' => '&ndash;', 'â€”' => '&mdash;', 'â€•' => '&horbar;', 'â€–' => '&Verbar;', 'â€˜' => '&OpenCurlyQuote;', 'â€™' => '&rsquo;', 'â€š' => '&sbquo;', 'â€œ' => '&OpenCurlyDoubleQuote;', 'â€' => '&rdquo;', 'â€ž' => '&bdquo;', 'â€ ' => '&dagger;', 'â€¡' => '&Dagger;', 'â€¢' => '&bull;', 'â€¥' => '&nldr;', 'â€¦' => '&hellip;', 'â€°' => '&permil;', 'â€±' => '&pertenk;', 'â€²' => '&prime;', 'â€³' => '&Prime;', 'â€´' => '&tprime;', 'â€µ' => '&backprime;', 'â€¹' => '&lsaquo;', 'â€º' => '&rsaquo;', 'â€¾' => '&oline;', 'â' => '&caret;', 'âƒ' => '&hybull;', 'â„' => '&frasl;', 'â' => '&bsemi;', 'â—' => '&qprime;', 'âŸ' => '&MediumSpace;', 'âŸâ€Š' => '&ThickSpace;', 'â ' => '&NoBreak;', 'â¡' => '&af;', 'â¢' => '&InvisibleTimes;', 'â£' => '&ic;', 'â‚¬' => '&euro;', 'âƒ›' => '&TripleDot;', 'âƒœ' => '&DotDot;', 'â„‚' => '&complexes;', 'â„…' => '&incare;', 'â„Š' => '&gscr;', 'â„‹' => '&HilbertSpace;', 'â„Œ' => '&Hfr;', 'â„' => '&Hopf;', 'â„Ž' => '&planckh;', 'â„' => '&planck;', 'â„' => '&imagline;', 'â„‘' => '&Ifr;', 'â„’' => '&lagran;', 'â„“' => '&ell;', 'â„•' => '&naturals;', 'â„–' => '&numero;', 'â„—' => '&copysr;', 'â„˜' => '&wp;', 'â„™' => '&primes;', 'â„š' => '&rationals;', 'â„›' => '&realine;', 'â„œ' => '&Rfr;', 'â„' => '&Ropf;', 'â„ž' => '&rx;', 'â„¢' => '&trade;', 'â„¤' => '&Zopf;', 'â„§' => '&mho;', 'â„¨' => '&Zfr;', 'â„©' => '&iiota;', 'â„¬' => '&Bscr;', 'â„­' => '&Cfr;', 'â„¯' => '&escr;', 'â„°' => '&expectation;', 'â„±' => '&Fouriertrf;', 'â„³' => '&Mellintrf;', 'â„´' => '&orderof;', 'â„µ' => '&aleph;', 'â„¶' => '&beth;', 'â„·' => '&gimel;', 'â„¸' => '&daleth;', 'â……' => '&CapitalDifferentialD;', 'â…†' => '&DifferentialD;', 'â…‡' => '&exponentiale;', 'â…ˆ' => '&ImaginaryI;', 'â…“' => '&frac13;', 'â…”' => '&frac23;', 'â…•' => '&frac15;', 'â…–' => '&frac25;', 'â…—' => '&frac35;', 'â…˜' => '&frac45;', 'â…™' => '&frac16;', 'â…š' => '&frac56;', 'â…›' => '&frac18;', 'â…œ' => '&frac38;', 'â…' => '&frac58;', 'â…ž' => '&frac78;', 'â†' => '&larr;', 'â†‘' => '&uarr;', 'â†’' => '&srarr;', 'â†“' => '&darr;', 'â†”' => '&harr;', 'â†•' => '&UpDownArrow;', 'â†–' => '&nwarrow;', 'â†—' => '&UpperRightArrow;', 'â†˜' => '&LowerRightArrow;', 'â†™' => '&swarr;', 'â†š' => '&nleftarrow;', 'â†›' => '&nrarr;', 'â†' => '&rarrw;', 'â†Ì¸' => '&nrarrw;', 'â†ž' => '&Larr;', 'â†Ÿ' => '&Uarr;', 'â† ' => '&twoheadrightarrow;', 'â†¡' => '&Darr;', 'â†¢' => '&larrtl;', 'â†£' => '&rarrtl;', 'â†¤' => '&LeftTeeArrow;', 'â†¥' => '&UpTeeArrow;', 'â†¦' => '&map;', 'â†§' => '&DownTeeArrow;', 'â†©' => '&larrhk;', 'â†ª' => '&rarrhk;', 'â†«' => '&larrlp;', 'â†¬' => '&looparrowright;', 'â†­' => '&harrw;', 'â†®' => '&nleftrightarrow;', 'â†°' => '&Lsh;', 'â†±' => '&rsh;', 'â†²' => '&ldsh;', 'â†³' => '&rdsh;', 'â†µ' => '&crarr;', 'â†¶' => '&curvearrowleft;', 'â†·' => '&curarr;', 'â†º' => '&olarr;', 'â†»' => '&orarr;', 'â†¼' => '&leftharpoonup;', 'â†½' => '&leftharpoondown;', 'â†¾' => '&RightUpVector;', 'â†¿' => '&uharl;', 'â‡€' => '&rharu;', 'â‡' => '&rhard;', 'â‡‚' => '&RightDownVector;', 'â‡ƒ' => '&dharl;', 'â‡„' => '&rightleftarrows;', 'â‡…' => '&udarr;', 'â‡†' => '&lrarr;', 'â‡‡' => '&llarr;', 'â‡ˆ' => '&upuparrows;', 'â‡‰' => '&rrarr;', 'â‡Š' => '&downdownarrows;', 'â‡‹' => '&leftrightharpoons;', 'â‡Œ' => '&rightleftharpoons;', 'â‡' => '&nLeftarrow;', 'â‡Ž' => '&nhArr;', 'â‡' => '&nrArr;', 'â‡' => '&DoubleLeftArrow;', 'â‡‘' => '&DoubleUpArrow;', 'â‡’' => '&Implies;', 'â‡“' => '&Downarrow;', 'â‡”' => '&hArr;', 'â‡•' => '&Updownarrow;', 'â‡–' => '&nwArr;', 'â‡—' => '&neArr;', 'â‡˜' => '&seArr;', 'â‡™' => '&swArr;', 'â‡š' => '&lAarr;', 'â‡›' => '&rAarr;', 'â‡' => '&zigrarr;', 'â‡¤' => '&LeftArrowBar;', 'â‡¥' => '&RightArrowBar;', 'â‡µ' => '&DownArrowUpArrow;', 'â‡½' => '&loarr;', 'â‡¾' => '&roarr;', 'â‡¿' => '&hoarr;', 'âˆ€' => '&forall;', 'âˆ' => '&comp;', 'âˆ‚' => '&part;', 'âˆ‚Ì¸' => '&npart;', 'âˆƒ' => '&Exists;', 'âˆ„' => '&nexist;', 'âˆ…' => '&empty;', 'âˆ‡' => '&nabla;', 'âˆˆ' => '&isinv;', 'âˆ‰' => '&notin;', 'âˆ‹' => '&ReverseElement;', 'âˆŒ' => '&notniva;', 'âˆ' => '&prod;', 'âˆ' => '&Coproduct;', 'âˆ‘' => '&sum;', 'âˆ’' => '&minus;', 'âˆ“' => '&MinusPlus;', 'âˆ”' => '&plusdo;', 'âˆ–' => '&ssetmn;', 'âˆ—' => '&lowast;', 'âˆ˜' => '&compfn;', 'âˆš' => '&Sqrt;', 'âˆ' => '&prop;', 'âˆž' => '&infin;', 'âˆŸ' => '&angrt;', 'âˆ ' => '&angle;', 'âˆ âƒ’' => '&nang;', 'âˆ¡' => '&angmsd;', 'âˆ¢' => '&angsph;', 'âˆ£' => '&mid;', 'âˆ¤' => '&nshortmid;', 'âˆ¥' => '&shortparallel;', 'âˆ¦' => '&nparallel;', 'âˆ§' => '&and;', 'âˆ¨' => '&or;', 'âˆ©' => '&cap;', 'âˆ©ï¸€' => '&caps;', 'âˆª' => '&cup;', 'âˆªï¸€' => '&cups', 'âˆ«' => '&Integral;', 'âˆ¬' => '&Int;', 'âˆ­' => '&tint;', 'âˆ®' => '&ContourIntegral;', 'âˆ¯' => '&DoubleContourIntegral;', 'âˆ°' => '&Cconint;', 'âˆ±' => '&cwint;', 'âˆ²' => '&cwconint;', 'âˆ³' => '&awconint;', 'âˆ´' => '&there4;', 'âˆµ' => '&Because;', 'âˆ¶' => '&ratio;', 'âˆ·' => '&Colon;', 'âˆ¸' => '&minusd;', 'âˆº' => '&mDDot;', 'âˆ»' => '&homtht;', 'âˆ¼' => '&sim;', 'âˆ¼âƒ’' => '&nvsim;', 'âˆ½' => '&bsim;', 'âˆ½Ì±' => '&race;', 'âˆ¾' => '&ac;', 'âˆ¾Ì³' => '&acE;', 'âˆ¿' => '&acd;', 'â‰€' => '&wr;', 'â‰' => '&NotTilde;', 'â‰‚' => '&esim;', 'â‰‚Ì¸' => '&nesim;', 'â‰ƒ' => '&simeq;', 'â‰„' => '&nsime;', 'â‰…' => '&TildeFullEqual;', 'â‰†' => '&simne;', 'â‰‡' => '&ncong;', 'â‰ˆ' => '&approx;', 'â‰‰' => '&napprox;', 'â‰Š' => '&ape;', 'â‰‹' => '&apid;', 'â‰‹Ì¸' => '&napid;', 'â‰Œ' => '&bcong;', 'â‰' => '&CupCap;', 'â‰âƒ’' => '&nvap;', 'â‰Ž' => '&bump;', 'â‰ŽÌ¸' => '&nbump;', 'â‰' => '&HumpEqual;', 'â‰Ì¸' => '&nbumpe;', 'â‰' => '&esdot;', 'â‰Ì¸' => '&nedot;', 'â‰‘' => '&doteqdot;', 'â‰’' => '&fallingdotseq;', 'â‰“' => '&risingdotseq;', 'â‰”' => '&coloneq;', 'â‰•' => '&eqcolon;', 'â‰–' => '&ecir;', 'â‰—' => '&circeq;', 'â‰™' => '&wedgeq;', 'â‰š' => '&veeeq;', 'â‰œ' => '&triangleq;', 'â‰Ÿ' => '&equest;', 'â‰ ' => '&NotEqual;', 'â‰¡' => '&Congruent;', 'â‰¡âƒ¥' => '&bnequiv;', 'â‰¢' => '&NotCongruent;', 'â‰¤' => '&leq;', 'â‰¤âƒ’' => '&nvle;', 'â‰¥' => '&ge;', 'â‰¥âƒ’' => '&nvge;', 'â‰¦' => '&lE;', 'â‰¦Ì¸' => '&nlE;', 'â‰§' => '&geqq;', 'â‰§Ì¸' => '&NotGreaterFullEqual;', 'â‰¨' => '&lneqq;', 'â‰¨ï¸€' => '&lvertneqq;', 'â‰©' => '&gneqq;', 'â‰©ï¸€' => '&gvertneqq;', 'â‰ª' => '&ll;', 'â‰ªÌ¸' => '&nLtv;', 'â‰ªâƒ’' => '&nLt;', 'â‰«' => '&gg;', 'â‰«Ì¸' => '&NotGreaterGreater;', 'â‰«âƒ’' => '&nGt;', 'â‰¬' => '&between;', 'â‰­' => '&NotCupCap;', 'â‰®' => '&NotLess;', 'â‰¯' => '&ngtr;', 'â‰°' => '&NotLessEqual;', 'â‰±' => '&ngeq;', 'â‰²' => '&LessTilde;', 'â‰³' => '&GreaterTilde;', 'â‰´' => '&nlsim;', 'â‰µ' => '&ngsim;', 'â‰¶' => '&lessgtr;', 'â‰·' => '&gl;', 'â‰¸' => '&ntlg;', 'â‰¹' => '&NotGreaterLess;', 'â‰º' => '&prec;', 'â‰»' => '&succ;', 'â‰¼' => '&PrecedesSlantEqual;', 'â‰½' => '&succcurlyeq;', 'â‰¾' => '&precsim;', 'â‰¿' => '&SucceedsTilde;', 'â‰¿Ì¸' => '&NotSucceedsTilde;', 'âŠ€' => '&npr;', 'âŠ' => '&NotSucceeds;', 'âŠ‚' => '&sub;', 'âŠ‚âƒ’' => '&vnsub;', 'âŠƒ' => '&sup;', 'âŠƒâƒ’' => '&nsupset;', 'âŠ„' => '&nsub;', 'âŠ…' => '&nsup;', 'âŠ†' => '&SubsetEqual;', 'âŠ‡' => '&supe;', 'âŠˆ' => '&NotSubsetEqual;', 'âŠ‰' => '&NotSupersetEqual;', 'âŠŠ' => '&subsetneq;', 'âŠŠï¸€' => '&vsubne;', 'âŠ‹' => '&supsetneq;', 'âŠ‹ï¸€' => '&vsupne;', 'âŠ' => '&cupdot;', 'âŠŽ' => '&UnionPlus;', 'âŠ' => '&sqsub;', 'âŠÌ¸' => '&NotSquareSubset;', 'âŠ' => '&sqsupset;', 'âŠÌ¸' => '&NotSquareSuperset;', 'âŠ‘' => '&SquareSubsetEqual;', 'âŠ’' => '&SquareSupersetEqual;', 'âŠ“' => '&sqcap;', 'âŠ“ï¸€' => '&sqcaps;', 'âŠ”' => '&sqcup;', 'âŠ”ï¸€' => '&sqcups;', 'âŠ•' => '&CirclePlus;', 'âŠ–' => '&ominus;', 'âŠ—' => '&CircleTimes;', 'âŠ˜' => '&osol;', 'âŠ™' => '&CircleDot;', 'âŠš' => '&ocir;', 'âŠ›' => '&oast;', 'âŠ' => '&odash;', 'âŠž' => '&boxplus;', 'âŠŸ' => '&boxminus;', 'âŠ ' => '&timesb;', 'âŠ¡' => '&sdotb;', 'âŠ¢' => '&vdash;', 'âŠ£' => '&dashv;', 'âŠ¤' => '&DownTee;', 'âŠ¥' => '&perp;', 'âŠ§' => '&models;', 'âŠ¨' => '&DoubleRightTee;', 'âŠ©' => '&Vdash;', 'âŠª' => '&Vvdash;', 'âŠ«' => '&VDash;', 'âŠ¬' => '&nvdash;', 'âŠ­' => '&nvDash;', 'âŠ®' => '&nVdash;', 'âŠ¯' => '&nVDash;', 'âŠ°' => '&prurel;', 'âŠ²' => '&vartriangleleft;', 'âŠ³' => '&vrtri;', 'âŠ´' => '&LeftTriangleEqual;', 'âŠ´âƒ’' => '&nvltrie;', 'âŠµ' => '&RightTriangleEqual;', 'âŠµâƒ’' => '&nvrtrie;', 'âŠ¶' => '&origof;', 'âŠ·' => '&imof;', 'âŠ¸' => '&mumap;', 'âŠ¹' => '&hercon;', 'âŠº' => '&intcal;', 'âŠ»' => '&veebar;', 'âŠ½' => '&barvee;', 'âŠ¾' => '&angrtvb;', 'âŠ¿' => '&lrtri;', 'â‹€' => '&xwedge;', 'â‹' => '&xvee;', 'â‹‚' => '&bigcap;', 'â‹ƒ' => '&bigcup;', 'â‹„' => '&diamond;', 'â‹…' => '&sdot;', 'â‹†' => '&Star;', 'â‹‡' => '&divonx;', 'â‹ˆ' => '&bowtie;', 'â‹‰' => '&ltimes;', 'â‹Š' => '&rtimes;', 'â‹‹' => '&lthree;', 'â‹Œ' => '&rthree;', 'â‹' => '&backsimeq;', 'â‹Ž' => '&curlyvee;', 'â‹' => '&curlywedge;', 'â‹' => '&Sub;', 'â‹‘' => '&Supset;', 'â‹’' => '&Cap;', 'â‹“' => '&Cup;', 'â‹”' => '&pitchfork;', 'â‹•' => '&epar;', 'â‹–' => '&lessdot;', 'â‹—' => '&gtrdot;', 'â‹˜' => '&Ll;', 'â‹˜Ì¸' => '&nLl;', 'â‹™' => '&Gg;', 'â‹™Ì¸' => '&nGg;', 'â‹š' => '&lesseqgtr;', 'â‹šï¸€' => '&lesg;', 'â‹›' => '&gtreqless;', 'â‹›ï¸€' => '&gesl;', 'â‹ž' => '&curlyeqprec;', 'â‹Ÿ' => '&cuesc;', 'â‹ ' => '&NotPrecedesSlantEqual;', 'â‹¡' => '&NotSucceedsSlantEqual;', 'â‹¢' => '&NotSquareSubsetEqual;', 'â‹£' => '&NotSquareSupersetEqual;', 'â‹¦' => '&lnsim;', 'â‹§' => '&gnsim;', 'â‹¨' => '&precnsim;', 'â‹©' => '&scnsim;', 'â‹ª' => '&nltri;', 'â‹«' => '&ntriangleright;', 'â‹¬' => '&nltrie;', 'â‹­' => '&NotRightTriangleEqual;', 'â‹®' => '&vellip;', 'â‹¯' => '&ctdot;', 'â‹°' => '&utdot;', 'â‹±' => '&dtdot;', 'â‹²' => '&disin;', 'â‹³' => '&isinsv;', 'â‹´' => '&isins;', 'â‹µ' => '&isindot;', 'â‹µÌ¸' => '&notindot;', 'â‹¶' => '&notinvc;', 'â‹·' => '&notinvb;', 'â‹¹' => '&isinE;', 'â‹¹Ì¸' => '&notinE;', 'â‹º' => '&nisd;', 'â‹»' => '&xnis;', 'â‹¼' => '&nis;', 'â‹½' => '&notnivc;', 'â‹¾' => '&notnivb;', 'âŒ…' => '&barwed;', 'âŒ†' => '&doublebarwedge;', 'âŒˆ' => '&lceil;', 'âŒ‰' => '&RightCeiling;', 'âŒŠ' => '&LeftFloor;', 'âŒ‹' => '&RightFloor;', 'âŒŒ' => '&drcrop;', 'âŒ' => '&dlcrop;', 'âŒŽ' => '&urcrop;', 'âŒ' => '&ulcrop;', 'âŒ' => '&bnot;', 'âŒ’' => '&profline;', 'âŒ“' => '&profsurf;', 'âŒ•' => '&telrec;', 'âŒ–' => '&target;', 'âŒœ' => '&ulcorner;', 'âŒ' => '&urcorner;', 'âŒž' => '&llcorner;', 'âŒŸ' => '&drcorn;', 'âŒ¢' => '&frown;', 'âŒ£' => '&smile;', 'âŒ­' => '&cylcty;', 'âŒ®' => '&profalar;', 'âŒ¶' => '&topbot;', 'âŒ½' => '&ovbar;', 'âŒ¿' => '&solbar;', 'â¼' => '&angzarr;', 'âŽ°' => '&lmoust;', 'âŽ±' => '&rmoust;', 'âŽ´' => '&OverBracket;', 'âŽµ' => '&bbrk;', 'âŽ¶' => '&bbrktbrk;', 'âœ' => '&OverParenthesis;', 'â' => '&UnderParenthesis;', 'âž' => '&OverBrace;', 'âŸ' => '&UnderBrace;', 'â¢' => '&trpezium;', 'â§' => '&elinters;', 'â£' => '&blank;', 'â“ˆ' => '&oS;', 'â”€' => '&HorizontalLine;', 'â”‚' => '&boxv;', 'â”Œ' => '&boxdr;', 'â”' => '&boxdl;', 'â””' => '&boxur;', 'â”˜' => '&boxul;', 'â”œ' => '&boxvr;', 'â”¤' => '&boxvl;', 'â”¬' => '&boxhd;', 'â”´' => '&boxhu;', 'â”¼' => '&boxvh;', 'â•' => '&boxH;', 'â•‘' => '&boxV;', 'â•’' => '&boxdR;', 'â•“' => '&boxDr;', 'â•”' => '&boxDR;', 'â••' => '&boxdL;', 'â•–' => '&boxDl;', 'â•—' => '&boxDL;', 'â•˜' => '&boxuR;', 'â•™' => '&boxUr;', 'â•š' => '&boxUR;', 'â•›' => '&boxuL;', 'â•œ' => '&boxUl;', 'â•' => '&boxUL;', 'â•ž' => '&boxvR;', 'â•Ÿ' => '&boxVr;', 'â• ' => '&boxVR;', 'â•¡' => '&boxvL;', 'â•¢' => '&boxVl;', 'â•£' => '&boxVL;', 'â•¤' => '&boxHd;', 'â•¥' => '&boxhD;', 'â•¦' => '&boxHD;', 'â•§' => '&boxHu;', 'â•¨' => '&boxhU;', 'â•©' => '&boxHU;', 'â•ª' => '&boxvH;', 'â•«' => '&boxVh;', 'â•¬' => '&boxVH;', 'â–€' => '&uhblk;', 'â–„' => '&lhblk;', 'â–ˆ' => '&block;', 'â–‘' => '&blk14;', 'â–’' => '&blk12;', 'â–“' => '&blk34;', 'â–¡' => '&Square;', 'â–ª' => '&squarf;', 'â–«' => '&EmptyVerySmallSquare;', 'â–­' => '&rect;', 'â–®' => '&marker;', 'â–±' => '&fltns;', 'â–³' => '&bigtriangleup;', 'â–´' => '&blacktriangle;', 'â–µ' => '&triangle;', 'â–¸' => '&blacktriangleright;', 'â–¹' => '&rtri;', 'â–½' => '&bigtriangledown;', 'â–¾' => '&blacktriangledown;', 'â–¿' => '&triangledown;', 'â—‚' => '&blacktriangleleft;', 'â—ƒ' => '&ltri;', 'â—Š' => '&lozenge;', 'â—‹' => '&cir;', 'â—¬' => '&tridot;', 'â—¯' => '&bigcirc;', 'â—¸' => '&ultri;', 'â—¹' => '&urtri;', 'â—º' => '&lltri;', 'â—»' => '&EmptySmallSquare;', 'â—¼' => '&FilledSmallSquare;', 'â˜…' => '&starf;', 'â˜†' => '&star;', 'â˜Ž' => '&phone;', 'â™€' => '&female;', 'â™‚' => '&male;', 'â™ ' => '&spadesuit;', 'â™£' => '&clubs;', 'â™¥' => '&hearts;', 'â™¦' => '&diamondsuit;', 'â™ª' => '&sung;', 'â™­' => '&flat;', 'â™®' => '&natur;', 'â™¯' => '&sharp;', 'âœ“' => '&check;', 'âœ—' => '&cross;', 'âœ ' => '&maltese;', 'âœ¶' => '&sext;', 'â˜' => '&VerticalSeparator;', 'â²' => '&lbbrk;', 'â³' => '&rbbrk;', 'âŸˆ' => '&bsolhsub;', 'âŸ‰' => '&suphsol;', 'âŸ¦' => '&LeftDoubleBracket;', 'âŸ§' => '&RightDoubleBracket;', 'âŸ¨' => '&langle;', 'âŸ©' => '&RightAngleBracket;', 'âŸª' => '&Lang;', 'âŸ«' => '&Rang;', 'âŸ¬' => '&loang;', 'âŸ­' => '&roang;', 'âŸµ' => '&longleftarrow;', 'âŸ¶' => '&LongRightArrow;', 'âŸ·' => '&LongLeftRightArrow;', 'âŸ¸' => '&xlArr;', 'âŸ¹' => '&DoubleLongRightArrow;', 'âŸº' => '&xhArr;', 'âŸ¼' => '&xmap;', 'âŸ¿' => '&dzigrarr;', 'â¤‚' => '&nvlArr;', 'â¤ƒ' => '&nvrArr;', 'â¤„' => '&nvHarr;', 'â¤…' => '&Map;', 'â¤Œ' => '&lbarr;', 'â¤' => '&bkarow;', 'â¤Ž' => '&lBarr;', 'â¤' => '&dbkarow;', 'â¤' => '&drbkarow;', 'â¤‘' => '&DDotrahd;', 'â¤’' => '&UpArrowBar;', 'â¤“' => '&DownArrowBar;', 'â¤–' => '&Rarrtl;', 'â¤™' => '&latail;', 'â¤š' => '&ratail;', 'â¤›' => '&lAtail;', 'â¤œ' => '&rAtail;', 'â¤' => '&larrfs;', 'â¤ž' => '&rarrfs;', 'â¤Ÿ' => '&larrbfs;', 'â¤ ' => '&rarrbfs;', 'â¤£' => '&nwarhk;', 'â¤¤' => '&nearhk;', 'â¤¥' => '&searhk;', 'â¤¦' => '&swarhk;', 'â¤§' => '&nwnear;', 'â¤¨' => '&toea;', 'â¤©' => '&seswar;', 'â¤ª' => '&swnwar;', 'â¤³' => '&rarrc;', 'â¤³Ì¸' => '&nrarrc;', 'â¤µ' => '&cudarrr;', 'â¤¶' => '&ldca;', 'â¤·' => '&rdca;', 'â¤¸' => '&cudarrl;', 'â¤¹' => '&larrpl;', 'â¤¼' => '&curarrm;', 'â¤½' => '&cularrp;', 'â¥…' => '&rarrpl;', 'â¥ˆ' => '&harrcir;', 'â¥‰' => '&Uarrocir;', 'â¥Š' => '&lurdshar;', 'â¥‹' => '&ldrushar;', 'â¥Ž' => '&LeftRightVector;', 'â¥' => '&RightUpDownVector;', 'â¥' => '&DownLeftRightVector;', 'â¥‘' => '&LeftUpDownVector;', 'â¥’' => '&LeftVectorBar;', 'â¥“' => '&RightVectorBar;', 'â¥”' => '&RightUpVectorBar;', 'â¥•' => '&RightDownVectorBar;', 'â¥–' => '&DownLeftVectorBar;', 'â¥—' => '&DownRightVectorBar;', 'â¥˜' => '&LeftUpVectorBar;', 'â¥™' => '&LeftDownVectorBar;', 'â¥š' => '&LeftTeeVector;', 'â¥›' => '&RightTeeVector;', 'â¥œ' => '&RightUpTeeVector;', 'â¥' => '&RightDownTeeVector;', 'â¥ž' => '&DownLeftTeeVector;', 'â¥Ÿ' => '&DownRightTeeVector;', 'â¥ ' => '&LeftUpTeeVector;', 'â¥¡' => '&LeftDownTeeVector;', 'â¥¢' => '&lHar;', 'â¥£' => '&uHar;', 'â¥¤' => '&rHar;', 'â¥¥' => '&dHar;', 'â¥¦' => '&luruhar;', 'â¥§' => '&ldrdhar;', 'â¥¨' => '&ruluhar;', 'â¥©' => '&rdldhar;', 'â¥ª' => '&lharul;', 'â¥«' => '&llhard;', 'â¥¬' => '&rharul;', 'â¥­' => '&lrhard;', 'â¥®' => '&udhar;', 'â¥¯' => '&ReverseUpEquilibrium;', 'â¥°' => '&RoundImplies;', 'â¥±' => '&erarr;', 'â¥²' => '&simrarr;', 'â¥³' => '&larrsim;', 'â¥´' => '&rarrsim;', 'â¥µ' => '&rarrap;', 'â¥¶' => '&ltlarr;', 'â¥¸' => '&gtrarr;', 'â¥¹' => '&subrarr;', 'â¥»' => '&suplarr;', 'â¥¼' => '&lfisht;', 'â¥½' => '&rfisht;', 'â¥¾' => '&ufisht;', 'â¥¿' => '&dfisht;', 'â¦…' => '&lopar;', 'â¦†' => '&ropar;', 'â¦‹' => '&lbrke;', 'â¦Œ' => '&rbrke;', 'â¦' => '&lbrkslu;', 'â¦Ž' => '&rbrksld;', 'â¦' => '&lbrksld;', 'â¦' => '&rbrkslu;', 'â¦‘' => '&langd;', 'â¦’' => '&rangd;', 'â¦“' => '&lparlt;', 'â¦”' => '&rpargt;', 'â¦•' => '&gtlPar;', 'â¦–' => '&ltrPar;', 'â¦š' => '&vzigzag;', 'â¦œ' => '&vangrt;', 'â¦' => '&angrtvbd;', 'â¦¤' => '&ange;', 'â¦¥' => '&range;', 'â¦¦' => '&dwangle;', 'â¦§' => '&uwangle;', 'â¦¨' => '&angmsdaa;', 'â¦©' => '&angmsdab;', 'â¦ª' => '&angmsdac;', 'â¦«' => '&angmsdad;', 'â¦¬' => '&angmsdae;', 'â¦­' => '&angmsdaf;', 'â¦®' => '&angmsdag;', 'â¦¯' => '&angmsdah;', 'â¦°' => '&bemptyv;', 'â¦±' => '&demptyv;', 'â¦²' => '&cemptyv;', 'â¦³' => '&raemptyv;', 'â¦´' => '&laemptyv;', 'â¦µ' => '&ohbar;', 'â¦¶' => '&omid;', 'â¦·' => '&opar;', 'â¦¹' => '&operp;', 'â¦»' => '&olcross;', 'â¦¼' => '&odsold;', 'â¦¾' => '&olcir;', 'â¦¿' => '&ofcir;', 'â§€' => '&olt;', 'â§' => '&ogt;', 'â§‚' => '&cirscir;', 'â§ƒ' => '&cirE;', 'â§„' => '&solb;', 'â§…' => '&bsolb;', 'â§‰' => '&boxbox;', 'â§' => '&trisb;', 'â§Ž' => '&rtriltri;', 'â§' => '&LeftTriangleBar;', 'â§Ì¸' => '&NotLeftTriangleBar;', 'â§' => '&RightTriangleBar;', 'â§Ì¸' => '&NotRightTriangleBar;', 'â§œ' => '&iinfin;', 'â§' => '&infintie;', 'â§ž' => '&nvinfin;', 'â§£' => '&eparsl;', 'â§¤' => '&smeparsl;', 'â§¥' => '&eqvparsl;', 'â§«' => '&lozf;', 'â§´' => '&RuleDelayed;', 'â§¶' => '&dsol;', 'â¨€' => '&xodot;', 'â¨' => '&bigoplus;', 'â¨‚' => '&bigotimes;', 'â¨„' => '&biguplus;', 'â¨†' => '&bigsqcup;', 'â¨Œ' => '&iiiint;', 'â¨' => '&fpartint;', 'â¨' => '&cirfnint;', 'â¨‘' => '&awint;', 'â¨’' => '&rppolint;', 'â¨“' => '&scpolint;', 'â¨”' => '&npolint;', 'â¨•' => '&pointint;', 'â¨–' => '&quatint;', 'â¨—' => '&intlarhk;', 'â¨¢' => '&pluscir;', 'â¨£' => '&plusacir;', 'â¨¤' => '&simplus;', 'â¨¥' => '&plusdu;', 'â¨¦' => '&plussim;', 'â¨§' => '&plustwo;', 'â¨©' => '&mcomma;', 'â¨ª' => '&minusdu;', 'â¨­' => '&loplus;', 'â¨®' => '&roplus;', 'â¨¯' => '&Cross;', 'â¨°' => '&timesd;', 'â¨±' => '&timesbar;', 'â¨³' => '&smashp;', 'â¨´' => '&lotimes;', 'â¨µ' => '&rotimes;', 'â¨¶' => '&otimesas;', 'â¨·' => '&Otimes;', 'â¨¸' => '&odiv;', 'â¨¹' => '&triplus;', 'â¨º' => '&triminus;', 'â¨»' => '&tritime;', 'â¨¼' => '&iprod;', 'â¨¿' => '&amalg;', 'â©€' => '&capdot;', 'â©‚' => '&ncup;', 'â©ƒ' => '&ncap;', 'â©„' => '&capand;', 'â©…' => '&cupor;', 'â©†' => '&cupcap;', 'â©‡' => '&capcup;', 'â©ˆ' => '&cupbrcap;', 'â©‰' => '&capbrcup;', 'â©Š' => '&cupcup;', 'â©‹' => '&capcap;', 'â©Œ' => '&ccups;', 'â©' => '&ccaps;', 'â©' => '&ccupssm;', 'â©“' => '&And;', 'â©”' => '&Or;', 'â©•' => '&andand;', 'â©–' => '&oror;', 'â©—' => '&orslope;', 'â©˜' => '&andslope;', 'â©š' => '&andv;', 'â©›' => '&orv;', 'â©œ' => '&andd;', 'â©' => '&ord;', 'â©Ÿ' => '&wedbar;', 'â©¦' => '&sdote;', 'â©ª' => '&simdot;', 'â©­' => '&congdot;', 'â©­Ì¸' => '&ncongdot;', 'â©®' => '&easter;', 'â©¯' => '&apacir;', 'â©°' => '&apE;', 'â©°Ì¸' => '&napE;', 'â©±' => '&eplus;', 'â©²' => '&pluse;', 'â©³' => '&Esim;', 'â©´' => '&Colone;', 'â©µ' => '&Equal;', 'â©·' => '&ddotseq;', 'â©¸' => '&equivDD;', 'â©¹' => '&ltcir;', 'â©º' => '&gtcir;', 'â©»' => '&ltquest;', 'â©¼' => '&gtquest;', 'â©½' => '&les;', 'â©½Ì¸' => '&nles;', 'â©¾' => '&ges;', 'â©¾Ì¸' => '&nges;', 'â©¿' => '&lesdot;', 'âª€' => '&gesdot;', 'âª' => '&lesdoto;', 'âª‚' => '&gesdoto;', 'âªƒ' => '&lesdotor;', 'âª„' => '&gesdotol;', 'âª…' => '&lap;', 'âª†' => '&gap;', 'âª‡' => '&lne;', 'âªˆ' => '&gne;', 'âª‰' => '&lnap;', 'âªŠ' => '&gnap;', 'âª‹' => '&lesseqqgtr;', 'âªŒ' => '&gEl;', 'âª' => '&lsime;', 'âªŽ' => '&gsime;', 'âª' => '&lsimg;', 'âª' => '&gsiml;', 'âª‘' => '&lgE;', 'âª’' => '&glE;', 'âª“' => '&lesges;', 'âª”' => '&gesles;', 'âª•' => '&els;', 'âª–' => '&egs;', 'âª—' => '&elsdot;', 'âª˜' => '&egsdot;', 'âª™' => '&el;', 'âªš' => '&eg;', 'âª' => '&siml;', 'âªž' => '&simg;', 'âªŸ' => '&simlE;', 'âª ' => '&simgE;', 'âª¡' => '&LessLess;', 'âª¡Ì¸' => '&NotNestedLessLess;', 'âª¢' => '&GreaterGreater;', 'âª¢Ì¸' => '&NotNestedGreaterGreater;', 'âª¤' => '&glj;', 'âª¥' => '&gla;', 'âª¦' => '&ltcc;', 'âª§' => '&gtcc;', 'âª¨' => '&lescc;', 'âª©' => '&gescc;', 'âªª' => '&smt;', 'âª«' => '&lat;', 'âª¬' => '&smte;', 'âª¬ï¸€' => '&smtes;', 'âª­' => '&late;', 'âª­ï¸€' => '&lates;', 'âª®' => '&bumpE;', 'âª¯' => '&preceq;', 'âª¯Ì¸' => '&NotPrecedesEqual;', 'âª°' => '&SucceedsEqual;', 'âª°Ì¸' => '&NotSucceedsEqual;', 'âª³' => '&prE;', 'âª´' => '&scE;', 'âªµ' => '&precneqq;', 'âª¶' => '&scnE;', 'âª·' => '&precapprox;', 'âª¸' => '&succapprox;', 'âª¹' => '&precnapprox;', 'âªº' => '&succnapprox;', 'âª»' => '&Pr;', 'âª¼' => '&Sc;', 'âª½' => '&subdot;', 'âª¾' => '&supdot;', 'âª¿' => '&subplus;', 'â«€' => '&supplus;', 'â«' => '&submult;', 'â«‚' => '&supmult;', 'â«ƒ' => '&subedot;', 'â«„' => '&supedot;', 'â«…' => '&subE;', 'â«…Ì¸' => '&nsubE;', 'â«†' => '&supseteqq;', 'â«†Ì¸' => '&nsupseteqq;', 'â«‡' => '&subsim;', 'â«ˆ' => '&supsim;', 'â«‹' => '&subsetneqq;', 'â«‹ï¸€' => '&vsubnE;', 'â«Œ' => '&supnE;', 'â«Œï¸€' => '&varsupsetneqq;', 'â«' => '&csub;', 'â«' => '&csup;', 'â«‘' => '&csube;', 'â«’' => '&csupe;', 'â«“' => '&subsup;', 'â«”' => '&supsub;', 'â«•' => '&subsub;', 'â«–' => '&supsup;', 'â«—' => '&suphsub;', 'â«˜' => '&supdsub;', 'â«™' => '&forkv;', 'â«š' => '&topfork;', 'â«›' => '&mlcp;', 'â«¤' => '&Dashv;', 'â«¦' => '&Vdashl;', 'â«§' => '&Barv;', 'â«¨' => '&vBar;', 'â«©' => '&vBarv;', 'â««' => '&Vbar;', 'â«¬' => '&Not;', 'â«­' => '&bNot;', 'â«®' => '&rnmid;', 'â«¯' => '&cirmid;', 'â«°' => '&midcir;', 'â«±' => '&topcir;', 'â«²' => '&nhpar;', 'â«³' => '&parsim;', 'â«½' => '&parsl;', 'â«½âƒ¥' => '&nparsl;', 'ï¬€' => '&fflig;', 'ï¬' => '&filig;', 'ï¬‚' => '&fllig;', 'ï¬ƒ' => '&ffilig;', 'ï¬„' => '&ffllig;', 'ð’œ' => '&Ascr;', 'ð’ž' => '&Cscr;', 'ð’Ÿ' => '&Dscr;', 'ð’¢' => '&Gscr;', 'ð’¥' => '&Jscr;', 'ð’¦' => '&Kscr;', 'ð’©' => '&Nscr;', 'ð’ª' => '&Oscr;', 'ð’«' => '&Pscr;', 'ð’¬' => '&Qscr;', 'ð’®' => '&Sscr;', 'ð’¯' => '&Tscr;', 'ð’°' => '&Uscr;', 'ð’±' => '&Vscr;', 'ð’²' => '&Wscr;', 'ð’³' => '&Xscr;', 'ð’´' => '&Yscr;', 'ð’µ' => '&Zscr;', 'ð’¶' => '&ascr;', 'ð’·' => '&bscr;', 'ð’¸' => '&cscr;', 'ð’¹' => '&dscr;', 'ð’»' => '&fscr;', 'ð’½' => '&hscr;', 'ð’¾' => '&iscr;', 'ð’¿' => '&jscr;', 'ð“€' => '&kscr;', 'ð“' => '&lscr;', 'ð“‚' => '&mscr;', 'ð“ƒ' => '&nscr;', 'ð“…' => '&pscr;', 'ð“†' => '&qscr;', 'ð“‡' => '&rscr;', 'ð“ˆ' => '&sscr;', 'ð“‰' => '&tscr;', 'ð“Š' => '&uscr;', 'ð“‹' => '&vscr;', 'ð“Œ' => '&wscr;', 'ð“' => '&xscr;', 'ð“Ž' => '&yscr;', 'ð“' => '&zscr;', 'ð”„' => '&Afr;', 'ð”…' => '&Bfr;', 'ð”‡' => '&Dfr;', 'ð”ˆ' => '&Efr;', 'ð”‰' => '&Ffr;', 'ð”Š' => '&Gfr;', 'ð”' => '&Jfr;', 'ð”Ž' => '&Kfr;', 'ð”' => '&Lfr;', 'ð”' => '&Mfr;', 'ð”‘' => '&Nfr;', 'ð”’' => '&Ofr;', 'ð”“' => '&Pfr;', 'ð””' => '&Qfr;', 'ð”–' => '&Sfr;', 'ð”—' => '&Tfr;', 'ð”˜' => '&Ufr;', 'ð”™' => '&Vfr;', 'ð”š' => '&Wfr;', 'ð”›' => '&Xfr;', 'ð”œ' => '&Yfr;', 'ð”ž' => '&afr;', 'ð”Ÿ' => '&bfr;', 'ð” ' => '&cfr;', 'ð”¡' => '&dfr;', 'ð”¢' => '&efr;', 'ð”£' => '&ffr;', 'ð”¤' => '&gfr;', 'ð”¥' => '&hfr;', 'ð”¦' => '&ifr;', 'ð”§' => '&jfr;', 'ð”¨' => '&kfr;', 'ð”©' => '&lfr;', 'ð”ª' => '&mfr;', 'ð”«' => '&nfr;', 'ð”¬' => '&ofr;', 'ð”­' => '&pfr;', 'ð”®' => '&qfr;', 'ð”¯' => '&rfr;', 'ð”°' => '&sfr;', 'ð”±' => '&tfr;', 'ð”²' => '&ufr;', 'ð”³' => '&vfr;', 'ð”´' => '&wfr;', 'ð”µ' => '&xfr;', 'ð”¶' => '&yfr;', 'ð”·' => '&zfr;', 'ð”¸' => '&Aopf;', 'ð”¹' => '&Bopf;', 'ð”»' => '&Dopf;', 'ð”¼' => '&Eopf;', 'ð”½' => '&Fopf;', 'ð”¾' => '&Gopf;', 'ð•€' => '&Iopf;', 'ð•' => '&Jopf;', 'ð•‚' => '&Kopf;', 'ð•ƒ' => '&Lopf;', 'ð•„' => '&Mopf;', 'ð•†' => '&Oopf;', 'ð•Š' => '&Sopf;', 'ð•‹' => '&Topf;', 'ð•Œ' => '&Uopf;', 'ð•' => '&Vopf;', 'ð•Ž' => '&Wopf;', 'ð•' => '&Xopf;', 'ð•' => '&Yopf;', 'ð•’' => '&aopf;', 'ð•“' => '&bopf;', 'ð•”' => '&copf;', 'ð••' => '&dopf;', 'ð•–' => '&eopf;', 'ð•—' => '&fopf;', 'ð•˜' => '&gopf;', 'ð•™' => '&hopf;', 'ð•š' => '&iopf;', 'ð•›' => '&jopf;', 'ð•œ' => '&kopf;', 'ð•' => '&lopf;', 'ð•ž' => '&mopf;', 'ð•Ÿ' => '&nopf;', 'ð• ' => '&oopf;', 'ð•¡' => '&popf;', 'ð•¢' => '&qopf;', 'ð•£' => '&ropf;', 'ð•¤' => '&sopf;', 'ð•¥' => '&topf;', 'ð•¦' => '&uopf;', 'ð•§' => '&vopf;', 'ð•¨' => '&wopf;', 'ð•©' => '&xopf;', 'ð•ª' => '&yopf;', 'ð•«' => '&zopf;', ]; private static $_never_allowed_regex = [ 'javascript\s*:', '(document|(document\.)?window)\.(location|on\w*)', 'jar\s*:', 'applescript\s*:', 'vbscript\s*:', 'wscript\s*:', 'jscript\s*:', 'vbs\s*:', 'behavior\s:', 'Redirect\s+30\d', "([\"'])?data\s*:[^\\1]*?base64[^\\1]*?,[^\\1]*?\\1?", '&\s*\{[^}]*(\}\s*;?|$)', 'expression\s*(\(|&\#40;)', 'mocha\s*:', 'livescript\s*:', 'view-source\s*:', ]; private static $_never_allowed_str_afterwards = [ 'FSCommand', 'onAbort', 'onActivate', 'onAttribute', 'onAfterPrint', 'onAfterScriptExecute', 'onAfterUpdate', 'onAnimationEnd', 'onAnimationIteration', 'onAnimationStart', 'onAriaRequest', 'onAutoComplete', 'onAutoCompleteError', 'onBeforeActivate', 'onBeforeCopy', 'onBeforeCut', 'onBeforeDeactivate', 'onBeforeEditFocus', 'onBeforePaste', 'onBeforePrint', 'onBeforeScriptExecute', 'onBeforeUnload', 'onBeforeUpdate', 'onBegin', 'onBlur', 'onBounce', 'onCancel', 'onCanPlay', 'onCanPlayThrough', 'onCellChange', 'onChange', 'onClick', 'onClose', 'onCommand', 'onCompassNeedsCalibration', 'onContextMenu', 'onControlSelect', 'onCopy', 'onCueChange', 'onCut', 'onDataAvailable', 'onDataSetChanged', 'onDataSetComplete', 'onDblClick', 'onDeactivate', 'onDeviceLight', 'onDeviceMotion', 'onDeviceOrientation', 'onDeviceProximity', 'onDrag', 'onDragDrop', 'onDragEnd', 'onDragEnter', 'onDragLeave', 'onDragOver', 'onDragStart', 'onDrop', 'onDurationChange', 'onEmptied', 'onEnd', 'onEnded', 'onError', 'onErrorUpdate', 'onExit', 'onFilterChange', 'onFinish', 'onFocus', 'onFocusIn', 'onFocusOut', 'onFormChange', 'onFormInput', 'onFullScreenChange', 'onFullScreenError', 'onGotPointerCapture', 'onHashChange', 'onHelp', 'onInput', 'onInvalid', 'onKeyDown', 'onKeyPress', 'onKeyUp', 'onLanguageChange', 'onLayoutComplete', 'onLoad', 'onLoadedData', 'onLoadedMetaData', 'onLoadStart', 'onLoseCapture', 'onLostPointerCapture', 'onMediaComplete', 'onMediaError', 'onMessage', 'onMouseDown', 'onMouseEnter', 'onMouseLeave', 'onMouseMove', 'onMouseOut', 'onMouseOver', 'onMouseUp', 'onMouseWheel', 'onMove', 'onMoveEnd', 'onMoveStart', 'onMozFullScreenChange', 'onMozFullScreenError', 'onMozPointerLockChange', 'onMozPointerLockError', 'onMsContentZoom', 'onMsFullScreenChange', 'onMsFullScreenError', 'onMsGestureChange', 'onMsGestureDoubleTap', 'onMsGestureEnd', 'onMsGestureHold', 'onMsGestureStart', 'onMsGestureTap', 'onMsGotPointerCapture', 'onMsInertiaStart', 'onMsLostPointerCapture', 'onMsManipulationStateChanged', 'onMsPointerCancel', 'onMsPointerDown', 'onMsPointerEnter', 'onMsPointerLeave', 'onMsPointerMove', 'onMsPointerOut', 'onMsPointerOver', 'onMsPointerUp', 'onMsSiteModeJumpListItemRemoved', 'onMsThumbnailClick', 'onOffline', 'onOnline', 'onOutOfSync', 'onPage', 'onPageHide', 'onPageShow', 'onPaste', 'onPause', 'onPlay', 'onPlaying', 'onPointerCancel', 'onPointerDown', 'onPointerEnter', 'onPointerLeave', 'onPointerLockChange', 'onPointerLockError', 'onPointerMove', 'onPointerOut', 'onPointerOver', 'onPointerUp', 'onPopState', 'onProgress', 'onPropertyChange', 'onRateChange', 'onReadyStateChange', 'onReceived', 'onRepeat', 'onReset', 'onResize', 'onResizeEnd', 'onResizeStart', 'onResume', 'onReverse', 'onRowDelete', 'onRowEnter', 'onRowExit', 'onRowInserted', 'onRowsDelete', 'onRowsEnter', 'onRowsExit', 'onRowsInserted', 'onScroll', 'onSearch', 'onSeek', 'onSeeked', 'onSeeking', 'onSelect', 'onSelectionChange', 'onSelectStart', 'onStalled', 'onStorage', 'onStorageCommit', 'onStart', 'onStop', 'onShow', 'onSyncRestored', 'onSubmit', 'onSuspend', 'onSynchRestored', 'onTimeError', 'onTimeUpdate', 'onTrackChange', 'onTransitionEnd', 'onToggle', 'onUnload', 'onURLFlip', 'onUserProximity', 'onVolumeChange', 'onWaiting', 'onWebKitAnimationEnd', 'onWebKitAnimationIteration', 'onWebKitAnimationStart', 'onWebKitFullScreenChange', 'onWebKitFullScreenError', 'onWebKitTransitionEnd', 'onWheel', 'ev:handler', 'ev:event', '0;url', ]; private $_evil_attributes = [ 'on\w*', 'style', 'xmlns', 'formaction', 'form', 'xlink:href', 'seekSegmentTime', 'userid', 'datasrc', 'datafld', 'dataformatas', 'FSCommand', ]; private $_evil_html_tags = [ 'applet', 'alert', 'audio', 'basefont', 'base', 'behavior', 'bgsound', 'blink', 'body', 'embed', 'eval', 'expression', 'form', 'frameset', 'frame', 'head', 'html', 'ilayer', 'iframe', 'input', 'button', 'select', 'isindex', 'layer', 'link', 'meta', 'keygen', 'object', 'plaintext', 'style', 'script', 'textarea', 'title', 'math', 'video', 'source', 'svg', 'xml', 'xss', ]; private $_xss_hash; private $_replacement = ''; private $_never_allowed_str = []; private $_stripe_4byte_chars = false; private $xss_found; public function __construct() { $this->_initNeverAllowedStr(); } private function _compact_exploded_words_callback($matches): string { return \preg_replace('/(?:\s+|"|\042|\'|\047|\+)*+/', '', $matches[1]) . $matches[2]; } private function _decode_entity(array $match): string { $this->_xss_hash(); $str = $match[0]; $str = (string)\preg_replace('|\?([a-z\_0-9\-]+)\=([a-z\_0-9\-/]+)|i', $this->_xss_hash . '::GET_FIRST' . '\\1=\\2', $str); $str = (string)\preg_replace('|\&([a-z\_0-9\-]+)\=([a-z\_0-9\-/]+)|i', $this->_xss_hash . '::GET_NEXT' . '\\1=\\2', $str); return \str_replace( [ $this->_xss_hash . '::GET_FIRST', $this->_xss_hash . '::GET_NEXT', ], [ '?', '&', ], $this->_entity_decode($str) ); } private function _do($str) { $str = (string)$str; $strInt = (int)$str; $strFloat = (float)$str; if ( !$str || "$strInt" == $str || "$strFloat" == $str ) { if ($this->xss_found !== true) { $this->xss_found = false; } return $str; } $str = UTF8::clean( $str, true, true, false, false, true, true ); $str = $this->_repack_utf7($str); $str = $this->_decode_string($str); if ($this->_stripe_4byte_chars === true) { $str = (string)\preg_replace('/[\x{10000}-\x{10FFFF}]/u', '', $str); } $str_backup = $str; $str = $this->_do_never_allowed($str); $str = $this->_compact_exploded_javascript($str); $str = $this->_remove_disallowed_javascript($str); $str = $this->_remove_evil_attributes($str); $str = $this->_sanitize_naughty_javascript($str); $str = $this->_sanitize_naughty_html($str); $str = $this->_do_never_allowed_afterwards($str); if ($this->xss_found !== true) { $this->xss_found = !($str_backup === $str); } return $str; } private function _do_never_allowed(string $str): string { static $NEVER_ALLOWED_CACHE = []; $NEVER_ALLOWED_CACHE['keys'] = null; $NEVER_ALLOWED_CACHE['regex'] = null; if (null === $NEVER_ALLOWED_CACHE['keys']) { $NEVER_ALLOWED_CACHE['keys'] = \array_keys($this->_never_allowed_str); } $str = \str_ireplace($NEVER_ALLOWED_CACHE['keys'], $this->_never_allowed_str, $str); if (null === $NEVER_ALLOWED_CACHE['regex']) { $NEVER_ALLOWED_CACHE['regex'] = \implode('|', self::$_never_allowed_regex); } $str = (string)\preg_replace('#' . $NEVER_ALLOWED_CACHE['regex'] . '#is', $this->_replacement, $str); return $str; } private function _do_never_allowed_afterwards(string $str): string { static $NEVER_ALLOWED_STR_AFTERWARDS_CACHE; if (null === $NEVER_ALLOWED_STR_AFTERWARDS_CACHE) { foreach (self::$_never_allowed_str_afterwards as &$neverAllowedStr) { $neverAllowedStr .= '.*='; } unset($neverAllowedStr); $NEVER_ALLOWED_STR_AFTERWARDS_CACHE = \implode('|', self::$_never_allowed_str_afterwards); } $str = (string)\preg_replace('#' . $NEVER_ALLOWED_STR_AFTERWARDS_CACHE . '#isU', $this->_replacement, $str); return $str; } private function _entity_decode(string $str): string { static $HTML_ENTITIES_CACHE; $flags = ENT_QUOTES | ENT_HTML5 | ENT_DISALLOWED | ENT_SUBSTITUTE; if (strpos($str, $this->_xss_hash) !== false) { $str = UTF8::html_entity_decode($str, $flags); } else { $str = UTF8::rawurldecode($str); } if (preg_match_all('/&[A-Za-z]{2,}[;]{0}/', $str, $matches)) { if (null === $HTML_ENTITIES_CACHE) { $entitiesSecurity = [ '&#x00000;' => '', '&#0;' => '', '&#x00001;' => '', '&#1;' => '', '&nvgt;' => '', '&#61253;' => '', '&#x0EF45;' => '', '&shy;' => '', '&#x000AD;' => '', '&#173;' => '', '&colon;' => ':', '&#x0003A;' => ':', '&#58;' => ':', '&lpar;' => '(', '&#x00028;' => '(', '&#40;' => '(', '&rpar;' => ')', '&#x00029;' => ')', '&#41;' => ')', '&quest;' => '?', '&#x0003F;' => '?', '&#63;' => '?', '&sol;' => '/', '&#x0002F;' => '/', '&#47;' => '/', '&apos;' => '\'', '&#x00027;' => '\'', '&#039;' => '\'', '&#39;' => '\'', '&#x27;' => '\'', '&bsol;' => '\'', '&#x0005C;' => '\\', '&#92;' => '\\', '&comma;' => ',', '&#x0002C;' => ',', '&#44;' => ',', '&period;' => '.', '&#x0002E;' => '.', '&quot;' => '"', '&QUOT;' => '"', '&#x00022;' => '"', '&#34;' => '"', '&grave;' => '`', '&DiacriticalGrave;' => '`', '&#x00060;' => '`', '&#96;' => '`', '&#46;' => '.', '&equals;' => '=', '&#x0003D;' => '=', '&#61;' => '=', '&newline;' => "\n", '&#x0000A;' => "\n", '&#10;' => "\n", '&tab;' => "\t", '&#x00009;' => "\t", '&#9;' => "\t", ]; $HTML_ENTITIES_CACHE = \array_merge( $entitiesSecurity, \array_flip(\get_html_translation_table(HTML_ENTITIES, $flags)), \array_flip(self::$entitiesFallback) ); } $replace = []; foreach ($matches[0] as $match) { $match .= ';'; if (isset($HTML_ENTITIES_CACHE[$match])) { $replace[$match] = $HTML_ENTITIES_CACHE[$match]; } } if (\count($replace) > 0) { $str = \str_replace(\array_keys($replace), \array_values($replace), $str); } } return $str; } private function _filter_attributes(string $str): string { if ($str === '') { return ''; } $out = ''; if ( \preg_match_all('#\s*[A-Za-z\-]+\s*=\s*("|\042|\'|\047)([^\\1]*?)\\1#', $str, $matches) || ( $this->_replacement && \preg_match_all('#\s*[a-zA-Z\-]+\s*=' . \preg_quote($this->_replacement, '#') . '$#', $str, $matches) ) ) { foreach ($matches[0] as $match) { $out .= $match; } } return $out; } private function _initNeverAllowedStr() { $this->_never_allowed_str = [ 'document.cookie' => $this->_replacement, 'document.write' => $this->_replacement, '.parentNode' => $this->_replacement, '.innerHTML' => $this->_replacement, '.appendChild' => $this->_replacement, '-moz-binding' => $this->_replacement, '<!--' => '&lt;!--', '-->' => '--&gt;', '<?' => '&lt;?', '?>' => '?&gt;', '<![CDATA[' => '&lt;![CDATA[', '<!ENTITY' => '&lt;!ENTITY', '<!DOCTYPE' => '&lt;!DOCTYPE', '<!ATTLIST' => '&lt;!ATTLIST', ]; } private function _js_link_removal_callback(array $match): string { return $this->_js_removal_callback($match, 'href'); } private function _js_removal_callback(array $match, string $search): string { if (!$match[0]) { return ''; } $replacer = $this->_filter_attributes(\str_replace(['<', '>',], '', $match[1])); $pattern = '#' . $search . '=.*(?:\(.+([^\)]*?)(?:\)|$)|javascript:|view-source:|livescript:|wscript:|vbscript:|mocha:|charset=|window\.|document\.|\.cookie|<script|d\s*a\s*t\s*a\s*:)#is'; $matchInner = []; \preg_match($pattern, $match[1], $matchInner); if (\count($matchInner) > 0) { $replacer = (string)\preg_replace( $pattern, $search . '="' . $this->_replacement . '"', $replacer ); } return \str_ireplace($match[1], $replacer, $match[0]); } private function _js_src_removal_callback(array $match): string { return $this->_js_removal_callback($match, 'src'); } private function _sanitize_naughty_html_callback(array $matches): string { return '&lt;' . $matches[1] . $matches[2] . $matches[3] . \str_replace( [ '>', '<', ], [ '&gt;', '&lt;', ], $matches[4] ); } public function addEvilAttributes(array $strings) { $this->_evil_attributes = \array_merge($strings, $this->_evil_attributes); return $this; } public function addEvilHtmlTags(array $strings) { $this->_evil_html_tags = \array_merge($strings, $this->_evil_html_tags); return $this; } private function _compact_exploded_javascript(string $str): string { static $WORDS_CACHE; $words = [ 'javascript', 'expression', 'view-source', 'vbscript', 'jscript', 'wscript', 'vbs', 'script', 'base64', 'applet', 'alert', 'document', 'write', 'cookie', 'window', 'confirm', 'prompt', 'eval', ]; foreach ($words as $word) { if (!isset($WORDS_CACHE[$word])) { $regex = '(?:\s|\+|"|\042|\'|\047)*'; $word = $WORDS_CACHE[$word] = \substr( \chunk_split($word, 1, $regex), 0, -\strlen($regex) ); } else { $word = $WORDS_CACHE[$word]; } $str = (string)\preg_replace_callback( '#(' . $word . ')(\W)#is', [ $this, '_compact_exploded_words_callback', ], $str ); } return $str; } private function _decode_string(string $str): string { $regExForHtmlTags = '/<\w+.*+/si'; if (\preg_match($regExForHtmlTags, $str, $matches) === 1) { $str = (string)\preg_replace_callback( $regExForHtmlTags, [ $this, '_decode_entity', ], $str ); } else { $str = UTF8::rawurldecode($str); } return $str; } public function isXssFound() { return $this->xss_found; } public function removeEvilAttributes(array $strings) { $this->_evil_attributes = \array_diff( $this->_evil_attributes, \array_intersect($strings, $this->_evil_attributes) ); return $this; } public function removeEvilHtmlTags(array $strings) { $this->_evil_html_tags = \array_diff( $this->_evil_html_tags, \array_intersect($strings, $this->_evil_html_tags) ); return $this; } private function _remove_disallowed_javascript($str): string { do { $original = $str; if (\stripos($str, '<a') !== false) { $str = (string)\preg_replace_callback( '#<a[^a-z0-9>]+([^>]*?)(?:>|$)#i', [ $this, '_js_link_removal_callback', ], $str ); } if (\stripos($str, '<img') !== false) { $str = (string)\preg_replace_callback( '#<img[^a-z0-9]+([^>]*?)(?:\s?/?>|$)#i', [ $this, '_js_src_removal_callback', ], $str ); } if (\stripos($str, '<audio') !== false) { $str = (string)\preg_replace_callback( '#<audio[^a-z0-9]+([^>]*?)(?:\s?/?>|$)#i', [ $this, '_js_src_removal_callback', ], $str ); } if (\stripos($str, '<video') !== false) { $str = (string)\preg_replace_callback( '#<video[^a-z0-9]+([^>]*?)(?:\s?/?>|$)#i', [ $this, '_js_src_removal_callback', ], $str ); } if (\stripos($str, '<source') !== false) { $str = (string)\preg_replace_callback( '#<source[^a-z0-9]+([^>]*?)(?:\s?/?>|$)#i', [ $this, '_js_src_removal_callback', ], $str ); } if (\stripos($str, 'script') !== false) { $str = (string)\preg_replace('#(?:Â¼|<)/*(?:script).*(?:Â¾|>)#isuU', $this->_replacement, $str); } } while ($original !== $str); return (string)$str; } private function _remove_evil_attributes($str): string { if (\in_array('style', $this->_evil_attributes, true)) { do { $count = $temp_count = 0; $str = (string)\preg_replace( '/(<[^>]+)(?<!\w)(style\s*=\s*"(:?[^"]*?)"|style\s*=\s*\'(:?[^\']*?)\')/i', '$1' . $this->_replacement, $str, -1, $temp_count ); $count += $temp_count; } while ($count); } $evil_attributes_string = \implode('|', $this->_evil_attributes); do { $count = $temp_count = 0; $str = (string)\preg_replace( '/(.*)((?:<[^>]+)(?<!\w))(?:' . $evil_attributes_string . ')(?:\s*=\s*)(?:(?:\'|\047)(?:.*?)(?:\'|\047)|(?:"|\042)(?:.*?)(?:"|\042))(.*)/is', '$1$2' . $this->_replacement . '$3$4', $str, -1, $temp_count ); $count += $temp_count; $str = (string)\preg_replace( '/(.*)(<[^>]+)(?<!\w)(?:' . $evil_attributes_string . ')\s*=\s*(?:[^\s>]*)(.*)/is', '$1$2' . $this->_replacement . '$3', $str, -1, $temp_count ); $count += $temp_count; } while ($count); return (string)$str; } private function _repack_utf7($str): string { return \preg_replace_callback( '#\+([0-9a-zA-Z/]+)\-#', [$this, '_repack_utf7_callback'], $str ); } private function _repack_utf7_callback($str): string { $strTmp = \base64_decode($str[1]); if ($strTmp === false) { return $str; } $str = (string)\preg_replace_callback( '/^((?:\x00.)*?)((?:[^\x00].)+)/us', [$this, '_repack_utf7_callback_back'], $strTmp ); return \preg_replace('/\x00(.)/us', '$1', $str); } private function _repack_utf7_callback_back($str): string { return $str[1] . '+' . \rtrim(\base64_encode($str[2]), '=') . '-'; } private function _sanitize_naughty_html($str): string { $evil_html_tags = \implode('|', $this->_evil_html_tags); $str = (string)\preg_replace_callback( '#<(/*\s*)(' . $evil_html_tags . ')([^><]*)([><]*)#i', [ $this, '_sanitize_naughty_html_callback', ], $str ); return (string)$str; } private function _sanitize_naughty_javascript($str): string { $str = (string)\preg_replace( '#(alert|eval|prompt|confirm|cmd|passthru|eval|exec|expression|system|fopen|fsockopen|file|file_get_contents|readfile|unlink)(\s*)\((.*)\)#siU', '\\1\\2&#40;\\3&#41;', $str ); return (string)$str; } public function setReplacement($string) { $this->_replacement = (string)$string; $this->_initNeverAllowedStr(); return $this; } public function setStripe4byteChars($bool) { $this->_stripe_4byte_chars = (bool)$bool; return $this; } public function xss_clean($str) { $this->xss_found = null; if (\is_array($str) === true) { foreach ($str as $key => &$value) { $str[$key] = $this->xss_clean($value); } return $str; } do { $old_str = $str; $str = $this->_do($str); } while ($old_str !== $str); return $str; } private function _xss_hash(): string { if ($this->_xss_hash === null) { $rand = Bootup::get_random_bytes(16); if (!$rand) { $this->_xss_hash = \md5(\uniqid(\mt_rand(), true)); } else { $this->_xss_hash = \bin2hex($rand); } } return 'voku::anti-xss::' . $this->_xss_hash; } } 