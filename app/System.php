<?php
namespace App; use Illuminate\Database\Eloquent\Model; use Illuminate\Support\Facades\Cache; use Illuminate\Support\Facades\Log; class System extends Model { protected $guarded = array(); private static $systems = array(); public static function _init() { static::$systems = Cache::remember('settings.all', 10, function () { $sp01b2d5 = self::query()->get()->toArray(); foreach ($sp01b2d5 as $spc43fbc) { static::$systems[$spc43fbc['name']] = $spc43fbc['value']; } return static::$systems; }); static::$systems['_initialized'] = true; } public static function _get($spd7c47a, $sp1682d6 = NULL) { if (!isset(static::$systems['_initialized'])) { static::_init(); } if (isset(static::$systems[$spd7c47a])) { return static::$systems[$spd7c47a]; } return $sp1682d6; } public static function _getInt($spd7c47a, $sp1682d6 = NULL) { return (int) static::_get($spd7c47a, $sp1682d6); } public static function _set($spd7c47a, $sp849ede) { static::$systems[$spd7c47a] = $sp849ede; $sp849136 = System::query()->where('name', $spd7c47a)->first(); if ($sp849136) { $sp849136->value = $sp849ede; $sp849136->save(); } else { try { System::query()->create(array('name' => $spd7c47a, 'value' => $sp849ede)); } catch (\Exception $spd3b3eb) { } } self::flushCache(); } public static function flushCache() { Cache::forget('settings.all'); } protected static function boot() { parent::boot(); static::updated(function () { self::flushCache(); }); static::created(function () { self::flushCache(); }); static::deleted(function () { self::flushCache(); }); } }