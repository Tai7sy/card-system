<?php
namespace App\Library\Pay\JCBPay; use App\Library\CurlRequest; use App\Library\Helper; use App\Library\Pay\ApiInterface; use Illuminate\Support\Facades\Log; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; public function __construct($spe00284) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $spe00284; $this->url_return = SYS_URL . '/pay/return/' . $spe00284; } function goPay($spc27de0, $spba04f6, $sp9f49de, $sp224c81, $sp6956b3) { if (!isset($spc27de0['url'])) { throw new \Exception('请填写支付网页 [url]'); } if (!isset($spc27de0['app_id'])) { throw new \Exception('请填写APPID [app_id]'); } if (!isset($spc27de0['app_key'])) { throw new \Exception('请填写APPKEY [app_key]'); } if (!isset($spc27de0['key'])) { throw new \Exception('请填写接口key [key]'); } if (!isset($spc27de0['md5key'])) { throw new \Exception('请填写校验key [md5key]'); } header('Location: ' . $spc27de0['url'] . '/pay/pay.php?appid=' . $spc27de0['app_id'] . '&payno=' . $spba04f6 . '&typ=' . $spc27de0['payway'] . '&money=' . sprintf('%.2f', $sp6956b3 / 100) . '&back_url=' . $this->url_return); die; } function verify($spc27de0, $sp4294a3) { $spb2acff = isset($spc27de0['isNotify']) && $spc27de0['isNotify']; if ($spb2acff) { $sp3ab68a = $_REQUEST['key']; $spb428f9 = $_REQUEST['tno']; $sp4b7093 = $_REQUEST['payno']; $sp49ac38 = $_REQUEST['money']; $sp75e4cc = $_REQUEST['sign']; $spc82866 = (int) $_REQUEST['typ']; if ($spc82866 == 1) { $sp0631f3 = '手工充值'; } else { if ($spc82866 == 2) { $sp0631f3 = '支付宝充值'; } else { if ($spc82866 == 3) { $sp0631f3 = '财付通充值'; } else { if ($spc82866 == 4) { $sp0631f3 = '手Q充值'; } else { if ($spc82866 == 5) { $sp0631f3 = '微信充值'; } } } } } if (!$spb428f9) { die('没有订单号'); } if (!$sp4b7093) { die('没有付款说明'); } if ($sp3ab68a !== $spc27de0['key']) { die('KEY错误'); } if (strtoupper($sp75e4cc) !== strtoupper(md5($spb428f9 . $sp4b7093 . $sp49ac38 . $spc27de0['md5key']))) { die('签名错误'); } $sp4294a3($sp4b7093, (int) round($sp49ac38 * 100), $spb428f9); die('1'); } else { if (isset($spc27de0['out_trade_no']) && $spc27de0['out_trade_no']) { return false; } if (!isset($_REQUEST['appid']) || !isset($_REQUEST['tno']) || !isset($_REQUEST['payno']) || !isset($_REQUEST['money']) || !isset($_REQUEST['typ']) || !isset($_REQUEST['paytime']) || !isset($_REQUEST['sign'])) { return false; } $sp1e31b3 = (int) $_REQUEST['appid']; $spb428f9 = $_REQUEST['tno']; $sp4b7093 = $_REQUEST['payno']; $sp49ac38 = $_REQUEST['money']; $spc82866 = (int) $_REQUEST['typ']; $spbd18c0 = $_REQUEST['paytime']; $sp75e4cc = $_REQUEST['sign']; if (!$sp1e31b3 || !$spb428f9 || !$sp4b7093 || !$sp49ac38 || !$spc82866 || !$spbd18c0 || !$sp75e4cc) { die('参数错误'); } if ($spc27de0['app_id'] != $sp1e31b3) { die('appid error'); } if ($sp75e4cc != md5($sp1e31b3 . '|' . $spc27de0['app_key'] . '|' . $spb428f9 . '|' . $sp4b7093 . '|' . $sp49ac38 . '|' . $spbd18c0 . '|' . $spc82866)) { die('签名错误'); } if ($spc82866 == 1) { $sp0631f3 = '手工充值'; } else { if ($spc82866 == 2) { $sp0631f3 = '支付宝充值'; } else { if ($spc82866 == 3) { $sp0631f3 = '财付通充值'; } else { if ($spc82866 == 4) { $sp0631f3 = '手Q充值'; } else { if ($spc82866 == 5) { $sp0631f3 = '微信充值'; } } } } } $sp4294a3($sp4b7093, (int) round($sp49ac38 * 100), $spb428f9); return true; } } }