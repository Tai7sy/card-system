<?php
namespace App\Library\Pay\Yeke; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; public function __construct($sp3c46ab) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $sp3c46ab; $this->url_return = SYS_URL . '/pay/return/' . $sp3c46ab; } function goPay($sp9d4382, $sp2e47fc, $spd4e90d, $spd0789a, $sp076ec7) { $spf59c91 = sprintf('%.2f', $sp076ec7 / 100); define('yeke_USER_ID', $sp9d4382['id']); define('yeke_USER_KEY', $sp9d4382['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); $spf9ad85 = strtolower($sp9d4382['payway']); $sp257b4f = ''; $spcb9ea8 = ''; if ($spf9ad85 == 'alipay' || $spf9ad85 == 'alipay_wap') { $sp257b4f = 'alipay'; $spcb9ea8 = 'ALIPAY'; } elseif ($spf9ad85 == 'tenpay' || $spf9ad85 == 'tenpay_wap') { $sp257b4f = 'tenpay'; $spcb9ea8 = 'TENPAY'; } elseif ($spf9ad85 == 'weixin') { $sp257b4f = 'weixin'; $spcb9ea8 = 'WEIXIN'; } elseif ($spf9ad85 == 'weixin_wap') { $sp257b4f = 'wxwap'; $spcb9ea8 = 'wxwap'; } elseif ($spf9ad85 == 'qq' || $spf9ad85 == 'qq_wap') { $sp257b4f = 'sqzf'; $spcb9ea8 = 'sqzf'; } elseif ($spf9ad85 == 'qq_wap') { $sp257b4f = 'sqzfqb'; $spcb9ea8 = 'sqzfqb'; } require 'yekeApiLib.php'; require 'HttpClient.php'; $spd4e90d = mb_substr($spd4e90d, 0, 50, 'UTF-8'); $spd0789a = mb_substr($spd0789a, 0, 100, 'UTF-8'); $spc0e525 = array('P_orderid' => $sp2e47fc, 'P_paymoney' => $spf59c91, 'P_productname' => urlencode($spd4e90d), 'P_productinfo' => urlencode($spd0789a), 'P_remark' => urlencode($sp2e47fc), 'P_custom_1' => urlencode($spcb9ea8), 'P_custom_2' => '', 'P_contact' => urlencode(SYS_NAME), 'P_paytype' => $sp257b4f, 'P_gateway' => $spcb9ea8, 'P_cardnum' => '', 'P_cardpwd' => '', 'P_cardvalue' => '', 'P_notify_url' => $this->url_notify, 'P_return_url' => $this->url_return . '/' . $sp2e47fc); $sp618c34 = new \yekeAPI(); $spb72f32 = $sp618c34->payGate($spc0e525); echo $spb72f32; } function verify($sp9d4382, $sp9a4d97) { $sp7b2182 = isset($sp9d4382['isNotify']) && $sp9d4382['isNotify']; define('yeke_USER_ID', $sp9d4382['id']); define('yeke_USER_KEY', $sp9d4382['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); require 'HttpClient.php'; require 'yekeApiLib.php'; $sp618c34 = new \yekeAPI(); if ($sp7b2182) { $spb72f32 = $sp618c34->verifyNotify(); } else { $spb72f32 = $sp618c34->verifyReturn(); } if ($spb72f32) { $spc48a4d = $_REQUEST['P_orderid']; $spd194fa = $_REQUEST['P_api_orderid']; $sp5a0851 = $_REQUEST['P_money']; if ($_REQUEST['P_status'] == 'SUCCESS') { $sp9a4d97($spd194fa, (int) round($sp5a0851 * 100), $spc48a4d); if ($sp7b2182) { echo 'success'; } return true; } else { if ($sp7b2182) { echo '失败订单'; } } } else { if ($sp7b2182) { echo '验证失败'; } } return false; } }