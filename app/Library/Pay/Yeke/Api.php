<?php
namespace App\Library\Pay\Yeke; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; public function __construct($sp53f8aa) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $sp53f8aa; $this->url_return = SYS_URL . '/pay/return/' . $sp53f8aa; } function goPay($spbe80b7, $spa3e681, $sp45f07e, $sp873488, $sp5213ee) { $sp429fcc = sprintf('%.2f', $sp5213ee / 100); define('yeke_USER_ID', $spbe80b7['id']); define('yeke_USER_KEY', $spbe80b7['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); $sp908e43 = strtolower($spbe80b7['payway']); $sp08d91e = ''; $sp3ab55a = ''; if ($sp908e43 == 'alipay' || $sp908e43 == 'alipay_wap') { $sp08d91e = 'alipay'; $sp3ab55a = 'ALIPAY'; } elseif ($sp908e43 == 'tenpay' || $sp908e43 == 'tenpay_wap') { $sp08d91e = 'tenpay'; $sp3ab55a = 'TENPAY'; } elseif ($sp908e43 == 'weixin') { $sp08d91e = 'weixin'; $sp3ab55a = 'WEIXIN'; } elseif ($sp908e43 == 'weixin_wap') { $sp08d91e = 'wxwap'; $sp3ab55a = 'wxwap'; } elseif ($sp908e43 == 'qq' || $sp908e43 == 'qq_wap') { $sp08d91e = 'sqzf'; $sp3ab55a = 'sqzf'; } elseif ($sp908e43 == 'qq_wap') { $sp08d91e = 'sqzfqb'; $sp3ab55a = 'sqzfqb'; } require 'yekeApiLib.php'; require 'HttpClient.php'; $sp45f07e = mb_substr($sp45f07e, 0, 50, 'UTF-8'); $sp873488 = mb_substr($sp873488, 0, 100, 'UTF-8'); $spa26894 = array('P_orderid' => $spa3e681, 'P_paymoney' => $sp429fcc, 'P_productname' => urlencode($sp45f07e), 'P_productinfo' => urlencode($sp873488), 'P_remark' => urlencode($spa3e681), 'P_custom_1' => urlencode($sp3ab55a), 'P_custom_2' => '', 'P_contact' => urlencode(SYS_NAME), 'P_paytype' => $sp08d91e, 'P_gateway' => $sp3ab55a, 'P_cardnum' => '', 'P_cardpwd' => '', 'P_cardvalue' => '', 'P_notify_url' => $this->url_notify, 'P_return_url' => $this->url_return . '/' . $spa3e681); $spb06608 = new \yekeAPI(); $spbbda25 = $spb06608->payGate($spa26894); echo $spbbda25; } function verify($spbe80b7, $sp04f0f8) { $sp3bce01 = isset($spbe80b7['isNotify']) && $spbe80b7['isNotify']; define('yeke_USER_ID', $spbe80b7['id']); define('yeke_USER_KEY', $spbe80b7['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); require 'HttpClient.php'; require 'yekeApiLib.php'; $spb06608 = new \yekeAPI(); if ($sp3bce01) { $spbbda25 = $spb06608->verifyNotify(); } else { $spbbda25 = $spb06608->verifyReturn(); } if ($spbbda25) { $spe908b7 = $_REQUEST['P_orderid']; $spea6909 = $_REQUEST['P_api_orderid']; $sp6a858b = $_REQUEST['P_money']; if ($_REQUEST['P_status'] == 'SUCCESS') { $sp04f0f8($spea6909, (int) round($sp6a858b * 100), $spe908b7); if ($sp3bce01) { echo 'success'; } return true; } else { if ($sp3bce01) { echo '失败订单'; } } } else { if ($sp3bce01) { echo '验证失败'; } } return false; } }