<?php
namespace App\Library\Pay\Fakala; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; private $pay_id; public function __construct($sp53f8aa) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $sp53f8aa; $this->url_return = SYS_URL . '/pay/return/' . $sp53f8aa; $this->pay_id = $sp53f8aa; } function goPay($spbe80b7, $spa3e681, $sp45f07e, $sp873488, $sp5213ee) { if (!isset($spbe80b7['gateway'])) { throw new \Exception('请填写gateway'); } if (!isset($spbe80b7['api_id'])) { throw new \Exception('请填写api_id'); } if (!isset($spbe80b7['api_key'])) { throw new \Exception('请填写api_key'); } include_once 'sdk.php'; $sp1ffdf9 = new \fakala($spbe80b7['gateway'], $spbe80b7['api_id'], $spbe80b7['api_key']); $spdc9a36 = strtolower($spbe80b7['payway']); $sp1ffdf9->goPay($spdc9a36, $sp45f07e, $spa3e681, 0, $sp5213ee, '', $this->url_return, $this->url_notify); } function verify($spbe80b7, $sp04f0f8) { $sp3bce01 = isset($spbe80b7['isNotify']) && $spbe80b7['isNotify']; include_once 'sdk.php'; $sp1ffdf9 = new \fakala($spbe80b7['gateway'], $spbe80b7['api_id'], $spbe80b7['api_key']); if ($sp3bce01) { $spbbda25 = $sp1ffdf9->notify_verify(); $spa3e681 = $_POST['out_trade_no']; $sp9624ba = $_POST['total_fee']; $sped7673 = $_POST['order_no']; } else { if (empty($spbe80b7['out_trade_no'])) { $spbbda25 = $sp1ffdf9->return_verify(); $spa3e681 = $_GET['out_trade_no']; $sp9624ba = $_GET['total_fee']; $sped7673 = $_GET['order_no']; } else { $sp4f4c0d = @$sp1ffdf9->get_order($spbe80b7['out_trade_no']); if (empty($sp4f4c0d['status'])) { return false; } $spbbda25 = @$sp4f4c0d['status'] === 2; $spa3e681 = $sp4f4c0d['api_out_no']; $sp9624ba = $sp4f4c0d['paid']; $sped7673 = $sp4f4c0d['order_no']; } } if ($spbbda25) { $sp04f0f8($spa3e681, $sp9624ba, $sped7673); } return $spbbda25; } }