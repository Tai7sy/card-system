<?php
namespace App\Library\Pay\Fakala; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; private $pay_id; public function __construct($spe00284) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $spe00284; $this->url_return = SYS_URL . '/pay/return/' . $spe00284; $this->pay_id = $spe00284; } function goPay($spc27de0, $spba04f6, $sp9f49de, $sp224c81, $sp6956b3) { if (!isset($spc27de0['gateway'])) { throw new \Exception('请填写gateway'); } if (!isset($spc27de0['api_id'])) { throw new \Exception('请填写api_id'); } if (!isset($spc27de0['api_key'])) { throw new \Exception('请填写api_key'); } include_once 'sdk.php'; $spf7d22d = new \fakala($spc27de0['gateway'], $spc27de0['api_id'], $spc27de0['api_key']); $spd53b1c = strtolower($spc27de0['payway']); $spf7d22d->goPay($spd53b1c, $sp9f49de, $spba04f6, 0, $sp6956b3, '', $this->url_return, $this->url_notify); } function verify($spc27de0, $sp4294a3) { $spb2acff = isset($spc27de0['isNotify']) && $spc27de0['isNotify']; include_once 'sdk.php'; $spf7d22d = new \fakala($spc27de0['gateway'], $spc27de0['api_id'], $spc27de0['api_key']); if ($spb2acff) { $spb34b01 = $spf7d22d->notify_verify(); } else { $spb34b01 = $spf7d22d->return_verify(); } if ($spb34b01) { $spba04f6 = $_REQUEST['out_trade_no']; $sp36f78e = $_REQUEST['total_fee']; $spd4a405 = $_REQUEST['order_no']; $sp4294a3($spba04f6, $sp36f78e, $spd4a405); } return $spb34b01; } }