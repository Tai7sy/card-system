<?php
namespace App\Library\Pay\Fakala; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; private $pay_id; public function __construct($sp3c46ab) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $sp3c46ab; $this->url_return = SYS_URL . '/pay/return/' . $sp3c46ab; $this->pay_id = $sp3c46ab; } function goPay($sp9d4382, $sp2e47fc, $spd4e90d, $spd0789a, $sp076ec7) { if (!isset($sp9d4382['gateway'])) { throw new \Exception('请填写gateway'); } if (!isset($sp9d4382['api_id'])) { throw new \Exception('请填写api_id'); } if (!isset($sp9d4382['api_key'])) { throw new \Exception('请填写api_key'); } include_once 'sdk.php'; $spb42e2c = new \fakala($sp9d4382['gateway'], $sp9d4382['api_id'], $sp9d4382['api_key']); $spf9ca0c = strtolower($sp9d4382['payway']); $spb42e2c->goPay($spf9ca0c, $spd4e90d, $sp2e47fc, 0, $sp076ec7, '', $this->url_return, $this->url_notify); } function verify($sp9d4382, $sp9a4d97) { $sp7b2182 = isset($sp9d4382['isNotify']) && $sp9d4382['isNotify']; include_once 'sdk.php'; $spb42e2c = new \fakala($sp9d4382['gateway'], $sp9d4382['api_id'], $sp9d4382['api_key']); if ($sp7b2182) { $spb72f32 = $spb42e2c->notify_verify(); $sp2e47fc = $_POST['out_trade_no']; $spc686cf = $_POST['total_fee']; $sp93309f = $_POST['order_no']; } else { if (empty($sp9d4382['out_trade_no'])) { $spb72f32 = $spb42e2c->return_verify(); $sp2e47fc = $_GET['out_trade_no']; $spc686cf = $_GET['total_fee']; $sp93309f = $_GET['order_no']; } else { $spe0613f = @$spb42e2c->get_order($sp9d4382['out_trade_no']); if (empty($spe0613f['status'])) { return false; } $spb72f32 = @$spe0613f['status'] === 2; $sp2e47fc = $spe0613f['api_out_no']; $spc686cf = $spe0613f['paid']; $sp93309f = $spe0613f['order_no']; } } if ($spb72f32) { $sp9a4d97($sp2e47fc, $spc686cf, $sp93309f); } return $spb72f32; } }