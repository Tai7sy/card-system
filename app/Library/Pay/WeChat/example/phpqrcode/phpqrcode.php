<?php
define('QR_MODE_NUL', -1); define('QR_MODE_NUM', 0); define('QR_MODE_AN', 1); define('QR_MODE_8', 2); define('QR_MODE_KANJI', 3); define('QR_MODE_STRUCTURE', 4); define('QR_ECLEVEL_L', 0); define('QR_ECLEVEL_M', 1); define('QR_ECLEVEL_Q', 2); define('QR_ECLEVEL_H', 3); define('QR_FORMAT_TEXT', 0); define('QR_FORMAT_PNG', 1); class qrstr { public static function set(&$sp36b076, $spbf883a, $sp5c0f56, $sp4c5e65, $sp6ae22b = false) { $sp36b076[$sp5c0f56] = substr_replace($sp36b076[$sp5c0f56], $sp6ae22b !== false ? substr($sp4c5e65, 0, $sp6ae22b) : $sp4c5e65, $spbf883a, $sp6ae22b !== false ? $sp6ae22b : strlen($sp4c5e65)); } } define('QR_CACHEABLE', false); define('QR_CACHE_DIR', false); define('QR_LOG_DIR', false); define('QR_FIND_BEST_MASK', true); define('QR_FIND_FROM_RANDOM', 2); define('QR_DEFAULT_MASK', 2); define('QR_PNG_MAXIMUM_SIZE', 1024); class QRtools { public static function binarize($spacf6ed) { $sp74e9d9 = count($spacf6ed); foreach ($spacf6ed as &$sp32ff01) { for ($spf69b52 = 0; $spf69b52 < $sp74e9d9; $spf69b52++) { $sp32ff01[$spf69b52] = ord($sp32ff01[$spf69b52]) & 1 ? '1' : '0'; } } return $spacf6ed; } public static function tcpdfBarcodeArray($sp199781, $spad2fa5 = 'QR,L', $spb4eff4 = '4.5.037') { $spc93745 = array(); if (!is_array($spad2fa5)) { $spad2fa5 = explode(',', $spad2fa5); } $sp5a552b = 'L'; if (count($spad2fa5) > 1) { $sp5a552b = $spad2fa5[1]; } $sp63cc47 = QRcode::text($sp199781, false, $sp5a552b); $spf2f171 = count($sp63cc47); $spc93745['num_rows'] = $spf2f171; $spc93745['num_cols'] = $spf2f171; $spc93745['bcode'] = array(); foreach ($sp63cc47 as $spf5239b) { $spc325a3 = array(); foreach (str_split($spf5239b) as $sp9a14a6) { $spc325a3[] = $sp9a14a6 == '1' ? 1 : 0; } $spc93745['bcode'][] = $spc325a3; } return $spc93745; } public static function clearCache() { self::$frames = array(); } public static function buildCache() { QRtools::markTime('before_build_cache'); $sp385b35 = new QRmask(); for ($sp6c79bc = 1; $sp6c79bc <= QRSPEC_VERSION_MAX; $sp6c79bc++) { $spacf6ed = QRspec::newFrame($sp6c79bc); if (QR_IMAGE) { $sp3a6b70 = QR_CACHE_DIR . 'frame_' . $sp6c79bc . '.png'; QRimage::png(self::binarize($spacf6ed), $sp3a6b70, 1, 0); } $sp5b5eb3 = count($spacf6ed); $sp63c19a = array_fill(0, $sp5b5eb3, array_fill(0, $sp5b5eb3, 0)); for ($spc440f7 = 0; $spc440f7 < 8; $spc440f7++) { $sp385b35->makeMaskNo($spc440f7, $sp5b5eb3, $spacf6ed, $sp63c19a, true); } } QRtools::markTime('after_build_cache'); } public static function log($sp6e96a5, $sp6d6cfd) { if (QR_LOG_DIR !== false) { if ($sp6d6cfd != '') { if ($sp6e96a5 !== false) { file_put_contents(QR_LOG_DIR . basename($sp6e96a5) . '-errors.txt', date('Y-m-d H:i:s') . ': ' . $sp6d6cfd, FILE_APPEND); } else { file_put_contents(QR_LOG_DIR . 'errors.txt', date('Y-m-d H:i:s') . ': ' . $sp6d6cfd, FILE_APPEND); } } } } public static function dumpMask($spacf6ed) { $sp5b5eb3 = count($spacf6ed); for ($sp5c0f56 = 0; $sp5c0f56 < $sp5b5eb3; $sp5c0f56++) { for ($spbf883a = 0; $spbf883a < $sp5b5eb3; $spbf883a++) { echo ord($spacf6ed[$sp5c0f56][$spbf883a]) . ','; } } } public static function markTime($sp55ac59) { list($sp98d02d, $sp7546e1) = explode(' ', microtime()); $spaae7dc = (double) $sp98d02d + (double) $sp7546e1; if (!isset($spf0be94['qr_time_bench'])) { $spf0be94['qr_time_bench'] = array(); } $spf0be94['qr_time_bench'][$sp55ac59] = $spaae7dc; } public static function timeBenchmark() { self::markTime('finish'); $sp5a7a3c = 0; $spd40e33 = 0; $sp89dfd0 = 0; echo '<table cellpadding="3" cellspacing="1">
                    <thead><tr style="border-bottom:1px solid silver"><td colspan="2" style="text-align:center">BENCHMARK</td></tr></thead>
                    <tbody>'; foreach ($spf0be94['qr_time_bench'] as $sp55ac59 => $sp9c6266) { if ($sp89dfd0 > 0) { echo '<tr><th style="text-align:right">till ' . $sp55ac59 . ': </th><td>' . number_format($sp9c6266 - $sp5a7a3c, 6) . 's</td></tr>'; } else { $spd40e33 = $sp9c6266; } $sp89dfd0++; $sp5a7a3c = $sp9c6266; } echo '</tbody><tfoot>
                <tr style="border-top:2px solid black"><th style="text-align:right">TOTAL: </th><td>' . number_format($sp5a7a3c - $spd40e33, 6) . 's</td></tr>
            </tfoot>
            </table>'; } } QRtools::markTime('start'); define('QRSPEC_VERSION_MAX', 40); define('QRSPEC_WIDTH_MAX', 177); define('QRCAP_WIDTH', 0); define('QRCAP_WORDS', 1); define('QRCAP_REMINDER', 2); define('QRCAP_EC', 3); class QRspec { public static $capacity = array(array(0, 0, 0, array(0, 0, 0, 0)), array(21, 26, 0, array(7, 10, 13, 17)), array(25, 44, 7, array(10, 16, 22, 28)), array(29, 70, 7, array(15, 26, 36, 44)), array(33, 100, 7, array(20, 36, 52, 64)), array(37, 134, 7, array(26, 48, 72, 88)), array(41, 172, 7, array(36, 64, 96, 112)), array(45, 196, 0, array(40, 72, 108, 130)), array(49, 242, 0, array(48, 88, 132, 156)), array(53, 292, 0, array(60, 110, 160, 192)), array(57, 346, 0, array(72, 130, 192, 224)), array(61, 404, 0, array(80, 150, 224, 264)), array(65, 466, 0, array(96, 176, 260, 308)), array(69, 532, 0, array(104, 198, 288, 352)), array(73, 581, 3, array(120, 216, 320, 384)), array(77, 655, 3, array(132, 240, 360, 432)), array(81, 733, 3, array(144, 280, 408, 480)), array(85, 815, 3, array(168, 308, 448, 532)), array(89, 901, 3, array(180, 338, 504, 588)), array(93, 991, 3, array(196, 364, 546, 650)), array(97, 1085, 3, array(224, 416, 600, 700)), array(101, 1156, 4, array(224, 442, 644, 750)), array(105, 1258, 4, array(252, 476, 690, 816)), array(109, 1364, 4, array(270, 504, 750, 900)), array(113, 1474, 4, array(300, 560, 810, 960)), array(117, 1588, 4, array(312, 588, 870, 1050)), array(121, 1706, 4, array(336, 644, 952, 1110)), array(125, 1828, 4, array(360, 700, 1020, 1200)), array(129, 1921, 3, array(390, 728, 1050, 1260)), array(133, 2051, 3, array(420, 784, 1140, 1350)), array(137, 2185, 3, array(450, 812, 1200, 1440)), array(141, 2323, 3, array(480, 868, 1290, 1530)), array(145, 2465, 3, array(510, 924, 1350, 1620)), array(149, 2611, 3, array(540, 980, 1440, 1710)), array(153, 2761, 3, array(570, 1036, 1530, 1800)), array(157, 2876, 0, array(570, 1064, 1590, 1890)), array(161, 3034, 0, array(600, 1120, 1680, 1980)), array(165, 3196, 0, array(630, 1204, 1770, 2100)), array(169, 3362, 0, array(660, 1260, 1860, 2220)), array(173, 3532, 0, array(720, 1316, 1950, 2310)), array(177, 3706, 0, array(750, 1372, 2040, 2430))); public static function getDataLength($spc801f8, $sp013fda) { return self::$capacity[$spc801f8][QRCAP_WORDS] - self::$capacity[$spc801f8][QRCAP_EC][$sp013fda]; } public static function getECCLength($spc801f8, $sp013fda) { return self::$capacity[$spc801f8][QRCAP_EC][$sp013fda]; } public static function getWidth($spc801f8) { return self::$capacity[$spc801f8][QRCAP_WIDTH]; } public static function getRemainder($spc801f8) { return self::$capacity[$spc801f8][QRCAP_REMINDER]; } public static function getMinimumVersion($spf2f171, $sp013fda) { for ($spf69b52 = 1; $spf69b52 <= QRSPEC_VERSION_MAX; $spf69b52++) { $spefca14 = self::$capacity[$spf69b52][QRCAP_WORDS] - self::$capacity[$spf69b52][QRCAP_EC][$sp013fda]; if ($spefca14 >= $spf2f171) { return $spf69b52; } } return -1; } public static $lengthTableBits = array(array(10, 12, 14), array(9, 11, 13), array(8, 16, 16), array(8, 10, 12)); public static function lengthIndicator($spad2fa5, $spc801f8) { if ($spad2fa5 == QR_MODE_STRUCTURE) { return 0; } if ($spc801f8 <= 9) { $spb68fab = 0; } else { if ($spc801f8 <= 26) { $spb68fab = 1; } else { $spb68fab = 2; } } return self::$lengthTableBits[$spad2fa5][$spb68fab]; } public static function maximumWords($spad2fa5, $spc801f8) { if ($spad2fa5 == QR_MODE_STRUCTURE) { return 3; } if ($spc801f8 <= 9) { $spb68fab = 0; } else { if ($spc801f8 <= 26) { $spb68fab = 1; } else { $spb68fab = 2; } } $spd9f7a0 = self::$lengthTableBits[$spad2fa5][$spb68fab]; $spefca14 = (1 << $spd9f7a0) - 1; if ($spad2fa5 == QR_MODE_KANJI) { $spefca14 *= 2; } return $spefca14; } public static $eccTable = array(array(array(0, 0), array(0, 0), array(0, 0), array(0, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(2, 0), array(2, 0)), array(array(1, 0), array(2, 0), array(2, 0), array(4, 0)), array(array(1, 0), array(2, 0), array(2, 2), array(2, 2)), array(array(2, 0), array(4, 0), array(4, 0), array(4, 0)), array(array(2, 0), array(4, 0), array(2, 4), array(4, 1)), array(array(2, 0), array(2, 2), array(4, 2), array(4, 2)), array(array(2, 0), array(3, 2), array(4, 4), array(4, 4)), array(array(2, 2), array(4, 1), array(6, 2), array(6, 2)), array(array(4, 0), array(1, 4), array(4, 4), array(3, 8)), array(array(2, 2), array(6, 2), array(4, 6), array(7, 4)), array(array(4, 0), array(8, 1), array(8, 4), array(12, 4)), array(array(3, 1), array(4, 5), array(11, 5), array(11, 5)), array(array(5, 1), array(5, 5), array(5, 7), array(11, 7)), array(array(5, 1), array(7, 3), array(15, 2), array(3, 13)), array(array(1, 5), array(10, 1), array(1, 15), array(2, 17)), array(array(5, 1), array(9, 4), array(17, 1), array(2, 19)), array(array(3, 4), array(3, 11), array(17, 4), array(9, 16)), array(array(3, 5), array(3, 13), array(15, 5), array(15, 10)), array(array(4, 4), array(17, 0), array(17, 6), array(19, 6)), array(array(2, 7), array(17, 0), array(7, 16), array(34, 0)), array(array(4, 5), array(4, 14), array(11, 14), array(16, 14)), array(array(6, 4), array(6, 14), array(11, 16), array(30, 2)), array(array(8, 4), array(8, 13), array(7, 22), array(22, 13)), array(array(10, 2), array(19, 4), array(28, 6), array(33, 4)), array(array(8, 4), array(22, 3), array(8, 26), array(12, 28)), array(array(3, 10), array(3, 23), array(4, 31), array(11, 31)), array(array(7, 7), array(21, 7), array(1, 37), array(19, 26)), array(array(5, 10), array(19, 10), array(15, 25), array(23, 25)), array(array(13, 3), array(2, 29), array(42, 1), array(23, 28)), array(array(17, 0), array(10, 23), array(10, 35), array(19, 35)), array(array(17, 1), array(14, 21), array(29, 19), array(11, 46)), array(array(13, 6), array(14, 23), array(44, 7), array(59, 1)), array(array(12, 7), array(12, 26), array(39, 14), array(22, 41)), array(array(6, 14), array(6, 34), array(46, 10), array(2, 64)), array(array(17, 4), array(29, 14), array(49, 10), array(24, 46)), array(array(4, 18), array(13, 32), array(48, 14), array(42, 32)), array(array(20, 4), array(40, 7), array(43, 22), array(10, 67)), array(array(19, 6), array(18, 31), array(34, 34), array(20, 61))); public static function getEccSpec($spc801f8, $sp013fda, array &$sp3ec8a8) { if (count($sp3ec8a8) < 5) { $sp3ec8a8 = array(0, 0, 0, 0, 0); } $sp032772 = self::$eccTable[$spc801f8][$sp013fda][0]; $spf0af39 = self::$eccTable[$spc801f8][$sp013fda][1]; $sp69c4ce = self::getDataLength($spc801f8, $sp013fda); $sp55f187 = self::getECCLength($spc801f8, $sp013fda); if ($spf0af39 == 0) { $sp3ec8a8[0] = $sp032772; $sp3ec8a8[1] = (int) ($sp69c4ce / $sp032772); $sp3ec8a8[2] = (int) ($sp55f187 / $sp032772); $sp3ec8a8[3] = 0; $sp3ec8a8[4] = 0; } else { $sp3ec8a8[0] = $sp032772; $sp3ec8a8[1] = (int) ($sp69c4ce / ($sp032772 + $spf0af39)); $sp3ec8a8[2] = (int) ($sp55f187 / ($sp032772 + $spf0af39)); $sp3ec8a8[3] = $spf0af39; $sp3ec8a8[4] = $sp3ec8a8[1] + 1; } } public static $alignmentPattern = array(array(0, 0), array(0, 0), array(18, 0), array(22, 0), array(26, 0), array(30, 0), array(34, 0), array(22, 38), array(24, 42), array(26, 46), array(28, 50), array(30, 54), array(32, 58), array(34, 62), array(26, 46), array(26, 48), array(26, 50), array(30, 54), array(30, 56), array(30, 58), array(34, 62), array(28, 50), array(26, 50), array(30, 54), array(28, 54), array(32, 58), array(30, 58), array(34, 62), array(26, 50), array(30, 54), array(26, 52), array(30, 56), array(34, 60), array(30, 58), array(34, 62), array(30, 54), array(24, 50), array(28, 54), array(32, 58), array(26, 54), array(30, 58)); public static function putAlignmentMarker(array &$spacf6ed, $spc004d6, $sp6d9978) { $sp177993 = array('°°°°°', '°†††°', '°†°†°', '°†††°', '°°°°°'); $sp3bb6af = $sp6d9978 - 2; $sp894a3b = $spc004d6 - 2; for ($sp5c0f56 = 0; $sp5c0f56 < 5; $sp5c0f56++) { QRstr::set($spacf6ed, $sp894a3b, $sp3bb6af + $sp5c0f56, $sp177993[$sp5c0f56]); } } public static function putAlignmentPattern($spc801f8, &$spacf6ed, $sp5b5eb3) { if ($spc801f8 < 2) { return; } $spc2f836 = self::$alignmentPattern[$spc801f8][1] - self::$alignmentPattern[$spc801f8][0]; if ($spc2f836 < 0) { $sp514488 = 2; } else { $sp514488 = (int) (($sp5b5eb3 - self::$alignmentPattern[$spc801f8][0]) / $spc2f836 + 2); } if ($sp514488 * $sp514488 - 3 == 1) { $spbf883a = self::$alignmentPattern[$spc801f8][0]; $sp5c0f56 = self::$alignmentPattern[$spc801f8][0]; self::putAlignmentMarker($spacf6ed, $spbf883a, $sp5c0f56); return; } $spfc5fd8 = self::$alignmentPattern[$spc801f8][0]; for ($spbf883a = 1; $spbf883a < $sp514488 - 1; $spbf883a++) { self::putAlignmentMarker($spacf6ed, 6, $spfc5fd8); self::putAlignmentMarker($spacf6ed, $spfc5fd8, 6); $spfc5fd8 += $spc2f836; } $spe46cfe = self::$alignmentPattern[$spc801f8][0]; for ($sp5c0f56 = 0; $sp5c0f56 < $sp514488 - 1; $sp5c0f56++) { $spfc5fd8 = self::$alignmentPattern[$spc801f8][0]; for ($spbf883a = 0; $spbf883a < $sp514488 - 1; $spbf883a++) { self::putAlignmentMarker($spacf6ed, $spfc5fd8, $spe46cfe); $spfc5fd8 += $spc2f836; } $spe46cfe += $spc2f836; } } public static $versionPattern = array(31892, 34236, 39577, 42195, 48118, 51042, 55367, 58893, 63784, 68472, 70749, 76311, 79154, 84390, 87683, 92361, 96236, 102084, 102881, 110507, 110734, 117786, 119615, 126325, 127568, 133589, 136944, 141498, 145311, 150283, 152622, 158308, 161089, 167017); public static function getVersionPattern($spc801f8) { if ($spc801f8 < 7 || $spc801f8 > QRSPEC_VERSION_MAX) { return 0; } return self::$versionPattern[$spc801f8 - 7]; } public static $formatInfo = array(array(30660, 29427, 32170, 30877, 26159, 25368, 27713, 26998), array(21522, 20773, 24188, 23371, 17913, 16590, 20375, 19104), array(13663, 12392, 16177, 14854, 9396, 8579, 11994, 11245), array(5769, 5054, 7399, 6608, 1890, 597, 3340, 2107)); public static function getFormatInfo($sp385b35, $sp013fda) { if ($sp385b35 < 0 || $sp385b35 > 7) { return 0; } if ($sp013fda < 0 || $sp013fda > 3) { return 0; } return self::$formatInfo[$sp013fda][$sp385b35]; } public static $frames = array(); public static function putFinderPattern(&$spacf6ed, $spc004d6, $sp6d9978) { $sp177993 = array('¡¡¡¡¡¡¡', '¡¿¿¿¿¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¿¿¿¿¡', '¡¡¡¡¡¡¡'); for ($sp5c0f56 = 0; $sp5c0f56 < 7; $sp5c0f56++) { QRstr::set($spacf6ed, $spc004d6, $sp6d9978 + $sp5c0f56, $sp177993[$sp5c0f56]); } } public static function createFrame($spc801f8) { $sp5b5eb3 = self::$capacity[$spc801f8][QRCAP_WIDTH]; $sp32ff01 = str_repeat(' ', $sp5b5eb3); $spacf6ed = array_fill(0, $sp5b5eb3, $sp32ff01); self::putFinderPattern($spacf6ed, 0, 0); self::putFinderPattern($spacf6ed, $sp5b5eb3 - 7, 0); self::putFinderPattern($spacf6ed, 0, $sp5b5eb3 - 7); $spe4ed4e = $sp5b5eb3 - 7; for ($sp5c0f56 = 0; $sp5c0f56 < 7; $sp5c0f56++) { $spacf6ed[$sp5c0f56][7] = '¿'; $spacf6ed[$sp5c0f56][$sp5b5eb3 - 8] = '¿'; $spacf6ed[$spe4ed4e][7] = '¿'; $spe4ed4e++; } $sp80ce96 = str_repeat('¿', 8); QRstr::set($spacf6ed, 0, 7, $sp80ce96); QRstr::set($spacf6ed, $sp5b5eb3 - 8, 7, $sp80ce96); QRstr::set($spacf6ed, 0, $sp5b5eb3 - 8, $sp80ce96); $sp80ce96 = str_repeat('Ñ', 9); QRstr::set($spacf6ed, 0, 8, $sp80ce96); QRstr::set($spacf6ed, $sp5b5eb3 - 8, 8, $sp80ce96, 8); $spe4ed4e = $sp5b5eb3 - 8; for ($sp5c0f56 = 0; $sp5c0f56 < 8; $sp5c0f56++, $spe4ed4e++) { $spacf6ed[$sp5c0f56][8] = 'Ñ'; $spacf6ed[$spe4ed4e][8] = 'Ñ'; } for ($spf69b52 = 1; $spf69b52 < $sp5b5eb3 - 15; $spf69b52++) { $spacf6ed[6][7 + $spf69b52] = chr(144 | $spf69b52 & 1); $spacf6ed[7 + $spf69b52][6] = chr(144 | $spf69b52 & 1); } self::putAlignmentPattern($spc801f8, $spacf6ed, $sp5b5eb3); if ($spc801f8 >= 7) { $sp8747e9 = self::getVersionPattern($spc801f8); $sp2a00a3 = $sp8747e9; for ($spbf883a = 0; $spbf883a < 6; $spbf883a++) { for ($sp5c0f56 = 0; $sp5c0f56 < 3; $sp5c0f56++) { $spacf6ed[$sp5b5eb3 - 11 + $sp5c0f56][$spbf883a] = chr(136 | $sp2a00a3 & 1); $sp2a00a3 = $sp2a00a3 >> 1; } } $sp2a00a3 = $sp8747e9; for ($sp5c0f56 = 0; $sp5c0f56 < 6; $sp5c0f56++) { for ($spbf883a = 0; $spbf883a < 3; $spbf883a++) { $spacf6ed[$sp5c0f56][$spbf883a + ($sp5b5eb3 - 11)] = chr(136 | $sp2a00a3 & 1); $sp2a00a3 = $sp2a00a3 >> 1; } } } $spacf6ed[$sp5b5eb3 - 8][8] = 'Å'; return $spacf6ed; } public static function debug($spacf6ed, $sp4d9e6f = false) { if ($sp4d9e6f) { foreach ($spacf6ed as &$sp32ff01) { $sp32ff01 = join('<span class="m">&nbsp;&nbsp;</span>', explode('0', $sp32ff01)); $sp32ff01 = join('&#9608;&#9608;', explode('1', $sp32ff01)); } ?>
                <style>
                    .m { background-color: white; }
                </style>
                <?php  echo '<pre><tt><br/ ><br/ ><br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; echo join('<br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', $spacf6ed); echo '</tt></pre><br/ ><br/ ><br/ ><br/ ><br/ ><br/ >'; } else { foreach ($spacf6ed as &$sp32ff01) { $sp32ff01 = join('<span class="m">&nbsp;</span>', explode('¿', $sp32ff01)); $sp32ff01 = join('<span class="m">&#9618;</span>', explode('¡', $sp32ff01)); $sp32ff01 = join('<span class="p">&nbsp;</span>', explode('†', $sp32ff01)); $sp32ff01 = join('<span class="p">&#9618;</span>', explode('°', $sp32ff01)); $sp32ff01 = join('<span class="s">&#9671;</span>', explode('Ñ', $sp32ff01)); $sp32ff01 = join('<span class="s">&#9670;</span>', explode('Ö', $sp32ff01)); $sp32ff01 = join('<span class="x">&#9762;</span>', explode('Å', $sp32ff01)); $sp32ff01 = join('<span class="c">&nbsp;</span>', explode('ê', $sp32ff01)); $sp32ff01 = join('<span class="c">&#9719;</span>', explode('ë', $sp32ff01)); $sp32ff01 = join('<span class="f">&nbsp;</span>', explode('à', $sp32ff01)); $sp32ff01 = join('<span class="f">&#9618;</span>', explode('â', $sp32ff01)); $sp32ff01 = join('&#9830;', explode('', $sp32ff01)); $sp32ff01 = join('&#8901;', explode(' ', $sp32ff01)); } ?>
                <style>
                    .p { background-color: yellow; }
                    .m { background-color: #00FF00; }
                    .s { background-color: #FF0000; }
                    .c { background-color: aqua; }
                    .x { background-color: pink; }
                    .f { background-color: gold; }
                </style>
                <?php  echo '<pre><tt>'; echo join('<br/ >', $spacf6ed); echo '</tt></pre>'; } } public static function serial($spacf6ed) { return gzcompress(join('
', $spacf6ed), 9); } public static function unserial($sp199781) { return explode('
', gzuncompress($sp199781)); } public static function newFrame($spc801f8) { if ($spc801f8 < 1 || $spc801f8 > QRSPEC_VERSION_MAX) { return null; } if (!isset(self::$frames[$spc801f8])) { $sp3a6b70 = QR_CACHE_DIR . 'frame_' . $spc801f8 . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp3a6b70)) { self::$frames[$spc801f8] = self::unserial(file_get_contents($sp3a6b70)); } else { self::$frames[$spc801f8] = self::createFrame($spc801f8); file_put_contents($sp3a6b70, self::serial(self::$frames[$spc801f8])); } } else { self::$frames[$spc801f8] = self::createFrame($spc801f8); } } if (is_null(self::$frames[$spc801f8])) { return null; } return self::$frames[$spc801f8]; } public static function rsBlockNum($sp3ec8a8) { return $sp3ec8a8[0] + $sp3ec8a8[3]; } public static function rsBlockNum1($sp3ec8a8) { return $sp3ec8a8[0]; } public static function rsDataCodes1($sp3ec8a8) { return $sp3ec8a8[1]; } public static function rsEccCodes1($sp3ec8a8) { return $sp3ec8a8[2]; } public static function rsBlockNum2($sp3ec8a8) { return $sp3ec8a8[3]; } public static function rsDataCodes2($sp3ec8a8) { return $sp3ec8a8[4]; } public static function rsEccCodes2($sp3ec8a8) { return $sp3ec8a8[2]; } public static function rsDataLength($sp3ec8a8) { return $sp3ec8a8[0] * $sp3ec8a8[1] + $sp3ec8a8[3] * $sp3ec8a8[4]; } public static function rsEccLength($sp3ec8a8) { return ($sp3ec8a8[0] + $sp3ec8a8[3]) * $sp3ec8a8[2]; } } define('QR_IMAGE', true); class QRimage { public static function png($spacf6ed, $sp986884 = false, $sp4d679c = 4, $spbf0371 = 4, $sp0ebf30 = FALSE) { $sp839b45 = self::image($spacf6ed, $sp4d679c, $spbf0371); if ($sp986884 === false) { Header('Content-type: image/png'); ImagePng($sp839b45); } else { if ($sp0ebf30 === TRUE) { ImagePng($sp839b45, $sp986884); header('Content-type: image/png'); ImagePng($sp839b45); } else { ImagePng($sp839b45, $sp986884); } } ImageDestroy($sp839b45); } public static function jpg($spacf6ed, $sp986884 = false, $sp4d679c = 8, $spbf0371 = 4, $sp5456d1 = 85) { $sp839b45 = self::image($spacf6ed, $sp4d679c, $spbf0371); if ($sp986884 === false) { Header('Content-type: image/jpeg'); ImageJpeg($sp839b45, null, $sp5456d1); } else { ImageJpeg($sp839b45, $sp986884, $sp5456d1); } ImageDestroy($sp839b45); } private static function image($spacf6ed, $sp4d679c = 4, $spbf0371 = 4) { $sp1ed215 = count($spacf6ed); $sp514488 = strlen($spacf6ed[0]); $sp525c0f = $sp514488 + 2 * $spbf0371; $sp2def4c = $sp1ed215 + 2 * $spbf0371; $spd0b6d9 = ImageCreate($sp525c0f, $sp2def4c); $sp5a15cd[0] = ImageColorAllocate($spd0b6d9, 255, 255, 255); $sp5a15cd[1] = ImageColorAllocate($spd0b6d9, 0, 0, 0); imagefill($spd0b6d9, 0, 0, $sp5a15cd[0]); for ($sp5c0f56 = 0; $sp5c0f56 < $sp1ed215; $sp5c0f56++) { for ($spbf883a = 0; $spbf883a < $sp514488; $spbf883a++) { if ($spacf6ed[$sp5c0f56][$spbf883a] == '1') { ImageSetPixel($spd0b6d9, $spbf883a + $spbf0371, $sp5c0f56 + $spbf0371, $sp5a15cd[1]); } } } $sp50acf0 = ImageCreate($sp525c0f * $sp4d679c, $sp2def4c * $sp4d679c); ImageCopyResized($sp50acf0, $spd0b6d9, 0, 0, 0, 0, $sp525c0f * $sp4d679c, $sp2def4c * $sp4d679c, $sp525c0f, $sp2def4c); ImageDestroy($spd0b6d9); return $sp50acf0; } } define('STRUCTURE_HEADER_BITS', 20); define('MAX_STRUCTURED_SYMBOLS', 16); class QRinputItem { public $mode; public $size; public $data; public $bstream; public function __construct($spad2fa5, $spf2f171, $sp69c4ce, $spb60826 = null) { $sp9d8a98 = array_slice($sp69c4ce, 0, $spf2f171); if (count($sp9d8a98) < $spf2f171) { $sp9d8a98 = array_merge($sp9d8a98, array_fill(0, $spf2f171 - count($sp9d8a98), 0)); } if (!QRinput::check($spad2fa5, $spf2f171, $sp9d8a98)) { throw new Exception('Error m:' . $spad2fa5 . ',s:' . $spf2f171 . ',d:' . join(',', $sp9d8a98)); return null; } $this->mode = $spad2fa5; $this->size = $spf2f171; $this->data = $sp9d8a98; $this->bstream = $spb60826; } public function encodeModeNum($spc801f8) { try { $spefca14 = (int) ($this->size / 3); $spf571d9 = new QRbitstream(); $sp7a0550 = 1; $spf571d9->appendNum(4, $sp7a0550); $spf571d9->appendNum(QRspec::lengthIndicator(QR_MODE_NUM, $spc801f8), $this->size); for ($spf69b52 = 0; $spf69b52 < $spefca14; $spf69b52++) { $sp7a0550 = (ord($this->data[$spf69b52 * 3]) - ord('0')) * 100; $sp7a0550 += (ord($this->data[$spf69b52 * 3 + 1]) - ord('0')) * 10; $sp7a0550 += ord($this->data[$spf69b52 * 3 + 2]) - ord('0'); $spf571d9->appendNum(10, $sp7a0550); } if ($this->size - $spefca14 * 3 == 1) { $sp7a0550 = ord($this->data[$spefca14 * 3]) - ord('0'); $spf571d9->appendNum(4, $sp7a0550); } else { if ($this->size - $spefca14 * 3 == 2) { $sp7a0550 = (ord($this->data[$spefca14 * 3]) - ord('0')) * 10; $sp7a0550 += ord($this->data[$spefca14 * 3 + 1]) - ord('0'); $spf571d9->appendNum(7, $sp7a0550); } } $this->bstream = $spf571d9; return 0; } catch (Exception $spbcc446) { return -1; } } public function encodeModeAn($spc801f8) { try { $spefca14 = (int) ($this->size / 2); $spf571d9 = new QRbitstream(); $spf571d9->appendNum(4, 2); $spf571d9->appendNum(QRspec::lengthIndicator(QR_MODE_AN, $spc801f8), $this->size); for ($spf69b52 = 0; $spf69b52 < $spefca14; $spf69b52++) { $sp7a0550 = (int) QRinput::lookAnTable(ord($this->data[$spf69b52 * 2])) * 45; $sp7a0550 += (int) QRinput::lookAnTable(ord($this->data[$spf69b52 * 2 + 1])); $spf571d9->appendNum(11, $sp7a0550); } if ($this->size & 1) { $sp7a0550 = QRinput::lookAnTable(ord($this->data[$spefca14 * 2])); $spf571d9->appendNum(6, $sp7a0550); } $this->bstream = $spf571d9; return 0; } catch (Exception $spbcc446) { return -1; } } public function encodeMode8($spc801f8) { try { $spf571d9 = new QRbitstream(); $spf571d9->appendNum(4, 4); $spf571d9->appendNum(QRspec::lengthIndicator(QR_MODE_8, $spc801f8), $this->size); for ($spf69b52 = 0; $spf69b52 < $this->size; $spf69b52++) { $spf571d9->appendNum(8, ord($this->data[$spf69b52])); } $this->bstream = $spf571d9; return 0; } catch (Exception $spbcc446) { return -1; } } public function encodeModeKanji($spc801f8) { try { $spf571d9 = new QRbitrtream(); $spf571d9->appendNum(4, 8); $spf571d9->appendNum(QRspec::lengthIndicator(QR_MODE_KANJI, $spc801f8), (int) ($this->size / 2)); for ($spf69b52 = 0; $spf69b52 < $this->size; $spf69b52 += 2) { $sp7a0550 = ord($this->data[$spf69b52]) << 8 | ord($this->data[$spf69b52 + 1]); if ($sp7a0550 <= 40956) { $sp7a0550 -= 33088; } else { $sp7a0550 -= 49472; } $sp1ed215 = ($sp7a0550 >> 8) * 192; $sp7a0550 = ($sp7a0550 & 255) + $sp1ed215; $spf571d9->appendNum(13, $sp7a0550); } $this->bstream = $spf571d9; return 0; } catch (Exception $spbcc446) { return -1; } } public function encodeModeStructure() { try { $spf571d9 = new QRbitstream(); $spf571d9->appendNum(4, 3); $spf571d9->appendNum(4, ord($this->data[1]) - 1); $spf571d9->appendNum(4, ord($this->data[0]) - 1); $spf571d9->appendNum(8, ord($this->data[2])); $this->bstream = $spf571d9; return 0; } catch (Exception $spbcc446) { return -1; } } public function estimateBitStreamSizeOfEntry($spc801f8) { $spd9f7a0 = 0; if ($spc801f8 == 0) { $spc801f8 = 1; } switch ($this->mode) { case QR_MODE_NUM: $spd9f7a0 = QRinput::estimateBitsModeNum($this->size); break; case QR_MODE_AN: $spd9f7a0 = QRinput::estimateBitsModeAn($this->size); break; case QR_MODE_8: $spd9f7a0 = QRinput::estimateBitsMode8($this->size); break; case QR_MODE_KANJI: $spd9f7a0 = QRinput::estimateBitsModeKanji($this->size); break; case QR_MODE_STRUCTURE: return STRUCTURE_HEADER_BITS; default: return 0; } $spb68fab = QRspec::lengthIndicator($this->mode, $spc801f8); $sp71485b = 1 << $spb68fab; $sp2cf77a = (int) (($this->size + $sp71485b - 1) / $sp71485b); $spd9f7a0 += $sp2cf77a * (4 + $spb68fab); return $spd9f7a0; } public function encodeBitStream($spc801f8) { try { unset($this->bstream); $spefca14 = QRspec::maximumWords($this->mode, $spc801f8); if ($this->size > $spefca14) { $spc9d38a = new QRinputItem($this->mode, $spefca14, $this->data); $sp44abcc = new QRinputItem($this->mode, $this->size - $spefca14, array_slice($this->data, $spefca14)); $spc9d38a->encodeBitStream($spc801f8); $sp44abcc->encodeBitStream($spc801f8); $this->bstream = new QRbitstream(); $this->bstream->append($spc9d38a->bstream); $this->bstream->append($sp44abcc->bstream); unset($spc9d38a); unset($sp44abcc); } else { $sp6f1294 = 0; switch ($this->mode) { case QR_MODE_NUM: $sp6f1294 = $this->encodeModeNum($spc801f8); break; case QR_MODE_AN: $sp6f1294 = $this->encodeModeAn($spc801f8); break; case QR_MODE_8: $sp6f1294 = $this->encodeMode8($spc801f8); break; case QR_MODE_KANJI: $sp6f1294 = $this->encodeModeKanji($spc801f8); break; case QR_MODE_STRUCTURE: $sp6f1294 = $this->encodeModeStructure(); break; default: break; } if ($sp6f1294 < 0) { return -1; } } return $this->bstream->size(); } catch (Exception $spbcc446) { return -1; } } } class QRinput { public $items; private $version; private $level; public function __construct($spc801f8 = 0, $sp013fda = QR_ECLEVEL_L) { if ($spc801f8 < 0 || $spc801f8 > QRSPEC_VERSION_MAX || $sp013fda > QR_ECLEVEL_H) { throw new Exception('Invalid version no'); return NULL; } $this->version = $spc801f8; $this->level = $sp013fda; } public function getVersion() { return $this->version; } public function setVersion($spc801f8) { if ($spc801f8 < 0 || $spc801f8 > QRSPEC_VERSION_MAX) { throw new Exception('Invalid version no'); return -1; } $this->version = $spc801f8; return 0; } public function getErrorCorrectionLevel() { return $this->level; } public function setErrorCorrectionLevel($sp013fda) { if ($sp013fda > QR_ECLEVEL_H) { throw new Exception('Invalid ECLEVEL'); return -1; } $this->level = $sp013fda; return 0; } public function appendEntry(QRinputItem $sp7b5d58) { $this->items[] = $sp7b5d58; } public function append($spad2fa5, $spf2f171, $sp69c4ce) { try { $sp7b5d58 = new QRinputItem($spad2fa5, $spf2f171, $sp69c4ce); $this->items[] = $sp7b5d58; return 0; } catch (Exception $spbcc446) { return -1; } } public function insertStructuredAppendHeader($spf2f171, $sp014b81, $spebbaf2) { if ($spf2f171 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong size'); } if ($sp014b81 <= 0 || $sp014b81 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong index'); } $sp2922d4 = array($spf2f171, $sp014b81, $spebbaf2); try { $sp7b5d58 = new QRinputItem(QR_MODE_STRUCTURE, 3, buf); array_unshift($this->items, $sp7b5d58); return 0; } catch (Exception $spbcc446) { return -1; } } public function calcParity() { $spebbaf2 = 0; foreach ($this->items as $sp1b8ac8) { if ($sp1b8ac8->mode != QR_MODE_STRUCTURE) { for ($spf69b52 = $sp1b8ac8->size - 1; $spf69b52 >= 0; $spf69b52--) { $spebbaf2 ^= $sp1b8ac8->data[$spf69b52]; } } } return $spebbaf2; } public static function checkModeNum($spf2f171, $sp69c4ce) { for ($spf69b52 = 0; $spf69b52 < $spf2f171; $spf69b52++) { if (ord($sp69c4ce[$spf69b52]) < ord('0') || ord($sp69c4ce[$spf69b52]) > ord('9')) { return false; } } return true; } public static function estimateBitsModeNum($spf2f171) { $sp514488 = (int) $spf2f171 / 3; $spd9f7a0 = $sp514488 * 10; switch ($spf2f171 - $sp514488 * 3) { case 1: $spd9f7a0 += 4; break; case 2: $spd9f7a0 += 7; break; default: break; } return $spd9f7a0; } public static $anTable = array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 36, -1, -1, -1, 37, 38, -1, -1, -1, -1, 39, 40, -1, 41, 42, 43, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 44, -1, -1, -1, -1, -1, -1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1); public static function lookAnTable($spfa0fd3) { return $spfa0fd3 > 127 ? -1 : self::$anTable[$spfa0fd3]; } public static function checkModeAn($spf2f171, $sp69c4ce) { for ($spf69b52 = 0; $spf69b52 < $spf2f171; $spf69b52++) { if (self::lookAnTable(ord($sp69c4ce[$spf69b52])) == -1) { return false; } } return true; } public static function estimateBitsModeAn($spf2f171) { $sp514488 = (int) ($spf2f171 / 2); $spd9f7a0 = $sp514488 * 11; if ($spf2f171 & 1) { $spd9f7a0 += 6; } return $spd9f7a0; } public static function estimateBitsMode8($spf2f171) { return $spf2f171 * 8; } public function estimateBitsModeKanji($spf2f171) { return (int) ($spf2f171 / 2 * 13); } public static function checkModeKanji($spf2f171, $sp69c4ce) { if ($spf2f171 & 1) { return false; } for ($spf69b52 = 0; $spf69b52 < $spf2f171; $spf69b52 += 2) { $sp7a0550 = ord($sp69c4ce[$spf69b52]) << 8 | ord($sp69c4ce[$spf69b52 + 1]); if ($sp7a0550 < 33088 || $sp7a0550 > 40956 && $sp7a0550 < 57408 || $sp7a0550 > 60351) { return false; } } return true; } public static function check($spad2fa5, $spf2f171, $sp69c4ce) { if ($spf2f171 <= 0) { return false; } switch ($spad2fa5) { case QR_MODE_NUM: return self::checkModeNum($spf2f171, $sp69c4ce); break; case QR_MODE_AN: return self::checkModeAn($spf2f171, $sp69c4ce); break; case QR_MODE_KANJI: return self::checkModeKanji($spf2f171, $sp69c4ce); break; case QR_MODE_8: return true; break; case QR_MODE_STRUCTURE: return true; break; default: break; } return false; } public function estimateBitStreamSize($spc801f8) { $spd9f7a0 = 0; foreach ($this->items as $sp1b8ac8) { $spd9f7a0 += $sp1b8ac8->estimateBitStreamSizeOfEntry($spc801f8); } return $spd9f7a0; } public function estimateVersion() { $spc801f8 = 0; $sp0b3f0f = 0; do { $sp0b3f0f = $spc801f8; $spd9f7a0 = $this->estimateBitStreamSize($sp0b3f0f); $spc801f8 = QRspec::getMinimumVersion((int) (($spd9f7a0 + 7) / 8), $this->level); if ($spc801f8 < 0) { return -1; } } while ($spc801f8 > $sp0b3f0f); return $spc801f8; } public static function lengthOfCode($spad2fa5, $spc801f8, $spd9f7a0) { $sp5de5b1 = $spd9f7a0 - 4 - QRspec::lengthIndicator($spad2fa5, $spc801f8); switch ($spad2fa5) { case QR_MODE_NUM: $sp0a610d = (int) ($sp5de5b1 / 10); $sp3d25ea = $sp5de5b1 - $sp0a610d * 10; $spf2f171 = $sp0a610d * 3; if ($sp3d25ea >= 7) { $spf2f171 += 2; } else { if ($sp3d25ea >= 4) { $spf2f171 += 1; } } break; case QR_MODE_AN: $sp0a610d = (int) ($sp5de5b1 / 11); $sp3d25ea = $sp5de5b1 - $sp0a610d * 11; $spf2f171 = $sp0a610d * 2; if ($sp3d25ea >= 6) { $spf2f171++; } break; case QR_MODE_8: $spf2f171 = (int) ($sp5de5b1 / 8); break; case QR_MODE_KANJI: $spf2f171 = (int) ($sp5de5b1 / 13 * 2); break; case QR_MODE_STRUCTURE: $spf2f171 = (int) ($sp5de5b1 / 8); break; default: $spf2f171 = 0; break; } $spf2e34d = QRspec::maximumWords($spad2fa5, $spc801f8); if ($spf2f171 < 0) { $spf2f171 = 0; } if ($spf2f171 > $spf2e34d) { $spf2f171 = $spf2e34d; } return $spf2f171; } public function createBitStream() { $sp16dd1b = 0; foreach ($this->items as $sp1b8ac8) { $spd9f7a0 = $sp1b8ac8->encodeBitStream($this->version); if ($spd9f7a0 < 0) { return -1; } $sp16dd1b += $spd9f7a0; } return $sp16dd1b; } public function convertData() { $spd59f1b = $this->estimateVersion(); if ($spd59f1b > $this->getVersion()) { $this->setVersion($spd59f1b); } for (;;) { $spd9f7a0 = $this->createBitStream(); if ($spd9f7a0 < 0) { return -1; } $spd59f1b = QRspec::getMinimumVersion((int) (($spd9f7a0 + 7) / 8), $this->level); if ($spd59f1b < 0) { throw new Exception('WRONG VERSION'); return -1; } else { if ($spd59f1b > $this->getVersion()) { $this->setVersion($spd59f1b); } else { break; } } } return 0; } public function appendPaddingBit(&$spb60826) { $spd9f7a0 = $spb60826->size(); $spb0136f = QRspec::getDataLength($this->version, $this->level); $sp1e8909 = $spb0136f * 8; if ($sp1e8909 == $spd9f7a0) { return 0; } if ($sp1e8909 - $spd9f7a0 < 5) { return $spb60826->appendNum($sp1e8909 - $spd9f7a0, 0); } $spd9f7a0 += 4; $spefca14 = (int) (($spd9f7a0 + 7) / 8); $sp76c84b = new QRbitstream(); $sp6f1294 = $sp76c84b->appendNum($spefca14 * 8 - $spd9f7a0 + 4, 0); if ($sp6f1294 < 0) { return $sp6f1294; } $sp97662e = $spb0136f - $spefca14; if ($sp97662e > 0) { $sp64147b = array(); for ($spf69b52 = 0; $spf69b52 < $sp97662e; $spf69b52++) { $sp64147b[$spf69b52] = $spf69b52 & 1 ? 17 : 236; } $sp6f1294 = $sp76c84b->appendBytes($sp97662e, $sp64147b); if ($sp6f1294 < 0) { return $sp6f1294; } } $sp6f1294 = $spb60826->append($sp76c84b); return $sp6f1294; } public function mergeBitStream() { if ($this->convertData() < 0) { return null; } $spb60826 = new QRbitstream(); foreach ($this->items as $sp1b8ac8) { $sp6f1294 = $spb60826->append($sp1b8ac8->bstream); if ($sp6f1294 < 0) { return null; } } return $spb60826; } public function getBitStream() { $spb60826 = $this->mergeBitStream(); if ($spb60826 == null) { return null; } $sp6f1294 = $this->appendPaddingBit($spb60826); if ($sp6f1294 < 0) { return null; } return $spb60826; } public function getByteStream() { $spb60826 = $this->getBitStream(); if ($spb60826 == null) { return null; } return $spb60826->toByte(); } } class QRbitstream { public $data = array(); public function size() { return count($this->data); } public function allocate($spd2b9fb) { $this->data = array_fill(0, $spd2b9fb, 0); return 0; } public static function newFromNum($spd9f7a0, $sp2cf77a) { $spb60826 = new QRbitstream(); $spb60826->allocate($spd9f7a0); $sp385b35 = 1 << $spd9f7a0 - 1; for ($spf69b52 = 0; $spf69b52 < $spd9f7a0; $spf69b52++) { if ($sp2cf77a & $sp385b35) { $spb60826->data[$spf69b52] = 1; } else { $spb60826->data[$spf69b52] = 0; } $sp385b35 = $sp385b35 >> 1; } return $spb60826; } public static function newFromBytes($spf2f171, $sp69c4ce) { $spb60826 = new QRbitstream(); $spb60826->allocate($spf2f171 * 8); $sp89dfd0 = 0; for ($spf69b52 = 0; $spf69b52 < $spf2f171; $spf69b52++) { $sp385b35 = 128; for ($spa68871 = 0; $spa68871 < 8; $spa68871++) { if ($sp69c4ce[$spf69b52] & $sp385b35) { $spb60826->data[$sp89dfd0] = 1; } else { $spb60826->data[$sp89dfd0] = 0; } $sp89dfd0++; $sp385b35 = $sp385b35 >> 1; } } return $spb60826; } public function append(QRbitstream $sp3373de) { if (is_null($sp3373de)) { return -1; } if ($sp3373de->size() == 0) { return 0; } if ($this->size() == 0) { $this->data = $sp3373de->data; return 0; } $this->data = array_values(array_merge($this->data, $sp3373de->data)); return 0; } public function appendNum($spd9f7a0, $sp2cf77a) { if ($spd9f7a0 == 0) { return 0; } $sp2d97c0 = QRbitstream::newFromNum($spd9f7a0, $sp2cf77a); if (is_null($sp2d97c0)) { return -1; } $sp6f1294 = $this->append($sp2d97c0); unset($sp2d97c0); return $sp6f1294; } public function appendBytes($spf2f171, $sp69c4ce) { if ($spf2f171 == 0) { return 0; } $sp2d97c0 = QRbitstream::newFromBytes($spf2f171, $sp69c4ce); if (is_null($sp2d97c0)) { return -1; } $sp6f1294 = $this->append($sp2d97c0); unset($sp2d97c0); return $sp6f1294; } public function toByte() { $spf2f171 = $this->size(); if ($spf2f171 == 0) { return array(); } $sp69c4ce = array_fill(0, (int) (($spf2f171 + 7) / 8), 0); $sp43d9e0 = (int) ($spf2f171 / 8); $sp89dfd0 = 0; for ($spf69b52 = 0; $spf69b52 < $sp43d9e0; $spf69b52++) { $sp2a00a3 = 0; for ($spa68871 = 0; $spa68871 < 8; $spa68871++) { $sp2a00a3 = $sp2a00a3 << 1; $sp2a00a3 |= $this->data[$sp89dfd0]; $sp89dfd0++; } $sp69c4ce[$spf69b52] = $sp2a00a3; } if ($spf2f171 & 7) { $sp2a00a3 = 0; for ($spa68871 = 0; $spa68871 < ($spf2f171 & 7); $spa68871++) { $sp2a00a3 = $sp2a00a3 << 1; $sp2a00a3 |= $this->data[$sp89dfd0]; $sp89dfd0++; } $sp69c4ce[$sp43d9e0] = $sp2a00a3; } return $sp69c4ce; } } class QRsplit { public $dataStr = ''; public $input; public $modeHint; public function __construct($sp4e096d, $sp5bf110, $spfe4e1b) { $this->dataStr = $sp4e096d; $this->input = $sp5bf110; $this->modeHint = $spfe4e1b; } public static function isdigitat($sp512d95, $spac02ec) { if ($spac02ec >= strlen($sp512d95)) { return false; } return ord($sp512d95[$spac02ec]) >= ord('0') && ord($sp512d95[$spac02ec]) <= ord('9'); } public static function isalnumat($sp512d95, $spac02ec) { if ($spac02ec >= strlen($sp512d95)) { return false; } return QRinput::lookAnTable(ord($sp512d95[$spac02ec])) >= 0; } public function identifyMode($spac02ec) { if ($spac02ec >= strlen($this->dataStr)) { return QR_MODE_NUL; } $spfa0fd3 = $this->dataStr[$spac02ec]; if (self::isdigitat($this->dataStr, $spac02ec)) { return QR_MODE_NUM; } else { if (self::isalnumat($this->dataStr, $spac02ec)) { return QR_MODE_AN; } else { if ($this->modeHint == QR_MODE_KANJI) { if ($spac02ec + 1 < strlen($this->dataStr)) { $spc2f836 = $this->dataStr[$spac02ec + 1]; $spdb95a8 = ord($spfa0fd3) << 8 | ord($spc2f836); if ($spdb95a8 >= 33088 && $spdb95a8 <= 40956 || $spdb95a8 >= 57408 && $spdb95a8 <= 60351) { return QR_MODE_KANJI; } } } } } return QR_MODE_8; } public function eatNum() { $sp298c5c = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp89dfd0 = 0; while (self::isdigitat($this->dataStr, $sp89dfd0)) { $sp89dfd0++; } $sp4ae707 = $sp89dfd0; $spad2fa5 = $this->identifyMode($sp89dfd0); if ($spad2fa5 == QR_MODE_8) { $sp278491 = QRinput::estimateBitsModeNum($sp4ae707) + 4 + $sp298c5c + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp4ae707 + 1); if ($sp278491 > 0) { return $this->eat8(); } } if ($spad2fa5 == QR_MODE_AN) { $sp278491 = QRinput::estimateBitsModeNum($sp4ae707) + 4 + $sp298c5c + QRinput::estimateBitsModeAn(1) - QRinput::estimateBitsModeAn($sp4ae707 + 1); if ($sp278491 > 0) { return $this->eatAn(); } } $sp6f1294 = $this->input->append(QR_MODE_NUM, $sp4ae707, str_split($this->dataStr)); if ($sp6f1294 < 0) { return -1; } return $sp4ae707; } public function eatAn() { $spcaa3d3 = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp298c5c = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp89dfd0 = 0; while (self::isalnumat($this->dataStr, $sp89dfd0)) { if (self::isdigitat($this->dataStr, $sp89dfd0)) { $sp5456d1 = $sp89dfd0; while (self::isdigitat($this->dataStr, $sp5456d1)) { $sp5456d1++; } $sp278491 = QRinput::estimateBitsModeAn($sp89dfd0) + QRinput::estimateBitsModeNum($sp5456d1 - $sp89dfd0) + 4 + $sp298c5c - QRinput::estimateBitsModeAn($sp5456d1); if ($sp278491 < 0) { break; } else { $sp89dfd0 = $sp5456d1; } } else { $sp89dfd0++; } } $sp4ae707 = $sp89dfd0; if (!self::isalnumat($this->dataStr, $sp89dfd0)) { $sp278491 = QRinput::estimateBitsModeAn($sp4ae707) + 4 + $spcaa3d3 + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp4ae707 + 1); if ($sp278491 > 0) { return $this->eat8(); } } $sp6f1294 = $this->input->append(QR_MODE_AN, $sp4ae707, str_split($this->dataStr)); if ($sp6f1294 < 0) { return -1; } return $sp4ae707; } public function eatKanji() { $sp89dfd0 = 0; while ($this->identifyMode($sp89dfd0) == QR_MODE_KANJI) { $sp89dfd0 += 2; } $sp6f1294 = $this->input->append(QR_MODE_KANJI, $sp89dfd0, str_split($this->dataStr)); if ($sp6f1294 < 0) { return -1; } return $sp4ae707; } public function eat8() { $spcaa3d3 = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp298c5c = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp89dfd0 = 1; $spe5d985 = strlen($this->dataStr); while ($sp89dfd0 < $spe5d985) { $spad2fa5 = $this->identifyMode($sp89dfd0); if ($spad2fa5 == QR_MODE_KANJI) { break; } if ($spad2fa5 == QR_MODE_NUM) { $sp5456d1 = $sp89dfd0; while (self::isdigitat($this->dataStr, $sp5456d1)) { $sp5456d1++; } $sp278491 = QRinput::estimateBitsMode8($sp89dfd0) + QRinput::estimateBitsModeNum($sp5456d1 - $sp89dfd0) + 4 + $sp298c5c - QRinput::estimateBitsMode8($sp5456d1); if ($sp278491 < 0) { break; } else { $sp89dfd0 = $sp5456d1; } } else { if ($spad2fa5 == QR_MODE_AN) { $sp5456d1 = $sp89dfd0; while (self::isalnumat($this->dataStr, $sp5456d1)) { $sp5456d1++; } $sp278491 = QRinput::estimateBitsMode8($sp89dfd0) + QRinput::estimateBitsModeAn($sp5456d1 - $sp89dfd0) + 4 + $spcaa3d3 - QRinput::estimateBitsMode8($sp5456d1); if ($sp278491 < 0) { break; } else { $sp89dfd0 = $sp5456d1; } } else { $sp89dfd0++; } } } $sp4ae707 = $sp89dfd0; $sp6f1294 = $this->input->append(QR_MODE_8, $sp4ae707, str_split($this->dataStr)); if ($sp6f1294 < 0) { return -1; } return $sp4ae707; } public function splitString() { while (strlen($this->dataStr) > 0) { if ($this->dataStr == '') { return 0; } $spad2fa5 = $this->identifyMode(0); switch ($spad2fa5) { case QR_MODE_NUM: $sp4d881e = $this->eatNum(); break; case QR_MODE_AN: $sp4d881e = $this->eatAn(); break; case QR_MODE_KANJI: if ($sp341d94 == QR_MODE_KANJI) { $sp4d881e = $this->eatKanji(); } else { $sp4d881e = $this->eat8(); } break; default: $sp4d881e = $this->eat8(); break; } if ($sp4d881e == 0) { return 0; } if ($sp4d881e < 0) { return -1; } $this->dataStr = substr($this->dataStr, $sp4d881e); } } public function toUpper() { $spb11909 = strlen($this->dataStr); $sp89dfd0 = 0; while ($sp89dfd0 < $spb11909) { $spad2fa5 = self::identifyMode(substr($this->dataStr, $sp89dfd0), $this->modeHint); if ($spad2fa5 == QR_MODE_KANJI) { $sp89dfd0 += 2; } else { if (ord($this->dataStr[$sp89dfd0]) >= ord('a') && ord($this->dataStr[$sp89dfd0]) <= ord('z')) { $this->dataStr[$sp89dfd0] = chr(ord($this->dataStr[$sp89dfd0]) - 32); } $sp89dfd0++; } } return $this->dataStr; } public static function splitStringToQRinput($sp6dba13, QRinput $sp5bf110, $spfe4e1b, $sp924c0f = true) { if (is_null($sp6dba13) || $sp6dba13 == '\\0' || $sp6dba13 == '') { throw new Exception('empty string!!!'); } $spb8fb84 = new QRsplit($sp6dba13, $sp5bf110, $spfe4e1b); if (!$sp924c0f) { $spb8fb84->toUpper(); } return $spb8fb84->splitString(); } } class QRrsItem { public $mm; public $nn; public $alpha_to = array(); public $index_of = array(); public $genpoly = array(); public $nroots; public $fcr; public $prim; public $iprim; public $pad; public $gfpoly; public function modnn($spbf883a) { while ($spbf883a >= $this->nn) { $spbf883a -= $this->nn; $spbf883a = ($spbf883a >> $this->mm) + ($spbf883a & $this->nn); } return $spbf883a; } public static function init_rs_char($spe74f6c, $spccc173, $spae8352, $sp85cd70, $sp1557db, $spf3208b) { $sp021972 = null; if ($spe74f6c < 0 || $spe74f6c > 8) { return $sp021972; } if ($spae8352 < 0 || $spae8352 >= 1 << $spe74f6c) { return $sp021972; } if ($sp85cd70 <= 0 || $sp85cd70 >= 1 << $spe74f6c) { return $sp021972; } if ($sp1557db < 0 || $sp1557db >= 1 << $spe74f6c) { return $sp021972; } if ($spf3208b < 0 || $spf3208b >= (1 << $spe74f6c) - 1 - $sp1557db) { return $sp021972; } $sp021972 = new QRrsItem(); $sp021972->mm = $spe74f6c; $sp021972->nn = (1 << $spe74f6c) - 1; $sp021972->pad = $spf3208b; $sp021972->alpha_to = array_fill(0, $sp021972->nn + 1, 0); $sp021972->index_of = array_fill(0, $sp021972->nn + 1, 0); $sp01d88b =& $sp021972->nn; $spe98827 =& $sp01d88b; $sp021972->index_of[0] = $spe98827; $sp021972->alpha_to[$spe98827] = 0; $spc70640 = 1; for ($spf69b52 = 0; $spf69b52 < $sp021972->nn; $spf69b52++) { $sp021972->index_of[$spc70640] = $spf69b52; $sp021972->alpha_to[$spf69b52] = $spc70640; $spc70640 <<= 1; if ($spc70640 & 1 << $spe74f6c) { $spc70640 ^= $spccc173; } $spc70640 &= $sp021972->nn; } if ($spc70640 != 1) { $sp021972 = NULL; return $sp021972; } $sp021972->genpoly = array_fill(0, $sp1557db + 1, 0); $sp021972->fcr = $spae8352; $sp021972->prim = $sp85cd70; $sp021972->nroots = $sp1557db; $sp021972->gfpoly = $spccc173; for ($spff50cb = 1; $spff50cb % $sp85cd70 != 0; $spff50cb += $sp021972->nn) { } $sp021972->iprim = (int) ($spff50cb / $sp85cd70); $sp021972->genpoly[0] = 1; for ($spf69b52 = 0, $speb9d08 = $spae8352 * $sp85cd70; $spf69b52 < $sp1557db; $spf69b52++, $speb9d08 += $sp85cd70) { $sp021972->genpoly[$spf69b52 + 1] = 1; for ($spa68871 = $spf69b52; $spa68871 > 0; $spa68871--) { if ($sp021972->genpoly[$spa68871] != 0) { $sp021972->genpoly[$spa68871] = $sp021972->genpoly[$spa68871 - 1] ^ $sp021972->alpha_to[$sp021972->modnn($sp021972->index_of[$sp021972->genpoly[$spa68871]] + $speb9d08)]; } else { $sp021972->genpoly[$spa68871] = $sp021972->genpoly[$spa68871 - 1]; } } $sp021972->genpoly[0] = $sp021972->alpha_to[$sp021972->modnn($sp021972->index_of[$sp021972->genpoly[0]] + $speb9d08)]; } for ($spf69b52 = 0; $spf69b52 <= $sp1557db; $spf69b52++) { $sp021972->genpoly[$spf69b52] = $sp021972->index_of[$sp021972->genpoly[$spf69b52]]; } return $sp021972; } public function encode_rs_char($sp69c4ce, &$spebbaf2) { $sp049afb =& $this->mm; $sp01d88b =& $this->nn; $sp47fb8a =& $this->alpha_to; $sp8b6045 =& $this->index_of; $sp8010e7 =& $this->genpoly; $sp3d5e7f =& $this->nroots; $sp96731e =& $this->fcr; $spc455c4 =& $this->prim; $sp155752 =& $this->iprim; $spad98b4 =& $this->pad; $spe98827 =& $sp01d88b; $spebbaf2 = array_fill(0, $sp3d5e7f, 0); for ($spf69b52 = 0; $spf69b52 < $sp01d88b - $sp3d5e7f - $spad98b4; $spf69b52++) { $spbc20d5 = $sp8b6045[$sp69c4ce[$spf69b52] ^ $spebbaf2[0]]; if ($spbc20d5 != $spe98827) { $spbc20d5 = $this->modnn($sp01d88b - $sp8010e7[$sp3d5e7f] + $spbc20d5); for ($spa68871 = 1; $spa68871 < $sp3d5e7f; $spa68871++) { $spebbaf2[$spa68871] ^= $sp47fb8a[$this->modnn($spbc20d5 + $sp8010e7[$sp3d5e7f - $spa68871])]; } } array_shift($spebbaf2); if ($spbc20d5 != $spe98827) { array_push($spebbaf2, $sp47fb8a[$this->modnn($spbc20d5 + $sp8010e7[0])]); } else { array_push($spebbaf2, 0); } } } } class QRrs { public static $items = array(); public static function init_rs($spe74f6c, $spccc173, $spae8352, $sp85cd70, $sp1557db, $spf3208b) { foreach (self::$items as $sp021972) { if ($sp021972->pad != $spf3208b) { continue; } if ($sp021972->nroots != $sp1557db) { continue; } if ($sp021972->mm != $spe74f6c) { continue; } if ($sp021972->gfpoly != $spccc173) { continue; } if ($sp021972->fcr != $spae8352) { continue; } if ($sp021972->prim != $sp85cd70) { continue; } return $sp021972; } $sp021972 = QRrsItem::init_rs_char($spe74f6c, $spccc173, $spae8352, $sp85cd70, $sp1557db, $spf3208b); array_unshift(self::$items, $sp021972); return $sp021972; } } define('N1', 3); define('N2', 3); define('N3', 40); define('N4', 10); class QRmask { public $runLength = array(); public function __construct() { $this->runLength = array_fill(0, QRSPEC_WIDTH_MAX + 1, 0); } public function writeFormatInformation($sp5b5eb3, &$spacf6ed, $sp385b35, $sp013fda) { $spba869a = 0; $spa81a63 = QRspec::getFormatInfo($sp385b35, $sp013fda); for ($spf69b52 = 0; $spf69b52 < 8; $spf69b52++) { if ($spa81a63 & 1) { $spba869a += 2; $sp2a00a3 = 133; } else { $sp2a00a3 = 132; } $spacf6ed[8][$sp5b5eb3 - 1 - $spf69b52] = chr($sp2a00a3); if ($spf69b52 < 6) { $spacf6ed[$spf69b52][8] = chr($sp2a00a3); } else { $spacf6ed[$spf69b52 + 1][8] = chr($sp2a00a3); } $spa81a63 = $spa81a63 >> 1; } for ($spf69b52 = 0; $spf69b52 < 7; $spf69b52++) { if ($spa81a63 & 1) { $spba869a += 2; $sp2a00a3 = 133; } else { $sp2a00a3 = 132; } $spacf6ed[$sp5b5eb3 - 7 + $spf69b52][8] = chr($sp2a00a3); if ($spf69b52 == 0) { $spacf6ed[8][7] = chr($sp2a00a3); } else { $spacf6ed[8][6 - $spf69b52] = chr($sp2a00a3); } $spa81a63 = $spa81a63 >> 1; } return $spba869a; } public function mask0($spbf883a, $sp5c0f56) { return $spbf883a + $sp5c0f56 & 1; } public function mask1($spbf883a, $sp5c0f56) { return $sp5c0f56 & 1; } public function mask2($spbf883a, $sp5c0f56) { return $spbf883a % 3; } public function mask3($spbf883a, $sp5c0f56) { return ($spbf883a + $sp5c0f56) % 3; } public function mask4($spbf883a, $sp5c0f56) { return (int) ($sp5c0f56 / 2) + (int) ($spbf883a / 3) & 1; } public function mask5($spbf883a, $sp5c0f56) { return ($spbf883a * $sp5c0f56 & 1) + $spbf883a * $sp5c0f56 % 3; } public function mask6($spbf883a, $sp5c0f56) { return ($spbf883a * $sp5c0f56 & 1) + $spbf883a * $sp5c0f56 % 3 & 1; } public function mask7($spbf883a, $sp5c0f56) { return $spbf883a * $sp5c0f56 % 3 + ($spbf883a + $sp5c0f56 & 1) & 1; } private function generateMaskNo($spc440f7, $sp5b5eb3, $spacf6ed) { $sp63c19a = array_fill(0, $sp5b5eb3, array_fill(0, $sp5b5eb3, 0)); for ($sp5c0f56 = 0; $sp5c0f56 < $sp5b5eb3; $sp5c0f56++) { for ($spbf883a = 0; $spbf883a < $sp5b5eb3; $spbf883a++) { if (ord($spacf6ed[$sp5c0f56][$spbf883a]) & 128) { $sp63c19a[$sp5c0f56][$spbf883a] = 0; } else { $sp07d3d5 = call_user_func(array($this, 'mask' . $spc440f7), $spbf883a, $sp5c0f56); $sp63c19a[$sp5c0f56][$spbf883a] = $sp07d3d5 == 0 ? 1 : 0; } } } return $sp63c19a; } public static function serial($spa0da89) { $sp367c3c = array(); foreach ($spa0da89 as $spf5239b) { $sp367c3c[] = join('', $spf5239b); } return gzcompress(join('
', $sp367c3c), 9); } public static function unserial($sp199781) { $sp367c3c = array(); $sp9fa445 = explode('
', gzuncompress($sp199781)); foreach ($sp9fa445 as $spf5239b) { $sp367c3c[] = str_split($spf5239b); } return $sp367c3c; } public function makeMaskNo($spc440f7, $sp5b5eb3, $sp2cbe8d, &$spc2f836, $sp01e813 = false) { $sp2d97c0 = 0; $sp63c19a = array(); $sp3a6b70 = QR_CACHE_DIR . 'mask_' . $spc440f7 . DIRECTORY_SEPARATOR . 'mask_' . $sp5b5eb3 . '_' . $spc440f7 . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp3a6b70)) { $sp63c19a = self::unserial(file_get_contents($sp3a6b70)); } else { $sp63c19a = $this->generateMaskNo($spc440f7, $sp5b5eb3, $sp2cbe8d, $spc2f836); if (!file_exists(QR_CACHE_DIR . 'mask_' . $spc440f7)) { mkdir(QR_CACHE_DIR . 'mask_' . $spc440f7); } file_put_contents($sp3a6b70, self::serial($sp63c19a)); } } else { $sp63c19a = $this->generateMaskNo($spc440f7, $sp5b5eb3, $sp2cbe8d, $spc2f836); } if ($sp01e813) { return; } $spc2f836 = $sp2cbe8d; for ($sp5c0f56 = 0; $sp5c0f56 < $sp5b5eb3; $sp5c0f56++) { for ($spbf883a = 0; $spbf883a < $sp5b5eb3; $spbf883a++) { if ($sp63c19a[$sp5c0f56][$spbf883a] == 1) { $spc2f836[$sp5c0f56][$spbf883a] = chr(ord($sp2cbe8d[$sp5c0f56][$spbf883a]) ^ (int) $sp63c19a[$sp5c0f56][$spbf883a]); } $sp2d97c0 += (int) (ord($spc2f836[$sp5c0f56][$spbf883a]) & 1); } } return $sp2d97c0; } public function makeMask($sp5b5eb3, $spacf6ed, $spc440f7, $sp013fda) { $sp1f6a91 = array_fill(0, $sp5b5eb3, str_repeat(' ', $sp5b5eb3)); $this->makeMaskNo($spc440f7, $sp5b5eb3, $spacf6ed, $sp1f6a91); $this->writeFormatInformation($sp5b5eb3, $sp1f6a91, $spc440f7, $sp013fda); return $sp1f6a91; } public function calcN1N3($sp4d881e) { $sp07cd55 = 0; for ($spf69b52 = 0; $spf69b52 < $sp4d881e; $spf69b52++) { if ($this->runLength[$spf69b52] >= 5) { $sp07cd55 += N1 + ($this->runLength[$spf69b52] - 5); } if ($spf69b52 & 1) { if ($spf69b52 >= 3 && $spf69b52 < $sp4d881e - 2 && $this->runLength[$spf69b52] % 3 == 0) { $sp3a623a = (int) ($this->runLength[$spf69b52] / 3); if ($this->runLength[$spf69b52 - 2] == $sp3a623a && $this->runLength[$spf69b52 - 1] == $sp3a623a && $this->runLength[$spf69b52 + 1] == $sp3a623a && $this->runLength[$spf69b52 + 2] == $sp3a623a) { if ($this->runLength[$spf69b52 - 3] < 0 || $this->runLength[$spf69b52 - 3] >= 4 * $sp3a623a) { $sp07cd55 += N3; } else { if ($spf69b52 + 3 >= $sp4d881e || $this->runLength[$spf69b52 + 3] >= 4 * $sp3a623a) { $sp07cd55 += N3; } } } } } } return $sp07cd55; } public function evaluateSymbol($sp5b5eb3, $spacf6ed) { $sp6df387 = 0; $sp07cd55 = 0; for ($sp5c0f56 = 0; $sp5c0f56 < $sp5b5eb3; $sp5c0f56++) { $sp6df387 = 0; $this->runLength[0] = 1; $spb6ea24 = $spacf6ed[$sp5c0f56]; if ($sp5c0f56 > 0) { $spf30d4c = $spacf6ed[$sp5c0f56 - 1]; } for ($spbf883a = 0; $spbf883a < $sp5b5eb3; $spbf883a++) { if ($spbf883a > 0 && $sp5c0f56 > 0) { $sp258184 = ord($spb6ea24[$spbf883a]) & ord($spb6ea24[$spbf883a - 1]) & ord($spf30d4c[$spbf883a]) & ord($spf30d4c[$spbf883a - 1]); $spa41289 = ord($spb6ea24[$spbf883a]) | ord($spb6ea24[$spbf883a - 1]) | ord($spf30d4c[$spbf883a]) | ord($spf30d4c[$spbf883a - 1]); if (($sp258184 | $spa41289 ^ 1) & 1) { $sp07cd55 += N2; } } if ($spbf883a == 0 && ord($spb6ea24[$spbf883a]) & 1) { $this->runLength[0] = -1; $sp6df387 = 1; $this->runLength[$sp6df387] = 1; } else { if ($spbf883a > 0) { if ((ord($spb6ea24[$spbf883a]) ^ ord($spb6ea24[$spbf883a - 1])) & 1) { $sp6df387++; $this->runLength[$sp6df387] = 1; } else { $this->runLength[$sp6df387]++; } } } } $sp07cd55 += $this->calcN1N3($sp6df387 + 1); } for ($spbf883a = 0; $spbf883a < $sp5b5eb3; $spbf883a++) { $sp6df387 = 0; $this->runLength[0] = 1; for ($sp5c0f56 = 0; $sp5c0f56 < $sp5b5eb3; $sp5c0f56++) { if ($sp5c0f56 == 0 && ord($spacf6ed[$sp5c0f56][$spbf883a]) & 1) { $this->runLength[0] = -1; $sp6df387 = 1; $this->runLength[$sp6df387] = 1; } else { if ($sp5c0f56 > 0) { if ((ord($spacf6ed[$sp5c0f56][$spbf883a]) ^ ord($spacf6ed[$sp5c0f56 - 1][$spbf883a])) & 1) { $sp6df387++; $this->runLength[$sp6df387] = 1; } else { $this->runLength[$sp6df387]++; } } } } $sp07cd55 += $this->calcN1N3($sp6df387 + 1); } return $sp07cd55; } public function mask($sp5b5eb3, $spacf6ed, $sp013fda) { $sp51c3c8 = PHP_INT_MAX; $sp9ba31c = 0; $spfb6502 = array(); $spe33c29 = array(0, 1, 2, 3, 4, 5, 6, 7); if (QR_FIND_FROM_RANDOM !== false) { $sp090c38 = 8 - QR_FIND_FROM_RANDOM % 9; for ($spf69b52 = 0; $spf69b52 < $sp090c38; $spf69b52++) { $sp7aff90 = rand(0, count($spe33c29) - 1); unset($spe33c29[$sp7aff90]); $spe33c29 = array_values($spe33c29); } } $spfb6502 = $spacf6ed; foreach ($spe33c29 as $spf69b52) { $sp385b35 = array_fill(0, $sp5b5eb3, str_repeat(' ', $sp5b5eb3)); $sp07cd55 = 0; $spba869a = 0; $spba869a = $this->makeMaskNo($spf69b52, $sp5b5eb3, $spacf6ed, $sp385b35); $spba869a += $this->writeFormatInformation($sp5b5eb3, $sp385b35, $spf69b52, $sp013fda); $spba869a = (int) (100 * $spba869a / ($sp5b5eb3 * $sp5b5eb3)); $sp07cd55 = (int) ((int) (abs($spba869a - 50) / 5) * N4); $sp07cd55 += $this->evaluateSymbol($sp5b5eb3, $sp385b35); if ($sp07cd55 < $sp51c3c8) { $sp51c3c8 = $sp07cd55; $spfb6502 = $sp385b35; $sp9ba31c = $spf69b52; } } return $spfb6502; } } class QRrsblock { public $dataLength; public $data = array(); public $eccLength; public $ecc = array(); public function __construct($spd7f78e, $sp69c4ce, $spe78c57, &$sp55f187, QRrsItem $sp021972) { $sp021972->encode_rs_char($sp69c4ce, $sp55f187); $this->dataLength = $spd7f78e; $this->data = $sp69c4ce; $this->eccLength = $spe78c57; $this->ecc = $sp55f187; } } class QRrawcode { public $version; public $datacode = array(); public $ecccode = array(); public $blocks; public $rsblocks = array(); public $count; public $dataLength; public $eccLength; public $b1; public function __construct(QRinput $sp5bf110) { $sp3ec8a8 = array(0, 0, 0, 0, 0); $this->datacode = $sp5bf110->getByteStream(); if (is_null($this->datacode)) { throw new Exception('null imput string'); } QRspec::getEccSpec($sp5bf110->getVersion(), $sp5bf110->getErrorCorrectionLevel(), $sp3ec8a8); $this->version = $sp5bf110->getVersion(); $this->b1 = QRspec::rsBlockNum1($sp3ec8a8); $this->dataLength = QRspec::rsDataLength($sp3ec8a8); $this->eccLength = QRspec::rsEccLength($sp3ec8a8); $this->ecccode = array_fill(0, $this->eccLength, 0); $this->blocks = QRspec::rsBlockNum($sp3ec8a8); $sp6f1294 = $this->init($sp3ec8a8); if ($sp6f1294 < 0) { throw new Exception('block alloc error'); return null; } $this->count = 0; } public function init(array $sp3ec8a8) { $spd7f78e = QRspec::rsDataCodes1($sp3ec8a8); $spe78c57 = QRspec::rsEccCodes1($sp3ec8a8); $sp021972 = QRrs::init_rs(8, 285, 0, 1, $spe78c57, 255 - $spd7f78e - $spe78c57); $spe345e2 = 0; $sp3e5973 = 0; $sp3d2c4f = 0; for ($spf69b52 = 0; $spf69b52 < QRspec::rsBlockNum1($sp3ec8a8); $spf69b52++) { $sp55f187 = array_slice($this->ecccode, $sp3d2c4f); $this->rsblocks[$spe345e2] = new QRrsblock($spd7f78e, array_slice($this->datacode, $sp3e5973), $spe78c57, $sp55f187, $sp021972); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp3d2c4f), $sp55f187); $sp3e5973 += $spd7f78e; $sp3d2c4f += $spe78c57; $spe345e2++; } if (QRspec::rsBlockNum2($sp3ec8a8) == 0) { return 0; } $spd7f78e = QRspec::rsDataCodes2($sp3ec8a8); $spe78c57 = QRspec::rsEccCodes2($sp3ec8a8); $sp021972 = QRrs::init_rs(8, 285, 0, 1, $spe78c57, 255 - $spd7f78e - $spe78c57); if ($sp021972 == NULL) { return -1; } for ($spf69b52 = 0; $spf69b52 < QRspec::rsBlockNum2($sp3ec8a8); $spf69b52++) { $sp55f187 = array_slice($this->ecccode, $sp3d2c4f); $this->rsblocks[$spe345e2] = new QRrsblock($spd7f78e, array_slice($this->datacode, $sp3e5973), $spe78c57, $sp55f187, $sp021972); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp3d2c4f), $sp55f187); $sp3e5973 += $spd7f78e; $sp3d2c4f += $spe78c57; $spe345e2++; } return 0; } public function getCode() { $sp6f1294; if ($this->count < $this->dataLength) { $sp3c328f = $this->count % $this->blocks; $sp5a15cd = $this->count / $this->blocks; if ($sp5a15cd >= $this->rsblocks[0]->dataLength) { $sp3c328f += $this->b1; } $sp6f1294 = $this->rsblocks[$sp3c328f]->data[$sp5a15cd]; } else { if ($this->count < $this->dataLength + $this->eccLength) { $sp3c328f = ($this->count - $this->dataLength) % $this->blocks; $sp5a15cd = ($this->count - $this->dataLength) / $this->blocks; $sp6f1294 = $this->rsblocks[$sp3c328f]->ecc[$sp5a15cd]; } else { return 0; } } $this->count++; return $sp6f1294; } } class QRcode { public $version; public $width; public $data; public function encodeMask(QRinput $sp5bf110, $sp385b35) { if ($sp5bf110->getVersion() < 0 || $sp5bf110->getVersion() > QRSPEC_VERSION_MAX) { throw new Exception('wrong version'); } if ($sp5bf110->getErrorCorrectionLevel() > QR_ECLEVEL_H) { throw new Exception('wrong level'); } $sp4ec59e = new QRrawcode($sp5bf110); QRtools::markTime('after_raw'); $spc801f8 = $sp4ec59e->version; $sp5b5eb3 = QRspec::getWidth($spc801f8); $spacf6ed = QRspec::newFrame($spc801f8); $sp847acf = new FrameFiller($sp5b5eb3, $spacf6ed); if (is_null($sp847acf)) { return NULL; } for ($spf69b52 = 0; $spf69b52 < $sp4ec59e->dataLength + $sp4ec59e->eccLength; $spf69b52++) { $sp199781 = $sp4ec59e->getCode(); $sp15aa20 = 128; for ($spa68871 = 0; $spa68871 < 8; $spa68871++) { $spdff60c = $sp847acf->next(); $sp847acf->setFrameAt($spdff60c, 2 | ($sp15aa20 & $sp199781) != 0); $sp15aa20 = $sp15aa20 >> 1; } } QRtools::markTime('after_filler'); unset($sp4ec59e); $spa68871 = QRspec::getRemainder($spc801f8); for ($spf69b52 = 0; $spf69b52 < $spa68871; $spf69b52++) { $spdff60c = $sp847acf->next(); $sp847acf->setFrameAt($spdff60c, 2); } $spacf6ed = $sp847acf->frame; unset($sp847acf); $sp452d7b = new QRmask(); if ($sp385b35 < 0) { if (QR_FIND_BEST_MASK) { $sp1f6a91 = $sp452d7b->mask($sp5b5eb3, $spacf6ed, $sp5bf110->getErrorCorrectionLevel()); } else { $sp1f6a91 = $sp452d7b->makeMask($sp5b5eb3, $spacf6ed, intval(QR_DEFAULT_MASK) % 8, $sp5bf110->getErrorCorrectionLevel()); } } else { $sp1f6a91 = $sp452d7b->makeMask($sp5b5eb3, $spacf6ed, $sp385b35, $sp5bf110->getErrorCorrectionLevel()); } if ($sp1f6a91 == NULL) { return NULL; } QRtools::markTime('after_mask'); $this->version = $spc801f8; $this->width = $sp5b5eb3; $this->data = $sp1f6a91; return $this; } public function encodeInput(QRinput $sp5bf110) { return $this->encodeMask($sp5bf110, -1); } public function encodeString8bit($sp6dba13, $spc801f8, $sp013fda) { if (string == NULL) { throw new Exception('empty string!'); return NULL; } $sp5bf110 = new QRinput($spc801f8, $sp013fda); if ($sp5bf110 == NULL) { return NULL; } $sp6f1294 = $sp5bf110->append($sp5bf110, QR_MODE_8, strlen($sp6dba13), str_split($sp6dba13)); if ($sp6f1294 < 0) { unset($sp5bf110); return NULL; } return $this->encodeInput($sp5bf110); } public function encodeString($sp6dba13, $spc801f8, $sp013fda, $sp341d94, $sp924c0f) { if ($sp341d94 != QR_MODE_8 && $sp341d94 != QR_MODE_KANJI) { throw new Exception('bad hint'); return NULL; } $sp5bf110 = new QRinput($spc801f8, $sp013fda); if ($sp5bf110 == NULL) { return NULL; } $sp6f1294 = QRsplit::splitStringToQRinput($sp6dba13, $sp5bf110, $sp341d94, $sp924c0f); if ($sp6f1294 < 0) { return NULL; } return $this->encodeInput($sp5bf110); } public static function png($spedba08, $sp6e96a5 = false, $sp013fda = QR_ECLEVEL_L, $spf2f171 = 3, $sp09101a = 4, $sp0ebf30 = false) { $sp58581c = QRencode::factory($sp013fda, $spf2f171, $sp09101a); return $sp58581c->encodePNG($spedba08, $sp6e96a5, $sp0ebf30 = false); } public static function text($spedba08, $sp6e96a5 = false, $sp013fda = QR_ECLEVEL_L, $spf2f171 = 3, $sp09101a = 4) { $sp58581c = QRencode::factory($sp013fda, $spf2f171, $sp09101a); return $sp58581c->encode($spedba08, $sp6e96a5); } public static function raw($spedba08, $sp6e96a5 = false, $sp013fda = QR_ECLEVEL_L, $spf2f171 = 3, $sp09101a = 4) { $sp58581c = QRencode::factory($sp013fda, $spf2f171, $sp09101a); return $sp58581c->encodeRAW($spedba08, $sp6e96a5); } } class FrameFiller { public $width; public $frame; public $x; public $y; public $dir; public $bit; public function __construct($sp5b5eb3, &$spacf6ed) { $this->width = $sp5b5eb3; $this->frame = $spacf6ed; $this->x = $sp5b5eb3 - 1; $this->y = $sp5b5eb3 - 1; $this->dir = -1; $this->bit = -1; } public function setFrameAt($spe5c5a1, $sp7a0550) { $this->frame[$spe5c5a1['y']][$spe5c5a1['x']] = chr($sp7a0550); } public function getFrameAt($spe5c5a1) { return ord($this->frame[$spe5c5a1['y']][$spe5c5a1['x']]); } public function next() { do { if ($this->bit == -1) { $this->bit = 0; return array('x' => $this->x, 'y' => $this->y); } $spbf883a = $this->x; $sp5c0f56 = $this->y; $sp514488 = $this->width; if ($this->bit == 0) { $spbf883a--; $this->bit++; } else { $spbf883a++; $sp5c0f56 += $this->dir; $this->bit--; } if ($this->dir < 0) { if ($sp5c0f56 < 0) { $sp5c0f56 = 0; $spbf883a -= 2; $this->dir = 1; if ($spbf883a == 6) { $spbf883a--; $sp5c0f56 = 9; } } } else { if ($sp5c0f56 == $sp514488) { $sp5c0f56 = $sp514488 - 1; $spbf883a -= 2; $this->dir = -1; if ($spbf883a == 6) { $spbf883a--; $sp5c0f56 -= 8; } } } if ($spbf883a < 0 || $sp5c0f56 < 0) { return null; } $this->x = $spbf883a; $this->y = $sp5c0f56; } while (ord($this->frame[$sp5c0f56][$spbf883a]) & 128); return array('x' => $spbf883a, 'y' => $sp5c0f56); } } class QRencode { public $casesensitive = true; public $eightbit = false; public $version = 0; public $size = 3; public $margin = 4; public $structured = 0; public $level = QR_ECLEVEL_L; public $hint = QR_MODE_8; public static function factory($sp013fda = QR_ECLEVEL_L, $spf2f171 = 3, $sp09101a = 4) { $sp58581c = new QRencode(); $sp58581c->size = $spf2f171; $sp58581c->margin = $sp09101a; switch ($sp013fda . '') { case '0': case '1': case '2': case '3': $sp58581c->level = $sp013fda; break; case 'l': case 'L': $sp58581c->level = QR_ECLEVEL_L; break; case 'm': case 'M': $sp58581c->level = QR_ECLEVEL_M; break; case 'q': case 'Q': $sp58581c->level = QR_ECLEVEL_Q; break; case 'h': case 'H': $sp58581c->level = QR_ECLEVEL_H; break; } return $sp58581c; } public function encodeRAW($sp071865, $sp6e96a5 = false) { $sp199781 = new QRcode(); if ($this->eightbit) { $sp199781->encodeString8bit($sp071865, $this->version, $this->level); } else { $sp199781->encodeString($sp071865, $this->version, $this->level, $this->hint, $this->casesensitive); } return $sp199781->data; } public function encode($sp071865, $sp6e96a5 = false) { $sp199781 = new QRcode(); if ($this->eightbit) { $sp199781->encodeString8bit($sp071865, $this->version, $this->level); } else { $sp199781->encodeString($sp071865, $this->version, $this->level, $this->hint, $this->casesensitive); } QRtools::markTime('after_encode'); if ($sp6e96a5 !== false) { file_put_contents($sp6e96a5, join('
', QRtools::binarize($sp199781->data))); } else { return QRtools::binarize($sp199781->data); } } public function encodePNG($sp071865, $sp6e96a5 = false, $sp0ebf30 = false) { try { ob_start(); $spb34ee6 = $this->encode($sp071865); $sp6d6cfd = ob_get_contents(); ob_end_clean(); if ($sp6d6cfd != '') { QRtools::log($sp6e96a5, $sp6d6cfd); } $sp383bab = (int) (QR_PNG_MAXIMUM_SIZE / (count($spb34ee6) + 2 * $this->margin)); QRimage::png($spb34ee6, $sp6e96a5, min(max(1, $this->size), $sp383bab), $this->margin, $sp0ebf30); } catch (Exception $spbcc446) { QRtools::log($sp6e96a5, $spbcc446->getMessage()); } } }