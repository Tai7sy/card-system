<?php
define('QR_MODE_NUL', -1); define('QR_MODE_NUM', 0); define('QR_MODE_AN', 1); define('QR_MODE_8', 2); define('QR_MODE_KANJI', 3); define('QR_MODE_STRUCTURE', 4); define('QR_ECLEVEL_L', 0); define('QR_ECLEVEL_M', 1); define('QR_ECLEVEL_Q', 2); define('QR_ECLEVEL_H', 3); define('QR_FORMAT_TEXT', 0); define('QR_FORMAT_PNG', 1); class qrstr { public static function set(&$spd94fb0, $sp521ef8, $spfe16e7, $spa3530e, $spfb94dc = false) { $spd94fb0[$spfe16e7] = substr_replace($spd94fb0[$spfe16e7], $spfb94dc !== false ? substr($spa3530e, 0, $spfb94dc) : $spa3530e, $sp521ef8, $spfb94dc !== false ? $spfb94dc : strlen($spa3530e)); } } define('QR_CACHEABLE', false); define('QR_CACHE_DIR', false); define('QR_LOG_DIR', false); define('QR_FIND_BEST_MASK', true); define('QR_FIND_FROM_RANDOM', 2); define('QR_DEFAULT_MASK', 2); define('QR_PNG_MAXIMUM_SIZE', 1024); class QRtools { public static function binarize($sp2cfdb8) { $sp60db54 = count($sp2cfdb8); foreach ($sp2cfdb8 as &$sp9445aa) { for ($sp218d20 = 0; $sp218d20 < $sp60db54; $sp218d20++) { $sp9445aa[$sp218d20] = ord($sp9445aa[$sp218d20]) & 1 ? '1' : '0'; } } return $sp2cfdb8; } public static function tcpdfBarcodeArray($spd51873, $sp8211ed = 'QR,L', $sp1c9014 = '4.5.037') { $spa01deb = array(); if (!is_array($sp8211ed)) { $sp8211ed = explode(',', $sp8211ed); } $sp4dd2bc = 'L'; if (count($sp8211ed) > 1) { $sp4dd2bc = $sp8211ed[1]; } $spda32b9 = QRcode::text($spd51873, false, $sp4dd2bc); $sp5b0542 = count($spda32b9); $spa01deb['num_rows'] = $sp5b0542; $spa01deb['num_cols'] = $sp5b0542; $spa01deb['bcode'] = array(); foreach ($spda32b9 as $sp91490f) { $spa64776 = array(); foreach (str_split($sp91490f) as $spdb558d) { $spa64776[] = $spdb558d == '1' ? 1 : 0; } $spa01deb['bcode'][] = $spa64776; } return $spa01deb; } public static function clearCache() { self::$frames = array(); } public static function buildCache() { QRtools::markTime('before_build_cache'); $spa3e44c = new QRmask(); for ($spa154f9 = 1; $spa154f9 <= QRSPEC_VERSION_MAX; $spa154f9++) { $sp2cfdb8 = QRspec::newFrame($spa154f9); if (QR_IMAGE) { $sp522c55 = QR_CACHE_DIR . 'frame_' . $spa154f9 . '.png'; QRimage::png(self::binarize($sp2cfdb8), $sp522c55, 1, 0); } $sp395073 = count($sp2cfdb8); $sp4ad1ae = array_fill(0, $sp395073, array_fill(0, $sp395073, 0)); for ($sp138bae = 0; $sp138bae < 8; $sp138bae++) { $spa3e44c->makeMaskNo($sp138bae, $sp395073, $sp2cfdb8, $sp4ad1ae, true); } } QRtools::markTime('after_build_cache'); } public static function log($spc67485, $sp165219) { if (QR_LOG_DIR !== false) { if ($sp165219 != '') { if ($spc67485 !== false) { file_put_contents(QR_LOG_DIR . basename($spc67485) . '-errors.txt', date('Y-m-d H:i:s') . ': ' . $sp165219, FILE_APPEND); } else { file_put_contents(QR_LOG_DIR . 'errors.txt', date('Y-m-d H:i:s') . ': ' . $sp165219, FILE_APPEND); } } } } public static function dumpMask($sp2cfdb8) { $sp395073 = count($sp2cfdb8); for ($spfe16e7 = 0; $spfe16e7 < $sp395073; $spfe16e7++) { for ($sp521ef8 = 0; $sp521ef8 < $sp395073; $sp521ef8++) { echo ord($sp2cfdb8[$spfe16e7][$sp521ef8]) . ','; } } } public static function markTime($spfc877b) { list($spdf1d1b, $sp7677d6) = explode(' ', microtime()); $sp8ff766 = (double) $spdf1d1b + (double) $sp7677d6; if (!isset($sp03cf15['qr_time_bench'])) { $sp03cf15['qr_time_bench'] = array(); } $sp03cf15['qr_time_bench'][$spfc877b] = $sp8ff766; } public static function timeBenchmark() { self::markTime('finish'); $spe6f3e7 = 0; $sp7d35f1 = 0; $spfe92bd = 0; echo '<table cellpadding="3" cellspacing="1">
                    <thead><tr style="border-bottom:1px solid silver"><td colspan="2" style="text-align:center">BENCHMARK</td></tr></thead>
                    <tbody>'; foreach ($sp03cf15['qr_time_bench'] as $spfc877b => $spef78cb) { if ($spfe92bd > 0) { echo '<tr><th style="text-align:right">till ' . $spfc877b . ': </th><td>' . number_format($spef78cb - $spe6f3e7, 6) . 's</td></tr>'; } else { $sp7d35f1 = $spef78cb; } $spfe92bd++; $spe6f3e7 = $spef78cb; } echo '</tbody><tfoot>
                <tr style="border-top:2px solid black"><th style="text-align:right">TOTAL: </th><td>' . number_format($spe6f3e7 - $sp7d35f1, 6) . 's</td></tr>
            </tfoot>
            </table>'; } } QRtools::markTime('start'); define('QRSPEC_VERSION_MAX', 40); define('QRSPEC_WIDTH_MAX', 177); define('QRCAP_WIDTH', 0); define('QRCAP_WORDS', 1); define('QRCAP_REMINDER', 2); define('QRCAP_EC', 3); class QRspec { public static $capacity = array(array(0, 0, 0, array(0, 0, 0, 0)), array(21, 26, 0, array(7, 10, 13, 17)), array(25, 44, 7, array(10, 16, 22, 28)), array(29, 70, 7, array(15, 26, 36, 44)), array(33, 100, 7, array(20, 36, 52, 64)), array(37, 134, 7, array(26, 48, 72, 88)), array(41, 172, 7, array(36, 64, 96, 112)), array(45, 196, 0, array(40, 72, 108, 130)), array(49, 242, 0, array(48, 88, 132, 156)), array(53, 292, 0, array(60, 110, 160, 192)), array(57, 346, 0, array(72, 130, 192, 224)), array(61, 404, 0, array(80, 150, 224, 264)), array(65, 466, 0, array(96, 176, 260, 308)), array(69, 532, 0, array(104, 198, 288, 352)), array(73, 581, 3, array(120, 216, 320, 384)), array(77, 655, 3, array(132, 240, 360, 432)), array(81, 733, 3, array(144, 280, 408, 480)), array(85, 815, 3, array(168, 308, 448, 532)), array(89, 901, 3, array(180, 338, 504, 588)), array(93, 991, 3, array(196, 364, 546, 650)), array(97, 1085, 3, array(224, 416, 600, 700)), array(101, 1156, 4, array(224, 442, 644, 750)), array(105, 1258, 4, array(252, 476, 690, 816)), array(109, 1364, 4, array(270, 504, 750, 900)), array(113, 1474, 4, array(300, 560, 810, 960)), array(117, 1588, 4, array(312, 588, 870, 1050)), array(121, 1706, 4, array(336, 644, 952, 1110)), array(125, 1828, 4, array(360, 700, 1020, 1200)), array(129, 1921, 3, array(390, 728, 1050, 1260)), array(133, 2051, 3, array(420, 784, 1140, 1350)), array(137, 2185, 3, array(450, 812, 1200, 1440)), array(141, 2323, 3, array(480, 868, 1290, 1530)), array(145, 2465, 3, array(510, 924, 1350, 1620)), array(149, 2611, 3, array(540, 980, 1440, 1710)), array(153, 2761, 3, array(570, 1036, 1530, 1800)), array(157, 2876, 0, array(570, 1064, 1590, 1890)), array(161, 3034, 0, array(600, 1120, 1680, 1980)), array(165, 3196, 0, array(630, 1204, 1770, 2100)), array(169, 3362, 0, array(660, 1260, 1860, 2220)), array(173, 3532, 0, array(720, 1316, 1950, 2310)), array(177, 3706, 0, array(750, 1372, 2040, 2430))); public static function getDataLength($sp348765, $sp8a0843) { return self::$capacity[$sp348765][QRCAP_WORDS] - self::$capacity[$sp348765][QRCAP_EC][$sp8a0843]; } public static function getECCLength($sp348765, $sp8a0843) { return self::$capacity[$sp348765][QRCAP_EC][$sp8a0843]; } public static function getWidth($sp348765) { return self::$capacity[$sp348765][QRCAP_WIDTH]; } public static function getRemainder($sp348765) { return self::$capacity[$sp348765][QRCAP_REMINDER]; } public static function getMinimumVersion($sp5b0542, $sp8a0843) { for ($sp218d20 = 1; $sp218d20 <= QRSPEC_VERSION_MAX; $sp218d20++) { $spe775f1 = self::$capacity[$sp218d20][QRCAP_WORDS] - self::$capacity[$sp218d20][QRCAP_EC][$sp8a0843]; if ($spe775f1 >= $sp5b0542) { return $sp218d20; } } return -1; } public static $lengthTableBits = array(array(10, 12, 14), array(9, 11, 13), array(8, 16, 16), array(8, 10, 12)); public static function lengthIndicator($sp8211ed, $sp348765) { if ($sp8211ed == QR_MODE_STRUCTURE) { return 0; } if ($sp348765 <= 9) { $spcc6fc4 = 0; } else { if ($sp348765 <= 26) { $spcc6fc4 = 1; } else { $spcc6fc4 = 2; } } return self::$lengthTableBits[$sp8211ed][$spcc6fc4]; } public static function maximumWords($sp8211ed, $sp348765) { if ($sp8211ed == QR_MODE_STRUCTURE) { return 3; } if ($sp348765 <= 9) { $spcc6fc4 = 0; } else { if ($sp348765 <= 26) { $spcc6fc4 = 1; } else { $spcc6fc4 = 2; } } $spa43692 = self::$lengthTableBits[$sp8211ed][$spcc6fc4]; $spe775f1 = (1 << $spa43692) - 1; if ($sp8211ed == QR_MODE_KANJI) { $spe775f1 *= 2; } return $spe775f1; } public static $eccTable = array(array(array(0, 0), array(0, 0), array(0, 0), array(0, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(2, 0), array(2, 0)), array(array(1, 0), array(2, 0), array(2, 0), array(4, 0)), array(array(1, 0), array(2, 0), array(2, 2), array(2, 2)), array(array(2, 0), array(4, 0), array(4, 0), array(4, 0)), array(array(2, 0), array(4, 0), array(2, 4), array(4, 1)), array(array(2, 0), array(2, 2), array(4, 2), array(4, 2)), array(array(2, 0), array(3, 2), array(4, 4), array(4, 4)), array(array(2, 2), array(4, 1), array(6, 2), array(6, 2)), array(array(4, 0), array(1, 4), array(4, 4), array(3, 8)), array(array(2, 2), array(6, 2), array(4, 6), array(7, 4)), array(array(4, 0), array(8, 1), array(8, 4), array(12, 4)), array(array(3, 1), array(4, 5), array(11, 5), array(11, 5)), array(array(5, 1), array(5, 5), array(5, 7), array(11, 7)), array(array(5, 1), array(7, 3), array(15, 2), array(3, 13)), array(array(1, 5), array(10, 1), array(1, 15), array(2, 17)), array(array(5, 1), array(9, 4), array(17, 1), array(2, 19)), array(array(3, 4), array(3, 11), array(17, 4), array(9, 16)), array(array(3, 5), array(3, 13), array(15, 5), array(15, 10)), array(array(4, 4), array(17, 0), array(17, 6), array(19, 6)), array(array(2, 7), array(17, 0), array(7, 16), array(34, 0)), array(array(4, 5), array(4, 14), array(11, 14), array(16, 14)), array(array(6, 4), array(6, 14), array(11, 16), array(30, 2)), array(array(8, 4), array(8, 13), array(7, 22), array(22, 13)), array(array(10, 2), array(19, 4), array(28, 6), array(33, 4)), array(array(8, 4), array(22, 3), array(8, 26), array(12, 28)), array(array(3, 10), array(3, 23), array(4, 31), array(11, 31)), array(array(7, 7), array(21, 7), array(1, 37), array(19, 26)), array(array(5, 10), array(19, 10), array(15, 25), array(23, 25)), array(array(13, 3), array(2, 29), array(42, 1), array(23, 28)), array(array(17, 0), array(10, 23), array(10, 35), array(19, 35)), array(array(17, 1), array(14, 21), array(29, 19), array(11, 46)), array(array(13, 6), array(14, 23), array(44, 7), array(59, 1)), array(array(12, 7), array(12, 26), array(39, 14), array(22, 41)), array(array(6, 14), array(6, 34), array(46, 10), array(2, 64)), array(array(17, 4), array(29, 14), array(49, 10), array(24, 46)), array(array(4, 18), array(13, 32), array(48, 14), array(42, 32)), array(array(20, 4), array(40, 7), array(43, 22), array(10, 67)), array(array(19, 6), array(18, 31), array(34, 34), array(20, 61))); public static function getEccSpec($sp348765, $sp8a0843, array &$spe29e09) { if (count($spe29e09) < 5) { $spe29e09 = array(0, 0, 0, 0, 0); } $sp0bcb9a = self::$eccTable[$sp348765][$sp8a0843][0]; $spa2cc91 = self::$eccTable[$sp348765][$sp8a0843][1]; $spbda5b4 = self::getDataLength($sp348765, $sp8a0843); $sp7ca352 = self::getECCLength($sp348765, $sp8a0843); if ($spa2cc91 == 0) { $spe29e09[0] = $sp0bcb9a; $spe29e09[1] = (int) ($spbda5b4 / $sp0bcb9a); $spe29e09[2] = (int) ($sp7ca352 / $sp0bcb9a); $spe29e09[3] = 0; $spe29e09[4] = 0; } else { $spe29e09[0] = $sp0bcb9a; $spe29e09[1] = (int) ($spbda5b4 / ($sp0bcb9a + $spa2cc91)); $spe29e09[2] = (int) ($sp7ca352 / ($sp0bcb9a + $spa2cc91)); $spe29e09[3] = $spa2cc91; $spe29e09[4] = $spe29e09[1] + 1; } } public static $alignmentPattern = array(array(0, 0), array(0, 0), array(18, 0), array(22, 0), array(26, 0), array(30, 0), array(34, 0), array(22, 38), array(24, 42), array(26, 46), array(28, 50), array(30, 54), array(32, 58), array(34, 62), array(26, 46), array(26, 48), array(26, 50), array(30, 54), array(30, 56), array(30, 58), array(34, 62), array(28, 50), array(26, 50), array(30, 54), array(28, 54), array(32, 58), array(30, 58), array(34, 62), array(26, 50), array(30, 54), array(26, 52), array(30, 56), array(34, 60), array(30, 58), array(34, 62), array(30, 54), array(24, 50), array(28, 54), array(32, 58), array(26, 54), array(30, 58)); public static function putAlignmentMarker(array &$sp2cfdb8, $sp63e12e, $sp167192) { $sp1756ca = array('°°°°°', '°†††°', '°†°†°', '°†††°', '°°°°°'); $sp167225 = $sp167192 - 2; $sp2c37e0 = $sp63e12e - 2; for ($spfe16e7 = 0; $spfe16e7 < 5; $spfe16e7++) { QRstr::set($sp2cfdb8, $sp2c37e0, $sp167225 + $spfe16e7, $sp1756ca[$spfe16e7]); } } public static function putAlignmentPattern($sp348765, &$sp2cfdb8, $sp395073) { if ($sp348765 < 2) { return; } $sp35e2fa = self::$alignmentPattern[$sp348765][1] - self::$alignmentPattern[$sp348765][0]; if ($sp35e2fa < 0) { $sp2f8aa7 = 2; } else { $sp2f8aa7 = (int) (($sp395073 - self::$alignmentPattern[$sp348765][0]) / $sp35e2fa + 2); } if ($sp2f8aa7 * $sp2f8aa7 - 3 == 1) { $sp521ef8 = self::$alignmentPattern[$sp348765][0]; $spfe16e7 = self::$alignmentPattern[$sp348765][0]; self::putAlignmentMarker($sp2cfdb8, $sp521ef8, $spfe16e7); return; } $spe38fee = self::$alignmentPattern[$sp348765][0]; for ($sp521ef8 = 1; $sp521ef8 < $sp2f8aa7 - 1; $sp521ef8++) { self::putAlignmentMarker($sp2cfdb8, 6, $spe38fee); self::putAlignmentMarker($sp2cfdb8, $spe38fee, 6); $spe38fee += $sp35e2fa; } $sp73acf2 = self::$alignmentPattern[$sp348765][0]; for ($spfe16e7 = 0; $spfe16e7 < $sp2f8aa7 - 1; $spfe16e7++) { $spe38fee = self::$alignmentPattern[$sp348765][0]; for ($sp521ef8 = 0; $sp521ef8 < $sp2f8aa7 - 1; $sp521ef8++) { self::putAlignmentMarker($sp2cfdb8, $spe38fee, $sp73acf2); $spe38fee += $sp35e2fa; } $sp73acf2 += $sp35e2fa; } } public static $versionPattern = array(31892, 34236, 39577, 42195, 48118, 51042, 55367, 58893, 63784, 68472, 70749, 76311, 79154, 84390, 87683, 92361, 96236, 102084, 102881, 110507, 110734, 117786, 119615, 126325, 127568, 133589, 136944, 141498, 145311, 150283, 152622, 158308, 161089, 167017); public static function getVersionPattern($sp348765) { if ($sp348765 < 7 || $sp348765 > QRSPEC_VERSION_MAX) { return 0; } return self::$versionPattern[$sp348765 - 7]; } public static $formatInfo = array(array(30660, 29427, 32170, 30877, 26159, 25368, 27713, 26998), array(21522, 20773, 24188, 23371, 17913, 16590, 20375, 19104), array(13663, 12392, 16177, 14854, 9396, 8579, 11994, 11245), array(5769, 5054, 7399, 6608, 1890, 597, 3340, 2107)); public static function getFormatInfo($spa3e44c, $sp8a0843) { if ($spa3e44c < 0 || $spa3e44c > 7) { return 0; } if ($sp8a0843 < 0 || $sp8a0843 > 3) { return 0; } return self::$formatInfo[$sp8a0843][$spa3e44c]; } public static $frames = array(); public static function putFinderPattern(&$sp2cfdb8, $sp63e12e, $sp167192) { $sp1756ca = array('¡¡¡¡¡¡¡', '¡¿¿¿¿¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¿¿¿¿¡', '¡¡¡¡¡¡¡'); for ($spfe16e7 = 0; $spfe16e7 < 7; $spfe16e7++) { QRstr::set($sp2cfdb8, $sp63e12e, $sp167192 + $spfe16e7, $sp1756ca[$spfe16e7]); } } public static function createFrame($sp348765) { $sp395073 = self::$capacity[$sp348765][QRCAP_WIDTH]; $sp9445aa = str_repeat(' ', $sp395073); $sp2cfdb8 = array_fill(0, $sp395073, $sp9445aa); self::putFinderPattern($sp2cfdb8, 0, 0); self::putFinderPattern($sp2cfdb8, $sp395073 - 7, 0); self::putFinderPattern($sp2cfdb8, 0, $sp395073 - 7); $spbff7c6 = $sp395073 - 7; for ($spfe16e7 = 0; $spfe16e7 < 7; $spfe16e7++) { $sp2cfdb8[$spfe16e7][7] = '¿'; $sp2cfdb8[$spfe16e7][$sp395073 - 8] = '¿'; $sp2cfdb8[$spbff7c6][7] = '¿'; $spbff7c6++; } $sp03e497 = str_repeat('¿', 8); QRstr::set($sp2cfdb8, 0, 7, $sp03e497); QRstr::set($sp2cfdb8, $sp395073 - 8, 7, $sp03e497); QRstr::set($sp2cfdb8, 0, $sp395073 - 8, $sp03e497); $sp03e497 = str_repeat('Ñ', 9); QRstr::set($sp2cfdb8, 0, 8, $sp03e497); QRstr::set($sp2cfdb8, $sp395073 - 8, 8, $sp03e497, 8); $spbff7c6 = $sp395073 - 8; for ($spfe16e7 = 0; $spfe16e7 < 8; $spfe16e7++, $spbff7c6++) { $sp2cfdb8[$spfe16e7][8] = 'Ñ'; $sp2cfdb8[$spbff7c6][8] = 'Ñ'; } for ($sp218d20 = 1; $sp218d20 < $sp395073 - 15; $sp218d20++) { $sp2cfdb8[6][7 + $sp218d20] = chr(144 | $sp218d20 & 1); $sp2cfdb8[7 + $sp218d20][6] = chr(144 | $sp218d20 & 1); } self::putAlignmentPattern($sp348765, $sp2cfdb8, $sp395073); if ($sp348765 >= 7) { $sp85ae83 = self::getVersionPattern($sp348765); $spce84f3 = $sp85ae83; for ($sp521ef8 = 0; $sp521ef8 < 6; $sp521ef8++) { for ($spfe16e7 = 0; $spfe16e7 < 3; $spfe16e7++) { $sp2cfdb8[$sp395073 - 11 + $spfe16e7][$sp521ef8] = chr(136 | $spce84f3 & 1); $spce84f3 = $spce84f3 >> 1; } } $spce84f3 = $sp85ae83; for ($spfe16e7 = 0; $spfe16e7 < 6; $spfe16e7++) { for ($sp521ef8 = 0; $sp521ef8 < 3; $sp521ef8++) { $sp2cfdb8[$spfe16e7][$sp521ef8 + ($sp395073 - 11)] = chr(136 | $spce84f3 & 1); $spce84f3 = $spce84f3 >> 1; } } } $sp2cfdb8[$sp395073 - 8][8] = 'Å'; return $sp2cfdb8; } public static function debug($sp2cfdb8, $spc2055c = false) { if ($spc2055c) { foreach ($sp2cfdb8 as &$sp9445aa) { $sp9445aa = join('<span class="m">&nbsp;&nbsp;</span>', explode('0', $sp9445aa)); $sp9445aa = join('&#9608;&#9608;', explode('1', $sp9445aa)); } ?>
                <style>
                    .m { background-color: white; }
                </style>
                <?php  echo '<pre><tt><br/ ><br/ ><br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; echo join('<br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', $sp2cfdb8); echo '</tt></pre><br/ ><br/ ><br/ ><br/ ><br/ ><br/ >'; } else { foreach ($sp2cfdb8 as &$sp9445aa) { $sp9445aa = join('<span class="m">&nbsp;</span>', explode('¿', $sp9445aa)); $sp9445aa = join('<span class="m">&#9618;</span>', explode('¡', $sp9445aa)); $sp9445aa = join('<span class="p">&nbsp;</span>', explode('†', $sp9445aa)); $sp9445aa = join('<span class="p">&#9618;</span>', explode('°', $sp9445aa)); $sp9445aa = join('<span class="s">&#9671;</span>', explode('Ñ', $sp9445aa)); $sp9445aa = join('<span class="s">&#9670;</span>', explode('Ö', $sp9445aa)); $sp9445aa = join('<span class="x">&#9762;</span>', explode('Å', $sp9445aa)); $sp9445aa = join('<span class="c">&nbsp;</span>', explode('ê', $sp9445aa)); $sp9445aa = join('<span class="c">&#9719;</span>', explode('ë', $sp9445aa)); $sp9445aa = join('<span class="f">&nbsp;</span>', explode('à', $sp9445aa)); $sp9445aa = join('<span class="f">&#9618;</span>', explode('â', $sp9445aa)); $sp9445aa = join('&#9830;', explode('', $sp9445aa)); $sp9445aa = join('&#8901;', explode(' ', $sp9445aa)); } ?>
                <style>
                    .p { background-color: yellow; }
                    .m { background-color: #00FF00; }
                    .s { background-color: #FF0000; }
                    .c { background-color: aqua; }
                    .x { background-color: pink; }
                    .f { background-color: gold; }
                </style>
                <?php  echo '<pre><tt>'; echo join('<br/ >', $sp2cfdb8); echo '</tt></pre>'; } } public static function serial($sp2cfdb8) { return gzcompress(join('
', $sp2cfdb8), 9); } public static function unserial($spd51873) { return explode('
', gzuncompress($spd51873)); } public static function newFrame($sp348765) { if ($sp348765 < 1 || $sp348765 > QRSPEC_VERSION_MAX) { return null; } if (!isset(self::$frames[$sp348765])) { $sp522c55 = QR_CACHE_DIR . 'frame_' . $sp348765 . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp522c55)) { self::$frames[$sp348765] = self::unserial(file_get_contents($sp522c55)); } else { self::$frames[$sp348765] = self::createFrame($sp348765); file_put_contents($sp522c55, self::serial(self::$frames[$sp348765])); } } else { self::$frames[$sp348765] = self::createFrame($sp348765); } } if (is_null(self::$frames[$sp348765])) { return null; } return self::$frames[$sp348765]; } public static function rsBlockNum($spe29e09) { return $spe29e09[0] + $spe29e09[3]; } public static function rsBlockNum1($spe29e09) { return $spe29e09[0]; } public static function rsDataCodes1($spe29e09) { return $spe29e09[1]; } public static function rsEccCodes1($spe29e09) { return $spe29e09[2]; } public static function rsBlockNum2($spe29e09) { return $spe29e09[3]; } public static function rsDataCodes2($spe29e09) { return $spe29e09[4]; } public static function rsEccCodes2($spe29e09) { return $spe29e09[2]; } public static function rsDataLength($spe29e09) { return $spe29e09[0] * $spe29e09[1] + $spe29e09[3] * $spe29e09[4]; } public static function rsEccLength($spe29e09) { return ($spe29e09[0] + $spe29e09[3]) * $spe29e09[2]; } } define('QR_IMAGE', true); class QRimage { public static function png($sp2cfdb8, $sp61be63 = false, $spc54f05 = 4, $sp8ca7db = 4, $sp4d8b10 = FALSE) { $sp4ba97e = self::image($sp2cfdb8, $spc54f05, $sp8ca7db); if ($sp61be63 === false) { Header('Content-type: image/png'); ImagePng($sp4ba97e); } else { if ($sp4d8b10 === TRUE) { ImagePng($sp4ba97e, $sp61be63); header('Content-type: image/png'); ImagePng($sp4ba97e); } else { ImagePng($sp4ba97e, $sp61be63); } } ImageDestroy($sp4ba97e); } public static function jpg($sp2cfdb8, $sp61be63 = false, $spc54f05 = 8, $sp8ca7db = 4, $sp568cdb = 85) { $sp4ba97e = self::image($sp2cfdb8, $spc54f05, $sp8ca7db); if ($sp61be63 === false) { Header('Content-type: image/jpeg'); ImageJpeg($sp4ba97e, null, $sp568cdb); } else { ImageJpeg($sp4ba97e, $sp61be63, $sp568cdb); } ImageDestroy($sp4ba97e); } private static function image($sp2cfdb8, $spc54f05 = 4, $sp8ca7db = 4) { $sp0b958d = count($sp2cfdb8); $sp2f8aa7 = strlen($sp2cfdb8[0]); $spa81a7c = $sp2f8aa7 + 2 * $sp8ca7db; $sp4472ea = $sp0b958d + 2 * $sp8ca7db; $sp9e9419 = ImageCreate($spa81a7c, $sp4472ea); $spf437b8[0] = ImageColorAllocate($sp9e9419, 255, 255, 255); $spf437b8[1] = ImageColorAllocate($sp9e9419, 0, 0, 0); imagefill($sp9e9419, 0, 0, $spf437b8[0]); for ($spfe16e7 = 0; $spfe16e7 < $sp0b958d; $spfe16e7++) { for ($sp521ef8 = 0; $sp521ef8 < $sp2f8aa7; $sp521ef8++) { if ($sp2cfdb8[$spfe16e7][$sp521ef8] == '1') { ImageSetPixel($sp9e9419, $sp521ef8 + $sp8ca7db, $spfe16e7 + $sp8ca7db, $spf437b8[1]); } } } $spef2aed = ImageCreate($spa81a7c * $spc54f05, $sp4472ea * $spc54f05); ImageCopyResized($spef2aed, $sp9e9419, 0, 0, 0, 0, $spa81a7c * $spc54f05, $sp4472ea * $spc54f05, $spa81a7c, $sp4472ea); ImageDestroy($sp9e9419); return $spef2aed; } } define('STRUCTURE_HEADER_BITS', 20); define('MAX_STRUCTURED_SYMBOLS', 16); class QRinputItem { public $mode; public $size; public $data; public $bstream; public function __construct($sp8211ed, $sp5b0542, $spbda5b4, $speb816f = null) { $spab75cd = array_slice($spbda5b4, 0, $sp5b0542); if (count($spab75cd) < $sp5b0542) { $spab75cd = array_merge($spab75cd, array_fill(0, $sp5b0542 - count($spab75cd), 0)); } if (!QRinput::check($sp8211ed, $sp5b0542, $spab75cd)) { throw new Exception('Error m:' . $sp8211ed . ',s:' . $sp5b0542 . ',d:' . join(',', $spab75cd)); return null; } $this->mode = $sp8211ed; $this->size = $sp5b0542; $this->data = $spab75cd; $this->bstream = $speb816f; } public function encodeModeNum($sp348765) { try { $spe775f1 = (int) ($this->size / 3); $sp0251d6 = new QRbitstream(); $spfca62c = 1; $sp0251d6->appendNum(4, $spfca62c); $sp0251d6->appendNum(QRspec::lengthIndicator(QR_MODE_NUM, $sp348765), $this->size); for ($sp218d20 = 0; $sp218d20 < $spe775f1; $sp218d20++) { $spfca62c = (ord($this->data[$sp218d20 * 3]) - ord('0')) * 100; $spfca62c += (ord($this->data[$sp218d20 * 3 + 1]) - ord('0')) * 10; $spfca62c += ord($this->data[$sp218d20 * 3 + 2]) - ord('0'); $sp0251d6->appendNum(10, $spfca62c); } if ($this->size - $spe775f1 * 3 == 1) { $spfca62c = ord($this->data[$spe775f1 * 3]) - ord('0'); $sp0251d6->appendNum(4, $spfca62c); } else { if ($this->size - $spe775f1 * 3 == 2) { $spfca62c = (ord($this->data[$spe775f1 * 3]) - ord('0')) * 10; $spfca62c += ord($this->data[$spe775f1 * 3 + 1]) - ord('0'); $sp0251d6->appendNum(7, $spfca62c); } } $this->bstream = $sp0251d6; return 0; } catch (Exception $sp019ea9) { return -1; } } public function encodeModeAn($sp348765) { try { $spe775f1 = (int) ($this->size / 2); $sp0251d6 = new QRbitstream(); $sp0251d6->appendNum(4, 2); $sp0251d6->appendNum(QRspec::lengthIndicator(QR_MODE_AN, $sp348765), $this->size); for ($sp218d20 = 0; $sp218d20 < $spe775f1; $sp218d20++) { $spfca62c = (int) QRinput::lookAnTable(ord($this->data[$sp218d20 * 2])) * 45; $spfca62c += (int) QRinput::lookAnTable(ord($this->data[$sp218d20 * 2 + 1])); $sp0251d6->appendNum(11, $spfca62c); } if ($this->size & 1) { $spfca62c = QRinput::lookAnTable(ord($this->data[$spe775f1 * 2])); $sp0251d6->appendNum(6, $spfca62c); } $this->bstream = $sp0251d6; return 0; } catch (Exception $sp019ea9) { return -1; } } public function encodeMode8($sp348765) { try { $sp0251d6 = new QRbitstream(); $sp0251d6->appendNum(4, 4); $sp0251d6->appendNum(QRspec::lengthIndicator(QR_MODE_8, $sp348765), $this->size); for ($sp218d20 = 0; $sp218d20 < $this->size; $sp218d20++) { $sp0251d6->appendNum(8, ord($this->data[$sp218d20])); } $this->bstream = $sp0251d6; return 0; } catch (Exception $sp019ea9) { return -1; } } public function encodeModeKanji($sp348765) { try { $sp0251d6 = new QRbitrtream(); $sp0251d6->appendNum(4, 8); $sp0251d6->appendNum(QRspec::lengthIndicator(QR_MODE_KANJI, $sp348765), (int) ($this->size / 2)); for ($sp218d20 = 0; $sp218d20 < $this->size; $sp218d20 += 2) { $spfca62c = ord($this->data[$sp218d20]) << 8 | ord($this->data[$sp218d20 + 1]); if ($spfca62c <= 40956) { $spfca62c -= 33088; } else { $spfca62c -= 49472; } $sp0b958d = ($spfca62c >> 8) * 192; $spfca62c = ($spfca62c & 255) + $sp0b958d; $sp0251d6->appendNum(13, $spfca62c); } $this->bstream = $sp0251d6; return 0; } catch (Exception $sp019ea9) { return -1; } } public function encodeModeStructure() { try { $sp0251d6 = new QRbitstream(); $sp0251d6->appendNum(4, 3); $sp0251d6->appendNum(4, ord($this->data[1]) - 1); $sp0251d6->appendNum(4, ord($this->data[0]) - 1); $sp0251d6->appendNum(8, ord($this->data[2])); $this->bstream = $sp0251d6; return 0; } catch (Exception $sp019ea9) { return -1; } } public function estimateBitStreamSizeOfEntry($sp348765) { $spa43692 = 0; if ($sp348765 == 0) { $sp348765 = 1; } switch ($this->mode) { case QR_MODE_NUM: $spa43692 = QRinput::estimateBitsModeNum($this->size); break; case QR_MODE_AN: $spa43692 = QRinput::estimateBitsModeAn($this->size); break; case QR_MODE_8: $spa43692 = QRinput::estimateBitsMode8($this->size); break; case QR_MODE_KANJI: $spa43692 = QRinput::estimateBitsModeKanji($this->size); break; case QR_MODE_STRUCTURE: return STRUCTURE_HEADER_BITS; default: return 0; } $spcc6fc4 = QRspec::lengthIndicator($this->mode, $sp348765); $spf68fa5 = 1 << $spcc6fc4; $spc277ed = (int) (($this->size + $spf68fa5 - 1) / $spf68fa5); $spa43692 += $spc277ed * (4 + $spcc6fc4); return $spa43692; } public function encodeBitStream($sp348765) { try { unset($this->bstream); $spe775f1 = QRspec::maximumWords($this->mode, $sp348765); if ($this->size > $spe775f1) { $sp8319de = new QRinputItem($this->mode, $spe775f1, $this->data); $sp3059af = new QRinputItem($this->mode, $this->size - $spe775f1, array_slice($this->data, $spe775f1)); $sp8319de->encodeBitStream($sp348765); $sp3059af->encodeBitStream($sp348765); $this->bstream = new QRbitstream(); $this->bstream->append($sp8319de->bstream); $this->bstream->append($sp3059af->bstream); unset($sp8319de); unset($sp3059af); } else { $sp567373 = 0; switch ($this->mode) { case QR_MODE_NUM: $sp567373 = $this->encodeModeNum($sp348765); break; case QR_MODE_AN: $sp567373 = $this->encodeModeAn($sp348765); break; case QR_MODE_8: $sp567373 = $this->encodeMode8($sp348765); break; case QR_MODE_KANJI: $sp567373 = $this->encodeModeKanji($sp348765); break; case QR_MODE_STRUCTURE: $sp567373 = $this->encodeModeStructure(); break; default: break; } if ($sp567373 < 0) { return -1; } } return $this->bstream->size(); } catch (Exception $sp019ea9) { return -1; } } } class QRinput { public $items; private $version; private $level; public function __construct($sp348765 = 0, $sp8a0843 = QR_ECLEVEL_L) { if ($sp348765 < 0 || $sp348765 > QRSPEC_VERSION_MAX || $sp8a0843 > QR_ECLEVEL_H) { throw new Exception('Invalid version no'); return NULL; } $this->version = $sp348765; $this->level = $sp8a0843; } public function getVersion() { return $this->version; } public function setVersion($sp348765) { if ($sp348765 < 0 || $sp348765 > QRSPEC_VERSION_MAX) { throw new Exception('Invalid version no'); return -1; } $this->version = $sp348765; return 0; } public function getErrorCorrectionLevel() { return $this->level; } public function setErrorCorrectionLevel($sp8a0843) { if ($sp8a0843 > QR_ECLEVEL_H) { throw new Exception('Invalid ECLEVEL'); return -1; } $this->level = $sp8a0843; return 0; } public function appendEntry(QRinputItem $spb082da) { $this->items[] = $spb082da; } public function append($sp8211ed, $sp5b0542, $spbda5b4) { try { $spb082da = new QRinputItem($sp8211ed, $sp5b0542, $spbda5b4); $this->items[] = $spb082da; return 0; } catch (Exception $sp019ea9) { return -1; } } public function insertStructuredAppendHeader($sp5b0542, $spfe5663, $spb76594) { if ($sp5b0542 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong size'); } if ($spfe5663 <= 0 || $spfe5663 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong index'); } $sp8d2549 = array($sp5b0542, $spfe5663, $spb76594); try { $spb082da = new QRinputItem(QR_MODE_STRUCTURE, 3, buf); array_unshift($this->items, $spb082da); return 0; } catch (Exception $sp019ea9) { return -1; } } public function calcParity() { $spb76594 = 0; foreach ($this->items as $spe1403c) { if ($spe1403c->mode != QR_MODE_STRUCTURE) { for ($sp218d20 = $spe1403c->size - 1; $sp218d20 >= 0; $sp218d20--) { $spb76594 ^= $spe1403c->data[$sp218d20]; } } } return $spb76594; } public static function checkModeNum($sp5b0542, $spbda5b4) { for ($sp218d20 = 0; $sp218d20 < $sp5b0542; $sp218d20++) { if (ord($spbda5b4[$sp218d20]) < ord('0') || ord($spbda5b4[$sp218d20]) > ord('9')) { return false; } } return true; } public static function estimateBitsModeNum($sp5b0542) { $sp2f8aa7 = (int) $sp5b0542 / 3; $spa43692 = $sp2f8aa7 * 10; switch ($sp5b0542 - $sp2f8aa7 * 3) { case 1: $spa43692 += 4; break; case 2: $spa43692 += 7; break; default: break; } return $spa43692; } public static $anTable = array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 36, -1, -1, -1, 37, 38, -1, -1, -1, -1, 39, 40, -1, 41, 42, 43, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 44, -1, -1, -1, -1, -1, -1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1); public static function lookAnTable($spb91d1b) { return $spb91d1b > 127 ? -1 : self::$anTable[$spb91d1b]; } public static function checkModeAn($sp5b0542, $spbda5b4) { for ($sp218d20 = 0; $sp218d20 < $sp5b0542; $sp218d20++) { if (self::lookAnTable(ord($spbda5b4[$sp218d20])) == -1) { return false; } } return true; } public static function estimateBitsModeAn($sp5b0542) { $sp2f8aa7 = (int) ($sp5b0542 / 2); $spa43692 = $sp2f8aa7 * 11; if ($sp5b0542 & 1) { $spa43692 += 6; } return $spa43692; } public static function estimateBitsMode8($sp5b0542) { return $sp5b0542 * 8; } public function estimateBitsModeKanji($sp5b0542) { return (int) ($sp5b0542 / 2 * 13); } public static function checkModeKanji($sp5b0542, $spbda5b4) { if ($sp5b0542 & 1) { return false; } for ($sp218d20 = 0; $sp218d20 < $sp5b0542; $sp218d20 += 2) { $spfca62c = ord($spbda5b4[$sp218d20]) << 8 | ord($spbda5b4[$sp218d20 + 1]); if ($spfca62c < 33088 || $spfca62c > 40956 && $spfca62c < 57408 || $spfca62c > 60351) { return false; } } return true; } public static function check($sp8211ed, $sp5b0542, $spbda5b4) { if ($sp5b0542 <= 0) { return false; } switch ($sp8211ed) { case QR_MODE_NUM: return self::checkModeNum($sp5b0542, $spbda5b4); break; case QR_MODE_AN: return self::checkModeAn($sp5b0542, $spbda5b4); break; case QR_MODE_KANJI: return self::checkModeKanji($sp5b0542, $spbda5b4); break; case QR_MODE_8: return true; break; case QR_MODE_STRUCTURE: return true; break; default: break; } return false; } public function estimateBitStreamSize($sp348765) { $spa43692 = 0; foreach ($this->items as $spe1403c) { $spa43692 += $spe1403c->estimateBitStreamSizeOfEntry($sp348765); } return $spa43692; } public function estimateVersion() { $sp348765 = 0; $sp69ee8e = 0; do { $sp69ee8e = $sp348765; $spa43692 = $this->estimateBitStreamSize($sp69ee8e); $sp348765 = QRspec::getMinimumVersion((int) (($spa43692 + 7) / 8), $this->level); if ($sp348765 < 0) { return -1; } } while ($sp348765 > $sp69ee8e); return $sp348765; } public static function lengthOfCode($sp8211ed, $sp348765, $spa43692) { $sp8a271f = $spa43692 - 4 - QRspec::lengthIndicator($sp8211ed, $sp348765); switch ($sp8211ed) { case QR_MODE_NUM: $sp81a4ab = (int) ($sp8a271f / 10); $sp2160c3 = $sp8a271f - $sp81a4ab * 10; $sp5b0542 = $sp81a4ab * 3; if ($sp2160c3 >= 7) { $sp5b0542 += 2; } else { if ($sp2160c3 >= 4) { $sp5b0542 += 1; } } break; case QR_MODE_AN: $sp81a4ab = (int) ($sp8a271f / 11); $sp2160c3 = $sp8a271f - $sp81a4ab * 11; $sp5b0542 = $sp81a4ab * 2; if ($sp2160c3 >= 6) { $sp5b0542++; } break; case QR_MODE_8: $sp5b0542 = (int) ($sp8a271f / 8); break; case QR_MODE_KANJI: $sp5b0542 = (int) ($sp8a271f / 13 * 2); break; case QR_MODE_STRUCTURE: $sp5b0542 = (int) ($sp8a271f / 8); break; default: $sp5b0542 = 0; break; } $sp04468a = QRspec::maximumWords($sp8211ed, $sp348765); if ($sp5b0542 < 0) { $sp5b0542 = 0; } if ($sp5b0542 > $sp04468a) { $sp5b0542 = $sp04468a; } return $sp5b0542; } public function createBitStream() { $sp3ce394 = 0; foreach ($this->items as $spe1403c) { $spa43692 = $spe1403c->encodeBitStream($this->version); if ($spa43692 < 0) { return -1; } $sp3ce394 += $spa43692; } return $sp3ce394; } public function convertData() { $spc32085 = $this->estimateVersion(); if ($spc32085 > $this->getVersion()) { $this->setVersion($spc32085); } for (;;) { $spa43692 = $this->createBitStream(); if ($spa43692 < 0) { return -1; } $spc32085 = QRspec::getMinimumVersion((int) (($spa43692 + 7) / 8), $this->level); if ($spc32085 < 0) { throw new Exception('WRONG VERSION'); return -1; } else { if ($spc32085 > $this->getVersion()) { $this->setVersion($spc32085); } else { break; } } } return 0; } public function appendPaddingBit(&$speb816f) { $spa43692 = $speb816f->size(); $sp3c5a45 = QRspec::getDataLength($this->version, $this->level); $sp16dd4e = $sp3c5a45 * 8; if ($sp16dd4e == $spa43692) { return 0; } if ($sp16dd4e - $spa43692 < 5) { return $speb816f->appendNum($sp16dd4e - $spa43692, 0); } $spa43692 += 4; $spe775f1 = (int) (($spa43692 + 7) / 8); $sp4d96a5 = new QRbitstream(); $sp567373 = $sp4d96a5->appendNum($spe775f1 * 8 - $spa43692 + 4, 0); if ($sp567373 < 0) { return $sp567373; } $spb8c9f3 = $sp3c5a45 - $spe775f1; if ($spb8c9f3 > 0) { $spc66fc9 = array(); for ($sp218d20 = 0; $sp218d20 < $spb8c9f3; $sp218d20++) { $spc66fc9[$sp218d20] = $sp218d20 & 1 ? 17 : 236; } $sp567373 = $sp4d96a5->appendBytes($spb8c9f3, $spc66fc9); if ($sp567373 < 0) { return $sp567373; } } $sp567373 = $speb816f->append($sp4d96a5); return $sp567373; } public function mergeBitStream() { if ($this->convertData() < 0) { return null; } $speb816f = new QRbitstream(); foreach ($this->items as $spe1403c) { $sp567373 = $speb816f->append($spe1403c->bstream); if ($sp567373 < 0) { return null; } } return $speb816f; } public function getBitStream() { $speb816f = $this->mergeBitStream(); if ($speb816f == null) { return null; } $sp567373 = $this->appendPaddingBit($speb816f); if ($sp567373 < 0) { return null; } return $speb816f; } public function getByteStream() { $speb816f = $this->getBitStream(); if ($speb816f == null) { return null; } return $speb816f->toByte(); } } class QRbitstream { public $data = array(); public function size() { return count($this->data); } public function allocate($sp35f98f) { $this->data = array_fill(0, $sp35f98f, 0); return 0; } public static function newFromNum($spa43692, $spc277ed) { $speb816f = new QRbitstream(); $speb816f->allocate($spa43692); $spa3e44c = 1 << $spa43692 - 1; for ($sp218d20 = 0; $sp218d20 < $spa43692; $sp218d20++) { if ($spc277ed & $spa3e44c) { $speb816f->data[$sp218d20] = 1; } else { $speb816f->data[$sp218d20] = 0; } $spa3e44c = $spa3e44c >> 1; } return $speb816f; } public static function newFromBytes($sp5b0542, $spbda5b4) { $speb816f = new QRbitstream(); $speb816f->allocate($sp5b0542 * 8); $spfe92bd = 0; for ($sp218d20 = 0; $sp218d20 < $sp5b0542; $sp218d20++) { $spa3e44c = 128; for ($sp3dc13c = 0; $sp3dc13c < 8; $sp3dc13c++) { if ($spbda5b4[$sp218d20] & $spa3e44c) { $speb816f->data[$spfe92bd] = 1; } else { $speb816f->data[$spfe92bd] = 0; } $spfe92bd++; $spa3e44c = $spa3e44c >> 1; } } return $speb816f; } public function append(QRbitstream $spdef461) { if (is_null($spdef461)) { return -1; } if ($spdef461->size() == 0) { return 0; } if ($this->size() == 0) { $this->data = $spdef461->data; return 0; } $this->data = array_values(array_merge($this->data, $spdef461->data)); return 0; } public function appendNum($spa43692, $spc277ed) { if ($spa43692 == 0) { return 0; } $spe8bdca = QRbitstream::newFromNum($spa43692, $spc277ed); if (is_null($spe8bdca)) { return -1; } $sp567373 = $this->append($spe8bdca); unset($spe8bdca); return $sp567373; } public function appendBytes($sp5b0542, $spbda5b4) { if ($sp5b0542 == 0) { return 0; } $spe8bdca = QRbitstream::newFromBytes($sp5b0542, $spbda5b4); if (is_null($spe8bdca)) { return -1; } $sp567373 = $this->append($spe8bdca); unset($spe8bdca); return $sp567373; } public function toByte() { $sp5b0542 = $this->size(); if ($sp5b0542 == 0) { return array(); } $spbda5b4 = array_fill(0, (int) (($sp5b0542 + 7) / 8), 0); $sp021441 = (int) ($sp5b0542 / 8); $spfe92bd = 0; for ($sp218d20 = 0; $sp218d20 < $sp021441; $sp218d20++) { $spce84f3 = 0; for ($sp3dc13c = 0; $sp3dc13c < 8; $sp3dc13c++) { $spce84f3 = $spce84f3 << 1; $spce84f3 |= $this->data[$spfe92bd]; $spfe92bd++; } $spbda5b4[$sp218d20] = $spce84f3; } if ($sp5b0542 & 7) { $spce84f3 = 0; for ($sp3dc13c = 0; $sp3dc13c < ($sp5b0542 & 7); $sp3dc13c++) { $spce84f3 = $spce84f3 << 1; $spce84f3 |= $this->data[$spfe92bd]; $spfe92bd++; } $spbda5b4[$sp021441] = $spce84f3; } return $spbda5b4; } } class QRsplit { public $dataStr = ''; public $input; public $modeHint; public function __construct($sp760aa0, $sp317e70, $sp9d734e) { $this->dataStr = $sp760aa0; $this->input = $sp317e70; $this->modeHint = $sp9d734e; } public static function isdigitat($sp4e169a, $spa06d19) { if ($spa06d19 >= strlen($sp4e169a)) { return false; } return ord($sp4e169a[$spa06d19]) >= ord('0') && ord($sp4e169a[$spa06d19]) <= ord('9'); } public static function isalnumat($sp4e169a, $spa06d19) { if ($spa06d19 >= strlen($sp4e169a)) { return false; } return QRinput::lookAnTable(ord($sp4e169a[$spa06d19])) >= 0; } public function identifyMode($spa06d19) { if ($spa06d19 >= strlen($this->dataStr)) { return QR_MODE_NUL; } $spb91d1b = $this->dataStr[$spa06d19]; if (self::isdigitat($this->dataStr, $spa06d19)) { return QR_MODE_NUM; } else { if (self::isalnumat($this->dataStr, $spa06d19)) { return QR_MODE_AN; } else { if ($this->modeHint == QR_MODE_KANJI) { if ($spa06d19 + 1 < strlen($this->dataStr)) { $sp35e2fa = $this->dataStr[$spa06d19 + 1]; $spbef259 = ord($spb91d1b) << 8 | ord($sp35e2fa); if ($spbef259 >= 33088 && $spbef259 <= 40956 || $spbef259 >= 57408 && $spbef259 <= 60351) { return QR_MODE_KANJI; } } } } } return QR_MODE_8; } public function eatNum() { $spd9cc9f = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $spfe92bd = 0; while (self::isdigitat($this->dataStr, $spfe92bd)) { $spfe92bd++; } $spa7e822 = $spfe92bd; $sp8211ed = $this->identifyMode($spfe92bd); if ($sp8211ed == QR_MODE_8) { $sp4467df = QRinput::estimateBitsModeNum($spa7e822) + 4 + $spd9cc9f + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($spa7e822 + 1); if ($sp4467df > 0) { return $this->eat8(); } } if ($sp8211ed == QR_MODE_AN) { $sp4467df = QRinput::estimateBitsModeNum($spa7e822) + 4 + $spd9cc9f + QRinput::estimateBitsModeAn(1) - QRinput::estimateBitsModeAn($spa7e822 + 1); if ($sp4467df > 0) { return $this->eatAn(); } } $sp567373 = $this->input->append(QR_MODE_NUM, $spa7e822, str_split($this->dataStr)); if ($sp567373 < 0) { return -1; } return $spa7e822; } public function eatAn() { $spd776bd = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $spd9cc9f = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $spfe92bd = 0; while (self::isalnumat($this->dataStr, $spfe92bd)) { if (self::isdigitat($this->dataStr, $spfe92bd)) { $sp568cdb = $spfe92bd; while (self::isdigitat($this->dataStr, $sp568cdb)) { $sp568cdb++; } $sp4467df = QRinput::estimateBitsModeAn($spfe92bd) + QRinput::estimateBitsModeNum($sp568cdb - $spfe92bd) + 4 + $spd9cc9f - QRinput::estimateBitsModeAn($sp568cdb); if ($sp4467df < 0) { break; } else { $spfe92bd = $sp568cdb; } } else { $spfe92bd++; } } $spa7e822 = $spfe92bd; if (!self::isalnumat($this->dataStr, $spfe92bd)) { $sp4467df = QRinput::estimateBitsModeAn($spa7e822) + 4 + $spd776bd + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($spa7e822 + 1); if ($sp4467df > 0) { return $this->eat8(); } } $sp567373 = $this->input->append(QR_MODE_AN, $spa7e822, str_split($this->dataStr)); if ($sp567373 < 0) { return -1; } return $spa7e822; } public function eatKanji() { $spfe92bd = 0; while ($this->identifyMode($spfe92bd) == QR_MODE_KANJI) { $spfe92bd += 2; } $sp567373 = $this->input->append(QR_MODE_KANJI, $spfe92bd, str_split($this->dataStr)); if ($sp567373 < 0) { return -1; } return $spa7e822; } public function eat8() { $spd776bd = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $spd9cc9f = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $spfe92bd = 1; $sp38e31c = strlen($this->dataStr); while ($spfe92bd < $sp38e31c) { $sp8211ed = $this->identifyMode($spfe92bd); if ($sp8211ed == QR_MODE_KANJI) { break; } if ($sp8211ed == QR_MODE_NUM) { $sp568cdb = $spfe92bd; while (self::isdigitat($this->dataStr, $sp568cdb)) { $sp568cdb++; } $sp4467df = QRinput::estimateBitsMode8($spfe92bd) + QRinput::estimateBitsModeNum($sp568cdb - $spfe92bd) + 4 + $spd9cc9f - QRinput::estimateBitsMode8($sp568cdb); if ($sp4467df < 0) { break; } else { $spfe92bd = $sp568cdb; } } else { if ($sp8211ed == QR_MODE_AN) { $sp568cdb = $spfe92bd; while (self::isalnumat($this->dataStr, $sp568cdb)) { $sp568cdb++; } $sp4467df = QRinput::estimateBitsMode8($spfe92bd) + QRinput::estimateBitsModeAn($sp568cdb - $spfe92bd) + 4 + $spd776bd - QRinput::estimateBitsMode8($sp568cdb); if ($sp4467df < 0) { break; } else { $spfe92bd = $sp568cdb; } } else { $spfe92bd++; } } } $spa7e822 = $spfe92bd; $sp567373 = $this->input->append(QR_MODE_8, $spa7e822, str_split($this->dataStr)); if ($sp567373 < 0) { return -1; } return $spa7e822; } public function splitString() { while (strlen($this->dataStr) > 0) { if ($this->dataStr == '') { return 0; } $sp8211ed = $this->identifyMode(0); switch ($sp8211ed) { case QR_MODE_NUM: $sp047f5a = $this->eatNum(); break; case QR_MODE_AN: $sp047f5a = $this->eatAn(); break; case QR_MODE_KANJI: if ($sp57c9ab == QR_MODE_KANJI) { $sp047f5a = $this->eatKanji(); } else { $sp047f5a = $this->eat8(); } break; default: $sp047f5a = $this->eat8(); break; } if ($sp047f5a == 0) { return 0; } if ($sp047f5a < 0) { return -1; } $this->dataStr = substr($this->dataStr, $sp047f5a); } } public function toUpper() { $sp13c0a3 = strlen($this->dataStr); $spfe92bd = 0; while ($spfe92bd < $sp13c0a3) { $sp8211ed = self::identifyMode(substr($this->dataStr, $spfe92bd), $this->modeHint); if ($sp8211ed == QR_MODE_KANJI) { $spfe92bd += 2; } else { if (ord($this->dataStr[$spfe92bd]) >= ord('a') && ord($this->dataStr[$spfe92bd]) <= ord('z')) { $this->dataStr[$spfe92bd] = chr(ord($this->dataStr[$spfe92bd]) - 32); } $spfe92bd++; } } return $this->dataStr; } public static function splitStringToQRinput($spb81a87, QRinput $sp317e70, $sp9d734e, $sp67038b = true) { if (is_null($spb81a87) || $spb81a87 == '\\0' || $spb81a87 == '') { throw new Exception('empty string!!!'); } $sp98dc4e = new QRsplit($spb81a87, $sp317e70, $sp9d734e); if (!$sp67038b) { $sp98dc4e->toUpper(); } return $sp98dc4e->splitString(); } } class QRrsItem { public $mm; public $nn; public $alpha_to = array(); public $index_of = array(); public $genpoly = array(); public $nroots; public $fcr; public $prim; public $iprim; public $pad; public $gfpoly; public function modnn($sp521ef8) { while ($sp521ef8 >= $this->nn) { $sp521ef8 -= $this->nn; $sp521ef8 = ($sp521ef8 >> $this->mm) + ($sp521ef8 & $this->nn); } return $sp521ef8; } public static function init_rs_char($sp53f38b, $sp840409, $sp09aec5, $spffa201, $sp195e42, $sp85e30d) { $sp723085 = null; if ($sp53f38b < 0 || $sp53f38b > 8) { return $sp723085; } if ($sp09aec5 < 0 || $sp09aec5 >= 1 << $sp53f38b) { return $sp723085; } if ($spffa201 <= 0 || $spffa201 >= 1 << $sp53f38b) { return $sp723085; } if ($sp195e42 < 0 || $sp195e42 >= 1 << $sp53f38b) { return $sp723085; } if ($sp85e30d < 0 || $sp85e30d >= (1 << $sp53f38b) - 1 - $sp195e42) { return $sp723085; } $sp723085 = new QRrsItem(); $sp723085->mm = $sp53f38b; $sp723085->nn = (1 << $sp53f38b) - 1; $sp723085->pad = $sp85e30d; $sp723085->alpha_to = array_fill(0, $sp723085->nn + 1, 0); $sp723085->index_of = array_fill(0, $sp723085->nn + 1, 0); $sp0de42d =& $sp723085->nn; $spe81ae4 =& $sp0de42d; $sp723085->index_of[0] = $spe81ae4; $sp723085->alpha_to[$spe81ae4] = 0; $sp55dac3 = 1; for ($sp218d20 = 0; $sp218d20 < $sp723085->nn; $sp218d20++) { $sp723085->index_of[$sp55dac3] = $sp218d20; $sp723085->alpha_to[$sp218d20] = $sp55dac3; $sp55dac3 <<= 1; if ($sp55dac3 & 1 << $sp53f38b) { $sp55dac3 ^= $sp840409; } $sp55dac3 &= $sp723085->nn; } if ($sp55dac3 != 1) { $sp723085 = NULL; return $sp723085; } $sp723085->genpoly = array_fill(0, $sp195e42 + 1, 0); $sp723085->fcr = $sp09aec5; $sp723085->prim = $spffa201; $sp723085->nroots = $sp195e42; $sp723085->gfpoly = $sp840409; for ($spd17574 = 1; $spd17574 % $spffa201 != 0; $spd17574 += $sp723085->nn) { } $sp723085->iprim = (int) ($spd17574 / $spffa201); $sp723085->genpoly[0] = 1; for ($sp218d20 = 0, $sp458697 = $sp09aec5 * $spffa201; $sp218d20 < $sp195e42; $sp218d20++, $sp458697 += $spffa201) { $sp723085->genpoly[$sp218d20 + 1] = 1; for ($sp3dc13c = $sp218d20; $sp3dc13c > 0; $sp3dc13c--) { if ($sp723085->genpoly[$sp3dc13c] != 0) { $sp723085->genpoly[$sp3dc13c] = $sp723085->genpoly[$sp3dc13c - 1] ^ $sp723085->alpha_to[$sp723085->modnn($sp723085->index_of[$sp723085->genpoly[$sp3dc13c]] + $sp458697)]; } else { $sp723085->genpoly[$sp3dc13c] = $sp723085->genpoly[$sp3dc13c - 1]; } } $sp723085->genpoly[0] = $sp723085->alpha_to[$sp723085->modnn($sp723085->index_of[$sp723085->genpoly[0]] + $sp458697)]; } for ($sp218d20 = 0; $sp218d20 <= $sp195e42; $sp218d20++) { $sp723085->genpoly[$sp218d20] = $sp723085->index_of[$sp723085->genpoly[$sp218d20]]; } return $sp723085; } public function encode_rs_char($spbda5b4, &$spb76594) { $sp46927a =& $this->mm; $sp0de42d =& $this->nn; $spb9154e =& $this->alpha_to; $sp0c8da6 =& $this->index_of; $sp2eb603 =& $this->genpoly; $spb963cd =& $this->nroots; $sp79dfde =& $this->fcr; $sp412078 =& $this->prim; $sp909258 =& $this->iprim; $spf41bd5 =& $this->pad; $spe81ae4 =& $sp0de42d; $spb76594 = array_fill(0, $spb963cd, 0); for ($sp218d20 = 0; $sp218d20 < $sp0de42d - $spb963cd - $spf41bd5; $sp218d20++) { $spb4910e = $sp0c8da6[$spbda5b4[$sp218d20] ^ $spb76594[0]]; if ($spb4910e != $spe81ae4) { $spb4910e = $this->modnn($sp0de42d - $sp2eb603[$spb963cd] + $spb4910e); for ($sp3dc13c = 1; $sp3dc13c < $spb963cd; $sp3dc13c++) { $spb76594[$sp3dc13c] ^= $spb9154e[$this->modnn($spb4910e + $sp2eb603[$spb963cd - $sp3dc13c])]; } } array_shift($spb76594); if ($spb4910e != $spe81ae4) { array_push($spb76594, $spb9154e[$this->modnn($spb4910e + $sp2eb603[0])]); } else { array_push($spb76594, 0); } } } } class QRrs { public static $items = array(); public static function init_rs($sp53f38b, $sp840409, $sp09aec5, $spffa201, $sp195e42, $sp85e30d) { foreach (self::$items as $sp723085) { if ($sp723085->pad != $sp85e30d) { continue; } if ($sp723085->nroots != $sp195e42) { continue; } if ($sp723085->mm != $sp53f38b) { continue; } if ($sp723085->gfpoly != $sp840409) { continue; } if ($sp723085->fcr != $sp09aec5) { continue; } if ($sp723085->prim != $spffa201) { continue; } return $sp723085; } $sp723085 = QRrsItem::init_rs_char($sp53f38b, $sp840409, $sp09aec5, $spffa201, $sp195e42, $sp85e30d); array_unshift(self::$items, $sp723085); return $sp723085; } } define('N1', 3); define('N2', 3); define('N3', 40); define('N4', 10); class QRmask { public $runLength = array(); public function __construct() { $this->runLength = array_fill(0, QRSPEC_WIDTH_MAX + 1, 0); } public function writeFormatInformation($sp395073, &$sp2cfdb8, $spa3e44c, $sp8a0843) { $sp4c42af = 0; $sp667761 = QRspec::getFormatInfo($spa3e44c, $sp8a0843); for ($sp218d20 = 0; $sp218d20 < 8; $sp218d20++) { if ($sp667761 & 1) { $sp4c42af += 2; $spce84f3 = 133; } else { $spce84f3 = 132; } $sp2cfdb8[8][$sp395073 - 1 - $sp218d20] = chr($spce84f3); if ($sp218d20 < 6) { $sp2cfdb8[$sp218d20][8] = chr($spce84f3); } else { $sp2cfdb8[$sp218d20 + 1][8] = chr($spce84f3); } $sp667761 = $sp667761 >> 1; } for ($sp218d20 = 0; $sp218d20 < 7; $sp218d20++) { if ($sp667761 & 1) { $sp4c42af += 2; $spce84f3 = 133; } else { $spce84f3 = 132; } $sp2cfdb8[$sp395073 - 7 + $sp218d20][8] = chr($spce84f3); if ($sp218d20 == 0) { $sp2cfdb8[8][7] = chr($spce84f3); } else { $sp2cfdb8[8][6 - $sp218d20] = chr($spce84f3); } $sp667761 = $sp667761 >> 1; } return $sp4c42af; } public function mask0($sp521ef8, $spfe16e7) { return $sp521ef8 + $spfe16e7 & 1; } public function mask1($sp521ef8, $spfe16e7) { return $spfe16e7 & 1; } public function mask2($sp521ef8, $spfe16e7) { return $sp521ef8 % 3; } public function mask3($sp521ef8, $spfe16e7) { return ($sp521ef8 + $spfe16e7) % 3; } public function mask4($sp521ef8, $spfe16e7) { return (int) ($spfe16e7 / 2) + (int) ($sp521ef8 / 3) & 1; } public function mask5($sp521ef8, $spfe16e7) { return ($sp521ef8 * $spfe16e7 & 1) + $sp521ef8 * $spfe16e7 % 3; } public function mask6($sp521ef8, $spfe16e7) { return ($sp521ef8 * $spfe16e7 & 1) + $sp521ef8 * $spfe16e7 % 3 & 1; } public function mask7($sp521ef8, $spfe16e7) { return $sp521ef8 * $spfe16e7 % 3 + ($sp521ef8 + $spfe16e7 & 1) & 1; } private function generateMaskNo($sp138bae, $sp395073, $sp2cfdb8) { $sp4ad1ae = array_fill(0, $sp395073, array_fill(0, $sp395073, 0)); for ($spfe16e7 = 0; $spfe16e7 < $sp395073; $spfe16e7++) { for ($sp521ef8 = 0; $sp521ef8 < $sp395073; $sp521ef8++) { if (ord($sp2cfdb8[$spfe16e7][$sp521ef8]) & 128) { $sp4ad1ae[$spfe16e7][$sp521ef8] = 0; } else { $spaa8f84 = call_user_func(array($this, 'mask' . $sp138bae), $sp521ef8, $spfe16e7); $sp4ad1ae[$spfe16e7][$sp521ef8] = $spaa8f84 == 0 ? 1 : 0; } } } return $sp4ad1ae; } public static function serial($spb7fcb8) { $spc390d9 = array(); foreach ($spb7fcb8 as $sp91490f) { $spc390d9[] = join('', $sp91490f); } return gzcompress(join('
', $spc390d9), 9); } public static function unserial($spd51873) { $spc390d9 = array(); $spaea723 = explode('
', gzuncompress($spd51873)); foreach ($spaea723 as $sp91490f) { $spc390d9[] = str_split($sp91490f); } return $spc390d9; } public function makeMaskNo($sp138bae, $sp395073, $sp901b05, &$sp35e2fa, $sp5a22ba = false) { $spe8bdca = 0; $sp4ad1ae = array(); $sp522c55 = QR_CACHE_DIR . 'mask_' . $sp138bae . DIRECTORY_SEPARATOR . 'mask_' . $sp395073 . '_' . $sp138bae . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp522c55)) { $sp4ad1ae = self::unserial(file_get_contents($sp522c55)); } else { $sp4ad1ae = $this->generateMaskNo($sp138bae, $sp395073, $sp901b05, $sp35e2fa); if (!file_exists(QR_CACHE_DIR . 'mask_' . $sp138bae)) { mkdir(QR_CACHE_DIR . 'mask_' . $sp138bae); } file_put_contents($sp522c55, self::serial($sp4ad1ae)); } } else { $sp4ad1ae = $this->generateMaskNo($sp138bae, $sp395073, $sp901b05, $sp35e2fa); } if ($sp5a22ba) { return; } $sp35e2fa = $sp901b05; for ($spfe16e7 = 0; $spfe16e7 < $sp395073; $spfe16e7++) { for ($sp521ef8 = 0; $sp521ef8 < $sp395073; $sp521ef8++) { if ($sp4ad1ae[$spfe16e7][$sp521ef8] == 1) { $sp35e2fa[$spfe16e7][$sp521ef8] = chr(ord($sp901b05[$spfe16e7][$sp521ef8]) ^ (int) $sp4ad1ae[$spfe16e7][$sp521ef8]); } $spe8bdca += (int) (ord($sp35e2fa[$spfe16e7][$sp521ef8]) & 1); } } return $spe8bdca; } public function makeMask($sp395073, $sp2cfdb8, $sp138bae, $sp8a0843) { $sp1ac7d4 = array_fill(0, $sp395073, str_repeat(' ', $sp395073)); $this->makeMaskNo($sp138bae, $sp395073, $sp2cfdb8, $sp1ac7d4); $this->writeFormatInformation($sp395073, $sp1ac7d4, $sp138bae, $sp8a0843); return $sp1ac7d4; } public function calcN1N3($sp047f5a) { $spe45732 = 0; for ($sp218d20 = 0; $sp218d20 < $sp047f5a; $sp218d20++) { if ($this->runLength[$sp218d20] >= 5) { $spe45732 += N1 + ($this->runLength[$sp218d20] - 5); } if ($sp218d20 & 1) { if ($sp218d20 >= 3 && $sp218d20 < $sp047f5a - 2 && $this->runLength[$sp218d20] % 3 == 0) { $sp127eda = (int) ($this->runLength[$sp218d20] / 3); if ($this->runLength[$sp218d20 - 2] == $sp127eda && $this->runLength[$sp218d20 - 1] == $sp127eda && $this->runLength[$sp218d20 + 1] == $sp127eda && $this->runLength[$sp218d20 + 2] == $sp127eda) { if ($this->runLength[$sp218d20 - 3] < 0 || $this->runLength[$sp218d20 - 3] >= 4 * $sp127eda) { $spe45732 += N3; } else { if ($sp218d20 + 3 >= $sp047f5a || $this->runLength[$sp218d20 + 3] >= 4 * $sp127eda) { $spe45732 += N3; } } } } } } return $spe45732; } public function evaluateSymbol($sp395073, $sp2cfdb8) { $sp8aa4d4 = 0; $spe45732 = 0; for ($spfe16e7 = 0; $spfe16e7 < $sp395073; $spfe16e7++) { $sp8aa4d4 = 0; $this->runLength[0] = 1; $spb5f546 = $sp2cfdb8[$spfe16e7]; if ($spfe16e7 > 0) { $spaf913f = $sp2cfdb8[$spfe16e7 - 1]; } for ($sp521ef8 = 0; $sp521ef8 < $sp395073; $sp521ef8++) { if ($sp521ef8 > 0 && $spfe16e7 > 0) { $sp0a4105 = ord($spb5f546[$sp521ef8]) & ord($spb5f546[$sp521ef8 - 1]) & ord($spaf913f[$sp521ef8]) & ord($spaf913f[$sp521ef8 - 1]); $sp1d80a8 = ord($spb5f546[$sp521ef8]) | ord($spb5f546[$sp521ef8 - 1]) | ord($spaf913f[$sp521ef8]) | ord($spaf913f[$sp521ef8 - 1]); if (($sp0a4105 | $sp1d80a8 ^ 1) & 1) { $spe45732 += N2; } } if ($sp521ef8 == 0 && ord($spb5f546[$sp521ef8]) & 1) { $this->runLength[0] = -1; $sp8aa4d4 = 1; $this->runLength[$sp8aa4d4] = 1; } else { if ($sp521ef8 > 0) { if ((ord($spb5f546[$sp521ef8]) ^ ord($spb5f546[$sp521ef8 - 1])) & 1) { $sp8aa4d4++; $this->runLength[$sp8aa4d4] = 1; } else { $this->runLength[$sp8aa4d4]++; } } } } $spe45732 += $this->calcN1N3($sp8aa4d4 + 1); } for ($sp521ef8 = 0; $sp521ef8 < $sp395073; $sp521ef8++) { $sp8aa4d4 = 0; $this->runLength[0] = 1; for ($spfe16e7 = 0; $spfe16e7 < $sp395073; $spfe16e7++) { if ($spfe16e7 == 0 && ord($sp2cfdb8[$spfe16e7][$sp521ef8]) & 1) { $this->runLength[0] = -1; $sp8aa4d4 = 1; $this->runLength[$sp8aa4d4] = 1; } else { if ($spfe16e7 > 0) { if ((ord($sp2cfdb8[$spfe16e7][$sp521ef8]) ^ ord($sp2cfdb8[$spfe16e7 - 1][$sp521ef8])) & 1) { $sp8aa4d4++; $this->runLength[$sp8aa4d4] = 1; } else { $this->runLength[$sp8aa4d4]++; } } } } $spe45732 += $this->calcN1N3($sp8aa4d4 + 1); } return $spe45732; } public function mask($sp395073, $sp2cfdb8, $sp8a0843) { $spcf4d96 = PHP_INT_MAX; $spbc8e73 = 0; $spa964e8 = array(); $sp5dd3f6 = array(0, 1, 2, 3, 4, 5, 6, 7); if (QR_FIND_FROM_RANDOM !== false) { $sp5f65d8 = 8 - QR_FIND_FROM_RANDOM % 9; for ($sp218d20 = 0; $sp218d20 < $sp5f65d8; $sp218d20++) { $sp9be55b = rand(0, count($sp5dd3f6) - 1); unset($sp5dd3f6[$sp9be55b]); $sp5dd3f6 = array_values($sp5dd3f6); } } $spa964e8 = $sp2cfdb8; foreach ($sp5dd3f6 as $sp218d20) { $spa3e44c = array_fill(0, $sp395073, str_repeat(' ', $sp395073)); $spe45732 = 0; $sp4c42af = 0; $sp4c42af = $this->makeMaskNo($sp218d20, $sp395073, $sp2cfdb8, $spa3e44c); $sp4c42af += $this->writeFormatInformation($sp395073, $spa3e44c, $sp218d20, $sp8a0843); $sp4c42af = (int) (100 * $sp4c42af / ($sp395073 * $sp395073)); $spe45732 = (int) ((int) (abs($sp4c42af - 50) / 5) * N4); $spe45732 += $this->evaluateSymbol($sp395073, $spa3e44c); if ($spe45732 < $spcf4d96) { $spcf4d96 = $spe45732; $spa964e8 = $spa3e44c; $spbc8e73 = $sp218d20; } } return $spa964e8; } } class QRrsblock { public $dataLength; public $data = array(); public $eccLength; public $ecc = array(); public function __construct($spb01c2e, $spbda5b4, $spe31c76, &$sp7ca352, QRrsItem $sp723085) { $sp723085->encode_rs_char($spbda5b4, $sp7ca352); $this->dataLength = $spb01c2e; $this->data = $spbda5b4; $this->eccLength = $spe31c76; $this->ecc = $sp7ca352; } } class QRrawcode { public $version; public $datacode = array(); public $ecccode = array(); public $blocks; public $rsblocks = array(); public $count; public $dataLength; public $eccLength; public $b1; public function __construct(QRinput $sp317e70) { $spe29e09 = array(0, 0, 0, 0, 0); $this->datacode = $sp317e70->getByteStream(); if (is_null($this->datacode)) { throw new Exception('null imput string'); } QRspec::getEccSpec($sp317e70->getVersion(), $sp317e70->getErrorCorrectionLevel(), $spe29e09); $this->version = $sp317e70->getVersion(); $this->b1 = QRspec::rsBlockNum1($spe29e09); $this->dataLength = QRspec::rsDataLength($spe29e09); $this->eccLength = QRspec::rsEccLength($spe29e09); $this->ecccode = array_fill(0, $this->eccLength, 0); $this->blocks = QRspec::rsBlockNum($spe29e09); $sp567373 = $this->init($spe29e09); if ($sp567373 < 0) { throw new Exception('block alloc error'); return null; } $this->count = 0; } public function init(array $spe29e09) { $spb01c2e = QRspec::rsDataCodes1($spe29e09); $spe31c76 = QRspec::rsEccCodes1($spe29e09); $sp723085 = QRrs::init_rs(8, 285, 0, 1, $spe31c76, 255 - $spb01c2e - $spe31c76); $spee0a1a = 0; $spc9c306 = 0; $sp8baee3 = 0; for ($sp218d20 = 0; $sp218d20 < QRspec::rsBlockNum1($spe29e09); $sp218d20++) { $sp7ca352 = array_slice($this->ecccode, $sp8baee3); $this->rsblocks[$spee0a1a] = new QRrsblock($spb01c2e, array_slice($this->datacode, $spc9c306), $spe31c76, $sp7ca352, $sp723085); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp8baee3), $sp7ca352); $spc9c306 += $spb01c2e; $sp8baee3 += $spe31c76; $spee0a1a++; } if (QRspec::rsBlockNum2($spe29e09) == 0) { return 0; } $spb01c2e = QRspec::rsDataCodes2($spe29e09); $spe31c76 = QRspec::rsEccCodes2($spe29e09); $sp723085 = QRrs::init_rs(8, 285, 0, 1, $spe31c76, 255 - $spb01c2e - $spe31c76); if ($sp723085 == NULL) { return -1; } for ($sp218d20 = 0; $sp218d20 < QRspec::rsBlockNum2($spe29e09); $sp218d20++) { $sp7ca352 = array_slice($this->ecccode, $sp8baee3); $this->rsblocks[$spee0a1a] = new QRrsblock($spb01c2e, array_slice($this->datacode, $spc9c306), $spe31c76, $sp7ca352, $sp723085); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp8baee3), $sp7ca352); $spc9c306 += $spb01c2e; $sp8baee3 += $spe31c76; $spee0a1a++; } return 0; } public function getCode() { $sp567373; if ($this->count < $this->dataLength) { $spe9e25a = $this->count % $this->blocks; $spf437b8 = $this->count / $this->blocks; if ($spf437b8 >= $this->rsblocks[0]->dataLength) { $spe9e25a += $this->b1; } $sp567373 = $this->rsblocks[$spe9e25a]->data[$spf437b8]; } else { if ($this->count < $this->dataLength + $this->eccLength) { $spe9e25a = ($this->count - $this->dataLength) % $this->blocks; $spf437b8 = ($this->count - $this->dataLength) / $this->blocks; $sp567373 = $this->rsblocks[$spe9e25a]->ecc[$spf437b8]; } else { return 0; } } $this->count++; return $sp567373; } } class QRcode { public $version; public $width; public $data; public function encodeMask(QRinput $sp317e70, $spa3e44c) { if ($sp317e70->getVersion() < 0 || $sp317e70->getVersion() > QRSPEC_VERSION_MAX) { throw new Exception('wrong version'); } if ($sp317e70->getErrorCorrectionLevel() > QR_ECLEVEL_H) { throw new Exception('wrong level'); } $sp1783a2 = new QRrawcode($sp317e70); QRtools::markTime('after_raw'); $sp348765 = $sp1783a2->version; $sp395073 = QRspec::getWidth($sp348765); $sp2cfdb8 = QRspec::newFrame($sp348765); $spf9ac34 = new FrameFiller($sp395073, $sp2cfdb8); if (is_null($spf9ac34)) { return NULL; } for ($sp218d20 = 0; $sp218d20 < $sp1783a2->dataLength + $sp1783a2->eccLength; $sp218d20++) { $spd51873 = $sp1783a2->getCode(); $spef45dc = 128; for ($sp3dc13c = 0; $sp3dc13c < 8; $sp3dc13c++) { $spcc9567 = $spf9ac34->next(); $spf9ac34->setFrameAt($spcc9567, 2 | ($spef45dc & $spd51873) != 0); $spef45dc = $spef45dc >> 1; } } QRtools::markTime('after_filler'); unset($sp1783a2); $sp3dc13c = QRspec::getRemainder($sp348765); for ($sp218d20 = 0; $sp218d20 < $sp3dc13c; $sp218d20++) { $spcc9567 = $spf9ac34->next(); $spf9ac34->setFrameAt($spcc9567, 2); } $sp2cfdb8 = $spf9ac34->frame; unset($spf9ac34); $sp131226 = new QRmask(); if ($spa3e44c < 0) { if (QR_FIND_BEST_MASK) { $sp1ac7d4 = $sp131226->mask($sp395073, $sp2cfdb8, $sp317e70->getErrorCorrectionLevel()); } else { $sp1ac7d4 = $sp131226->makeMask($sp395073, $sp2cfdb8, intval(QR_DEFAULT_MASK) % 8, $sp317e70->getErrorCorrectionLevel()); } } else { $sp1ac7d4 = $sp131226->makeMask($sp395073, $sp2cfdb8, $spa3e44c, $sp317e70->getErrorCorrectionLevel()); } if ($sp1ac7d4 == NULL) { return NULL; } QRtools::markTime('after_mask'); $this->version = $sp348765; $this->width = $sp395073; $this->data = $sp1ac7d4; return $this; } public function encodeInput(QRinput $sp317e70) { return $this->encodeMask($sp317e70, -1); } public function encodeString8bit($spb81a87, $sp348765, $sp8a0843) { if (string == NULL) { throw new Exception('empty string!'); return NULL; } $sp317e70 = new QRinput($sp348765, $sp8a0843); if ($sp317e70 == NULL) { return NULL; } $sp567373 = $sp317e70->append($sp317e70, QR_MODE_8, strlen($spb81a87), str_split($spb81a87)); if ($sp567373 < 0) { unset($sp317e70); return NULL; } return $this->encodeInput($sp317e70); } public function encodeString($spb81a87, $sp348765, $sp8a0843, $sp57c9ab, $sp67038b) { if ($sp57c9ab != QR_MODE_8 && $sp57c9ab != QR_MODE_KANJI) { throw new Exception('bad hint'); return NULL; } $sp317e70 = new QRinput($sp348765, $sp8a0843); if ($sp317e70 == NULL) { return NULL; } $sp567373 = QRsplit::splitStringToQRinput($spb81a87, $sp317e70, $sp57c9ab, $sp67038b); if ($sp567373 < 0) { return NULL; } return $this->encodeInput($sp317e70); } public static function png($spcce599, $spc67485 = false, $sp8a0843 = QR_ECLEVEL_L, $sp5b0542 = 3, $sp6cc4f1 = 4, $sp4d8b10 = false) { $sp52907d = QRencode::factory($sp8a0843, $sp5b0542, $sp6cc4f1); return $sp52907d->encodePNG($spcce599, $spc67485, $sp4d8b10 = false); } public static function text($spcce599, $spc67485 = false, $sp8a0843 = QR_ECLEVEL_L, $sp5b0542 = 3, $sp6cc4f1 = 4) { $sp52907d = QRencode::factory($sp8a0843, $sp5b0542, $sp6cc4f1); return $sp52907d->encode($spcce599, $spc67485); } public static function raw($spcce599, $spc67485 = false, $sp8a0843 = QR_ECLEVEL_L, $sp5b0542 = 3, $sp6cc4f1 = 4) { $sp52907d = QRencode::factory($sp8a0843, $sp5b0542, $sp6cc4f1); return $sp52907d->encodeRAW($spcce599, $spc67485); } } class FrameFiller { public $width; public $frame; public $x; public $y; public $dir; public $bit; public function __construct($sp395073, &$sp2cfdb8) { $this->width = $sp395073; $this->frame = $sp2cfdb8; $this->x = $sp395073 - 1; $this->y = $sp395073 - 1; $this->dir = -1; $this->bit = -1; } public function setFrameAt($sp5ee01f, $spfca62c) { $this->frame[$sp5ee01f['y']][$sp5ee01f['x']] = chr($spfca62c); } public function getFrameAt($sp5ee01f) { return ord($this->frame[$sp5ee01f['y']][$sp5ee01f['x']]); } public function next() { do { if ($this->bit == -1) { $this->bit = 0; return array('x' => $this->x, 'y' => $this->y); } $sp521ef8 = $this->x; $spfe16e7 = $this->y; $sp2f8aa7 = $this->width; if ($this->bit == 0) { $sp521ef8--; $this->bit++; } else { $sp521ef8++; $spfe16e7 += $this->dir; $this->bit--; } if ($this->dir < 0) { if ($spfe16e7 < 0) { $spfe16e7 = 0; $sp521ef8 -= 2; $this->dir = 1; if ($sp521ef8 == 6) { $sp521ef8--; $spfe16e7 = 9; } } } else { if ($spfe16e7 == $sp2f8aa7) { $spfe16e7 = $sp2f8aa7 - 1; $sp521ef8 -= 2; $this->dir = -1; if ($sp521ef8 == 6) { $sp521ef8--; $spfe16e7 -= 8; } } } if ($sp521ef8 < 0 || $spfe16e7 < 0) { return null; } $this->x = $sp521ef8; $this->y = $spfe16e7; } while (ord($this->frame[$spfe16e7][$sp521ef8]) & 128); return array('x' => $sp521ef8, 'y' => $spfe16e7); } } class QRencode { public $casesensitive = true; public $eightbit = false; public $version = 0; public $size = 3; public $margin = 4; public $structured = 0; public $level = QR_ECLEVEL_L; public $hint = QR_MODE_8; public static function factory($sp8a0843 = QR_ECLEVEL_L, $sp5b0542 = 3, $sp6cc4f1 = 4) { $sp52907d = new QRencode(); $sp52907d->size = $sp5b0542; $sp52907d->margin = $sp6cc4f1; switch ($sp8a0843 . '') { case '0': case '1': case '2': case '3': $sp52907d->level = $sp8a0843; break; case 'l': case 'L': $sp52907d->level = QR_ECLEVEL_L; break; case 'm': case 'M': $sp52907d->level = QR_ECLEVEL_M; break; case 'q': case 'Q': $sp52907d->level = QR_ECLEVEL_Q; break; case 'h': case 'H': $sp52907d->level = QR_ECLEVEL_H; break; } return $sp52907d; } public function encodeRAW($spc8423b, $spc67485 = false) { $spd51873 = new QRcode(); if ($this->eightbit) { $spd51873->encodeString8bit($spc8423b, $this->version, $this->level); } else { $spd51873->encodeString($spc8423b, $this->version, $this->level, $this->hint, $this->casesensitive); } return $spd51873->data; } public function encode($spc8423b, $spc67485 = false) { $spd51873 = new QRcode(); if ($this->eightbit) { $spd51873->encodeString8bit($spc8423b, $this->version, $this->level); } else { $spd51873->encodeString($spc8423b, $this->version, $this->level, $this->hint, $this->casesensitive); } QRtools::markTime('after_encode'); if ($spc67485 !== false) { file_put_contents($spc67485, join('
', QRtools::binarize($spd51873->data))); } else { return QRtools::binarize($spd51873->data); } } public function encodePNG($spc8423b, $spc67485 = false, $sp4d8b10 = false) { try { ob_start(); $sp12b266 = $this->encode($spc8423b); $sp165219 = ob_get_contents(); ob_end_clean(); if ($sp165219 != '') { QRtools::log($spc67485, $sp165219); } $sp285940 = (int) (QR_PNG_MAXIMUM_SIZE / (count($sp12b266) + 2 * $this->margin)); QRimage::png($sp12b266, $spc67485, min(max(1, $this->size), $sp285940), $this->margin, $sp4d8b10); } catch (Exception $sp019ea9) { QRtools::log($spc67485, $sp019ea9->getMessage()); } } }