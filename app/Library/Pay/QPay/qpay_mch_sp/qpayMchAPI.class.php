<?php
require_once 'qpayMchUtil.class.php'; class QpayMchAPI { protected $url; protected $isSSL; protected $timeout; public function __construct($sp3db1b2, $spc4f70b, $sp39139f = 5) { $this->url = $sp3db1b2; $this->isSSL = $spc4f70b; $this->timeout = $sp39139f; } public function notify_params() { $sp377bc6 = file_get_contents('php://input'); return QpayMchUtil::xmlToArray($sp377bc6); } public function notify_verify($spa26894, $spbe80b7) { if (!isset($spa26894['sign'])) { return false; } $spa109d2 = QpayMchUtil::getSign($spa26894, $spbe80b7['mch_key']); return $spa109d2 === $spa26894['sign']; } public function req($spa26894, $spbe80b7) { $spb9589c = array(); $spa26894['mch_id'] = $spbe80b7['mch_id']; $spa26894['nonce_str'] = QpayMchUtil::createNoncestr(); $spa26894['sign'] = QpayMchUtil::getSign($spa26894, $spbe80b7['mch_key']); $sp377bc6 = QpayMchUtil::arrayToXml($spa26894); if (isset($this->isSSL)) { $spb9589c = QpayMchUtil::reqByCurlSSLPost($sp377bc6, $this->url, $this->timeout); } else { $spb9589c = QpayMchUtil::reqByCurlNormalPost($sp377bc6, $this->url, $this->timeout); } return $spb9589c; } }