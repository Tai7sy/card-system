<?php
require_once 'alipay_core.function.php'; class AlipayNotify { var $https_verify_url = 'https://mapi.alipay.com/gateway.do?service=notify_verify&'; var $http_verify_url = 'http://notify.alipay.com/trade/notify_query.do?'; var $alipay_config; function __construct($spaad359) { $this->alipay_config = $spaad359; } function AlipayNotify($spaad359) { $this->__construct($spaad359); } function verifyNotify() { if (empty($_POST)) { return false; } else { $spab6bdb = $this->getSignVeryfy($_POST, $_POST['sign']); $sp772499 = 'false'; if (!empty($_POST['notify_id'])) { $sp772499 = $this->getResponse($_POST['notify_id']); } if (preg_match('/true$/i', $sp772499) && $spab6bdb) { return true; } else { return false; } } } function verifyReturn() { if (empty($_GET)) { return false; } else { $spab6bdb = $this->getSignVeryfy($_GET, $_GET['sign']); $sp772499 = 'false'; if (!empty($_GET['notify_id'])) { $sp772499 = $this->getResponse($_GET['notify_id']); } if (preg_match('/true$/i', $sp772499) && $spab6bdb) { return true; } else { return false; } } } function getSignVeryfy($spd8d832, $sp964415) { $sp959d7d = paraFilter($spd8d832); $spb86c77 = argSort($sp959d7d); $sp753e95 = createLinkString($spb86c77); switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $sp679ba6 = md5Verify($sp753e95, $sp964415, $this->alipay_config['key']); break; default: $sp679ba6 = false; } return $sp679ba6; } function getResponse($sp983f78) { $sp713fc3 = strtolower(trim($this->alipay_config['transport'])); $sp5c99e7 = trim($this->alipay_config['partner']); if ($sp713fc3 == 'https') { $spf6507d = $this->https_verify_url; } else { $spf6507d = $this->http_verify_url; } $spf6507d = $spf6507d . 'partner=' . $sp5c99e7 . '&notify_id=' . $sp983f78; $sp772499 = getHttpResponseGET($spf6507d, $this->alipay_config['cacert']); return $sp772499; } }