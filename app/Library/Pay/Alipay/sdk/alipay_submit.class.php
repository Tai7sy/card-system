<?php
require_once 'alipay_core.function.php'; class AlipaySubmit { var $alipay_config; var $alipay_gateway_new = 'https://mapi.alipay.com/gateway.do?'; function __construct($spaad359) { $this->alipay_config = $spaad359; } function AlipaySubmit($spaad359) { $this->__construct($spaad359); } function buildRequestMysign($spb86c77) { $sp753e95 = createLinkString($spb86c77); switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $spc5fb95 = md5Sign($sp753e95, $this->alipay_config['key']); break; default: $spc5fb95 = ''; } return $spc5fb95; } function buildRequestPara($spd8d832) { $sp959d7d = paraFilter($spd8d832); $spb86c77 = argSort($sp959d7d); $spc5fb95 = $this->buildRequestMysign($spb86c77); $spb86c77['sign'] = $spc5fb95; $spb86c77['sign_type'] = strtoupper(trim($this->alipay_config['sign_type'])); return $spb86c77; } function buildRequestParaToString($spd8d832) { $sp7a655e = $this->buildRequestPara($spd8d832); $sp125bdd = createLinkStringUrlEncode($sp7a655e); return $sp125bdd; } function buildRequestForm($spd8d832, $spd0c59e, $sp1fd655) { $sp7a655e = $this->buildRequestPara($spd8d832); $spd9728a = '<form id=\'alipaysubmit\' name=\'alipaysubmit\' action=\'' . $this->alipay_gateway_new . '_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])) . '\' method=\'' . $spd0c59e . '\'>'; foreach ($sp7a655e as $spf1241f => $sp91e29b) { $spd9728a .= '<input type=\'hidden\' name=\'' . $spf1241f . '\' value=\'' . $sp91e29b . '\'/>'; } $spd9728a = $spd9728a . '<input type=\'submit\'  value=\'' . $sp1fd655 . '\' style=\'display:none;\'></form>'; $spd9728a = $spd9728a . '<script>document.forms[\'alipaysubmit\'].submit();</script>'; return $spd9728a; } function query_timestamp() { $spd2457c = $this->alipay_gateway_new . 'service=query_timestamp&partner=' . trim(strtolower($this->alipay_config['partner'])) . '&_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])); $spa82def = new DOMDocument(); $spa82def->load($spd2457c); $sp30aaef = $spa82def->getElementsByTagName('encrypt_key'); $sp42a4d2 = $sp30aaef->item(0)->nodeValue; return $sp42a4d2; } }