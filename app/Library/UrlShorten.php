<?php
namespace App\Library; class UrlShorten { public static function shorten($sp924227, $spaf1bf4 = false) { if ($spaf1bf4 === false) { $spaf1bf4 = \App\System::_get('domain_shorten'); } if ($spaf1bf4 === '1' || $spaf1bf4 === 'url.cn') { $spd84b4e = UrlShorten::url_cn($sp924227); } elseif ($spaf1bf4 === '2' || $spaf1bf4 === 't.cn') { $spd84b4e = UrlShorten::t_cn($sp924227); } elseif ($spaf1bf4 === 'w.url.cn') { $spd84b4e = UrlShorten::w_url_cn($sp924227); } elseif ($spaf1bf4 === 'custom') { $spd84b4e = UrlShorten::custom($sp924227); } else { return $sp924227; } } public static function t_cn_official($sp924227) { $sp924227 = urlencode($sp924227); $sp69550c = '2590114856'; $sp795d9f = 'http://api.t.sina.com.cn/short_url/shorten.json?source=' . $sp69550c . '&url_long=' . $sp924227; $spe30471 = curl_init(); curl_setopt($spe30471, CURLOPT_URL, $sp795d9f); curl_setopt($spe30471, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spe30471, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($spe30471, CURLOPT_HEADER, 0); curl_setopt($spe30471, CURLOPT_HTTPHEADER, array('Content-type: application/json')); $sp2a9a03 = curl_exec($spe30471); curl_close($spe30471); $sp34ef1b = json_decode($sp2a9a03, true); return isset($sp34ef1b['url_short']) && strstr($sp34ef1b['url_short'], 'http://') ? $sp34ef1b['url_short'] : null; } public static function t_cn($sp924227) { $sp924227 = urlencode($sp924227); $sp795d9f = 'https://i.alapi.cn/url/?url=' . $sp924227; $spe30471 = curl_init(); curl_setopt($spe30471, CURLOPT_URL, $sp795d9f); curl_setopt($spe30471, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spe30471, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($spe30471, CURLOPT_HEADER, 0); curl_setopt($spe30471, CURLOPT_HTTPHEADER, array('Content-type: application/json')); $sp2a9a03 = curl_exec($spe30471); curl_close($spe30471); $sp34ef1b = json_decode($sp2a9a03, true); return isset($sp34ef1b['shortUrl']) && strstr($sp34ef1b['shortUrl'], 'http') ? $sp34ef1b['shortUrl'] : null; } public static function url_cn($sp924227) { $sp924227 = urlencode($sp924227); $sp795d9f = 'https://api.uomg.com/api/long2dwz?dwzapi=urlcn&url=' . $sp924227; $spe30471 = curl_init(); curl_setopt($spe30471, CURLOPT_URL, $sp795d9f); curl_setopt($spe30471, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spe30471, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($spe30471, CURLOPT_HEADER, 0); curl_setopt($spe30471, CURLOPT_HTTPHEADER, array('Content-type: application/json')); curl_setopt($spe30471, CURLOPT_TIMEOUT, 5); curl_setopt($spe30471, CURLOPT_CONNECTTIMEOUT, 5); $sp2a9a03 = curl_exec($spe30471); curl_close($spe30471); $sp34ef1b = json_decode($sp2a9a03, true); return isset($sp34ef1b['ae_url']) && strstr($sp34ef1b['ae_url'], 'http') ? $sp34ef1b['ae_url'] : null; } public static function w_url_cn($sp924227) { return null; } public static function custom($sp924227) { $spc9dea9 = ''; $spef78f2 = ''; $sp924227 = urlencode($sp924227); $sp795d9f = 'http://api.his.cat/api/url/shorten.json?id=' . $spc9dea9 . '&key=' . $spef78f2 . '&url=' . $sp924227; $spe30471 = curl_init(); curl_setopt($spe30471, CURLOPT_URL, $sp795d9f); curl_setopt($spe30471, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spe30471, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($spe30471, CURLOPT_HEADER, 0); curl_setopt($spe30471, CURLOPT_HTTPHEADER, array('Content-type: application/json')); curl_setopt($spe30471, CURLOPT_TIMEOUT, 5); curl_setopt($spe30471, CURLOPT_CONNECTTIMEOUT, 5); $sp2a9a03 = curl_exec($spe30471); curl_close($spe30471); $sp34ef1b = json_decode($sp2a9a03, true); return isset($sp34ef1b['data']) && isset($sp34ef1b['data']['short_url']) && strstr($sp34ef1b['data']['short_url'], 'http') ? $sp34ef1b['data']['short_url'] : null; } }