<?php
namespace App\Library; class UrlShorten { public static function shorten($spcbb37e, $sp23bcc1 = false) { if ($sp23bcc1 === false) { $sp23bcc1 = \App\System::_get('domain_shorten'); } if ($sp23bcc1 === '1' || $sp23bcc1 === 'url.cn') { $sp573813 = UrlShorten::url_cn($spcbb37e); } elseif ($sp23bcc1 === '2' || $sp23bcc1 === 't.cn') { $sp573813 = UrlShorten::t_cn($spcbb37e); } elseif ($sp23bcc1 === 'w.url.cn') { $sp573813 = UrlShorten::w_url_cn($spcbb37e); } elseif ($sp23bcc1 === 'custom') { $sp573813 = UrlShorten::custom($spcbb37e); } else { return $spcbb37e; } } public static function t_cn_official($spcbb37e) { $spcbb37e = urlencode($spcbb37e); $spe438f6 = '2590114856'; $sp413ab7 = 'http://api.t.sina.com.cn/short_url/shorten.json?source=' . $spe438f6 . '&url_long=' . $spcbb37e; $sp5b9838 = curl_init(); curl_setopt($sp5b9838, CURLOPT_URL, $sp413ab7); curl_setopt($sp5b9838, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp5b9838, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($sp5b9838, CURLOPT_HEADER, 0); curl_setopt($sp5b9838, CURLOPT_HTTPHEADER, array('Content-type: application/json')); $spca52a4 = curl_exec($sp5b9838); curl_close($sp5b9838); $sp74d405 = json_decode($spca52a4, true); return isset($sp74d405['url_short']) && strstr($sp74d405['url_short'], 'http://') ? $sp74d405['url_short'] : null; } public static function t_cn($spcbb37e) { $spcbb37e = urlencode($spcbb37e); $sp413ab7 = 'https://i.alapi.cn/url/?url=' . $spcbb37e; $sp5b9838 = curl_init(); curl_setopt($sp5b9838, CURLOPT_URL, $sp413ab7); curl_setopt($sp5b9838, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp5b9838, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($sp5b9838, CURLOPT_HEADER, 0); curl_setopt($sp5b9838, CURLOPT_HTTPHEADER, array('Content-type: application/json')); $spca52a4 = curl_exec($sp5b9838); curl_close($sp5b9838); $sp74d405 = json_decode($spca52a4, true); return isset($sp74d405['shortUrl']) && strstr($sp74d405['shortUrl'], 'http') ? $sp74d405['shortUrl'] : null; } public static function url_cn($spcbb37e) { $spcbb37e = urlencode($spcbb37e); $sp413ab7 = 'https://api.uomg.com/api/long2dwz?dwzapi=urlcn&url=' . $spcbb37e; $sp5b9838 = curl_init(); curl_setopt($sp5b9838, CURLOPT_URL, $sp413ab7); curl_setopt($sp5b9838, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp5b9838, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($sp5b9838, CURLOPT_HEADER, 0); curl_setopt($sp5b9838, CURLOPT_HTTPHEADER, array('Content-type: application/json')); curl_setopt($sp5b9838, CURLOPT_TIMEOUT, 5); curl_setopt($sp5b9838, CURLOPT_CONNECTTIMEOUT, 5); $spca52a4 = curl_exec($sp5b9838); curl_close($sp5b9838); $sp74d405 = json_decode($spca52a4, true); return isset($sp74d405['ae_url']) && strstr($sp74d405['ae_url'], 'http') ? $sp74d405['ae_url'] : null; } public static function w_url_cn($spcbb37e) { return null; } public static function custom($spcbb37e) { $spf34ea7 = ''; $spfb30bb = ''; $spcbb37e = urlencode($spcbb37e); $sp413ab7 = 'http://api.his.cat/api/url/shorten.json?id=' . $spf34ea7 . '&key=' . $spfb30bb . '&url=' . $spcbb37e; $sp5b9838 = curl_init(); curl_setopt($sp5b9838, CURLOPT_URL, $sp413ab7); curl_setopt($sp5b9838, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp5b9838, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($sp5b9838, CURLOPT_HEADER, 0); curl_setopt($sp5b9838, CURLOPT_HTTPHEADER, array('Content-type: application/json')); curl_setopt($sp5b9838, CURLOPT_TIMEOUT, 5); curl_setopt($sp5b9838, CURLOPT_CONNECTTIMEOUT, 5); $spca52a4 = curl_exec($sp5b9838); curl_close($sp5b9838); $sp74d405 = json_decode($spca52a4, true); return isset($sp74d405['data']) && isset($sp74d405['data']['short_url']) && strstr($sp74d405['data']['short_url'], 'http') ? $sp74d405['data']['short_url'] : null; } }