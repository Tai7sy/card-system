<?php
namespace App\Library; class UrlShorten { public static function shorten($sp49fc6d, $spde8d63 = false) { if ($spde8d63 === false) { $spde8d63 = \App\System::_get('domain_shorten'); } if ($spde8d63 === '1' || $spde8d63 === 'url.cn') { $sp1609c2 = UrlShorten::url_cn($sp49fc6d); } elseif ($spde8d63 === '2' || $spde8d63 === 't.cn') { $sp1609c2 = UrlShorten::t_cn($sp49fc6d); } elseif ($spde8d63 === 'w.url.cn') { $sp1609c2 = UrlShorten::w_url_cn($sp49fc6d); } elseif ($spde8d63 === 'custom') { $sp1609c2 = UrlShorten::custom($sp49fc6d); } else { return $sp49fc6d; } } public static function t_cn_official($sp49fc6d) { $sp49fc6d = urlencode($sp49fc6d); $spa42aa8 = '2590114856'; $sp871296 = 'http://api.t.sina.com.cn/short_url/shorten.json?source=' . $spa42aa8 . '&url_long=' . $sp49fc6d; $sp2e518a = curl_init(); curl_setopt($sp2e518a, CURLOPT_URL, $sp871296); curl_setopt($sp2e518a, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp2e518a, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($sp2e518a, CURLOPT_HEADER, 0); curl_setopt($sp2e518a, CURLOPT_HTTPHEADER, array('Content-type: application/json')); $spae7658 = curl_exec($sp2e518a); curl_close($sp2e518a); $spb95089 = json_decode($spae7658, true); return isset($spb95089['url_short']) && strstr($spb95089['url_short'], 'http://') ? $spb95089['url_short'] : null; } public static function t_cn($sp49fc6d) { $sp49fc6d = urlencode($sp49fc6d); $sp871296 = 'https://i.alapi.cn/url/?url=' . $sp49fc6d; $sp2e518a = curl_init(); curl_setopt($sp2e518a, CURLOPT_URL, $sp871296); curl_setopt($sp2e518a, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp2e518a, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($sp2e518a, CURLOPT_HEADER, 0); curl_setopt($sp2e518a, CURLOPT_HTTPHEADER, array('Content-type: application/json')); $spae7658 = curl_exec($sp2e518a); curl_close($sp2e518a); $spb95089 = json_decode($spae7658, true); return isset($spb95089['shortUrl']) && strstr($spb95089['shortUrl'], 'http') ? $spb95089['shortUrl'] : null; } public static function url_cn($sp49fc6d) { $sp49fc6d = urlencode($sp49fc6d); $sp871296 = 'https://api.uomg.com/api/long2dwz?dwzapi=urlcn&url=' . $sp49fc6d; $sp2e518a = curl_init(); curl_setopt($sp2e518a, CURLOPT_URL, $sp871296); curl_setopt($sp2e518a, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp2e518a, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($sp2e518a, CURLOPT_HEADER, 0); curl_setopt($sp2e518a, CURLOPT_HTTPHEADER, array('Content-type: application/json')); curl_setopt($sp2e518a, CURLOPT_TIMEOUT, 5); curl_setopt($sp2e518a, CURLOPT_CONNECTTIMEOUT, 5); $spae7658 = curl_exec($sp2e518a); curl_close($sp2e518a); $spb95089 = json_decode($spae7658, true); return isset($spb95089['ae_url']) && strstr($spb95089['ae_url'], 'http') ? $spb95089['ae_url'] : null; } public static function w_url_cn($sp49fc6d) { return null; } public static function custom($sp49fc6d) { $spc3b88e = ''; $spf5ad2e = ''; $sp49fc6d = urlencode($sp49fc6d); $sp871296 = 'http://api.his.cat/api/url/shorten.json?id=' . $spc3b88e . '&key=' . $spf5ad2e . '&url=' . $sp49fc6d; $sp2e518a = curl_init(); curl_setopt($sp2e518a, CURLOPT_URL, $sp871296); curl_setopt($sp2e518a, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp2e518a, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($sp2e518a, CURLOPT_HEADER, 0); curl_setopt($sp2e518a, CURLOPT_HTTPHEADER, array('Content-type: application/json')); curl_setopt($sp2e518a, CURLOPT_TIMEOUT, 5); curl_setopt($sp2e518a, CURLOPT_CONNECTTIMEOUT, 5); $spae7658 = curl_exec($sp2e518a); curl_close($sp2e518a); $spb95089 = json_decode($spae7658, true); return isset($spb95089['data']) && isset($spb95089['data']['short_url']) && strstr($spb95089['data']['short_url'], 'http') ? $spb95089['data']['short_url'] : null; } }