<?php
namespace App\Library; class UrlShorten { public static function shorten($sp51697e, $spe27c4b = false) { if ($spe27c4b === false) { $spe27c4b = \App\System::_get('domain_shorten'); } if ($spe27c4b === '1' || $spe27c4b === 'url.cn') { $spa49769 = UrlShorten::url_cn($sp51697e); } elseif ($spe27c4b === '2' || $spe27c4b === 't.cn') { $spa49769 = UrlShorten::t_cn($sp51697e); } elseif ($spe27c4b === 'w.url.cn') { $spa49769 = UrlShorten::w_url_cn($sp51697e); } elseif ($spe27c4b === 'custom') { $spa49769 = UrlShorten::custom($sp51697e); } else { return $sp51697e; } } public static function t_cn_official($sp51697e) { $sp51697e = urlencode($sp51697e); $spaab3b7 = '2590114856'; $spdbeb92 = 'http://api.t.sina.com.cn/short_url/shorten.json?source=' . $spaab3b7 . '&url_long=' . $sp51697e; $spc9a8f8 = curl_init(); curl_setopt($spc9a8f8, CURLOPT_URL, $spdbeb92); curl_setopt($spc9a8f8, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spc9a8f8, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($spc9a8f8, CURLOPT_HEADER, 0); curl_setopt($spc9a8f8, CURLOPT_HTTPHEADER, array('Content-type: application/json')); $spf16c1a = curl_exec($spc9a8f8); curl_close($spc9a8f8); $sp2f259d = json_decode($spf16c1a, true); return isset($sp2f259d['url_short']) && strstr($sp2f259d['url_short'], 'http://') ? $sp2f259d['url_short'] : null; } public static function t_cn($sp51697e) { $sp51697e = urlencode($sp51697e); $spdbeb92 = 'https://i.alapi.cn/url/?url=' . $sp51697e; $spc9a8f8 = curl_init(); curl_setopt($spc9a8f8, CURLOPT_URL, $spdbeb92); curl_setopt($spc9a8f8, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spc9a8f8, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($spc9a8f8, CURLOPT_HEADER, 0); curl_setopt($spc9a8f8, CURLOPT_HTTPHEADER, array('Content-type: application/json')); $spf16c1a = curl_exec($spc9a8f8); curl_close($spc9a8f8); $sp2f259d = json_decode($spf16c1a, true); return isset($sp2f259d['shortUrl']) && strstr($sp2f259d['shortUrl'], 'http') ? $sp2f259d['shortUrl'] : null; } public static function url_cn($sp51697e) { $sp51697e = urlencode($sp51697e); $spdbeb92 = 'https://api.uomg.com/api/long2dwz?dwzapi=urlcn&url=' . $sp51697e; $spc9a8f8 = curl_init(); curl_setopt($spc9a8f8, CURLOPT_URL, $spdbeb92); curl_setopt($spc9a8f8, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spc9a8f8, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($spc9a8f8, CURLOPT_HEADER, 0); curl_setopt($spc9a8f8, CURLOPT_HTTPHEADER, array('Content-type: application/json')); curl_setopt($spc9a8f8, CURLOPT_TIMEOUT, 5); curl_setopt($spc9a8f8, CURLOPT_CONNECTTIMEOUT, 5); $spf16c1a = curl_exec($spc9a8f8); curl_close($spc9a8f8); $sp2f259d = json_decode($spf16c1a, true); return isset($sp2f259d['ae_url']) && strstr($sp2f259d['ae_url'], 'http') ? $sp2f259d['ae_url'] : null; } public static function w_url_cn($sp51697e) { return null; } public static function custom($sp51697e) { $spddd4e1 = ''; $sp7414f9 = ''; $sp51697e = urlencode($sp51697e); $spdbeb92 = 'http://api.his.cat/api/url/shorten.json?id=' . $spddd4e1 . '&key=' . $sp7414f9 . '&url=' . $sp51697e; $spc9a8f8 = curl_init(); curl_setopt($spc9a8f8, CURLOPT_URL, $spdbeb92); curl_setopt($spc9a8f8, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spc9a8f8, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($spc9a8f8, CURLOPT_HEADER, 0); curl_setopt($spc9a8f8, CURLOPT_HTTPHEADER, array('Content-type: application/json')); curl_setopt($spc9a8f8, CURLOPT_TIMEOUT, 5); curl_setopt($spc9a8f8, CURLOPT_CONNECTTIMEOUT, 5); $spf16c1a = curl_exec($spc9a8f8); curl_close($spc9a8f8); $sp2f259d = json_decode($spf16c1a, true); return isset($sp2f259d['data']) && isset($sp2f259d['data']['short_url']) && strstr($sp2f259d['data']['short_url'], 'http') ? $sp2f259d['data']['short_url'] : null; } }