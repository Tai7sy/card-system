<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { public static function curl($sp81d92a, $sp971692 = 0, $spb302fe = '', $spdc767d = array(), $spccdca6 = 5, &$sp35923d = false, &$spe9590d = false, &$spbb923d = false) { if (!isset($spdc767d['Accept']) && !isset($spdc767d['accept'])) { $spdc767d['Accept'] = '*/*'; } if (!isset($spdc767d['Referer']) && !isset($spdc767d['referer'])) { $spdc767d['Referer'] = $sp81d92a; } if (!isset($spdc767d['Content-Type']) && !isset($spdc767d['content-type'])) { $spdc767d['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($spdc767d['User-Agent']) && !isset($spdc767d['user-agent'])) { $spdc767d['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp35923d !== false) { $spdc767d['Cookie'] = $sp35923d; } $sp59a117 = array(); foreach ($spdc767d as $sp179d5d => $sp07e530) { $sp59a117[] = $sp179d5d . ': ' . $sp07e530; } $sp59a117[] = 'Expect:'; $sp0c7650 = curl_init(); curl_setopt($sp0c7650, CURLOPT_URL, $sp81d92a); curl_setopt($sp0c7650, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($sp0c7650, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($sp0c7650, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp0c7650, CURLOPT_MAXREDIRS, 3); if ($sp971692 == 1) { curl_setopt($sp0c7650, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($sp0c7650, CURLOPT_POST, 1); if ($spb302fe !== '') { curl_setopt($sp0c7650, CURLOPT_POSTFIELDS, $spb302fe); curl_setopt($sp0c7650, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $sp3b58b9 = MY_PROXY; $sp70bf4e = CURLPROXY_HTTP; if (strpos($sp3b58b9, 'http://') || strpos($sp3b58b9, 'https://')) { $sp3b58b9 = str_replace('http://', $sp3b58b9, $sp3b58b9); $sp3b58b9 = str_replace('https://', $sp3b58b9, $sp3b58b9); $sp70bf4e = CURLPROXY_HTTP; } elseif (strpos($sp3b58b9, 'socks4://')) { $sp3b58b9 = str_replace('socks4://', $sp3b58b9, $sp3b58b9); $sp70bf4e = CURLPROXY_SOCKS4; } elseif (strpos($sp3b58b9, 'socks4a://')) { $sp3b58b9 = str_replace('socks4a://', $sp3b58b9, $sp3b58b9); $sp70bf4e = CURLPROXY_SOCKS4A; } elseif (strpos($sp3b58b9, 'socks5://')) { $sp3b58b9 = str_replace('socks5://', $sp3b58b9, $sp3b58b9); $sp70bf4e = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp0c7650, CURLOPT_PROXY, $sp3b58b9); curl_setopt($sp0c7650, CURLOPT_PROXYTYPE, $sp70bf4e); if (defined('MY_PROXY_PASS')) { curl_setopt($sp0c7650, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($sp0c7650, CURLOPT_TIMEOUT, $spccdca6); curl_setopt($sp0c7650, CURLOPT_CONNECTTIMEOUT, $spccdca6); curl_setopt($sp0c7650, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp0c7650, CURLOPT_HEADER, 1); curl_setopt($sp0c7650, CURLOPT_HTTPHEADER, $sp59a117); $spca52a4 = curl_exec($sp0c7650); if (curl_errno($sp0c7650)) { $spbb923d = curl_error($sp0c7650); curl_close($sp0c7650); return null; } $sp143f15 = curl_getinfo($sp0c7650, CURLINFO_HEADER_SIZE); if ($spe9590d) { $spe9590d = curl_getinfo($sp0c7650, CURLINFO_HTTP_CODE); } $spb81793 = substr($spca52a4, 0, $sp143f15); $sp76b6a3 = substr($spca52a4, $sp143f15); curl_close($sp0c7650); if ($sp35923d !== false) { $spdc767d = explode('
', $spb81793); $sp53e765 = ''; foreach ($spdc767d as $spb81793) { if (strtolower(substr($spb81793, 0, 11)) === 'set-cookie:') { $spb81793 = 'Set-Cookie:' . substr($spb81793, 11); if (strpos($spb81793, 'Set-Cookie') !== false) { if (strpos($spb81793, ';') !== false) { $sp53e765 = $sp53e765 . trim(Helper::str_between($spb81793, 'Set-Cookie:', ';')) . ';'; } else { $sp53e765 = $sp53e765 . trim(str_replace('Set-Cookie:', '', $spb81793)) . ';'; } } } } $sp35923d = self::combineCookie($sp35923d, $sp53e765); } return $sp76b6a3; } public static function get($sp81d92a, $spdc767d = array(), $spccdca6 = 5, &$sp35923d = false) { return self::curl($sp81d92a, 0, '', $spdc767d, $spccdca6, $sp35923d); } public static function post($sp81d92a, $spb302fe = '', $spdc767d = array(), $spccdca6 = 5, &$sp35923d = false) { return self::curl($sp81d92a, 1, $spb302fe, $spdc767d, $spccdca6, $sp35923d); } public static function download($sp81d92a, $spf228e5, $sp7f6363 = false) { $sp92b245 = fopen($spf228e5, 'w+'); if (!$sp92b245) { throw new \Exception('cant open file: ' . $spf228e5); } $sp0c7650 = curl_init(); curl_setopt($sp0c7650, CURLOPT_URL, $sp81d92a); curl_setopt($sp0c7650, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp0c7650, CURLOPT_RETURNTRANSFER, true); curl_setopt($sp0c7650, CURLOPT_FILE, $sp92b245); if ($sp7f6363) { curl_setopt($sp0c7650, CURLOPT_PROGRESSFUNCTION, function ($sp1c5a18, $sp4a7a56, $sp4d82bf, $spce1c53, $sp799694) { if ($sp4a7a56 > 0) { echo '    download: ' . sprintf('%.2f', $sp4d82bf / $sp4a7a56 * 100) . '%'; } }); curl_setopt($sp0c7650, CURLOPT_NOPROGRESS, false); } curl_setopt($sp0c7650, CURLOPT_HEADER, 0); curl_setopt($sp0c7650, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'); if (defined('MY_PROXY')) { $sp3b58b9 = MY_PROXY; $sp70bf4e = CURLPROXY_HTTP; if (strpos($sp3b58b9, 'http://') || strpos($sp3b58b9, 'https://')) { $sp3b58b9 = str_replace('http://', $sp3b58b9, $sp3b58b9); $sp3b58b9 = str_replace('https://', $sp3b58b9, $sp3b58b9); $sp70bf4e = CURLPROXY_HTTP; } elseif (strpos($sp3b58b9, 'socks4://')) { $sp3b58b9 = str_replace('socks4://', $sp3b58b9, $sp3b58b9); $sp70bf4e = CURLPROXY_SOCKS4; } elseif (strpos($sp3b58b9, 'socks4a://')) { $sp3b58b9 = str_replace('socks4a://', $sp3b58b9, $sp3b58b9); $sp70bf4e = CURLPROXY_SOCKS4A; } elseif (strpos($sp3b58b9, 'socks5://')) { $sp3b58b9 = str_replace('socks5://', $sp3b58b9, $sp3b58b9); $sp70bf4e = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp0c7650, CURLOPT_PROXY, $sp3b58b9); curl_setopt($sp0c7650, CURLOPT_PROXYTYPE, $sp70bf4e); if (defined('MY_PROXY_PASS')) { curl_setopt($sp0c7650, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_exec($sp0c7650); if (curl_errno($sp0c7650)) { curl_close($sp0c7650); throw new \Exception('curl_error: ' . curl_error($sp0c7650)); } curl_close($sp0c7650); return true; } public static function combineCookie($spb2c74b, $sp34c67b) { $sp1175b8 = explode(';', $spb2c74b); $sp686482 = explode(';', $sp34c67b); foreach ($sp1175b8 as $spd69191) { if (self::cookieIsExists($sp686482, self::cookieGetName($spd69191)) == false) { array_push($sp686482, $spd69191); } } $spe032f2 = ''; foreach ($sp686482 as $spd69191) { if (substr($spd69191, -8, 8) != '=deleted' && strlen($spd69191) > 1) { $spe032f2 .= $spd69191 . '; '; } } return substr($spe032f2, 0, strlen($spe032f2) - 1); } public static function cookieGetName($spa5c0ef) { $sp6f5168 = strpos($spa5c0ef, '='); return substr($spa5c0ef, 0, $sp6f5168); } public static function cookieGetValue($spa5c0ef) { $sp6f5168 = strpos($spa5c0ef, '='); $spea9ebf = substr($spa5c0ef, $sp6f5168 + 1, strlen($spa5c0ef) - $sp6f5168); return $spea9ebf; } public static function cookieGet($sp35923d, $spbc4c78, $sp57ae00 = false) { $sp35923d = str_replace(' ', '', $sp35923d); if (substr($sp35923d, -1, 1) != ';') { $sp35923d = ';' . $sp35923d . ';'; } else { $sp35923d = ';' . $sp35923d; } $sp34c9e5 = Helper::str_between($sp35923d, ';' . $spbc4c78 . '=', ';'); if (!$sp57ae00 || $sp34c9e5 == '') { return $sp34c9e5; } else { return $spbc4c78 . '=' . $sp34c9e5; } } private static function cookieIsExists($sp02a2b4, $sp538f48) { foreach ($sp02a2b4 as $spd69191) { if (self::cookieGetName($spd69191) == $sp538f48) { return true; } } return false; } function test() { $spea9ebf = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($spea9ebf); } }