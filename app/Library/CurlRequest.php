<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($spdef5e4, $spd40db6 = 0, $spbbcc3b = '', $sp5ab84b = array(), $sp2a9805 = 5, &$spcf0e4b = false) { if (!isset($sp5ab84b['Accept'])) { $sp5ab84b['Accept'] = '*/*'; } if (!isset($sp5ab84b['Referer'])) { $sp5ab84b['Referer'] = $spdef5e4; } if (!isset($sp5ab84b['Content-Type'])) { $sp5ab84b['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp5ab84b['User-Agent'])) { $sp5ab84b['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($spcf0e4b !== false) { $sp5ab84b['Cookie'] = $spcf0e4b; } $sp12397c = array(); foreach ($sp5ab84b as $spb52645 => $sp66bad4) { $sp12397c[] = $spb52645 . ': ' . $sp66bad4; } $sp12397c[] = 'Expect:'; $spa2bd24 = curl_init(); curl_setopt($spa2bd24, CURLOPT_URL, $spdef5e4); curl_setopt($spa2bd24, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($spa2bd24, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($spa2bd24, CURLOPT_FOLLOWLOCATION, true); curl_setopt($spa2bd24, CURLOPT_MAXREDIRS, 3); if ($spd40db6 == 1) { curl_setopt($spa2bd24, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($spa2bd24, CURLOPT_POST, 1); if ($spbbcc3b !== '') { curl_setopt($spa2bd24, CURLOPT_POSTFIELDS, $spbbcc3b); curl_setopt($spa2bd24, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $sp6a28b9 = MY_PROXY; $sp3df9cf = CURLPROXY_HTTP; if (strpos($sp6a28b9, 'http://') || strpos($sp6a28b9, 'https://')) { $sp6a28b9 = str_replace('http://', $sp6a28b9, $sp6a28b9); $sp6a28b9 = str_replace('https://', $sp6a28b9, $sp6a28b9); $sp3df9cf = CURLPROXY_HTTP; } elseif (strpos($sp6a28b9, 'socks4://')) { $sp6a28b9 = str_replace('socks4://', $sp6a28b9, $sp6a28b9); $sp3df9cf = CURLPROXY_SOCKS4; } elseif (strpos($sp6a28b9, 'socks4a://')) { $sp6a28b9 = str_replace('socks4a://', $sp6a28b9, $sp6a28b9); $sp3df9cf = CURLPROXY_SOCKS4A; } elseif (strpos($sp6a28b9, 'socks5://')) { $sp6a28b9 = str_replace('socks5://', $sp6a28b9, $sp6a28b9); $sp3df9cf = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($spa2bd24, CURLOPT_PROXY, $sp6a28b9); curl_setopt($spa2bd24, CURLOPT_PROXYTYPE, $sp3df9cf); if (defined('MY_PROXY_PASS')) { curl_setopt($spa2bd24, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($spa2bd24, CURLOPT_TIMEOUT, $sp2a9805); curl_setopt($spa2bd24, CURLOPT_CONNECTTIMEOUT, $sp2a9805); curl_setopt($spa2bd24, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spa2bd24, CURLOPT_HEADER, 1); curl_setopt($spa2bd24, CURLOPT_HTTPHEADER, $sp12397c); $sp15108c = curl_exec($spa2bd24); $sp1c6c48 = curl_getinfo($spa2bd24, CURLINFO_HEADER_SIZE); $spfea060 = substr($sp15108c, 0, $sp1c6c48); $spab542e = substr($sp15108c, $sp1c6c48); curl_close($spa2bd24); if ($spcf0e4b !== false) { $sp5ab84b = explode('
', $spfea060); $spd21c4c = ''; foreach ($sp5ab84b as $spfea060) { if (strpos($spfea060, 'Set-Cookie') !== false) { if (strpos($spfea060, ';') !== false) { $spd21c4c = $spd21c4c . trim(Helper::str_between($spfea060, 'Set-Cookie:', ';')) . ';'; } else { $spd21c4c = $spd21c4c . trim(str_replace('Set-Cookie:', '', $spfea060)) . ';'; } } } $spcf0e4b = self::combineCookie($spcf0e4b, $spd21c4c); } return $spab542e; } public static function get($spdef5e4, $sp5ab84b = array(), $sp2a9805 = 5, &$spcf0e4b = false) { return self::curl($spdef5e4, 0, '', $sp5ab84b, $sp2a9805, $spcf0e4b); } public static function post($spdef5e4, $spbbcc3b = '', $sp5ab84b = array(), $sp2a9805 = 5, &$spcf0e4b = false) { return self::curl($spdef5e4, 1, $spbbcc3b, $sp5ab84b, $sp2a9805, $spcf0e4b); } public static function combineCookie($sp65bd71, $spa2f43c) { $sp3cf9b8 = explode(';', $sp65bd71); $sp7e6e34 = explode(';', $spa2f43c); foreach ($sp3cf9b8 as $spd4333d) { if (self::cookieIsExists($sp7e6e34, self::cookieGetName($spd4333d)) == false) { array_push($sp7e6e34, $spd4333d); } } $spfade7b = ''; foreach ($sp7e6e34 as $spd4333d) { if (substr($spd4333d, -8, 8) != '=deleted' && strlen($spd4333d) > 1) { $spfade7b .= $spd4333d . '; '; } } return substr($spfade7b, 0, strlen($spfade7b) - 2); } public static function cookieGetName($spa292e2) { $sp0ea183 = strpos($spa292e2, '='); return substr($spa292e2, 0, $sp0ea183); } public static function cookieGetValue($spa292e2) { $sp0ea183 = strpos($spa292e2, '='); $sp626217 = substr($spa292e2, $sp0ea183 + 1, strlen($spa292e2) - $sp0ea183); return $sp626217; } public static function cookieGet($spcf0e4b, $sp4c25fd, $spc7b358 = false) { $spcf0e4b = str_replace(' ', '', $spcf0e4b); if (substr($spcf0e4b, -1, 1) != ';') { $spcf0e4b = ';' . $spcf0e4b . ';'; } else { $spcf0e4b = ';' . $spcf0e4b; } $spebd96b = Helper::str_between($spcf0e4b, ';' . $sp4c25fd . '=', ';'); if (!$spc7b358 || $spebd96b == '') { return $spebd96b; } else { return $sp4c25fd . '=' . $spebd96b; } } private static function cookieIsExists($spe89460, $sp374e94) { foreach ($spe89460 as $spd4333d) { if (self::cookieGetName($spd4333d) == $sp374e94) { return true; } } return false; } function test() { $sp626217 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp626217); } }