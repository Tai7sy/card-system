<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { public static function curl($sp4daeba, $sp1e147b = 0, $sp7f6871 = '', $sp09e2ff = array(), $sp8d576c = 5, &$speb6e62 = false, &$sp691125 = false, &$spfcf99e = false) { if (!isset($sp09e2ff['Accept']) && !isset($sp09e2ff['accept'])) { $sp09e2ff['Accept'] = '*/*'; } if (!isset($sp09e2ff['Referer']) && !isset($sp09e2ff['referer'])) { $sp09e2ff['Referer'] = $sp4daeba; } if (!isset($sp09e2ff['Content-Type']) && !isset($sp09e2ff['content-type'])) { $sp09e2ff['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp09e2ff['User-Agent']) && !isset($sp09e2ff['user-agent'])) { $sp09e2ff['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($speb6e62 !== false) { $sp09e2ff['Cookie'] = $speb6e62; } $spe1a452 = array(); foreach ($sp09e2ff as $sp8380e6 => $sp0e39ba) { $spe1a452[] = $sp8380e6 . ': ' . $sp0e39ba; } $spe1a452[] = 'Expect:'; $spf40adf = curl_init(); curl_setopt($spf40adf, CURLOPT_URL, $sp4daeba); curl_setopt($spf40adf, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($spf40adf, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($spf40adf, CURLOPT_FOLLOWLOCATION, true); curl_setopt($spf40adf, CURLOPT_MAXREDIRS, 3); if ($sp1e147b == 1) { curl_setopt($spf40adf, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($spf40adf, CURLOPT_POST, 1); if ($sp7f6871 !== '') { curl_setopt($spf40adf, CURLOPT_POSTFIELDS, $sp7f6871); curl_setopt($spf40adf, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $sp051aab = MY_PROXY; $sp53ccc5 = CURLPROXY_HTTP; if (strpos($sp051aab, 'http://') || strpos($sp051aab, 'https://')) { $sp051aab = str_replace('http://', $sp051aab, $sp051aab); $sp051aab = str_replace('https://', $sp051aab, $sp051aab); $sp53ccc5 = CURLPROXY_HTTP; } elseif (strpos($sp051aab, 'socks4://')) { $sp051aab = str_replace('socks4://', $sp051aab, $sp051aab); $sp53ccc5 = CURLPROXY_SOCKS4; } elseif (strpos($sp051aab, 'socks4a://')) { $sp051aab = str_replace('socks4a://', $sp051aab, $sp051aab); $sp53ccc5 = CURLPROXY_SOCKS4A; } elseif (strpos($sp051aab, 'socks5://')) { $sp051aab = str_replace('socks5://', $sp051aab, $sp051aab); $sp53ccc5 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($spf40adf, CURLOPT_PROXY, $sp051aab); curl_setopt($spf40adf, CURLOPT_PROXYTYPE, $sp53ccc5); if (defined('MY_PROXY_PASS')) { curl_setopt($spf40adf, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($spf40adf, CURLOPT_TIMEOUT, $sp8d576c); curl_setopt($spf40adf, CURLOPT_CONNECTTIMEOUT, $sp8d576c); curl_setopt($spf40adf, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spf40adf, CURLOPT_HEADER, 1); curl_setopt($spf40adf, CURLOPT_HTTPHEADER, $spe1a452); $sp15bacb = curl_exec($spf40adf); if (curl_errno($spf40adf)) { $spfcf99e = curl_error($spf40adf); curl_close($spf40adf); return null; } $sp8b4236 = curl_getinfo($spf40adf, CURLINFO_HEADER_SIZE); if ($sp691125) { $sp691125 = curl_getinfo($spf40adf, CURLINFO_HTTP_CODE); } $sp4d52b9 = substr($sp15bacb, 0, $sp8b4236); $spe9f79f = substr($sp15bacb, $sp8b4236); curl_close($spf40adf); if ($speb6e62 !== false) { $sp09e2ff = explode('
', $sp4d52b9); $sp33aace = ''; foreach ($sp09e2ff as $sp4d52b9) { if (strtolower(substr($sp4d52b9, 0, 11)) === 'set-cookie:') { $sp4d52b9 = 'Set-Cookie:' . substr($sp4d52b9, 11); if (strpos($sp4d52b9, 'Set-Cookie') !== false) { if (strpos($sp4d52b9, ';') !== false) { $sp33aace = $sp33aace . trim(Helper::str_between($sp4d52b9, 'Set-Cookie:', ';')) . ';'; } else { $sp33aace = $sp33aace . trim(str_replace('Set-Cookie:', '', $sp4d52b9)) . ';'; } } } } $speb6e62 = self::combineCookie($speb6e62, $sp33aace); } return $spe9f79f; } public static function get($sp4daeba, $sp09e2ff = array(), $sp8d576c = 5, &$speb6e62 = false) { return self::curl($sp4daeba, 0, '', $sp09e2ff, $sp8d576c, $speb6e62); } public static function post($sp4daeba, $sp7f6871 = '', $sp09e2ff = array(), $sp8d576c = 5, &$speb6e62 = false) { return self::curl($sp4daeba, 1, $sp7f6871, $sp09e2ff, $sp8d576c, $speb6e62); } public static function download($sp4daeba, $sp5c665d, $spba87bb = false) { $sp154d16 = fopen($sp5c665d, 'w+'); if (!$sp154d16) { throw new \Exception('cant open file: ' . $sp5c665d); } $spf40adf = curl_init(); curl_setopt($spf40adf, CURLOPT_URL, $sp4daeba); curl_setopt($spf40adf, CURLOPT_FOLLOWLOCATION, true); curl_setopt($spf40adf, CURLOPT_RETURNTRANSFER, true); curl_setopt($spf40adf, CURLOPT_FILE, $sp154d16); if ($spba87bb) { curl_setopt($spf40adf, CURLOPT_PROGRESSFUNCTION, function ($spf2cde7, $sp84a044, $spd6e0dc, $sp1fd3cc, $spbae680) { if ($sp84a044 > 0) { echo '    download: ' . sprintf('%.2f', $spd6e0dc / $sp84a044 * 100) . '%'; } }); curl_setopt($spf40adf, CURLOPT_NOPROGRESS, false); } curl_setopt($spf40adf, CURLOPT_HEADER, 0); curl_setopt($spf40adf, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'); if (defined('MY_PROXY')) { $sp051aab = MY_PROXY; $sp53ccc5 = CURLPROXY_HTTP; if (strpos($sp051aab, 'http://') || strpos($sp051aab, 'https://')) { $sp051aab = str_replace('http://', $sp051aab, $sp051aab); $sp051aab = str_replace('https://', $sp051aab, $sp051aab); $sp53ccc5 = CURLPROXY_HTTP; } elseif (strpos($sp051aab, 'socks4://')) { $sp051aab = str_replace('socks4://', $sp051aab, $sp051aab); $sp53ccc5 = CURLPROXY_SOCKS4; } elseif (strpos($sp051aab, 'socks4a://')) { $sp051aab = str_replace('socks4a://', $sp051aab, $sp051aab); $sp53ccc5 = CURLPROXY_SOCKS4A; } elseif (strpos($sp051aab, 'socks5://')) { $sp051aab = str_replace('socks5://', $sp051aab, $sp051aab); $sp53ccc5 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($spf40adf, CURLOPT_PROXY, $sp051aab); curl_setopt($spf40adf, CURLOPT_PROXYTYPE, $sp53ccc5); if (defined('MY_PROXY_PASS')) { curl_setopt($spf40adf, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_exec($spf40adf); if (curl_errno($spf40adf)) { curl_close($spf40adf); throw new \Exception('curl_error: ' . curl_error($spf40adf)); } curl_close($spf40adf); return true; } public static function combineCookie($spfd84fd, $sp1061f3) { $sp2747b5 = explode(';', $spfd84fd); $sp1bfb63 = explode(';', $sp1061f3); foreach ($sp2747b5 as $spf7ce81) { if (self::cookieIsExists($sp1bfb63, self::cookieGetName($spf7ce81)) == false) { array_push($sp1bfb63, $spf7ce81); } } $spa25821 = ''; foreach ($sp1bfb63 as $spf7ce81) { if (substr($spf7ce81, -8, 8) != '=deleted' && strlen($spf7ce81) > 1) { $spa25821 .= $spf7ce81 . '; '; } } return substr($spa25821, 0, strlen($spa25821) - 1); } public static function cookieGetName($spfc5ae2) { $sp367bd2 = strpos($spfc5ae2, '='); return substr($spfc5ae2, 0, $sp367bd2); } public static function cookieGetValue($spfc5ae2) { $sp367bd2 = strpos($spfc5ae2, '='); $spc4ebb1 = substr($spfc5ae2, $sp367bd2 + 1, strlen($spfc5ae2) - $sp367bd2); return $spc4ebb1; } public static function cookieGet($speb6e62, $spd7c47a, $sp4a2927 = false) { $speb6e62 = str_replace(' ', '', $speb6e62); if (substr($speb6e62, -1, 1) != ';') { $speb6e62 = ';' . $speb6e62 . ';'; } else { $speb6e62 = ';' . $speb6e62; } $spf1c33c = Helper::str_between($speb6e62, ';' . $spd7c47a . '=', ';'); if (!$sp4a2927 || $spf1c33c == '') { return $spf1c33c; } else { return $spd7c47a . '=' . $spf1c33c; } } private static function cookieIsExists($sp208fd4, $sp9320b8) { foreach ($sp208fd4 as $spf7ce81) { if (self::cookieGetName($spf7ce81) == $sp9320b8) { return true; } } return false; } function test() { $spc4ebb1 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($spc4ebb1); } }