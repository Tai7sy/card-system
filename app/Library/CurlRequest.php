<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($spdcad38, $spdafea1 = 0, $sp083255 = '', $sp5f2049 = array(), $sp14ef99 = 5, &$sp2e6358 = false) { if (!isset($sp5f2049['Accept'])) { $sp5f2049['Accept'] = '*/*'; } if (!isset($sp5f2049['Referer'])) { $sp5f2049['Referer'] = $spdcad38; } if (!isset($sp5f2049['Content-Type'])) { $sp5f2049['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp5f2049['User-Agent'])) { $sp5f2049['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp2e6358 !== false) { $sp5f2049['Cookie'] = $sp2e6358; } $speee2e9 = array(); foreach ($sp5f2049 as $spf0fe24 => $sp85e8ba) { $speee2e9[] = $spf0fe24 . ': ' . $sp85e8ba; } $speee2e9[] = 'Expect:'; $spd5d7db = curl_init(); curl_setopt($spd5d7db, CURLOPT_URL, $spdcad38); curl_setopt($spd5d7db, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($spd5d7db, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($spd5d7db, CURLOPT_FOLLOWLOCATION, true); curl_setopt($spd5d7db, CURLOPT_MAXREDIRS, 3); if ($spdafea1 == 1) { curl_setopt($spd5d7db, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($spd5d7db, CURLOPT_POST, 1); if ($sp083255 !== '') { curl_setopt($spd5d7db, CURLOPT_POSTFIELDS, $sp083255); curl_setopt($spd5d7db, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $sp2a70f1 = MY_PROXY; $sp75ba11 = CURLPROXY_HTTP; if (strpos($sp2a70f1, 'http://') || strpos($sp2a70f1, 'https://')) { $sp2a70f1 = str_replace('http://', $sp2a70f1, $sp2a70f1); $sp2a70f1 = str_replace('https://', $sp2a70f1, $sp2a70f1); $sp75ba11 = CURLPROXY_HTTP; } elseif (strpos($sp2a70f1, 'socks4://')) { $sp2a70f1 = str_replace('socks4://', $sp2a70f1, $sp2a70f1); $sp75ba11 = CURLPROXY_SOCKS4; } elseif (strpos($sp2a70f1, 'socks4a://')) { $sp2a70f1 = str_replace('socks4a://', $sp2a70f1, $sp2a70f1); $sp75ba11 = CURLPROXY_SOCKS4A; } elseif (strpos($sp2a70f1, 'socks5://')) { $sp2a70f1 = str_replace('socks5://', $sp2a70f1, $sp2a70f1); $sp75ba11 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($spd5d7db, CURLOPT_PROXY, $sp2a70f1); curl_setopt($spd5d7db, CURLOPT_PROXYTYPE, $sp75ba11); if (defined('MY_PROXY_PASS')) { curl_setopt($spd5d7db, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($spd5d7db, CURLOPT_TIMEOUT, $sp14ef99); curl_setopt($spd5d7db, CURLOPT_CONNECTTIMEOUT, $sp14ef99); curl_setopt($spd5d7db, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spd5d7db, CURLOPT_HEADER, 1); curl_setopt($spd5d7db, CURLOPT_HTTPHEADER, $speee2e9); $spae7658 = curl_exec($spd5d7db); $spddd620 = curl_getinfo($spd5d7db, CURLINFO_HEADER_SIZE); $spaf87fd = substr($spae7658, 0, $spddd620); $sp9eda62 = substr($spae7658, $spddd620); curl_close($spd5d7db); if ($sp2e6358 !== false) { $sp5f2049 = explode('
', $spaf87fd); $sp84894c = ''; foreach ($sp5f2049 as $spaf87fd) { if (strpos($spaf87fd, 'Set-Cookie') !== false) { if (strpos($spaf87fd, ';') !== false) { $sp84894c = $sp84894c . trim(Helper::str_between($spaf87fd, 'Set-Cookie:', ';')) . ';'; } else { $sp84894c = $sp84894c . trim(str_replace('Set-Cookie:', '', $spaf87fd)) . ';'; } } } $sp2e6358 = self::combineCookie($sp2e6358, $sp84894c); } return $sp9eda62; } public static function get($spdcad38, $sp5f2049 = array(), $sp14ef99 = 5, &$sp2e6358 = false) { return self::curl($spdcad38, 0, '', $sp5f2049, $sp14ef99, $sp2e6358); } public static function post($spdcad38, $sp083255 = '', $sp5f2049 = array(), $sp14ef99 = 5, &$sp2e6358 = false) { return self::curl($spdcad38, 1, $sp083255, $sp5f2049, $sp14ef99, $sp2e6358); } public static function combineCookie($spd7d686, $spe58988) { $sp19811c = explode(';', $spd7d686); $sp5fab90 = explode(';', $spe58988); foreach ($sp19811c as $sp803a97) { if (self::cookieIsExists($sp5fab90, self::cookieGetName($sp803a97)) == false) { array_push($sp5fab90, $sp803a97); } } $sp2c6502 = ''; foreach ($sp5fab90 as $sp803a97) { if (substr($sp803a97, -8, 8) != '=deleted' && strlen($sp803a97) > 1) { $sp2c6502 .= $sp803a97 . '; '; } } return substr($sp2c6502, 0, strlen($sp2c6502) - 2); } public static function cookieGetName($spb9760e) { $spc457d4 = strpos($spb9760e, '='); return substr($spb9760e, 0, $spc457d4); } public static function cookieGetValue($spb9760e) { $spc457d4 = strpos($spb9760e, '='); $sp9912c8 = substr($spb9760e, $spc457d4 + 1, strlen($spb9760e) - $spc457d4); return $sp9912c8; } public static function cookieGet($sp2e6358, $spf4db88, $spa00460 = false) { $sp2e6358 = str_replace(' ', '', $sp2e6358); if (substr($sp2e6358, -1, 1) != ';') { $sp2e6358 = ';' . $sp2e6358 . ';'; } else { $sp2e6358 = ';' . $sp2e6358; } $spd76521 = Helper::str_between($sp2e6358, ';' . $spf4db88 . '=', ';'); if (!$spa00460 || $spd76521 == '') { return $spd76521; } else { return $spf4db88 . '=' . $spd76521; } } private static function cookieIsExists($spd63131, $spafafb6) { foreach ($spd63131 as $sp803a97) { if (self::cookieGetName($sp803a97) == $spafafb6) { return true; } } return false; } function test() { $sp9912c8 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp9912c8); } }