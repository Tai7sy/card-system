<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($sp40b98a, $sp2219e5 = 0, $spdd30d2 = '', $spa565dd = array(), $spe83a5d = 5, &$sp4bbe0a = false) { if (!isset($spa565dd['Accept'])) { $spa565dd['Accept'] = '*/*'; } if (!isset($spa565dd['Referer'])) { $spa565dd['Referer'] = $sp40b98a; } if (!isset($spa565dd['Content-Type'])) { $spa565dd['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($spa565dd['User-Agent'])) { $spa565dd['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp4bbe0a !== false) { $spa565dd['Cookie'] = $sp4bbe0a; } $spa37e42 = array(); foreach ($spa565dd as $spd8e776 => $spbc0c98) { $spa37e42[] = $spd8e776 . ': ' . $spbc0c98; } $spa37e42[] = 'Expect:'; $sp1942b5 = curl_init(); curl_setopt($sp1942b5, CURLOPT_URL, $sp40b98a); curl_setopt($sp1942b5, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($sp1942b5, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($sp1942b5, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp1942b5, CURLOPT_MAXREDIRS, 3); if ($sp2219e5 == 1) { curl_setopt($sp1942b5, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($sp1942b5, CURLOPT_POST, 1); if ($spdd30d2 !== '') { curl_setopt($sp1942b5, CURLOPT_POSTFIELDS, $spdd30d2); curl_setopt($sp1942b5, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $sp34031d = MY_PROXY; $sp9e3584 = CURLPROXY_HTTP; if (strpos($sp34031d, 'http://') || strpos($sp34031d, 'https://')) { $sp34031d = str_replace('http://', $sp34031d, $sp34031d); $sp34031d = str_replace('https://', $sp34031d, $sp34031d); $sp9e3584 = CURLPROXY_HTTP; } elseif (strpos($sp34031d, 'socks4://')) { $sp34031d = str_replace('socks4://', $sp34031d, $sp34031d); $sp9e3584 = CURLPROXY_SOCKS4; } elseif (strpos($sp34031d, 'socks4a://')) { $sp34031d = str_replace('socks4a://', $sp34031d, $sp34031d); $sp9e3584 = CURLPROXY_SOCKS4A; } elseif (strpos($sp34031d, 'socks5://')) { $sp34031d = str_replace('socks5://', $sp34031d, $sp34031d); $sp9e3584 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp1942b5, CURLOPT_PROXY, $sp34031d); curl_setopt($sp1942b5, CURLOPT_PROXYTYPE, $sp9e3584); if (defined('MY_PROXY_PASS')) { curl_setopt($sp1942b5, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($sp1942b5, CURLOPT_TIMEOUT, $spe83a5d); curl_setopt($sp1942b5, CURLOPT_CONNECTTIMEOUT, $spe83a5d); curl_setopt($sp1942b5, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp1942b5, CURLOPT_HEADER, 1); curl_setopt($sp1942b5, CURLOPT_HTTPHEADER, $spa37e42); $sp9d3345 = curl_exec($sp1942b5); $spf16b26 = curl_getinfo($sp1942b5, CURLINFO_HEADER_SIZE); $sp32acab = substr($sp9d3345, 0, $spf16b26); $sp219d02 = substr($sp9d3345, $spf16b26); curl_close($sp1942b5); if ($sp4bbe0a !== false) { $spa565dd = explode('
', $sp32acab); $sp7b008c = ''; foreach ($spa565dd as $sp32acab) { if (strpos($sp32acab, 'Set-Cookie') !== false) { if (strpos($sp32acab, ';') !== false) { $sp7b008c = $sp7b008c . trim(Helper::str_between($sp32acab, 'Set-Cookie:', ';')) . ';'; } else { $sp7b008c = $sp7b008c . trim(str_replace('Set-Cookie:', '', $sp32acab)) . ';'; } } } $sp4bbe0a = self::combineCookie($sp4bbe0a, $sp7b008c); } return $sp219d02; } public static function get($sp40b98a, $spa565dd = array(), $spe83a5d = 5, &$sp4bbe0a = false) { return self::curl($sp40b98a, 0, '', $spa565dd, $spe83a5d, $sp4bbe0a); } public static function post($sp40b98a, $spdd30d2 = '', $spa565dd = array(), $spe83a5d = 5, &$sp4bbe0a = false) { return self::curl($sp40b98a, 1, $spdd30d2, $spa565dd, $spe83a5d, $sp4bbe0a); } public static function combineCookie($sp265a87, $sp636f3a) { $spebbd4e = explode(';', $sp265a87); $spc6a5ca = explode(';', $sp636f3a); foreach ($spebbd4e as $spec7d6d) { if (self::cookieIsExists($spc6a5ca, self::cookieGetName($spec7d6d)) == false) { array_push($spc6a5ca, $spec7d6d); } } $spefbb2a = ''; foreach ($spc6a5ca as $spec7d6d) { if (substr($spec7d6d, -8, 8) != '=deleted' && strlen($spec7d6d) > 1) { $spefbb2a .= $spec7d6d . '; '; } } return substr($spefbb2a, 0, strlen($spefbb2a) - 2); } public static function cookieGetName($spd2350f) { $spcbea9e = strpos($spd2350f, '='); return substr($spd2350f, 0, $spcbea9e); } public static function cookieGetValue($spd2350f) { $spcbea9e = strpos($spd2350f, '='); $sp0f5db4 = substr($spd2350f, $spcbea9e + 1, strlen($spd2350f) - $spcbea9e); return $sp0f5db4; } public static function cookieGet($sp4bbe0a, $sp6b4dc2, $sp7234c0 = false) { $sp4bbe0a = str_replace(' ', '', $sp4bbe0a); if (substr($sp4bbe0a, -1, 1) != ';') { $sp4bbe0a = ';' . $sp4bbe0a . ';'; } else { $sp4bbe0a = ';' . $sp4bbe0a; } $sp800386 = Helper::str_between($sp4bbe0a, ';' . $sp6b4dc2 . '=', ';'); if (!$sp7234c0 || $sp800386 == '') { return $sp800386; } else { return $sp6b4dc2 . '=' . $sp800386; } } private static function cookieIsExists($sp9db6f3, $sp1d1a8b) { foreach ($sp9db6f3 as $spec7d6d) { if (self::cookieGetName($spec7d6d) == $sp1d1a8b) { return true; } } return false; } function test() { $sp0f5db4 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp0f5db4); } }