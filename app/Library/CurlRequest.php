<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($spc2ee22, $sp1d517d = 0, $spfb819a = '', $sp9e3fb1 = array(), $sp69a8ae = 5, &$spb60ca2 = false) { if (!isset($sp9e3fb1['Accept'])) { $sp9e3fb1['Accept'] = '*/*'; } if (!isset($sp9e3fb1['Referer'])) { $sp9e3fb1['Referer'] = $spc2ee22; } if (!isset($sp9e3fb1['Content-Type'])) { $sp9e3fb1['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp9e3fb1['User-Agent'])) { $sp9e3fb1['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($spb60ca2 !== false) { $sp9e3fb1['Cookie'] = $spb60ca2; } $sp3f070b = array(); foreach ($sp9e3fb1 as $sp22a48e => $spa93a2c) { $sp3f070b[] = $sp22a48e . ': ' . $spa93a2c; } $sp3f070b[] = 'Expect:'; $spc2dc02 = curl_init(); curl_setopt($spc2dc02, CURLOPT_URL, $spc2ee22); curl_setopt($spc2dc02, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($spc2dc02, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($spc2dc02, CURLOPT_FOLLOWLOCATION, true); curl_setopt($spc2dc02, CURLOPT_MAXREDIRS, 3); if ($sp1d517d == 1) { curl_setopt($spc2dc02, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($spc2dc02, CURLOPT_POST, 1); if ($spfb819a !== '') { curl_setopt($spc2dc02, CURLOPT_POSTFIELDS, $spfb819a); curl_setopt($spc2dc02, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $spc1178c = MY_PROXY; $sp476a35 = CURLPROXY_HTTP; if (strpos($spc1178c, 'http://') || strpos($spc1178c, 'https://')) { $spc1178c = str_replace('http://', $spc1178c, $spc1178c); $spc1178c = str_replace('https://', $spc1178c, $spc1178c); $sp476a35 = CURLPROXY_HTTP; } elseif (strpos($spc1178c, 'socks4://')) { $spc1178c = str_replace('socks4://', $spc1178c, $spc1178c); $sp476a35 = CURLPROXY_SOCKS4; } elseif (strpos($spc1178c, 'socks4a://')) { $spc1178c = str_replace('socks4a://', $spc1178c, $spc1178c); $sp476a35 = CURLPROXY_SOCKS4A; } elseif (strpos($spc1178c, 'socks5://')) { $spc1178c = str_replace('socks5://', $spc1178c, $spc1178c); $sp476a35 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($spc2dc02, CURLOPT_PROXY, $spc1178c); curl_setopt($spc2dc02, CURLOPT_PROXYTYPE, $sp476a35); if (defined('MY_PROXY_PASS')) { curl_setopt($spc2dc02, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($spc2dc02, CURLOPT_TIMEOUT, $sp69a8ae); curl_setopt($spc2dc02, CURLOPT_CONNECTTIMEOUT, $sp69a8ae); curl_setopt($spc2dc02, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spc2dc02, CURLOPT_HEADER, 1); curl_setopt($spc2dc02, CURLOPT_HTTPHEADER, $sp3f070b); $sp858086 = curl_exec($spc2dc02); $spcd16d0 = curl_getinfo($spc2dc02, CURLINFO_HEADER_SIZE); $sp933db7 = substr($sp858086, 0, $spcd16d0); $sp58fb80 = substr($sp858086, $spcd16d0); curl_close($spc2dc02); if ($spb60ca2 !== false) { $sp9e3fb1 = explode('
', $sp933db7); $sp2d07c8 = ''; foreach ($sp9e3fb1 as $sp933db7) { if (strpos($sp933db7, 'Set-Cookie') !== false) { if (strpos($sp933db7, ';') !== false) { $sp2d07c8 = $sp2d07c8 . trim(Helper::str_between($sp933db7, 'Set-Cookie:', ';')) . ';'; } else { $sp2d07c8 = $sp2d07c8 . trim(str_replace('Set-Cookie:', '', $sp933db7)) . ';'; } } } $spb60ca2 = self::combineCookie($spb60ca2, $sp2d07c8); } return $sp58fb80; } public static function get($spc2ee22, $sp9e3fb1 = array(), $sp69a8ae = 5, &$spb60ca2 = false) { return self::curl($spc2ee22, 0, '', $sp9e3fb1, $sp69a8ae, $spb60ca2); } public static function post($spc2ee22, $spfb819a = '', $sp9e3fb1 = array(), $sp69a8ae = 5, &$spb60ca2 = false) { return self::curl($spc2ee22, 1, $spfb819a, $sp9e3fb1, $sp69a8ae, $spb60ca2); } public static function combineCookie($spa445a0, $sp2f52b1) { $sp18c620 = explode(';', $spa445a0); $sp6e5db6 = explode(';', $sp2f52b1); foreach ($sp18c620 as $sp67522f) { if (self::cookieIsExists($sp6e5db6, self::cookieGetName($sp67522f)) == false) { array_push($sp6e5db6, $sp67522f); } } $spbe87fc = ''; foreach ($sp6e5db6 as $sp67522f) { if (substr($sp67522f, -8, 8) != '=deleted' && strlen($sp67522f) > 1) { $spbe87fc .= $sp67522f . '; '; } } return substr($spbe87fc, 0, strlen($spbe87fc) - 2); } public static function cookieGetName($sp299854) { $sp78c283 = strpos($sp299854, '='); return substr($sp299854, 0, $sp78c283); } public static function cookieGetValue($sp299854) { $sp78c283 = strpos($sp299854, '='); $sp52a643 = substr($sp299854, $sp78c283 + 1, strlen($sp299854) - $sp78c283); return $sp52a643; } public static function cookieGet($spb60ca2, $specbd57, $sp616b02 = false) { $spb60ca2 = str_replace(' ', '', $spb60ca2); if (substr($spb60ca2, -1, 1) != ';') { $spb60ca2 = ';' . $spb60ca2 . ';'; } else { $spb60ca2 = ';' . $spb60ca2; } $sp5f0409 = Helper::str_between($spb60ca2, ';' . $specbd57 . '=', ';'); if (!$sp616b02 || $sp5f0409 == '') { return $sp5f0409; } else { return $specbd57 . '=' . $sp5f0409; } } private static function cookieIsExists($sp986b93, $spc25fa2) { foreach ($sp986b93 as $sp67522f) { if (self::cookieGetName($sp67522f) == $spc25fa2) { return true; } } return false; } function test() { $sp52a643 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp52a643); } }