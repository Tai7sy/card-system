<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($sp556150, $sp930cec = 0, $spbd6dcb = '', $spd8c799 = array(), $sp40ff4b = 5, &$sp34cd44 = false) { if (!isset($spd8c799['Accept'])) { $spd8c799['Accept'] = '*/*'; } if (!isset($spd8c799['Referer'])) { $spd8c799['Referer'] = $sp556150; } if (!isset($spd8c799['Content-Type'])) { $spd8c799['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($spd8c799['User-Agent'])) { $spd8c799['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp34cd44 !== false) { $spd8c799['Cookie'] = $sp34cd44; } $sp13a25e = array(); foreach ($spd8c799 as $sp72e43c => $spfd514d) { $sp13a25e[] = $sp72e43c . ': ' . $spfd514d; } $sp13a25e[] = 'Expect:'; $sp89b559 = curl_init(); curl_setopt($sp89b559, CURLOPT_URL, $sp556150); curl_setopt($sp89b559, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($sp89b559, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($sp89b559, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp89b559, CURLOPT_MAXREDIRS, 3); if ($sp930cec == 1) { curl_setopt($sp89b559, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($sp89b559, CURLOPT_POST, 1); if ($spbd6dcb !== '') { curl_setopt($sp89b559, CURLOPT_POSTFIELDS, $spbd6dcb); curl_setopt($sp89b559, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $sp4cd3fc = MY_PROXY; $sp27c782 = CURLPROXY_HTTP; if (strpos($sp4cd3fc, 'http://') || strpos($sp4cd3fc, 'https://')) { $sp4cd3fc = str_replace('http://', $sp4cd3fc, $sp4cd3fc); $sp4cd3fc = str_replace('https://', $sp4cd3fc, $sp4cd3fc); $sp27c782 = CURLPROXY_HTTP; } elseif (strpos($sp4cd3fc, 'socks4://')) { $sp4cd3fc = str_replace('socks4://', $sp4cd3fc, $sp4cd3fc); $sp27c782 = CURLPROXY_SOCKS4; } elseif (strpos($sp4cd3fc, 'socks4a://')) { $sp4cd3fc = str_replace('socks4a://', $sp4cd3fc, $sp4cd3fc); $sp27c782 = CURLPROXY_SOCKS4A; } elseif (strpos($sp4cd3fc, 'socks5://')) { $sp4cd3fc = str_replace('socks5://', $sp4cd3fc, $sp4cd3fc); $sp27c782 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp89b559, CURLOPT_PROXY, $sp4cd3fc); curl_setopt($sp89b559, CURLOPT_PROXYTYPE, $sp27c782); if (defined('MY_PROXY_PASS')) { curl_setopt($sp89b559, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($sp89b559, CURLOPT_TIMEOUT, $sp40ff4b); curl_setopt($sp89b559, CURLOPT_CONNECTTIMEOUT, $sp40ff4b); curl_setopt($sp89b559, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp89b559, CURLOPT_HEADER, 1); curl_setopt($sp89b559, CURLOPT_HTTPHEADER, $sp13a25e); $sp014e61 = curl_exec($sp89b559); $sp55bc6c = curl_getinfo($sp89b559, CURLINFO_HEADER_SIZE); $sp5b017c = substr($sp014e61, 0, $sp55bc6c); $sp9f61ba = substr($sp014e61, $sp55bc6c); curl_close($sp89b559); if ($sp34cd44 !== false) { $spd8c799 = explode('
', $sp5b017c); $sp01e7c7 = ''; foreach ($spd8c799 as $sp5b017c) { if (strpos($sp5b017c, 'Set-Cookie') !== false) { if (strpos($sp5b017c, ';') !== false) { $sp01e7c7 = $sp01e7c7 . trim(Helper::str_between($sp5b017c, 'Set-Cookie:', ';')) . ';'; } else { $sp01e7c7 = $sp01e7c7 . trim(str_replace('Set-Cookie:', '', $sp5b017c)) . ';'; } } } $sp34cd44 = self::combineCookie($sp34cd44, $sp01e7c7); } return $sp9f61ba; } public static function get($sp556150, $spd8c799 = array(), $sp40ff4b = 5, &$sp34cd44 = false) { return self::curl($sp556150, 0, '', $spd8c799, $sp40ff4b, $sp34cd44); } public static function post($sp556150, $spbd6dcb = '', $spd8c799 = array(), $sp40ff4b = 5, &$sp34cd44 = false) { return self::curl($sp556150, 1, $spbd6dcb, $spd8c799, $sp40ff4b, $sp34cd44); } public static function combineCookie($sp4aa0c3, $spa31f46) { $spad2510 = explode(';', $sp4aa0c3); $sp44ddfd = explode(';', $spa31f46); foreach ($spad2510 as $sp40e39f) { if (self::cookieIsExists($sp44ddfd, self::cookieGetName($sp40e39f)) == false) { array_push($sp44ddfd, $sp40e39f); } } $sp2f0937 = ''; foreach ($sp44ddfd as $sp40e39f) { if (substr($sp40e39f, -8, 8) != '=deleted' && strlen($sp40e39f) > 1) { $sp2f0937 .= $sp40e39f . '; '; } } return substr($sp2f0937, 0, strlen($sp2f0937) - 2); } public static function cookieGetName($spfb06a1) { $sp2c79c2 = strpos($spfb06a1, '='); return substr($spfb06a1, 0, $sp2c79c2); } public static function cookieGetValue($spfb06a1) { $sp2c79c2 = strpos($spfb06a1, '='); $sp0514e5 = substr($spfb06a1, $sp2c79c2 + 1, strlen($spfb06a1) - $sp2c79c2); return $sp0514e5; } public static function cookieGet($sp34cd44, $sp1a236c, $speaa206 = false) { $sp34cd44 = str_replace(' ', '', $sp34cd44); if (substr($sp34cd44, -1, 1) != ';') { $sp34cd44 = ';' . $sp34cd44 . ';'; } else { $sp34cd44 = ';' . $sp34cd44; } $sp1dd111 = Helper::str_between($sp34cd44, ';' . $sp1a236c . '=', ';'); if (!$speaa206 || $sp1dd111 == '') { return $sp1dd111; } else { return $sp1a236c . '=' . $sp1dd111; } } private static function cookieIsExists($sp322ad7, $sp64ea66) { foreach ($sp322ad7 as $sp40e39f) { if (self::cookieGetName($sp40e39f) == $sp64ea66) { return true; } } return false; } function test() { $sp0514e5 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp0514e5); } }