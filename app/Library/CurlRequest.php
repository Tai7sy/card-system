<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { public static function curl($sp069c22, $spb8407e = 0, $sp0a769f = '', $sp5d00a4 = array(), $sp89060d = 5, &$sp264383 = false, &$sp322a14 = false, &$spd9676d = false) { if (!isset($sp5d00a4['Accept']) && !isset($sp5d00a4['accept'])) { $sp5d00a4['Accept'] = '*/*'; } if (!isset($sp5d00a4['Referer']) && !isset($sp5d00a4['referer'])) { $sp5d00a4['Referer'] = $sp069c22; } if (!isset($sp5d00a4['Content-Type']) && !isset($sp5d00a4['content-type'])) { $sp5d00a4['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp5d00a4['User-Agent']) && !isset($sp5d00a4['user-agent'])) { $sp5d00a4['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp264383 !== false) { $sp5d00a4['Cookie'] = $sp264383; } $spffdf86 = array(); foreach ($sp5d00a4 as $spc7c3bb => $sp73039a) { $spffdf86[] = $spc7c3bb . ': ' . $sp73039a; } $spffdf86[] = 'Expect:'; $sp2df40c = curl_init(); curl_setopt($sp2df40c, CURLOPT_URL, $sp069c22); curl_setopt($sp2df40c, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($sp2df40c, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($sp2df40c, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp2df40c, CURLOPT_MAXREDIRS, 3); if ($spb8407e == 1) { curl_setopt($sp2df40c, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($sp2df40c, CURLOPT_POST, 1); if ($sp0a769f !== '') { curl_setopt($sp2df40c, CURLOPT_POSTFIELDS, $sp0a769f); curl_setopt($sp2df40c, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $sp6f2ecf = MY_PROXY; $sp3c6cc7 = CURLPROXY_HTTP; if (strpos($sp6f2ecf, 'http://') || strpos($sp6f2ecf, 'https://')) { $sp6f2ecf = str_replace('http://', $sp6f2ecf, $sp6f2ecf); $sp6f2ecf = str_replace('https://', $sp6f2ecf, $sp6f2ecf); $sp3c6cc7 = CURLPROXY_HTTP; } elseif (strpos($sp6f2ecf, 'socks4://')) { $sp6f2ecf = str_replace('socks4://', $sp6f2ecf, $sp6f2ecf); $sp3c6cc7 = CURLPROXY_SOCKS4; } elseif (strpos($sp6f2ecf, 'socks4a://')) { $sp6f2ecf = str_replace('socks4a://', $sp6f2ecf, $sp6f2ecf); $sp3c6cc7 = CURLPROXY_SOCKS4A; } elseif (strpos($sp6f2ecf, 'socks5://')) { $sp6f2ecf = str_replace('socks5://', $sp6f2ecf, $sp6f2ecf); $sp3c6cc7 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp2df40c, CURLOPT_PROXY, $sp6f2ecf); curl_setopt($sp2df40c, CURLOPT_PROXYTYPE, $sp3c6cc7); if (defined('MY_PROXY_PASS')) { curl_setopt($sp2df40c, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($sp2df40c, CURLOPT_TIMEOUT, $sp89060d); curl_setopt($sp2df40c, CURLOPT_CONNECTTIMEOUT, $sp89060d); curl_setopt($sp2df40c, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp2df40c, CURLOPT_HEADER, 1); curl_setopt($sp2df40c, CURLOPT_HTTPHEADER, $spffdf86); $sp0223d2 = curl_exec($sp2df40c); if (curl_errno($sp2df40c)) { $spd9676d = curl_error($sp2df40c); curl_close($sp2df40c); return null; } $sp9700cb = curl_getinfo($sp2df40c, CURLINFO_HEADER_SIZE); if ($sp322a14) { $sp322a14 = curl_getinfo($sp2df40c, CURLINFO_HTTP_CODE); } $sp897e2b = substr($sp0223d2, 0, $sp9700cb); $sp88e266 = substr($sp0223d2, $sp9700cb); curl_close($sp2df40c); if ($sp264383 !== false) { $sp5d00a4 = explode('
', $sp897e2b); $spe8e4a9 = ''; foreach ($sp5d00a4 as $sp897e2b) { if (strtolower(substr($sp897e2b, 0, 11)) === 'set-cookie:') { $sp897e2b = 'Set-Cookie:' . substr($sp897e2b, 11); if (strpos($sp897e2b, 'Set-Cookie') !== false) { if (strpos($sp897e2b, ';') !== false) { $spe8e4a9 = $spe8e4a9 . trim(Helper::str_between($sp897e2b, 'Set-Cookie:', ';')) . ';'; } else { $spe8e4a9 = $spe8e4a9 . trim(str_replace('Set-Cookie:', '', $sp897e2b)) . ';'; } } } } $sp264383 = self::combineCookie($sp264383, $spe8e4a9); } return $sp88e266; } public static function get($sp069c22, $sp5d00a4 = array(), $sp89060d = 5, &$sp264383 = false) { return self::curl($sp069c22, 0, '', $sp5d00a4, $sp89060d, $sp264383); } public static function post($sp069c22, $sp0a769f = '', $sp5d00a4 = array(), $sp89060d = 5, &$sp264383 = false) { return self::curl($sp069c22, 1, $sp0a769f, $sp5d00a4, $sp89060d, $sp264383); } public static function download($sp069c22, $spfff5a5, $spd9ca31 = false) { $sp7f2319 = fopen($spfff5a5, 'w+'); if (!$sp7f2319) { throw new \Exception('cant open file: ' . $spfff5a5); } $sp2df40c = curl_init(); curl_setopt($sp2df40c, CURLOPT_URL, $sp069c22); curl_setopt($sp2df40c, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp2df40c, CURLOPT_RETURNTRANSFER, true); curl_setopt($sp2df40c, CURLOPT_FILE, $sp7f2319); if ($spd9ca31) { curl_setopt($sp2df40c, CURLOPT_PROGRESSFUNCTION, function ($spb1b5ca, $sp1e0b27, $spa33621, $sp764491, $spca0b7e) { if ($sp1e0b27 > 0) { echo '    download: ' . sprintf('%.2f', $spa33621 / $sp1e0b27 * 100) . '%'; } }); curl_setopt($sp2df40c, CURLOPT_NOPROGRESS, false); } curl_setopt($sp2df40c, CURLOPT_HEADER, 0); curl_setopt($sp2df40c, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'); if (defined('MY_PROXY')) { $sp6f2ecf = MY_PROXY; $sp3c6cc7 = CURLPROXY_HTTP; if (strpos($sp6f2ecf, 'http://') || strpos($sp6f2ecf, 'https://')) { $sp6f2ecf = str_replace('http://', $sp6f2ecf, $sp6f2ecf); $sp6f2ecf = str_replace('https://', $sp6f2ecf, $sp6f2ecf); $sp3c6cc7 = CURLPROXY_HTTP; } elseif (strpos($sp6f2ecf, 'socks4://')) { $sp6f2ecf = str_replace('socks4://', $sp6f2ecf, $sp6f2ecf); $sp3c6cc7 = CURLPROXY_SOCKS4; } elseif (strpos($sp6f2ecf, 'socks4a://')) { $sp6f2ecf = str_replace('socks4a://', $sp6f2ecf, $sp6f2ecf); $sp3c6cc7 = CURLPROXY_SOCKS4A; } elseif (strpos($sp6f2ecf, 'socks5://')) { $sp6f2ecf = str_replace('socks5://', $sp6f2ecf, $sp6f2ecf); $sp3c6cc7 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp2df40c, CURLOPT_PROXY, $sp6f2ecf); curl_setopt($sp2df40c, CURLOPT_PROXYTYPE, $sp3c6cc7); if (defined('MY_PROXY_PASS')) { curl_setopt($sp2df40c, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_exec($sp2df40c); if (curl_errno($sp2df40c)) { curl_close($sp2df40c); throw new \Exception('curl_error: ' . curl_error($sp2df40c)); } curl_close($sp2df40c); return true; } public static function combineCookie($sp216247, $sp73bf90) { $sp41cb56 = explode(';', $sp216247); $spc9b175 = explode(';', $sp73bf90); foreach ($sp41cb56 as $sp9ce903) { if (self::cookieIsExists($spc9b175, self::cookieGetName($sp9ce903)) == false) { array_push($spc9b175, $sp9ce903); } } $sp5097b0 = ''; foreach ($spc9b175 as $sp9ce903) { if (substr($sp9ce903, -8, 8) != '=deleted' && strlen($sp9ce903) > 1) { $sp5097b0 .= $sp9ce903 . '; '; } } return substr($sp5097b0, 0, strlen($sp5097b0) - 1); } public static function cookieGetName($sp784bd5) { $sp6183be = strpos($sp784bd5, '='); return substr($sp784bd5, 0, $sp6183be); } public static function cookieGetValue($sp784bd5) { $sp6183be = strpos($sp784bd5, '='); $spe5141b = substr($sp784bd5, $sp6183be + 1, strlen($sp784bd5) - $sp6183be); return $spe5141b; } public static function cookieGet($sp264383, $sp832442, $sp6f00be = false) { $sp264383 = str_replace(' ', '', $sp264383); if (substr($sp264383, -1, 1) != ';') { $sp264383 = ';' . $sp264383 . ';'; } else { $sp264383 = ';' . $sp264383; } $sp930c45 = Helper::str_between($sp264383, ';' . $sp832442 . '=', ';'); if (!$sp6f00be || $sp930c45 == '') { return $sp930c45; } else { return $sp832442 . '=' . $sp930c45; } } private static function cookieIsExists($spc716e9, $spced790) { foreach ($spc716e9 as $sp9ce903) { if (self::cookieGetName($sp9ce903) == $spced790) { return true; } } return false; } function test() { $spe5141b = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($spe5141b); } }