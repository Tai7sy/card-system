<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($sped560b, $sp2bb135 = 0, $sp40fa75 = '', $sp401ae7 = array(), $spfe407d = 5, &$sp3bfcbd = false) { if (!isset($sp401ae7['Accept'])) { $sp401ae7['Accept'] = '*/*'; } if (!isset($sp401ae7['Referer'])) { $sp401ae7['Referer'] = $sped560b; } if (!isset($sp401ae7['Content-Type'])) { $sp401ae7['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp401ae7['User-Agent'])) { $sp401ae7['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp3bfcbd !== false) { $sp401ae7['Cookie'] = $sp3bfcbd; } $sp9cd847 = array(); foreach ($sp401ae7 as $spc17f6b => $sp65f96d) { $sp9cd847[] = $spc17f6b . ': ' . $sp65f96d; } $sp9cd847[] = 'Expect:'; $sp669493 = curl_init(); curl_setopt($sp669493, CURLOPT_URL, $sped560b); curl_setopt($sp669493, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($sp669493, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($sp669493, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp669493, CURLOPT_MAXREDIRS, 3); if ($sp2bb135 == 1) { curl_setopt($sp669493, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($sp669493, CURLOPT_POST, 1); if ($sp40fa75 !== '') { curl_setopt($sp669493, CURLOPT_POSTFIELDS, $sp40fa75); curl_setopt($sp669493, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $spe5a9d0 = MY_PROXY; $spe997a1 = CURLPROXY_HTTP; if (strpos($spe5a9d0, 'http://') || strpos($spe5a9d0, 'https://')) { $spe5a9d0 = str_replace('http://', $spe5a9d0, $spe5a9d0); $spe5a9d0 = str_replace('https://', $spe5a9d0, $spe5a9d0); $spe997a1 = CURLPROXY_HTTP; } elseif (strpos($spe5a9d0, 'socks4://')) { $spe5a9d0 = str_replace('socks4://', $spe5a9d0, $spe5a9d0); $spe997a1 = CURLPROXY_SOCKS4; } elseif (strpos($spe5a9d0, 'socks4a://')) { $spe5a9d0 = str_replace('socks4a://', $spe5a9d0, $spe5a9d0); $spe997a1 = CURLPROXY_SOCKS4A; } elseif (strpos($spe5a9d0, 'socks5://')) { $spe5a9d0 = str_replace('socks5://', $spe5a9d0, $spe5a9d0); $spe997a1 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp669493, CURLOPT_PROXY, $spe5a9d0); curl_setopt($sp669493, CURLOPT_PROXYTYPE, $spe997a1); if (defined('MY_PROXY_PASS')) { curl_setopt($sp669493, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($sp669493, CURLOPT_TIMEOUT, $spfe407d); curl_setopt($sp669493, CURLOPT_CONNECTTIMEOUT, $spfe407d); curl_setopt($sp669493, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp669493, CURLOPT_HEADER, 1); curl_setopt($sp669493, CURLOPT_HTTPHEADER, $sp9cd847); $sp81fa79 = curl_exec($sp669493); $spca590f = curl_getinfo($sp669493, CURLINFO_HEADER_SIZE); $spe666de = substr($sp81fa79, 0, $spca590f); $sp62fc7f = substr($sp81fa79, $spca590f); curl_close($sp669493); if ($sp3bfcbd !== false) { $sp401ae7 = explode('
', $spe666de); $sp2fe3e2 = ''; foreach ($sp401ae7 as $spe666de) { if (strpos($spe666de, 'Set-Cookie') !== false) { if (strpos($spe666de, ';') !== false) { $sp2fe3e2 = $sp2fe3e2 . trim(Helper::str_between($spe666de, 'Set-Cookie:', ';')) . ';'; } else { $sp2fe3e2 = $sp2fe3e2 . trim(str_replace('Set-Cookie:', '', $spe666de)) . ';'; } } } $sp3bfcbd = self::combineCookie($sp3bfcbd, $sp2fe3e2); } return $sp62fc7f; } public static function get($sped560b, $sp401ae7 = array(), $spfe407d = 5, &$sp3bfcbd = false) { return self::curl($sped560b, 0, '', $sp401ae7, $spfe407d, $sp3bfcbd); } public static function post($sped560b, $sp40fa75 = '', $sp401ae7 = array(), $spfe407d = 5, &$sp3bfcbd = false) { return self::curl($sped560b, 1, $sp40fa75, $sp401ae7, $spfe407d, $sp3bfcbd); } public static function combineCookie($spf62e49, $spe6bc6d) { $sp0b79a6 = explode(';', $spf62e49); $sp90758f = explode(';', $spe6bc6d); foreach ($sp0b79a6 as $sp826f95) { if (self::cookieIsExists($sp90758f, self::cookieGetName($sp826f95)) == false) { array_push($sp90758f, $sp826f95); } } $spbad84a = ''; foreach ($sp90758f as $sp826f95) { if (substr($sp826f95, -8, 8) != '=deleted' && strlen($sp826f95) > 1) { $spbad84a .= $sp826f95 . '; '; } } return substr($spbad84a, 0, strlen($spbad84a) - 2); } public static function cookieGetName($spf31cf2) { $sp23432e = strpos($spf31cf2, '='); return substr($spf31cf2, 0, $sp23432e); } public static function cookieGetValue($spf31cf2) { $sp23432e = strpos($spf31cf2, '='); $sp8716e7 = substr($spf31cf2, $sp23432e + 1, strlen($spf31cf2) - $sp23432e); return $sp8716e7; } public static function cookieGet($sp3bfcbd, $sp023357, $sp2335bb = false) { $sp3bfcbd = str_replace(' ', '', $sp3bfcbd); if (substr($sp3bfcbd, -1, 1) != ';') { $sp3bfcbd = ';' . $sp3bfcbd . ';'; } else { $sp3bfcbd = ';' . $sp3bfcbd; } $spe57ee6 = Helper::str_between($sp3bfcbd, ';' . $sp023357 . '=', ';'); if (!$sp2335bb || $spe57ee6 == '') { return $spe57ee6; } else { return $sp023357 . '=' . $spe57ee6; } } private static function cookieIsExists($sp9b31d0, $sp65ae5b) { foreach ($sp9b31d0 as $sp826f95) { if (self::cookieGetName($sp826f95) == $sp65ae5b) { return true; } } return false; } function test() { $sp8716e7 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp8716e7); } }