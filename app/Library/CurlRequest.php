<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($sp3db1b2, $sp2e8ea8 = 0, $sp0e98cb = '', $sp28070b = array(), $sp39139f = 5, &$spe0ae41 = false) { if (!isset($sp28070b['Accept'])) { $sp28070b['Accept'] = '*/*'; } if (!isset($sp28070b['Referer'])) { $sp28070b['Referer'] = $sp3db1b2; } if (!isset($sp28070b['Content-Type'])) { $sp28070b['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp28070b['User-Agent'])) { $sp28070b['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($spe0ae41 !== false) { $sp28070b['Cookie'] = $spe0ae41; } $sp263179 = array(); foreach ($sp28070b as $sp0a9b77 => $spf9847c) { $sp263179[] = $sp0a9b77 . ': ' . $spf9847c; } $sp263179[] = 'Expect:'; $sp9b0943 = curl_init(); curl_setopt($sp9b0943, CURLOPT_URL, $sp3db1b2); curl_setopt($sp9b0943, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($sp9b0943, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($sp9b0943, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp9b0943, CURLOPT_MAXREDIRS, 3); if ($sp2e8ea8 == 1) { curl_setopt($sp9b0943, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($sp9b0943, CURLOPT_POST, 1); if ($sp0e98cb !== '') { curl_setopt($sp9b0943, CURLOPT_POSTFIELDS, $sp0e98cb); curl_setopt($sp9b0943, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $sp57f18d = MY_PROXY; $spb194f2 = CURLPROXY_HTTP; if (strpos($sp57f18d, 'http://') || strpos($sp57f18d, 'https://')) { $sp57f18d = str_replace('http://', $sp57f18d, $sp57f18d); $sp57f18d = str_replace('https://', $sp57f18d, $sp57f18d); $spb194f2 = CURLPROXY_HTTP; } elseif (strpos($sp57f18d, 'socks4://')) { $sp57f18d = str_replace('socks4://', $sp57f18d, $sp57f18d); $spb194f2 = CURLPROXY_SOCKS4; } elseif (strpos($sp57f18d, 'socks4a://')) { $sp57f18d = str_replace('socks4a://', $sp57f18d, $sp57f18d); $spb194f2 = CURLPROXY_SOCKS4A; } elseif (strpos($sp57f18d, 'socks5://')) { $sp57f18d = str_replace('socks5://', $sp57f18d, $sp57f18d); $spb194f2 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp9b0943, CURLOPT_PROXY, $sp57f18d); curl_setopt($sp9b0943, CURLOPT_PROXYTYPE, $spb194f2); if (defined('MY_PROXY_PASS')) { curl_setopt($sp9b0943, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($sp9b0943, CURLOPT_TIMEOUT, $sp39139f); curl_setopt($sp9b0943, CURLOPT_CONNECTTIMEOUT, $sp39139f); curl_setopt($sp9b0943, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp9b0943, CURLOPT_HEADER, 1); curl_setopt($sp9b0943, CURLOPT_HTTPHEADER, $sp263179); $sp3ac4e3 = curl_exec($sp9b0943); $sp70c798 = curl_getinfo($sp9b0943, CURLINFO_HEADER_SIZE); $sp79148a = substr($sp3ac4e3, 0, $sp70c798); $sp873488 = substr($sp3ac4e3, $sp70c798); curl_close($sp9b0943); if ($spe0ae41 !== false) { $sp28070b = explode('
', $sp79148a); $sp7fb521 = ''; foreach ($sp28070b as $sp79148a) { if (strpos($sp79148a, 'Set-Cookie') !== false) { if (strpos($sp79148a, ';') !== false) { $sp7fb521 = $sp7fb521 . trim(Helper::str_between($sp79148a, 'Set-Cookie:', ';')) . ';'; } else { $sp7fb521 = $sp7fb521 . trim(str_replace('Set-Cookie:', '', $sp79148a)) . ';'; } } } $spe0ae41 = self::combineCookie($spe0ae41, $sp7fb521); } return $sp873488; } public static function get($sp3db1b2, $sp28070b = array(), $sp39139f = 5, &$spe0ae41 = false) { return self::curl($sp3db1b2, 0, '', $sp28070b, $sp39139f, $spe0ae41); } public static function post($sp3db1b2, $sp0e98cb = '', $sp28070b = array(), $sp39139f = 5, &$spe0ae41 = false) { return self::curl($sp3db1b2, 1, $sp0e98cb, $sp28070b, $sp39139f, $spe0ae41); } public static function combineCookie($sp50470d, $spc14a3e) { $sp017a37 = explode(';', $sp50470d); $spd07747 = explode(';', $spc14a3e); foreach ($sp017a37 as $sp6e92a4) { if (self::cookieIsExists($spd07747, self::cookieGetName($sp6e92a4)) == false) { array_push($spd07747, $sp6e92a4); } } $spd26b12 = ''; foreach ($spd07747 as $sp6e92a4) { if (substr($sp6e92a4, -8, 8) != '=deleted' && strlen($sp6e92a4) > 1) { $spd26b12 .= $sp6e92a4 . '; '; } } return substr($spd26b12, 0, strlen($spd26b12) - 2); } public static function cookieGetName($sp5c601e) { $sp6de9f7 = strpos($sp5c601e, '='); return substr($sp5c601e, 0, $sp6de9f7); } public static function cookieGetValue($sp5c601e) { $sp6de9f7 = strpos($sp5c601e, '='); $sp31ee84 = substr($sp5c601e, $sp6de9f7 + 1, strlen($sp5c601e) - $sp6de9f7); return $sp31ee84; } public static function cookieGet($spe0ae41, $sp505b52, $sp32d9c3 = false) { $spe0ae41 = str_replace(' ', '', $spe0ae41); if (substr($spe0ae41, -1, 1) != ';') { $spe0ae41 = ';' . $spe0ae41 . ';'; } else { $spe0ae41 = ';' . $spe0ae41; } $spa5cb9b = Helper::str_between($spe0ae41, ';' . $sp505b52 . '=', ';'); if (!$sp32d9c3 || $spa5cb9b == '') { return $spa5cb9b; } else { return $sp505b52 . '=' . $spa5cb9b; } } private static function cookieIsExists($sp3b0476, $sp00e97c) { foreach ($sp3b0476 as $sp6e92a4) { if (self::cookieGetName($sp6e92a4) == $sp00e97c) { return true; } } return false; } function test() { $sp31ee84 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp31ee84); } }