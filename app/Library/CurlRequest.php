<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($sp69c1d6, $spf5337d = 0, $spce7304 = '', $spfeddd9 = array(), $sp9c8b22 = 5, &$sp75a3c7 = false) { if (!isset($spfeddd9['Accept'])) { $spfeddd9['Accept'] = '*/*'; } if (!isset($spfeddd9['Referer'])) { $spfeddd9['Referer'] = $sp69c1d6; } if (!isset($spfeddd9['Content-Type'])) { $spfeddd9['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($spfeddd9['User-Agent'])) { $spfeddd9['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp75a3c7 !== false) { $spfeddd9['Cookie'] = $sp75a3c7; } $spdd3d0f = array(); foreach ($spfeddd9 as $sp0314b6 => $sp712b74) { $spdd3d0f[] = $sp0314b6 . ': ' . $sp712b74; } $spdd3d0f[] = 'Expect:'; $spba6201 = curl_init(); curl_setopt($spba6201, CURLOPT_URL, $sp69c1d6); curl_setopt($spba6201, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($spba6201, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($spba6201, CURLOPT_FOLLOWLOCATION, true); curl_setopt($spba6201, CURLOPT_MAXREDIRS, 3); if ($spf5337d == 1) { curl_setopt($spba6201, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($spba6201, CURLOPT_POST, 1); if ($spce7304 !== '') { curl_setopt($spba6201, CURLOPT_POSTFIELDS, $spce7304); curl_setopt($spba6201, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $spa7dc76 = MY_PROXY; $sp0d4846 = CURLPROXY_HTTP; if (strpos($spa7dc76, 'http://') || strpos($spa7dc76, 'https://')) { $spa7dc76 = str_replace('http://', $spa7dc76, $spa7dc76); $spa7dc76 = str_replace('https://', $spa7dc76, $spa7dc76); $sp0d4846 = CURLPROXY_HTTP; } elseif (strpos($spa7dc76, 'socks4://')) { $spa7dc76 = str_replace('socks4://', $spa7dc76, $spa7dc76); $sp0d4846 = CURLPROXY_SOCKS4; } elseif (strpos($spa7dc76, 'socks4a://')) { $spa7dc76 = str_replace('socks4a://', $spa7dc76, $spa7dc76); $sp0d4846 = CURLPROXY_SOCKS4A; } elseif (strpos($spa7dc76, 'socks5://')) { $spa7dc76 = str_replace('socks5://', $spa7dc76, $spa7dc76); $sp0d4846 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($spba6201, CURLOPT_PROXY, $spa7dc76); curl_setopt($spba6201, CURLOPT_PROXYTYPE, $sp0d4846); if (defined('MY_PROXY_PASS')) { curl_setopt($spba6201, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($spba6201, CURLOPT_TIMEOUT, $sp9c8b22); curl_setopt($spba6201, CURLOPT_CONNECTTIMEOUT, $sp9c8b22); curl_setopt($spba6201, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spba6201, CURLOPT_HEADER, 1); curl_setopt($spba6201, CURLOPT_HTTPHEADER, $spdd3d0f); $sp7c95a4 = curl_exec($spba6201); $spd98786 = curl_getinfo($spba6201, CURLINFO_HEADER_SIZE); $sp3b2a21 = substr($sp7c95a4, 0, $spd98786); $sp028ecb = substr($sp7c95a4, $spd98786); curl_close($spba6201); if ($sp75a3c7 !== false) { $spfeddd9 = explode('
', $sp3b2a21); $spa2d52d = ''; foreach ($spfeddd9 as $sp3b2a21) { if (strpos($sp3b2a21, 'Set-Cookie') !== false) { if (strpos($sp3b2a21, ';') !== false) { $spa2d52d = $spa2d52d . trim(Helper::str_between($sp3b2a21, 'Set-Cookie:', ';')) . ';'; } else { $spa2d52d = $spa2d52d . trim(str_replace('Set-Cookie:', '', $sp3b2a21)) . ';'; } } } $sp75a3c7 = self::combineCookie($sp75a3c7, $spa2d52d); } return $sp028ecb; } public static function get($sp69c1d6, $spfeddd9 = array(), $sp9c8b22 = 5, &$sp75a3c7 = false) { return self::curl($sp69c1d6, 0, '', $spfeddd9, $sp9c8b22, $sp75a3c7); } public static function post($sp69c1d6, $spce7304 = '', $spfeddd9 = array(), $sp9c8b22 = 5, &$sp75a3c7 = false) { return self::curl($sp69c1d6, 1, $spce7304, $spfeddd9, $sp9c8b22, $sp75a3c7); } public static function combineCookie($sp409a5d, $sp0eddd4) { $sp6e8fc4 = explode(';', $sp409a5d); $sp494592 = explode(';', $sp0eddd4); foreach ($sp6e8fc4 as $sp7b784b) { if (self::cookieIsExists($sp494592, self::cookieGetName($sp7b784b)) == false) { array_push($sp494592, $sp7b784b); } } $sp5f713b = ''; foreach ($sp494592 as $sp7b784b) { if (substr($sp7b784b, -8, 8) != '=deleted' && strlen($sp7b784b) > 1) { $sp5f713b .= $sp7b784b . '; '; } } return substr($sp5f713b, 0, strlen($sp5f713b) - 2); } public static function cookieGetName($sp55b9d5) { $spd74535 = strpos($sp55b9d5, '='); return substr($sp55b9d5, 0, $spd74535); } public static function cookieGetValue($sp55b9d5) { $spd74535 = strpos($sp55b9d5, '='); $spe25c64 = substr($sp55b9d5, $spd74535 + 1, strlen($sp55b9d5) - $spd74535); return $spe25c64; } public static function cookieGet($sp75a3c7, $sp2dce9c, $spfc40c4 = false) { $sp75a3c7 = str_replace(' ', '', $sp75a3c7); if (substr($sp75a3c7, -1, 1) != ';') { $sp75a3c7 = ';' . $sp75a3c7 . ';'; } else { $sp75a3c7 = ';' . $sp75a3c7; } $sp37611b = Helper::str_between($sp75a3c7, ';' . $sp2dce9c . '=', ';'); if (!$spfc40c4 || $sp37611b == '') { return $sp37611b; } else { return $sp2dce9c . '=' . $sp37611b; } } private static function cookieIsExists($spe45f3a, $sp85efa9) { foreach ($spe45f3a as $sp7b784b) { if (self::cookieGetName($sp7b784b) == $sp85efa9) { return true; } } return false; } function test() { $spe25c64 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($spe25c64); } }