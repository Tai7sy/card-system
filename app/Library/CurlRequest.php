<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($speb2c05, $sp88d986 = 0, $sp7c56f1 = '', $sp5899b8 = array(), $sp451fd4 = 5, &$spb6e91a = false) { if (!isset($sp5899b8['Accept'])) { $sp5899b8['Accept'] = '*/*'; } if (!isset($sp5899b8['Referer'])) { $sp5899b8['Referer'] = $speb2c05; } if (!isset($sp5899b8['Content-Type'])) { $sp5899b8['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp5899b8['User-Agent'])) { $sp5899b8['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($spb6e91a !== false) { $sp5899b8['Cookie'] = $spb6e91a; } $sp2f3dad = array(); foreach ($sp5899b8 as $spcea317 => $sp7381eb) { $sp2f3dad[] = $spcea317 . ': ' . $sp7381eb; } $sp2f3dad[] = 'Expect:'; $sp5c5a22 = curl_init(); curl_setopt($sp5c5a22, CURLOPT_URL, $speb2c05); curl_setopt($sp5c5a22, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($sp5c5a22, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($sp5c5a22, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp5c5a22, CURLOPT_MAXREDIRS, 3); if ($sp88d986 == 1) { curl_setopt($sp5c5a22, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($sp5c5a22, CURLOPT_POST, 1); if ($sp7c56f1 !== '') { curl_setopt($sp5c5a22, CURLOPT_POSTFIELDS, $sp7c56f1); curl_setopt($sp5c5a22, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $spf69ab2 = MY_PROXY; $sp1b672e = CURLPROXY_HTTP; if (strpos($spf69ab2, 'http://') || strpos($spf69ab2, 'https://')) { $spf69ab2 = str_replace('http://', $spf69ab2, $spf69ab2); $spf69ab2 = str_replace('https://', $spf69ab2, $spf69ab2); $sp1b672e = CURLPROXY_HTTP; } elseif (strpos($spf69ab2, 'socks4://')) { $spf69ab2 = str_replace('socks4://', $spf69ab2, $spf69ab2); $sp1b672e = CURLPROXY_SOCKS4; } elseif (strpos($spf69ab2, 'socks4a://')) { $spf69ab2 = str_replace('socks4a://', $spf69ab2, $spf69ab2); $sp1b672e = CURLPROXY_SOCKS4A; } elseif (strpos($spf69ab2, 'socks5://')) { $spf69ab2 = str_replace('socks5://', $spf69ab2, $spf69ab2); $sp1b672e = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp5c5a22, CURLOPT_PROXY, $spf69ab2); curl_setopt($sp5c5a22, CURLOPT_PROXYTYPE, $sp1b672e); if (defined('MY_PROXY_PASS')) { curl_setopt($sp5c5a22, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($sp5c5a22, CURLOPT_TIMEOUT, $sp451fd4); curl_setopt($sp5c5a22, CURLOPT_CONNECTTIMEOUT, $sp451fd4); curl_setopt($sp5c5a22, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp5c5a22, CURLOPT_HEADER, 1); curl_setopt($sp5c5a22, CURLOPT_HTTPHEADER, $sp2f3dad); $sp05da90 = curl_exec($sp5c5a22); $spd46a6d = curl_getinfo($sp5c5a22, CURLINFO_HEADER_SIZE); $spc7f5b4 = substr($sp05da90, 0, $spd46a6d); $sp304d86 = substr($sp05da90, $spd46a6d); curl_close($sp5c5a22); if ($spb6e91a !== false) { $sp5899b8 = explode('
', $spc7f5b4); $sp4471a6 = ''; foreach ($sp5899b8 as $spc7f5b4) { if (strpos($spc7f5b4, 'Set-Cookie') !== false) { if (strpos($spc7f5b4, ';') !== false) { $sp4471a6 = $sp4471a6 . trim(Helper::str_between($spc7f5b4, 'Set-Cookie:', ';')) . ';'; } else { $sp4471a6 = $sp4471a6 . trim(str_replace('Set-Cookie:', '', $spc7f5b4)) . ';'; } } } $spb6e91a = self::combineCookie($spb6e91a, $sp4471a6); } return $sp304d86; } public static function get($speb2c05, $sp5899b8 = array(), $sp451fd4 = 5, &$spb6e91a = false) { return self::curl($speb2c05, 0, '', $sp5899b8, $sp451fd4, $spb6e91a); } public static function post($speb2c05, $sp7c56f1 = '', $sp5899b8 = array(), $sp451fd4 = 5, &$spb6e91a = false) { return self::curl($speb2c05, 1, $sp7c56f1, $sp5899b8, $sp451fd4, $spb6e91a); } public static function combineCookie($sp4affe8, $sp5d6ece) { $sp693ceb = explode(';', $sp4affe8); $sp8c251a = explode(';', $sp5d6ece); foreach ($sp693ceb as $spa29d80) { if (self::cookieIsExists($sp8c251a, self::cookieGetName($spa29d80)) == false) { array_push($sp8c251a, $spa29d80); } } $sp89b49b = ''; foreach ($sp8c251a as $spa29d80) { if (substr($spa29d80, -8, 8) != '=deleted' && strlen($spa29d80) > 1) { $sp89b49b .= $spa29d80 . '; '; } } return substr($sp89b49b, 0, strlen($sp89b49b) - 2); } public static function cookieGetName($sp6d0449) { $sp1683e1 = strpos($sp6d0449, '='); return substr($sp6d0449, 0, $sp1683e1); } public static function cookieGetValue($sp6d0449) { $sp1683e1 = strpos($sp6d0449, '='); $spe64723 = substr($sp6d0449, $sp1683e1 + 1, strlen($sp6d0449) - $sp1683e1); return $spe64723; } public static function cookieGet($spb6e91a, $sp7961e5, $sp75f077 = false) { $spb6e91a = str_replace(' ', '', $spb6e91a); if (substr($spb6e91a, -1, 1) != ';') { $spb6e91a = ';' . $spb6e91a . ';'; } else { $spb6e91a = ';' . $spb6e91a; } $spb56239 = Helper::str_between($spb6e91a, ';' . $sp7961e5 . '=', ';'); if (!$sp75f077 || $spb56239 == '') { return $spb56239; } else { return $sp7961e5 . '=' . $spb56239; } } private static function cookieIsExists($sp0b65d5, $sp645664) { foreach ($sp0b65d5 as $spa29d80) { if (self::cookieGetName($spa29d80) == $sp645664) { return true; } } return false; } function test() { $spe64723 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($spe64723); } }