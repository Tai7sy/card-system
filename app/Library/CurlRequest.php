<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($sp8d7716, $sp63cb36 = 0, $sp835b9b = '', $sp4977e0 = array(), $spd7c04a = 5, &$sp97edf1 = false) { if (!isset($sp4977e0['Accept'])) { $sp4977e0['Accept'] = '*/*'; } if (!isset($sp4977e0['Referer'])) { $sp4977e0['Referer'] = $sp8d7716; } if (!isset($sp4977e0['Content-Type'])) { $sp4977e0['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp4977e0['User-Agent'])) { $sp4977e0['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp97edf1 !== false) { $sp4977e0['Cookie'] = $sp97edf1; } $sp0a030c = array(); foreach ($sp4977e0 as $sp08a844 => $sp70d5fe) { $sp0a030c[] = $sp08a844 . ': ' . $sp70d5fe; } $sp0a030c[] = 'Expect:'; $sp6b3fc7 = curl_init(); curl_setopt($sp6b3fc7, CURLOPT_URL, $sp8d7716); curl_setopt($sp6b3fc7, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($sp6b3fc7, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($sp6b3fc7, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp6b3fc7, CURLOPT_MAXREDIRS, 3); if ($sp63cb36 == 1) { curl_setopt($sp6b3fc7, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($sp6b3fc7, CURLOPT_POST, 1); if ($sp835b9b !== '') { curl_setopt($sp6b3fc7, CURLOPT_POSTFIELDS, $sp835b9b); curl_setopt($sp6b3fc7, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $spc90954 = MY_PROXY; $sp117795 = CURLPROXY_HTTP; if (strpos($spc90954, 'http://') || strpos($spc90954, 'https://')) { $spc90954 = str_replace('http://', $spc90954, $spc90954); $spc90954 = str_replace('https://', $spc90954, $spc90954); $sp117795 = CURLPROXY_HTTP; } elseif (strpos($spc90954, 'socks4://')) { $spc90954 = str_replace('socks4://', $spc90954, $spc90954); $sp117795 = CURLPROXY_SOCKS4; } elseif (strpos($spc90954, 'socks4a://')) { $spc90954 = str_replace('socks4a://', $spc90954, $spc90954); $sp117795 = CURLPROXY_SOCKS4A; } elseif (strpos($spc90954, 'socks5://')) { $spc90954 = str_replace('socks5://', $spc90954, $spc90954); $sp117795 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp6b3fc7, CURLOPT_PROXY, $spc90954); curl_setopt($sp6b3fc7, CURLOPT_PROXYTYPE, $sp117795); if (defined('MY_PROXY_PASS')) { curl_setopt($sp6b3fc7, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($sp6b3fc7, CURLOPT_TIMEOUT, $spd7c04a); curl_setopt($sp6b3fc7, CURLOPT_CONNECTTIMEOUT, $spd7c04a); curl_setopt($sp6b3fc7, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp6b3fc7, CURLOPT_HEADER, 1); curl_setopt($sp6b3fc7, CURLOPT_HTTPHEADER, $sp0a030c); $spf97340 = curl_exec($sp6b3fc7); $spf6f6fa = curl_getinfo($sp6b3fc7, CURLINFO_HEADER_SIZE); $sp880206 = substr($spf97340, 0, $spf6f6fa); $spcc04ea = substr($spf97340, $spf6f6fa); curl_close($sp6b3fc7); if ($sp97edf1 !== false) { $sp4977e0 = explode('
', $sp880206); $spef1bd0 = ''; foreach ($sp4977e0 as $sp880206) { if (strpos($sp880206, 'Set-Cookie') !== false) { if (strpos($sp880206, ';') !== false) { $spef1bd0 = $spef1bd0 . trim(Helper::str_between($sp880206, 'Set-Cookie:', ';')) . ';'; } else { $spef1bd0 = $spef1bd0 . trim(str_replace('Set-Cookie:', '', $sp880206)) . ';'; } } } $sp97edf1 = self::combineCookie($sp97edf1, $spef1bd0); } return $spcc04ea; } public static function get($sp8d7716, $sp4977e0 = array(), $spd7c04a = 5, &$sp97edf1 = false) { return self::curl($sp8d7716, 0, '', $sp4977e0, $spd7c04a, $sp97edf1); } public static function post($sp8d7716, $sp835b9b = '', $sp4977e0 = array(), $spd7c04a = 5, &$sp97edf1 = false) { return self::curl($sp8d7716, 1, $sp835b9b, $sp4977e0, $spd7c04a, $sp97edf1); } public static function combineCookie($spf3151b, $sp4db1dd) { $sp253e00 = explode(';', $spf3151b); $sp65e9c8 = explode(';', $sp4db1dd); foreach ($sp253e00 as $sp1a9cae) { if (self::cookieIsExists($sp65e9c8, self::cookieGetName($sp1a9cae)) == false) { array_push($sp65e9c8, $sp1a9cae); } } $sp413b23 = ''; foreach ($sp65e9c8 as $sp1a9cae) { if (substr($sp1a9cae, -8, 8) != '=deleted' && strlen($sp1a9cae) > 1) { $sp413b23 .= $sp1a9cae . '; '; } } return substr($sp413b23, 0, strlen($sp413b23) - 2); } public static function cookieGetName($sp538bc6) { $spaa5ad4 = strpos($sp538bc6, '='); return substr($sp538bc6, 0, $spaa5ad4); } public static function cookieGetValue($sp538bc6) { $spaa5ad4 = strpos($sp538bc6, '='); $sp593e0f = substr($sp538bc6, $spaa5ad4 + 1, strlen($sp538bc6) - $spaa5ad4); return $sp593e0f; } public static function cookieGet($sp97edf1, $sp71416b, $sp1897d0 = false) { $sp97edf1 = str_replace(' ', '', $sp97edf1); if (substr($sp97edf1, -1, 1) != ';') { $sp97edf1 = ';' . $sp97edf1 . ';'; } else { $sp97edf1 = ';' . $sp97edf1; } $sp342aea = Helper::str_between($sp97edf1, ';' . $sp71416b . '=', ';'); if (!$sp1897d0 || $sp342aea == '') { return $sp342aea; } else { return $sp71416b . '=' . $sp342aea; } } private static function cookieIsExists($spcd0827, $sp2723e2) { foreach ($spcd0827 as $sp1a9cae) { if (self::cookieGetName($sp1a9cae) == $sp2723e2) { return true; } } return false; } function test() { $sp593e0f = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp593e0f); } }