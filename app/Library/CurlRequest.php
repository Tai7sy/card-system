<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($spf47337, $spddf876 = 0, $spd8354b = '', $sp0a5e42 = array(), $sp98fc8f = 5, &$sp9c16c7 = false) { if (!isset($sp0a5e42['Accept'])) { $sp0a5e42['Accept'] = '*/*'; } if (!isset($sp0a5e42['Referer'])) { $sp0a5e42['Referer'] = $spf47337; } if (!isset($sp0a5e42['Content-Type'])) { $sp0a5e42['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp0a5e42['User-Agent'])) { $sp0a5e42['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp9c16c7 !== false) { $sp0a5e42['Cookie'] = $sp9c16c7; } $sp2f4c7b = array(); foreach ($sp0a5e42 as $spa3bc76 => $spbec8d9) { $sp2f4c7b[] = $spa3bc76 . ': ' . $spbec8d9; } $sp2f4c7b[] = 'Expect:'; $sp8bd541 = curl_init(); curl_setopt($sp8bd541, CURLOPT_URL, $spf47337); curl_setopt($sp8bd541, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($sp8bd541, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($sp8bd541, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp8bd541, CURLOPT_MAXREDIRS, 3); if ($spddf876 == 1) { curl_setopt($sp8bd541, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($sp8bd541, CURLOPT_POST, 1); if ($spd8354b !== '') { curl_setopt($sp8bd541, CURLOPT_POSTFIELDS, $spd8354b); curl_setopt($sp8bd541, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $spa6f720 = MY_PROXY; $sp423e37 = CURLPROXY_HTTP; if (strpos($spa6f720, 'http://') || strpos($spa6f720, 'https://')) { $spa6f720 = str_replace('http://', $spa6f720, $spa6f720); $spa6f720 = str_replace('https://', $spa6f720, $spa6f720); $sp423e37 = CURLPROXY_HTTP; } elseif (strpos($spa6f720, 'socks4://')) { $spa6f720 = str_replace('socks4://', $spa6f720, $spa6f720); $sp423e37 = CURLPROXY_SOCKS4; } elseif (strpos($spa6f720, 'socks4a://')) { $spa6f720 = str_replace('socks4a://', $spa6f720, $spa6f720); $sp423e37 = CURLPROXY_SOCKS4A; } elseif (strpos($spa6f720, 'socks5://')) { $spa6f720 = str_replace('socks5://', $spa6f720, $spa6f720); $sp423e37 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp8bd541, CURLOPT_PROXY, $spa6f720); curl_setopt($sp8bd541, CURLOPT_PROXYTYPE, $sp423e37); if (defined('MY_PROXY_PASS')) { curl_setopt($sp8bd541, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($sp8bd541, CURLOPT_TIMEOUT, $sp98fc8f); curl_setopt($sp8bd541, CURLOPT_CONNECTTIMEOUT, $sp98fc8f); curl_setopt($sp8bd541, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp8bd541, CURLOPT_HEADER, 1); curl_setopt($sp8bd541, CURLOPT_HTTPHEADER, $sp2f4c7b); $sp0a301e = curl_exec($sp8bd541); $spa17a8e = curl_getinfo($sp8bd541, CURLINFO_HEADER_SIZE); $sp12d7e3 = substr($sp0a301e, 0, $spa17a8e); $spc2ace9 = substr($sp0a301e, $spa17a8e); curl_close($sp8bd541); if ($sp9c16c7 !== false) { $sp0a5e42 = explode('
', $sp12d7e3); $sp59d703 = ''; foreach ($sp0a5e42 as $sp12d7e3) { if (strpos($sp12d7e3, 'Set-Cookie') !== false) { if (strpos($sp12d7e3, ';') !== false) { $sp59d703 = $sp59d703 . trim(Helper::str_between($sp12d7e3, 'Set-Cookie:', ';')) . ';'; } else { $sp59d703 = $sp59d703 . trim(str_replace('Set-Cookie:', '', $sp12d7e3)) . ';'; } } } $sp9c16c7 = self::combineCookie($sp9c16c7, $sp59d703); } return $spc2ace9; } public static function get($spf47337, $sp0a5e42 = array(), $sp98fc8f = 5, &$sp9c16c7 = false) { return self::curl($spf47337, 0, '', $sp0a5e42, $sp98fc8f, $sp9c16c7); } public static function post($spf47337, $spd8354b = '', $sp0a5e42 = array(), $sp98fc8f = 5, &$sp9c16c7 = false) { return self::curl($spf47337, 1, $spd8354b, $sp0a5e42, $sp98fc8f, $sp9c16c7); } public static function combineCookie($sp23cdff, $sp5788ec) { $spfaa70c = explode(';', $sp23cdff); $sp33ba4e = explode(';', $sp5788ec); foreach ($spfaa70c as $spd55f91) { if (self::cookieIsExists($sp33ba4e, self::cookieGetName($spd55f91)) == false) { array_push($sp33ba4e, $spd55f91); } } $spbbec79 = ''; foreach ($sp33ba4e as $spd55f91) { if (substr($spd55f91, -8, 8) != '=deleted' && strlen($spd55f91) > 1) { $spbbec79 .= $spd55f91 . '; '; } } return substr($spbbec79, 0, strlen($spbbec79) - 2); } public static function cookieGetName($spc1df08) { $spf12b21 = strpos($spc1df08, '='); return substr($spc1df08, 0, $spf12b21); } public static function cookieGetValue($spc1df08) { $spf12b21 = strpos($spc1df08, '='); $sp3034cd = substr($spc1df08, $spf12b21 + 1, strlen($spc1df08) - $spf12b21); return $sp3034cd; } public static function cookieGet($sp9c16c7, $sp6f359d, $sp2f76fd = false) { $sp9c16c7 = str_replace(' ', '', $sp9c16c7); if (substr($sp9c16c7, -1, 1) != ';') { $sp9c16c7 = ';' . $sp9c16c7 . ';'; } else { $sp9c16c7 = ';' . $sp9c16c7; } $sp4471bd = Helper::str_between($sp9c16c7, ';' . $sp6f359d . '=', ';'); if (!$sp2f76fd || $sp4471bd == '') { return $sp4471bd; } else { return $sp6f359d . '=' . $sp4471bd; } } private static function cookieIsExists($spd15a2f, $spb4ac7f) { foreach ($spd15a2f as $spd55f91) { if (self::cookieGetName($spd55f91) == $spb4ac7f) { return true; } } return false; } function test() { $sp3034cd = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp3034cd); } }