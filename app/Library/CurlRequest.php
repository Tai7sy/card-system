<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($sp2b97a5, $spa22985 = 0, $sp57bc9c = '', $sp297ae4 = array(), $sp730812 = 5, &$sp776967 = false) { if (!isset($sp297ae4['Accept'])) { $sp297ae4['Accept'] = '*/*'; } if (!isset($sp297ae4['Referer'])) { $sp297ae4['Referer'] = $sp2b97a5; } if (!isset($sp297ae4['Content-Type'])) { $sp297ae4['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp297ae4['User-Agent'])) { $sp297ae4['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp776967 !== false) { $sp297ae4['Cookie'] = $sp776967; } $sp644258 = array(); foreach ($sp297ae4 as $sp53e8d5 => $sp1a8aab) { $sp644258[] = $sp53e8d5 . ': ' . $sp1a8aab; } $sp644258[] = 'Expect:'; $sp10b8b7 = curl_init(); curl_setopt($sp10b8b7, CURLOPT_URL, $sp2b97a5); curl_setopt($sp10b8b7, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($sp10b8b7, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($sp10b8b7, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp10b8b7, CURLOPT_MAXREDIRS, 3); if ($spa22985 == 1) { curl_setopt($sp10b8b7, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($sp10b8b7, CURLOPT_POST, 1); if ($sp57bc9c !== '') { curl_setopt($sp10b8b7, CURLOPT_POSTFIELDS, $sp57bc9c); curl_setopt($sp10b8b7, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $sp9c75da = MY_PROXY; $spcf2e80 = CURLPROXY_HTTP; if (strpos($sp9c75da, 'http://') || strpos($sp9c75da, 'https://')) { $sp9c75da = str_replace('http://', $sp9c75da, $sp9c75da); $sp9c75da = str_replace('https://', $sp9c75da, $sp9c75da); $spcf2e80 = CURLPROXY_HTTP; } elseif (strpos($sp9c75da, 'socks4://')) { $sp9c75da = str_replace('socks4://', $sp9c75da, $sp9c75da); $spcf2e80 = CURLPROXY_SOCKS4; } elseif (strpos($sp9c75da, 'socks4a://')) { $sp9c75da = str_replace('socks4a://', $sp9c75da, $sp9c75da); $spcf2e80 = CURLPROXY_SOCKS4A; } elseif (strpos($sp9c75da, 'socks5://')) { $sp9c75da = str_replace('socks5://', $sp9c75da, $sp9c75da); $spcf2e80 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp10b8b7, CURLOPT_PROXY, $sp9c75da); curl_setopt($sp10b8b7, CURLOPT_PROXYTYPE, $spcf2e80); if (defined('MY_PROXY_PASS')) { curl_setopt($sp10b8b7, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($sp10b8b7, CURLOPT_TIMEOUT, $sp730812); curl_setopt($sp10b8b7, CURLOPT_CONNECTTIMEOUT, $sp730812); curl_setopt($sp10b8b7, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp10b8b7, CURLOPT_HEADER, 1); curl_setopt($sp10b8b7, CURLOPT_HTTPHEADER, $sp644258); $spef0962 = curl_exec($sp10b8b7); $sp12c79d = curl_getinfo($sp10b8b7, CURLINFO_HEADER_SIZE); $spf8036f = substr($spef0962, 0, $sp12c79d); $spee2a92 = substr($spef0962, $sp12c79d); curl_close($sp10b8b7); if ($sp776967 !== false) { $sp297ae4 = explode('
', $spf8036f); $sp979a75 = ''; foreach ($sp297ae4 as $spf8036f) { if (strpos($spf8036f, 'Set-Cookie') !== false) { if (strpos($spf8036f, ';') !== false) { $sp979a75 = $sp979a75 . trim(Helper::str_between($spf8036f, 'Set-Cookie:', ';')) . ';'; } else { $sp979a75 = $sp979a75 . trim(str_replace('Set-Cookie:', '', $spf8036f)) . ';'; } } } $sp776967 = self::combineCookie($sp776967, $sp979a75); } return $spee2a92; } public static function get($sp2b97a5, $sp297ae4 = array(), $sp730812 = 5, &$sp776967 = false) { return self::curl($sp2b97a5, 0, '', $sp297ae4, $sp730812, $sp776967); } public static function post($sp2b97a5, $sp57bc9c = '', $sp297ae4 = array(), $sp730812 = 5, &$sp776967 = false) { return self::curl($sp2b97a5, 1, $sp57bc9c, $sp297ae4, $sp730812, $sp776967); } public static function combineCookie($spfa55db, $spea0f2e) { $sp28f385 = explode(';', $spfa55db); $sp988cbe = explode(';', $spea0f2e); foreach ($sp28f385 as $spf834a8) { if (self::cookieIsExists($sp988cbe, self::cookieGetName($spf834a8)) == false) { array_push($sp988cbe, $spf834a8); } } $spde6386 = ''; foreach ($sp988cbe as $spf834a8) { if (substr($spf834a8, -8, 8) != '=deleted' && strlen($spf834a8) > 1) { $spde6386 .= $spf834a8 . '; '; } } return substr($spde6386, 0, strlen($spde6386) - 2); } public static function cookieGetName($sp9a4ebc) { $sp21e348 = strpos($sp9a4ebc, '='); return substr($sp9a4ebc, 0, $sp21e348); } public static function cookieGetValue($sp9a4ebc) { $sp21e348 = strpos($sp9a4ebc, '='); $spa9953c = substr($sp9a4ebc, $sp21e348 + 1, strlen($sp9a4ebc) - $sp21e348); return $spa9953c; } public static function cookieGet($sp776967, $spb6a91a, $spdc5fa8 = false) { $sp776967 = str_replace(' ', '', $sp776967); if (substr($sp776967, -1, 1) != ';') { $sp776967 = ';' . $sp776967 . ';'; } else { $sp776967 = ';' . $sp776967; } $spd4c49a = Helper::str_between($sp776967, ';' . $spb6a91a . '=', ';'); if (!$spdc5fa8 || $spd4c49a == '') { return $spd4c49a; } else { return $spb6a91a . '=' . $spd4c49a; } } private static function cookieIsExists($sp9f5c2f, $sp745e00) { foreach ($sp9f5c2f as $spf834a8) { if (self::cookieGetName($spf834a8) == $sp745e00) { return true; } } return false; } function test() { $spa9953c = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($spa9953c); } }