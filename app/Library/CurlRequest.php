<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($sp0784c1, $sp75c26f = 0, $spefc554 = '', $sp3e89cf = array(), $sp47c3be = 5, &$speed4bf = false) { if (!isset($sp3e89cf['Accept'])) { $sp3e89cf['Accept'] = '*/*'; } if (!isset($sp3e89cf['Referer'])) { $sp3e89cf['Referer'] = $sp0784c1; } if (!isset($sp3e89cf['Content-Type'])) { $sp3e89cf['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp3e89cf['User-Agent'])) { $sp3e89cf['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($speed4bf !== false) { $sp3e89cf['Cookie'] = $speed4bf; } $sp195769 = array(); foreach ($sp3e89cf as $sp5253dc => $sp1db901) { $sp195769[] = $sp5253dc . ': ' . $sp1db901; } $sp195769[] = 'Expect:'; $spf86e31 = curl_init(); curl_setopt($spf86e31, CURLOPT_URL, $sp0784c1); curl_setopt($spf86e31, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($spf86e31, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($spf86e31, CURLOPT_FOLLOWLOCATION, true); curl_setopt($spf86e31, CURLOPT_MAXREDIRS, 3); if ($sp75c26f == 1) { curl_setopt($spf86e31, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($spf86e31, CURLOPT_POST, 1); if ($spefc554 !== '') { curl_setopt($spf86e31, CURLOPT_POSTFIELDS, $spefc554); curl_setopt($spf86e31, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $spee5a33 = MY_PROXY; $sp1437c3 = CURLPROXY_HTTP; if (strpos($spee5a33, 'http://') || strpos($spee5a33, 'https://')) { $spee5a33 = str_replace('http://', $spee5a33, $spee5a33); $spee5a33 = str_replace('https://', $spee5a33, $spee5a33); $sp1437c3 = CURLPROXY_HTTP; } elseif (strpos($spee5a33, 'socks4://')) { $spee5a33 = str_replace('socks4://', $spee5a33, $spee5a33); $sp1437c3 = CURLPROXY_SOCKS4; } elseif (strpos($spee5a33, 'socks4a://')) { $spee5a33 = str_replace('socks4a://', $spee5a33, $spee5a33); $sp1437c3 = CURLPROXY_SOCKS4A; } elseif (strpos($spee5a33, 'socks5://')) { $spee5a33 = str_replace('socks5://', $spee5a33, $spee5a33); $sp1437c3 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($spf86e31, CURLOPT_PROXY, $spee5a33); curl_setopt($spf86e31, CURLOPT_PROXYTYPE, $sp1437c3); if (defined('MY_PROXY_PASS')) { curl_setopt($spf86e31, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($spf86e31, CURLOPT_TIMEOUT, $sp47c3be); curl_setopt($spf86e31, CURLOPT_CONNECTTIMEOUT, $sp47c3be); curl_setopt($spf86e31, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spf86e31, CURLOPT_HEADER, 1); curl_setopt($spf86e31, CURLOPT_HTTPHEADER, $sp195769); $spb9364a = curl_exec($spf86e31); $sp7501e7 = curl_getinfo($spf86e31, CURLINFO_HEADER_SIZE); $sp5a4bfe = substr($spb9364a, 0, $sp7501e7); $spe007d4 = substr($spb9364a, $sp7501e7); curl_close($spf86e31); if ($speed4bf !== false) { $sp3e89cf = explode('
', $sp5a4bfe); $spc07e85 = ''; foreach ($sp3e89cf as $sp5a4bfe) { if (strpos($sp5a4bfe, 'Set-Cookie') !== false) { if (strpos($sp5a4bfe, ';') !== false) { $spc07e85 = $spc07e85 . trim(Helper::str_between($sp5a4bfe, 'Set-Cookie:', ';')) . ';'; } else { $spc07e85 = $spc07e85 . trim(str_replace('Set-Cookie:', '', $sp5a4bfe)) . ';'; } } } $speed4bf = self::combineCookie($speed4bf, $spc07e85); } return $spe007d4; } public static function get($sp0784c1, $sp3e89cf = array(), $sp47c3be = 5, &$speed4bf = false) { return self::curl($sp0784c1, 0, '', $sp3e89cf, $sp47c3be, $speed4bf); } public static function post($sp0784c1, $spefc554 = '', $sp3e89cf = array(), $sp47c3be = 5, &$speed4bf = false) { return self::curl($sp0784c1, 1, $spefc554, $sp3e89cf, $sp47c3be, $speed4bf); } public static function combineCookie($sp31e536, $spb12e25) { $sp74ee5e = explode(';', $sp31e536); $sp8925e2 = explode(';', $spb12e25); foreach ($sp74ee5e as $sp738483) { if (self::cookieIsExists($sp8925e2, self::cookieGetName($sp738483)) == false) { array_push($sp8925e2, $sp738483); } } $spc7f0e3 = ''; foreach ($sp8925e2 as $sp738483) { if (substr($sp738483, -8, 8) != '=deleted' && strlen($sp738483) > 1) { $spc7f0e3 .= $sp738483 . '; '; } } return substr($spc7f0e3, 0, strlen($spc7f0e3) - 2); } public static function cookieGetName($spfe3049) { $spc977ba = strpos($spfe3049, '='); return substr($spfe3049, 0, $spc977ba); } public static function cookieGetValue($spfe3049) { $spc977ba = strpos($spfe3049, '='); $sp13c12f = substr($spfe3049, $spc977ba + 1, strlen($spfe3049) - $spc977ba); return $sp13c12f; } public static function cookieGet($speed4bf, $sp387f04, $sp430a40 = false) { $speed4bf = str_replace(' ', '', $speed4bf); if (substr($speed4bf, -1, 1) != ';') { $speed4bf = ';' . $speed4bf . ';'; } else { $speed4bf = ';' . $speed4bf; } $spf97afb = Helper::str_between($speed4bf, ';' . $sp387f04 . '=', ';'); if (!$sp430a40 || $spf97afb == '') { return $spf97afb; } else { return $sp387f04 . '=' . $spf97afb; } } private static function cookieIsExists($sp79e36e, $spe9e840) { foreach ($sp79e36e as $sp738483) { if (self::cookieGetName($sp738483) == $spe9e840) { return true; } } return false; } function test() { $sp13c12f = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp13c12f); } }