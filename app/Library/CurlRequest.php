<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($sp935125, $sp4b9287 = 0, $sp322593 = '', $sp472234 = array(), $sp475e68 = 5, &$spcfc25e = false) { if (!isset($sp472234['Accept'])) { $sp472234['Accept'] = '*/*'; } if (!isset($sp472234['Referer'])) { $sp472234['Referer'] = $sp935125; } if (!isset($sp472234['Content-Type'])) { $sp472234['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp472234['User-Agent'])) { $sp472234['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($spcfc25e !== false) { $sp472234['Cookie'] = $spcfc25e; } $sp9c9aa3 = array(); foreach ($sp472234 as $sp28fbdf => $sp4e6b0c) { $sp9c9aa3[] = $sp28fbdf . ': ' . $sp4e6b0c; } $sp9c9aa3[] = 'Expect:'; $spc4850c = curl_init(); curl_setopt($spc4850c, CURLOPT_URL, $sp935125); curl_setopt($spc4850c, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($spc4850c, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($spc4850c, CURLOPT_FOLLOWLOCATION, true); curl_setopt($spc4850c, CURLOPT_MAXREDIRS, 3); if ($sp4b9287 == 1) { curl_setopt($spc4850c, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($spc4850c, CURLOPT_POST, 1); if ($sp322593 !== '') { curl_setopt($spc4850c, CURLOPT_POSTFIELDS, $sp322593); curl_setopt($spc4850c, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $spbe3ce4 = MY_PROXY; $sp0d3890 = CURLPROXY_HTTP; if (strpos($spbe3ce4, 'http://') || strpos($spbe3ce4, 'https://')) { $spbe3ce4 = str_replace('http://', $spbe3ce4, $spbe3ce4); $spbe3ce4 = str_replace('https://', $spbe3ce4, $spbe3ce4); $sp0d3890 = CURLPROXY_HTTP; } elseif (strpos($spbe3ce4, 'socks4://')) { $spbe3ce4 = str_replace('socks4://', $spbe3ce4, $spbe3ce4); $sp0d3890 = CURLPROXY_SOCKS4; } elseif (strpos($spbe3ce4, 'socks4a://')) { $spbe3ce4 = str_replace('socks4a://', $spbe3ce4, $spbe3ce4); $sp0d3890 = CURLPROXY_SOCKS4A; } elseif (strpos($spbe3ce4, 'socks5://')) { $spbe3ce4 = str_replace('socks5://', $spbe3ce4, $spbe3ce4); $sp0d3890 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($spc4850c, CURLOPT_PROXY, $spbe3ce4); curl_setopt($spc4850c, CURLOPT_PROXYTYPE, $sp0d3890); if (defined('MY_PROXY_PASS')) { curl_setopt($spc4850c, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($spc4850c, CURLOPT_TIMEOUT, $sp475e68); curl_setopt($spc4850c, CURLOPT_CONNECTTIMEOUT, $sp475e68); curl_setopt($spc4850c, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spc4850c, CURLOPT_HEADER, 1); curl_setopt($spc4850c, CURLOPT_HTTPHEADER, $sp9c9aa3); $sp2a9a03 = curl_exec($spc4850c); $spc5a920 = curl_getinfo($spc4850c, CURLINFO_HEADER_SIZE); $spa5a1f7 = substr($sp2a9a03, 0, $spc5a920); $spb872e0 = substr($sp2a9a03, $spc5a920); curl_close($spc4850c); if ($spcfc25e !== false) { $sp472234 = explode('
', $spa5a1f7); $spddc746 = ''; foreach ($sp472234 as $spa5a1f7) { if (strpos($spa5a1f7, 'Set-Cookie') !== false) { if (strpos($spa5a1f7, ';') !== false) { $spddc746 = $spddc746 . trim(Helper::str_between($spa5a1f7, 'Set-Cookie:', ';')) . ';'; } else { $spddc746 = $spddc746 . trim(str_replace('Set-Cookie:', '', $spa5a1f7)) . ';'; } } } $spcfc25e = self::combineCookie($spcfc25e, $spddc746); } return $spb872e0; } public static function get($sp935125, $sp472234 = array(), $sp475e68 = 5, &$spcfc25e = false) { return self::curl($sp935125, 0, '', $sp472234, $sp475e68, $spcfc25e); } public static function post($sp935125, $sp322593 = '', $sp472234 = array(), $sp475e68 = 5, &$spcfc25e = false) { return self::curl($sp935125, 1, $sp322593, $sp472234, $sp475e68, $spcfc25e); } public static function combineCookie($sp8bbbdd, $spb1e23e) { $spe04ebc = explode(';', $sp8bbbdd); $sp45d2c8 = explode(';', $spb1e23e); foreach ($spe04ebc as $spd2d3a2) { if (self::cookieIsExists($sp45d2c8, self::cookieGetName($spd2d3a2)) == false) { array_push($sp45d2c8, $spd2d3a2); } } $sp763403 = ''; foreach ($sp45d2c8 as $spd2d3a2) { if (substr($spd2d3a2, -8, 8) != '=deleted' && strlen($spd2d3a2) > 1) { $sp763403 .= $spd2d3a2 . '; '; } } return substr($sp763403, 0, strlen($sp763403) - 2); } public static function cookieGetName($sp33699d) { $sp37a295 = strpos($sp33699d, '='); return substr($sp33699d, 0, $sp37a295); } public static function cookieGetValue($sp33699d) { $sp37a295 = strpos($sp33699d, '='); $spaedd86 = substr($sp33699d, $sp37a295 + 1, strlen($sp33699d) - $sp37a295); return $spaedd86; } public static function cookieGet($spcfc25e, $spa58881, $sp3f432f = false) { $spcfc25e = str_replace(' ', '', $spcfc25e); if (substr($spcfc25e, -1, 1) != ';') { $spcfc25e = ';' . $spcfc25e . ';'; } else { $spcfc25e = ';' . $spcfc25e; } $sp00fda7 = Helper::str_between($spcfc25e, ';' . $spa58881 . '=', ';'); if (!$sp3f432f || $sp00fda7 == '') { return $sp00fda7; } else { return $spa58881 . '=' . $sp00fda7; } } private static function cookieIsExists($sp6ba3cf, $sp6374d8) { foreach ($sp6ba3cf as $spd2d3a2) { if (self::cookieGetName($spd2d3a2) == $sp6374d8) { return true; } } return false; } function test() { $spaedd86 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($spaedd86); } }