<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { public static function curl($spe1037b, $spe0f3ae = 0, $sp624c8a = '', $sp119a5f = array(), $spbcfa9d = 5, &$sp2f0df3 = false, &$sp6b2e6a = false, &$spa9d79c = false) { if (!isset($sp119a5f['Accept']) && !isset($sp119a5f['accept'])) { $sp119a5f['Accept'] = '*/*'; } if (!isset($sp119a5f['Referer']) && !isset($sp119a5f['referer'])) { $sp119a5f['Referer'] = $spe1037b; } if (!isset($sp119a5f['Content-Type']) && !isset($sp119a5f['content-type'])) { $sp119a5f['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp119a5f['User-Agent']) && !isset($sp119a5f['user-agent'])) { $sp119a5f['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp2f0df3 !== false) { $sp119a5f['Cookie'] = $sp2f0df3; } $sp82b955 = array(); foreach ($sp119a5f as $sp16860f => $sp9514b5) { $sp82b955[] = $sp16860f . ': ' . $sp9514b5; } $sp82b955[] = 'Expect:'; $sp79ef57 = curl_init(); curl_setopt($sp79ef57, CURLOPT_URL, $spe1037b); curl_setopt($sp79ef57, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($sp79ef57, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($sp79ef57, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp79ef57, CURLOPT_MAXREDIRS, 3); if ($spe0f3ae == 1) { curl_setopt($sp79ef57, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($sp79ef57, CURLOPT_POST, 1); if ($sp624c8a !== '') { curl_setopt($sp79ef57, CURLOPT_POSTFIELDS, $sp624c8a); curl_setopt($sp79ef57, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $sp5921d2 = MY_PROXY; $sp156dfe = CURLPROXY_HTTP; if (strpos($sp5921d2, 'http://') || strpos($sp5921d2, 'https://')) { $sp5921d2 = str_replace('http://', $sp5921d2, $sp5921d2); $sp5921d2 = str_replace('https://', $sp5921d2, $sp5921d2); $sp156dfe = CURLPROXY_HTTP; } elseif (strpos($sp5921d2, 'socks4://')) { $sp5921d2 = str_replace('socks4://', $sp5921d2, $sp5921d2); $sp156dfe = CURLPROXY_SOCKS4; } elseif (strpos($sp5921d2, 'socks4a://')) { $sp5921d2 = str_replace('socks4a://', $sp5921d2, $sp5921d2); $sp156dfe = CURLPROXY_SOCKS4A; } elseif (strpos($sp5921d2, 'socks5://')) { $sp5921d2 = str_replace('socks5://', $sp5921d2, $sp5921d2); $sp156dfe = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp79ef57, CURLOPT_PROXY, $sp5921d2); curl_setopt($sp79ef57, CURLOPT_PROXYTYPE, $sp156dfe); if (defined('MY_PROXY_PASS')) { curl_setopt($sp79ef57, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($sp79ef57, CURLOPT_TIMEOUT, $spbcfa9d); curl_setopt($sp79ef57, CURLOPT_CONNECTTIMEOUT, $spbcfa9d); curl_setopt($sp79ef57, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp79ef57, CURLOPT_HEADER, 1); curl_setopt($sp79ef57, CURLOPT_HTTPHEADER, $sp82b955); $sp4ffb9b = curl_exec($sp79ef57); if (curl_errno($sp79ef57)) { $spa9d79c = curl_error($sp79ef57); curl_close($sp79ef57); return null; } $spd6b3b7 = curl_getinfo($sp79ef57, CURLINFO_HEADER_SIZE); if ($sp6b2e6a) { $sp6b2e6a = curl_getinfo($sp79ef57, CURLINFO_HTTP_CODE); } $spfb548b = substr($sp4ffb9b, 0, $spd6b3b7); $spd92ccb = substr($sp4ffb9b, $spd6b3b7); curl_close($sp79ef57); if ($sp2f0df3 !== false) { $sp119a5f = explode('
', $spfb548b); $sp8c1270 = ''; foreach ($sp119a5f as $spfb548b) { if (strtolower(substr($spfb548b, 0, 11)) === 'set-cookie:') { $spfb548b = 'Set-Cookie:' . substr($spfb548b, 11); if (strpos($spfb548b, 'Set-Cookie') !== false) { if (strpos($spfb548b, ';') !== false) { $sp8c1270 = $sp8c1270 . trim(Helper::str_between($spfb548b, 'Set-Cookie:', ';')) . ';'; } else { $sp8c1270 = $sp8c1270 . trim(str_replace('Set-Cookie:', '', $spfb548b)) . ';'; } } } } $sp2f0df3 = self::combineCookie($sp2f0df3, $sp8c1270); } return $spd92ccb; } public static function get($spe1037b, $sp119a5f = array(), $spbcfa9d = 5, &$sp2f0df3 = false) { return self::curl($spe1037b, 0, '', $sp119a5f, $spbcfa9d, $sp2f0df3); } public static function post($spe1037b, $sp624c8a = '', $sp119a5f = array(), $spbcfa9d = 5, &$sp2f0df3 = false) { return self::curl($spe1037b, 1, $sp624c8a, $sp119a5f, $spbcfa9d, $sp2f0df3); } public static function download($spe1037b, $spa23346, $sp50159e = false) { $spf916f9 = fopen($spa23346, 'w+'); if (!$spf916f9) { throw new \Exception('cant open file: ' . $spa23346); } $sp79ef57 = curl_init(); curl_setopt($sp79ef57, CURLOPT_URL, $spe1037b); curl_setopt($sp79ef57, CURLOPT_FOLLOWLOCATION, true); curl_setopt($sp79ef57, CURLOPT_RETURNTRANSFER, true); curl_setopt($sp79ef57, CURLOPT_FILE, $spf916f9); if ($sp50159e) { curl_setopt($sp79ef57, CURLOPT_PROGRESSFUNCTION, function ($spa6be92, $sp8dde0e, $sp1362f2, $sp0dd195, $sp2e96da) { if ($sp8dde0e > 0) { echo '    download: ' . sprintf('%.2f', $sp1362f2 / $sp8dde0e * 100) . '%'; } }); curl_setopt($sp79ef57, CURLOPT_NOPROGRESS, false); } curl_setopt($sp79ef57, CURLOPT_HEADER, 0); curl_setopt($sp79ef57, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'); if (defined('MY_PROXY')) { $sp5921d2 = MY_PROXY; $sp156dfe = CURLPROXY_HTTP; if (strpos($sp5921d2, 'http://') || strpos($sp5921d2, 'https://')) { $sp5921d2 = str_replace('http://', $sp5921d2, $sp5921d2); $sp5921d2 = str_replace('https://', $sp5921d2, $sp5921d2); $sp156dfe = CURLPROXY_HTTP; } elseif (strpos($sp5921d2, 'socks4://')) { $sp5921d2 = str_replace('socks4://', $sp5921d2, $sp5921d2); $sp156dfe = CURLPROXY_SOCKS4; } elseif (strpos($sp5921d2, 'socks4a://')) { $sp5921d2 = str_replace('socks4a://', $sp5921d2, $sp5921d2); $sp156dfe = CURLPROXY_SOCKS4A; } elseif (strpos($sp5921d2, 'socks5://')) { $sp5921d2 = str_replace('socks5://', $sp5921d2, $sp5921d2); $sp156dfe = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($sp79ef57, CURLOPT_PROXY, $sp5921d2); curl_setopt($sp79ef57, CURLOPT_PROXYTYPE, $sp156dfe); if (defined('MY_PROXY_PASS')) { curl_setopt($sp79ef57, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_exec($sp79ef57); if (curl_errno($sp79ef57)) { curl_close($sp79ef57); throw new \Exception('curl_error: ' . curl_error($sp79ef57)); } curl_close($sp79ef57); return true; } public static function combineCookie($spa2a1ea, $spacde83) { $sped1262 = explode(';', $spa2a1ea); $sp2da2d7 = explode(';', $spacde83); foreach ($sped1262 as $spdb87c6) { if (self::cookieIsExists($sp2da2d7, self::cookieGetName($spdb87c6)) == false) { array_push($sp2da2d7, $spdb87c6); } } $spcd950b = ''; foreach ($sp2da2d7 as $spdb87c6) { if (substr($spdb87c6, -8, 8) != '=deleted' && strlen($spdb87c6) > 1) { $spcd950b .= $spdb87c6 . '; '; } } return substr($spcd950b, 0, strlen($spcd950b) - 1); } public static function cookieGetName($spac074d) { $spb5b8e1 = strpos($spac074d, '='); return substr($spac074d, 0, $spb5b8e1); } public static function cookieGetValue($spac074d) { $spb5b8e1 = strpos($spac074d, '='); $spb60248 = substr($spac074d, $spb5b8e1 + 1, strlen($spac074d) - $spb5b8e1); return $spb60248; } public static function cookieGet($sp2f0df3, $spae6970, $sp56972f = false) { $sp2f0df3 = str_replace(' ', '', $sp2f0df3); if (substr($sp2f0df3, -1, 1) != ';') { $sp2f0df3 = ';' . $sp2f0df3 . ';'; } else { $sp2f0df3 = ';' . $sp2f0df3; } $sp93420b = Helper::str_between($sp2f0df3, ';' . $spae6970 . '=', ';'); if (!$sp56972f || $sp93420b == '') { return $sp93420b; } else { return $spae6970 . '=' . $sp93420b; } } private static function cookieIsExists($spe3464c, $spaedcf4) { foreach ($spe3464c as $spdb87c6) { if (self::cookieGetName($spdb87c6) == $spaedcf4) { return true; } } return false; } function test() { $spb60248 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($spb60248); } }