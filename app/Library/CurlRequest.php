<?php
namespace App\Library; use Illuminate\Support\Facades\Log; class CurlRequest { private static function curl($sp09d604, $spebaff4 = 0, $sp79334f = '', $sp95ef3b = array(), $sp4ac663 = 5, &$sp112213 = false) { if (!isset($sp95ef3b['Accept'])) { $sp95ef3b['Accept'] = '*/*'; } if (!isset($sp95ef3b['Referer'])) { $sp95ef3b['Referer'] = $sp09d604; } if (!isset($sp95ef3b['Content-Type'])) { $sp95ef3b['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp95ef3b['User-Agent'])) { $sp95ef3b['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp112213 !== false) { $sp95ef3b['Cookie'] = $sp112213; } $sp269779 = array(); foreach ($sp95ef3b as $sp266597 => $spc0429f) { $sp269779[] = $sp266597 . ': ' . $spc0429f; } $sp269779[] = 'Expect:'; $spbaddc2 = curl_init(); curl_setopt($spbaddc2, CURLOPT_URL, $sp09d604); curl_setopt($spbaddc2, CURLOPT_SSL_VERIFYPEER, true); curl_setopt($spbaddc2, CURLOPT_SSL_VERIFYHOST, 2); curl_setopt($spbaddc2, CURLOPT_FOLLOWLOCATION, true); curl_setopt($spbaddc2, CURLOPT_MAXREDIRS, 3); if ($spebaff4 == 1) { curl_setopt($spbaddc2, CURLOPT_CUSTOMREQUEST, 'POST'); curl_setopt($spbaddc2, CURLOPT_POST, 1); if ($sp79334f !== '') { curl_setopt($spbaddc2, CURLOPT_POSTFIELDS, $sp79334f); curl_setopt($spbaddc2, CURLOPT_POSTREDIR, 3); } } if (defined('MY_PROXY')) { $sp2420e0 = MY_PROXY; $spf2c377 = CURLPROXY_HTTP; if (strpos($sp2420e0, 'http://') || strpos($sp2420e0, 'https://')) { $sp2420e0 = str_replace('http://', $sp2420e0, $sp2420e0); $sp2420e0 = str_replace('https://', $sp2420e0, $sp2420e0); $spf2c377 = CURLPROXY_HTTP; } elseif (strpos($sp2420e0, 'socks4://')) { $sp2420e0 = str_replace('socks4://', $sp2420e0, $sp2420e0); $spf2c377 = CURLPROXY_SOCKS4; } elseif (strpos($sp2420e0, 'socks4a://')) { $sp2420e0 = str_replace('socks4a://', $sp2420e0, $sp2420e0); $spf2c377 = CURLPROXY_SOCKS4A; } elseif (strpos($sp2420e0, 'socks5://')) { $sp2420e0 = str_replace('socks5://', $sp2420e0, $sp2420e0); $spf2c377 = CURLPROXY_SOCKS5_HOSTNAME; } curl_setopt($spbaddc2, CURLOPT_PROXY, $sp2420e0); curl_setopt($spbaddc2, CURLOPT_PROXYTYPE, $spf2c377); if (defined('MY_PROXY_PASS')) { curl_setopt($spbaddc2, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } } curl_setopt($spbaddc2, CURLOPT_TIMEOUT, $sp4ac663); curl_setopt($spbaddc2, CURLOPT_CONNECTTIMEOUT, $sp4ac663); curl_setopt($spbaddc2, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spbaddc2, CURLOPT_HEADER, 1); curl_setopt($spbaddc2, CURLOPT_HTTPHEADER, $sp269779); $sp7fa26f = curl_exec($spbaddc2); $sp4f5212 = curl_getinfo($spbaddc2, CURLINFO_HEADER_SIZE); $sp5ec77b = substr($sp7fa26f, 0, $sp4f5212); $spe456af = substr($sp7fa26f, $sp4f5212); curl_close($spbaddc2); if ($sp112213 !== false) { $sp95ef3b = explode('
', $sp5ec77b); $sp85787e = ''; foreach ($sp95ef3b as $sp5ec77b) { if (strpos($sp5ec77b, 'Set-Cookie') !== false) { if (strpos($sp5ec77b, ';') !== false) { $sp85787e = $sp85787e . trim(Helper::str_between($sp5ec77b, 'Set-Cookie:', ';')) . ';'; } else { $sp85787e = $sp85787e . trim(str_replace('Set-Cookie:', '', $sp5ec77b)) . ';'; } } } $sp112213 = self::combineCookie($sp112213, $sp85787e); } return $spe456af; } public static function get($sp09d604, $sp95ef3b = array(), $sp4ac663 = 5, &$sp112213 = false) { return self::curl($sp09d604, 0, '', $sp95ef3b, $sp4ac663, $sp112213); } public static function post($sp09d604, $sp79334f = '', $sp95ef3b = array(), $sp4ac663 = 5, &$sp112213 = false) { return self::curl($sp09d604, 1, $sp79334f, $sp95ef3b, $sp4ac663, $sp112213); } public static function combineCookie($sp25d3e5, $sp7ebdbf) { $sp214977 = explode(';', $sp25d3e5); $sp94fc44 = explode(';', $sp7ebdbf); foreach ($sp214977 as $spe6fc3e) { if (self::cookieIsExists($sp94fc44, self::cookieGetName($spe6fc3e)) == false) { array_push($sp94fc44, $spe6fc3e); } } $spd4a421 = ''; foreach ($sp94fc44 as $spe6fc3e) { if (substr($spe6fc3e, -8, 8) != '=deleted' && strlen($spe6fc3e) > 1) { $spd4a421 .= $spe6fc3e . '; '; } } return substr($spd4a421, 0, strlen($spd4a421) - 2); } public static function cookieGetName($sp03e122) { $spda97c1 = strpos($sp03e122, '='); return substr($sp03e122, 0, $spda97c1); } public static function cookieGetValue($sp03e122) { $spda97c1 = strpos($sp03e122, '='); $sp146b82 = substr($sp03e122, $spda97c1 + 1, strlen($sp03e122) - $spda97c1); return $sp146b82; } public static function cookieGet($sp112213, $sp7fb7ec, $sp8b47f5 = false) { $sp112213 = str_replace(' ', '', $sp112213); if (substr($sp112213, -1, 1) != ';') { $sp112213 = ';' . $sp112213 . ';'; } else { $sp112213 = ';' . $sp112213; } $spf1d859 = Helper::str_between($sp112213, ';' . $sp7fb7ec . '=', ';'); if (!$sp8b47f5 || $spf1d859 == '') { return $spf1d859; } else { return $sp7fb7ec . '=' . $spf1d859; } } private static function cookieIsExists($sp72210c, $spb2975e) { foreach ($sp72210c as $spe6fc3e) { if (self::cookieGetName($spe6fc3e) == $spb2975e) { return true; } } return false; } function test() { $sp146b82 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp146b82); } }