<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('options' => 'array', 'config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $sp112ad7 = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($spabfbe1) use($sp112ad7) { if (!file_exists($sp112ad7 . DIRECTORY_SEPARATOR . $spabfbe1->name . DIRECTORY_SEPARATOR . 'config.php')) { $spabfbe1->delete(); } }); foreach (scandir($sp112ad7) as $spa67576) { if ($spa67576 === '.' || $spa67576 === '..') { continue; } try { @($spabfbe1 = (include $sp112ad7 . DIRECTORY_SEPARATOR . $spa67576 . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $sp2251d3) { continue; } $spabfbe1['config'] = array_map(function ($sp29b243) { return $sp29b243['value']; }, @$spabfbe1['options'] ?? array()); $spb56bb5 = \App\ShopTheme::query()->where('name', $spa67576)->first(); if ($spb56bb5) { $spb56bb5->description = $spabfbe1['description']; $spb56bb5->options = @$spabfbe1['options'] ?? array(); $spb56bb5->config = ($spb56bb5->config ?? array()) + $spabfbe1['config']; $spb56bb5->saveOrFail(); } else { if ($spabfbe1 && isset($spabfbe1['description'])) { \App\ShopTheme::query()->create(array('name' => $spa67576, 'description' => $spabfbe1['description'], 'options' => @$spabfbe1['options'] ?? array(), 'config' => $spabfbe1['config'])); } } } } }