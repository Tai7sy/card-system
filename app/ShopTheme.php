<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('options' => 'array', 'config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $spc6a7c6 = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($sp117a3d) use($spc6a7c6) { if (!file_exists($spc6a7c6 . DIRECTORY_SEPARATOR . $sp117a3d->name . DIRECTORY_SEPARATOR . 'config.php')) { $sp117a3d->delete(); } }); foreach (scandir($spc6a7c6) as $sp63570a) { if ($sp63570a === '.' || $sp63570a === '..') { continue; } try { @($sp117a3d = (include $spc6a7c6 . DIRECTORY_SEPARATOR . $sp63570a . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $spd118f7) { continue; } $sp117a3d['config'] = array_map(function ($sp415442) { return $sp415442['value']; }, @$sp117a3d['options'] ?? array()); $spb2c74b = \App\ShopTheme::query()->where('name', $sp63570a)->first(); if ($spb2c74b) { $spb2c74b->description = $sp117a3d['description']; $spb2c74b->options = @$sp117a3d['options'] ?? array(); $spb2c74b->config = ($spb2c74b->config ?? array()) + $sp117a3d['config']; $spb2c74b->saveOrFail(); } else { if ($sp117a3d && isset($sp117a3d['description'])) { \App\ShopTheme::query()->create(array('name' => $sp63570a, 'description' => $sp117a3d['description'], 'options' => @$sp117a3d['options'] ?? array(), 'config' => $sp117a3d['config'])); } } } } }