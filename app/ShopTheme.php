<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('options' => 'array', 'config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $sp14400e = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($spf6c194) use($sp14400e) { if (!file_exists($sp14400e . DIRECTORY_SEPARATOR . $spf6c194->name . DIRECTORY_SEPARATOR . 'config.php')) { $spf6c194->delete(); } }); foreach (scandir($sp14400e) as $spa755c2) { if ($spa755c2 === '.' || $spa755c2 === '..') { continue; } try { @($spf6c194 = (include $sp14400e . DIRECTORY_SEPARATOR . $spa755c2 . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $sp3f4aab) { continue; } $spf6c194['config'] = array_map(function ($sp10eb73) { return $sp10eb73['value']; }, @$spf6c194['options'] ?? array()); $sp7c77cf = \App\ShopTheme::query()->where('name', $spa755c2)->first(); if ($sp7c77cf) { $sp7c77cf->description = $spf6c194['description']; $sp7c77cf->options = @$spf6c194['options'] ?? array(); $sp7c77cf->config = ($sp7c77cf->config ?? array()) + $spf6c194['config']; $sp7c77cf->saveOrFail(); } else { if ($spf6c194 && isset($spf6c194['description'])) { \App\ShopTheme::query()->create(array('name' => $spa755c2, 'description' => $spf6c194['description'], 'options' => @$spf6c194['options'] ?? array(), 'config' => $spf6c194['config'])); } } } } }