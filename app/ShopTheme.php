<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('options' => 'array', 'config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $sp5af18a = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($spacd1cb) use($sp5af18a) { if (!file_exists($sp5af18a . DIRECTORY_SEPARATOR . $spacd1cb->name . DIRECTORY_SEPARATOR . 'config.php')) { $spacd1cb->delete(); } }); foreach (scandir($sp5af18a) as $spc485f4) { if ($spc485f4 === '.' || $spc485f4 === '..') { continue; } try { @($spacd1cb = (include $sp5af18a . DIRECTORY_SEPARATOR . $spc485f4 . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $sp96dd17) { continue; } $spacd1cb['config'] = array_map(function ($sp807bd0) { return $sp807bd0['value']; }, @$spacd1cb['options'] ?? array()); $sp265a87 = \App\ShopTheme::query()->where('name', $spc485f4)->first(); if ($sp265a87) { $sp265a87->description = $spacd1cb['description']; $sp265a87->options = @$spacd1cb['options'] ?? array(); $sp265a87->config = ($sp265a87->config ?? array()) + $spacd1cb['config']; $sp265a87->saveOrFail(); } else { if ($spacd1cb && isset($spacd1cb['description'])) { \App\ShopTheme::query()->create(array('name' => $spc485f4, 'description' => $spacd1cb['description'], 'options' => @$spacd1cb['options'] ?? array(), 'config' => $spacd1cb['config'])); } } } } }