<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('options' => 'array', 'config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $spaf341e = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($sp75bd4b) use($spaf341e) { if (!file_exists($spaf341e . DIRECTORY_SEPARATOR . $sp75bd4b->name . DIRECTORY_SEPARATOR . 'config.php')) { $sp75bd4b->delete(); } }); foreach (scandir($spaf341e) as $sp7eb165) { if ($sp7eb165 === '.' || $sp7eb165 === '..') { continue; } try { @($sp75bd4b = (include $spaf341e . DIRECTORY_SEPARATOR . $sp7eb165 . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $spf745ad) { continue; } $sp75bd4b['config'] = array_map(function ($sp5f5b2b) { return $sp5f5b2b['value']; }, @$sp75bd4b['options'] ?? array()); $sp6369b1 = \App\ShopTheme::query()->where('name', $sp7eb165)->first(); if ($sp6369b1) { $sp6369b1->description = $sp75bd4b['description']; $sp6369b1->options = @$sp75bd4b['options'] ?? array(); $sp6369b1->config = ($sp6369b1->config ?? array()) + $sp75bd4b['config']; $sp6369b1->saveOrFail(); } else { if ($sp75bd4b && isset($sp75bd4b['description'])) { \App\ShopTheme::query()->create(array('name' => $sp7eb165, 'description' => $sp75bd4b['description'], 'options' => @$sp75bd4b['options'] ?? array(), 'config' => $sp75bd4b['config'])); } } } } }