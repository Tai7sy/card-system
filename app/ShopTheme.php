<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('options' => 'array', 'config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $spde3d9c = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($spe0ff89) use($spde3d9c) { if (!file_exists($spde3d9c . DIRECTORY_SEPARATOR . $spe0ff89->name . DIRECTORY_SEPARATOR . 'config.php')) { $spe0ff89->delete(); } }); foreach (scandir($spde3d9c) as $sp45207a) { if ($sp45207a === '.' || $sp45207a === '..') { continue; } try { @($spe0ff89 = (include $spde3d9c . DIRECTORY_SEPARATOR . $sp45207a . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $sp45f5f1) { continue; } $spe0ff89['config'] = array_map(function ($spc6f905) { return $spc6f905['value']; }, @$spe0ff89['options'] ?? array()); $sp5fd1b4 = \App\ShopTheme::query()->where('name', $sp45207a)->first(); if ($sp5fd1b4) { $sp5fd1b4->description = $spe0ff89['description']; $sp5fd1b4->options = @$spe0ff89['options'] ?? array(); $sp5fd1b4->config = ($sp5fd1b4->config ?? array()) + $spe0ff89['config']; $sp5fd1b4->saveOrFail(); } else { if ($spe0ff89 && isset($spe0ff89['description'])) { \App\ShopTheme::query()->create(array('name' => $sp45207a, 'description' => $spe0ff89['description'], 'options' => @$spe0ff89['options'] ?? array(), 'config' => $spe0ff89['config'])); } } } } }