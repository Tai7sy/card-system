<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('options' => 'array', 'config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $sp189f81 = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($sp4a695f) use($sp189f81) { if (!file_exists($sp189f81 . DIRECTORY_SEPARATOR . $sp4a695f->name . DIRECTORY_SEPARATOR . 'config.php')) { $sp4a695f->delete(); } }); foreach (scandir($sp189f81) as $spb90151) { if ($spb90151 === '.' || $spb90151 === '..') { continue; } try { @($sp4a695f = (include $sp189f81 . DIRECTORY_SEPARATOR . $spb90151 . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $sp4b79b8) { continue; } $sp4a695f['config'] = array_map(function ($sp64913d) { return $sp64913d['value']; }, @$sp4a695f['options'] ?? array()); $spd7d686 = \App\ShopTheme::query()->where('name', $spb90151)->first(); if ($spd7d686) { $spd7d686->description = $sp4a695f['description']; $spd7d686->options = @$sp4a695f['options'] ?? array(); $spd7d686->config = ($spd7d686->config ?? array()) + $sp4a695f['config']; $spd7d686->saveOrFail(); } else { if ($sp4a695f && isset($sp4a695f['description'])) { \App\ShopTheme::query()->create(array('name' => $spb90151, 'description' => $sp4a695f['description'], 'options' => @$sp4a695f['options'] ?? array(), 'config' => $sp4a695f['config'])); } } } } }