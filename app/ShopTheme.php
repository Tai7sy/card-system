<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('options' => 'array', 'config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $spf25d20 = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($sp43fed5) use($spf25d20) { if (!file_exists($spf25d20 . DIRECTORY_SEPARATOR . $sp43fed5->name . DIRECTORY_SEPARATOR . 'config.php')) { $sp43fed5->delete(); } }); foreach (scandir($spf25d20) as $spe4d039) { if ($spe4d039 === '.' || $spe4d039 === '..') { continue; } try { @($sp43fed5 = (include $spf25d20 . DIRECTORY_SEPARATOR . $spe4d039 . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $spb62437) { continue; } $sp43fed5['config'] = array_map(function ($sp1a74be) { return $sp1a74be['value']; }, @$sp43fed5['options'] ?? array()); $spf62e49 = \App\ShopTheme::query()->where('name', $spe4d039)->first(); if ($spf62e49) { $spf62e49->description = $sp43fed5['description']; $spf62e49->options = @$sp43fed5['options'] ?? array(); $spf62e49->config = ($spf62e49->config ?? array()) + $sp43fed5['config']; $spf62e49->saveOrFail(); } else { if ($sp43fed5 && isset($sp43fed5['description'])) { \App\ShopTheme::query()->create(array('name' => $spe4d039, 'description' => $sp43fed5['description'], 'options' => @$sp43fed5['options'] ?? array(), 'config' => $sp43fed5['config'])); } } } } }