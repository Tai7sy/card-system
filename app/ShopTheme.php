<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('options' => 'array', 'config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $spe59991 = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($spb73f41) use($spe59991) { if (!file_exists($spe59991 . DIRECTORY_SEPARATOR . $spb73f41->name . DIRECTORY_SEPARATOR . 'config.php')) { $spb73f41->delete(); } }); foreach (scandir($spe59991) as $sp9a8a72) { if ($sp9a8a72 === '.' || $sp9a8a72 === '..') { continue; } try { @($spb73f41 = (include $spe59991 . DIRECTORY_SEPARATOR . $sp9a8a72 . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $sp45222f) { continue; } $spb73f41['config'] = array_map(function ($sp3f5c2c) { return $sp3f5c2c['value']; }, @$spb73f41['options'] ?? array()); $sp628678 = \App\ShopTheme::query()->where('name', $sp9a8a72)->first(); if ($sp628678) { $sp628678->description = $spb73f41['description']; $sp628678->options = @$spb73f41['options'] ?? array(); $sp628678->config = ($sp628678->config ?? array()) + $spb73f41['config']; $sp628678->saveOrFail(); } else { if ($spb73f41 && isset($spb73f41['description'])) { \App\ShopTheme::query()->create(array('name' => $sp9a8a72, 'description' => $spb73f41['description'], 'options' => @$spb73f41['options'] ?? array(), 'config' => $spb73f41['config'])); } } } } }