<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('options' => 'array', 'config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $sp987089 = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($sp659338) use($sp987089) { if (!file_exists($sp987089 . DIRECTORY_SEPARATOR . $sp659338->name . DIRECTORY_SEPARATOR . 'config.php')) { $sp659338->delete(); } }); foreach (scandir($sp987089) as $spaeb899) { if ($spaeb899 === '.' || $spaeb899 === '..') { continue; } try { @($sp659338 = (include $sp987089 . DIRECTORY_SEPARATOR . $spaeb899 . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $sp54a0c6) { continue; } $sp659338['config'] = array_map(function ($sp442f8b) { return $sp442f8b['value']; }, @$sp659338['options'] ?? array()); $spa2a1ea = \App\ShopTheme::query()->where('name', $spaeb899)->first(); if ($spa2a1ea) { $spa2a1ea->description = $sp659338['description']; $spa2a1ea->options = @$sp659338['options'] ?? array(); $spa2a1ea->config = ($spa2a1ea->config ?? array()) + $sp659338['config']; $spa2a1ea->saveOrFail(); } else { if ($sp659338 && isset($sp659338['description'])) { \App\ShopTheme::query()->create(array('name' => $spaeb899, 'description' => $sp659338['description'], 'options' => @$sp659338['options'] ?? array(), 'config' => $sp659338['config'])); } } } } }