<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('options' => 'array', 'config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $sp5bb4ef = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($spc5b3dc) use($sp5bb4ef) { if (!file_exists($sp5bb4ef . DIRECTORY_SEPARATOR . $spc5b3dc->name . DIRECTORY_SEPARATOR . 'config.php')) { $spc5b3dc->delete(); } }); foreach (scandir($sp5bb4ef) as $sp49fa71) { if ($sp49fa71 === '.' || $sp49fa71 === '..') { continue; } try { @($spc5b3dc = (include $sp5bb4ef . DIRECTORY_SEPARATOR . $sp49fa71 . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $spd54c56) { continue; } $spc5b3dc['config'] = array_map(function ($spe4455f) { return $spe4455f['value']; }, @$spc5b3dc['options'] ?? array()); $sp23cdff = \App\ShopTheme::query()->where('name', $sp49fa71)->first(); if ($sp23cdff) { $sp23cdff->description = $spc5b3dc['description']; $sp23cdff->options = @$spc5b3dc['options'] ?? array(); $sp23cdff->config = ($sp23cdff->config ?? array()) + $spc5b3dc['config']; $sp23cdff->saveOrFail(); } else { if ($spc5b3dc && isset($spc5b3dc['description'])) { \App\ShopTheme::query()->create(array('name' => $sp49fa71, 'description' => $spc5b3dc['description'], 'options' => @$spc5b3dc['options'] ?? array(), 'config' => $spc5b3dc['config'])); } } } } }