<?php
namespace App; use App\Library\Helper; use Illuminate\Database\Eloquent\Model; class PayWay extends Model { protected $guarded = array(); protected $casts = array('channels' => 'array'); const ENABLED_DISABLED = 0; const ENABLED_PC = 1; const ENABLED_MOBILE = 2; const ENABLED_ALL = 3; const TYPE_SHOP = 1; const TYPE_API = 2; public function getPayByWeight() { $sp75f1cf = $sp9cbe91 = 0; $spc82cdb = array(); $sp548f2b = array(); foreach ($this->channels as $sp458343) { $sp548f2b[] = intval($sp458343[0]); } $spa9f157 = \App\Pay::gets()->filter(function ($spf93c32) use($sp548f2b) { return in_array($spf93c32->id, $sp548f2b); }); $sp0c1658 = array(); foreach ($spa9f157 as $spdbb391) { $sp0c1658[$spdbb391->id] = $spdbb391; } foreach ($this->channels as $sp458343) { $sp47a82e = intval($sp458343[0]); $sp82427f = intval($sp458343[1]); if ($sp82427f && isset($sp0c1658[$sp47a82e]) && $sp0c1658[$sp47a82e]->enabled > 0) { $sp75f1cf += $sp82427f; $spd2ccf6 = $sp9cbe91 + $sp82427f; $spc82cdb[] = array('min' => $sp9cbe91, 'max' => $spd2ccf6, 'pay_id' => $sp47a82e); $sp9cbe91 = $spd2ccf6; } } if ($sp75f1cf <= 0) { return null; } $sp1ddb4e = mt_rand(0, $sp75f1cf - 1); foreach ($spc82cdb as $sp417898) { if ($sp417898['min'] <= $sp1ddb4e && $sp1ddb4e < $sp417898['max']) { return $sp0c1658[$sp417898['pay_id']]; } } return null; } public static function gets($spe2c9ac, $sp499157 = null) { $spd10097 = self::query(); if ($sp499157 !== null) { $spd10097->where($sp499157); } $spd62c7c = $spd10097->orderBy('sort')->get(array('name', 'img', 'channels')); $spe7e65d = array(); foreach ($spd62c7c as $spa7567f) { $spf93c32 = $spa7567f->getPayByWeight(); if ($spf93c32) { $spf93c32->setAttribute('name', $spa7567f->name); $spf93c32->setAttribute('img', $spa7567f->img); $spf93c32->setVisible(array('id', 'name', 'img', 'fee')); $spe7e65d[] = $spf93c32; } } return $spe7e65d; } }