<?php
namespace App; use App\Library\Helper; use Illuminate\Database\Eloquent\Model; class PayWay extends Model { protected $guarded = array(); protected $casts = array('channels' => 'array'); const ENABLED_DISABLED = 0; const ENABLED_PC = 1; const ENABLED_MOBILE = 2; const ENABLED_ALL = 3; const TYPE_SHOP = 1; const TYPE_API = 2; public function getPayByWeight() { $sp88dd02 = $spbc84bc = 0; $sp75e350 = array(); $sp864000 = array(); foreach ($this->channels as $sp5f5b2b) { $sp864000[] = intval($sp5f5b2b[0]); } $sp51f96e = \App\Pay::gets()->filter(function ($sp2e48e6) use($sp864000) { return in_array($sp2e48e6->id, $sp864000); }); $spa44fa4 = array(); foreach ($sp51f96e as $sp599b53) { $spa44fa4[$sp599b53->id] = $sp599b53; } foreach ($this->channels as $sp5f5b2b) { $sp748126 = intval($sp5f5b2b[0]); $spe6a2b7 = intval($sp5f5b2b[1]); if ($spe6a2b7 && isset($spa44fa4[$sp748126]) && $spa44fa4[$sp748126]->enabled > 0) { $sp88dd02 += $spe6a2b7; $sp5710d6 = $spbc84bc + $spe6a2b7; $sp75e350[] = array('min' => $spbc84bc, 'max' => $sp5710d6, 'pay_id' => $sp748126); $spbc84bc = $sp5710d6; } } if ($sp88dd02 <= 0) { return null; } $spcfe5f4 = mt_rand(0, $sp88dd02 - 1); foreach ($sp75e350 as $spa50ec9) { if ($spa50ec9['min'] <= $spcfe5f4 && $spcfe5f4 < $spa50ec9['max']) { return $spa44fa4[$spa50ec9['pay_id']]; } } return null; } public static function gets($sp586d7b, $sp24164f = null) { $sp40bc20 = self::query(); if ($sp24164f !== null) { $sp40bc20->where($sp24164f); } $sp10fa09 = $sp40bc20->orderBy('sort')->get(array('name', 'img', 'channels')); $sp608e58 = array(); foreach ($sp10fa09 as $sp2ae2bd) { $sp2e48e6 = $sp2ae2bd->getPayByWeight(); if ($sp2e48e6) { $sp2e48e6->setAttribute('name', $sp2ae2bd->name); $sp2e48e6->setAttribute('img', $sp2ae2bd->img); $sp2e48e6->setVisible(array('id', 'name', 'img', 'fee')); $sp608e58[] = $sp2e48e6; } } return $sp608e58; } }