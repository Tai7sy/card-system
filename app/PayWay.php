<?php
namespace App; use App\Library\Helper; use Illuminate\Database\Eloquent\Model; class PayWay extends Model { protected $guarded = array(); protected $casts = array('channels' => 'array'); const ENABLED_DISABLED = 0; const ENABLED_PC = 1; const ENABLED_MOBILE = 2; const ENABLED_ALL = 3; const TYPE_SHOP = 1; const TYPE_API = 2; public function getPayByWeight() { $sp1ca412 = $sp06ca4e = 0; $spdfb949 = array(); $sp60bb7e = array(); foreach ($this->channels as $sp3f5c2c) { $sp60bb7e[] = intval($sp3f5c2c[0]); } $sp577f16 = \App\Pay::gets()->filter(function ($sp2e6adb) use($sp60bb7e) { return in_array($sp2e6adb->id, $sp60bb7e); }); $sp55ad16 = array(); foreach ($sp577f16 as $spc40d0a) { $sp55ad16[$spc40d0a->id] = $spc40d0a; } foreach ($this->channels as $sp3f5c2c) { $sp56237f = intval($sp3f5c2c[0]); $sp3996b3 = intval($sp3f5c2c[1]); if ($sp3996b3 && isset($sp55ad16[$sp56237f]) && $sp55ad16[$sp56237f]->enabled > 0) { $sp1ca412 += $sp3996b3; $sp43097d = $sp06ca4e + $sp3996b3; $spdfb949[] = array('min' => $sp06ca4e, 'max' => $sp43097d, 'pay_id' => $sp56237f); $sp06ca4e = $sp43097d; } } if ($sp1ca412 <= 0) { return null; } $sp7b4085 = mt_rand(0, $sp1ca412 - 1); foreach ($spdfb949 as $sp667286) { if ($sp667286['min'] <= $sp7b4085 && $sp7b4085 < $sp667286['max']) { return $sp55ad16[$sp667286['pay_id']]; } } return null; } public static function gets($spc33961, $spcd6f4f = null) { $sp8e2ceb = self::query(); if ($spcd6f4f !== null) { $sp8e2ceb->where($spcd6f4f); } $spb04c65 = $sp8e2ceb->orderBy('sort')->get(array('name', 'img', 'channels')); $sp98a23d = array(); foreach ($spb04c65 as $sp87bb1a) { $sp2e6adb = $sp87bb1a->getPayByWeight(); if ($sp2e6adb) { $sp2e6adb->setAttribute('name', $sp87bb1a->name); $sp2e6adb->setAttribute('img', $sp87bb1a->img); $sp2e6adb->setVisible(array('id', 'name', 'img', 'fee')); $sp98a23d[] = $sp2e6adb; } } return $sp98a23d; } }