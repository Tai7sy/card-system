<?php
namespace App; use App\Library\Helper; use Illuminate\Database\Eloquent\Model; class PayWay extends Model { protected $guarded = array(); protected $casts = array('channels' => 'array'); const ENABLED_DISABLED = 0; const ENABLED_PC = 1; const ENABLED_MOBILE = 2; const ENABLED_ALL = 3; const TYPE_SHOP = 1; const TYPE_API = 2; public function getPayByWeight() { $spe95220 = $spddab33 = 0; $sp5d9773 = array(); $sp892962 = array(); foreach ($this->channels as $sp9c771b) { $sp892962[] = intval($sp9c771b[0]); } $spa2d5d9 = \App\Pay::gets()->filter(function ($spade156) use($sp892962) { return in_array($spade156->id, $sp892962); }); $sp5e12ff = array(); foreach ($spa2d5d9 as $sp633c84) { $sp5e12ff[$sp633c84->id] = $sp633c84; } foreach ($this->channels as $sp9c771b) { $sp951599 = intval($sp9c771b[0]); $sp8deb40 = intval($sp9c771b[1]); if ($sp8deb40 && isset($sp5e12ff[$sp951599]) && $sp5e12ff[$sp951599]->enabled > 0) { $spe95220 += $sp8deb40; $sp1e1ab8 = $spddab33 + $sp8deb40; $sp5d9773[] = array('min' => $spddab33, 'max' => $sp1e1ab8, 'pay_id' => $sp951599); $spddab33 = $sp1e1ab8; } } if ($spe95220 <= 0) { return null; } $sp6b9869 = mt_rand(0, $spe95220 - 1); foreach ($sp5d9773 as $sp60eaa5) { if ($sp60eaa5['min'] <= $sp6b9869 && $sp6b9869 < $sp60eaa5['max']) { return $sp5e12ff[$sp60eaa5['pay_id']]; } } return null; } public static function gets($sp590011, $spd3a109 = null) { $spcfdf85 = self::query(); if ($spd3a109 !== null) { $spcfdf85->where($spd3a109); } $spaf1f48 = $spcfdf85->orderBy('sort')->get(array('name', 'img', 'channels')); $sp556e1d = array(); foreach ($spaf1f48 as $sp26063f) { $spade156 = $sp26063f->getPayByWeight(); if ($spade156) { $spade156->setAttribute('name', $sp26063f->name); $spade156->setAttribute('img', $sp26063f->img); $spade156->setVisible(array('id', 'name', 'img', 'fee')); $sp556e1d[] = $spade156; } } return $sp556e1d; } }