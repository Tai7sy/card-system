<?php
namespace App; use App\Library\Helper; use Illuminate\Database\Eloquent\Model; class PayWay extends Model { protected $guarded = array(); protected $casts = array('channels' => 'array'); const ENABLED_DISABLED = 0; const ENABLED_PC = 1; const ENABLED_MOBILE = 2; const ENABLED_ALL = 3; const TYPE_SHOP = 1; const TYPE_API = 2; public function getPayByWeight() { $spc2ebcd = $spbafb9f = 0; $sp410f13 = array(); $spdf2438 = array(); foreach ($this->channels as $sp222058) { $spdf2438[] = intval($sp222058[0]); } $spa34121 = \App\Pay::gets()->filter(function ($spec443a) use($spdf2438) { return in_array($spec443a->id, $spdf2438); }); $spd8f233 = array(); foreach ($spa34121 as $sp8cb721) { $spd8f233[$sp8cb721->id] = $sp8cb721; } foreach ($this->channels as $sp222058) { $sp697b06 = intval($sp222058[0]); $sp5e6cf6 = intval($sp222058[1]); if ($sp5e6cf6 && isset($spd8f233[$sp697b06]) && $spd8f233[$sp697b06]->enabled > 0) { $spc2ebcd += $sp5e6cf6; $spaa3b88 = $spbafb9f + $sp5e6cf6; $sp410f13[] = array('min' => $spbafb9f, 'max' => $spaa3b88, 'pay_id' => $sp697b06); $spbafb9f = $spaa3b88; } } if ($spc2ebcd <= 0) { return null; } $sp087d2f = mt_rand(0, $spc2ebcd - 1); foreach ($sp410f13 as $sp3b7c92) { if ($sp3b7c92['min'] <= $sp087d2f && $sp087d2f < $sp3b7c92['max']) { return $spd8f233[$sp3b7c92['pay_id']]; } } return null; } public static function gets($sp91cc0b, $sp841972 = null) { $sp479bde = self::query(); if ($sp841972 !== null) { $sp479bde->where($sp841972); } $sp17314b = $sp479bde->orderBy('sort')->get(array('name', 'img', 'channels')); $sp885b69 = array(); foreach ($sp17314b as $sp692033) { $spec443a = $sp692033->getPayByWeight(); if ($spec443a) { $spec443a->setAttribute('name', $sp692033->name); $spec443a->setAttribute('img', $sp692033->img); $spec443a->setVisible(array('id', 'name', 'img', 'fee')); $sp885b69[] = $spec443a; } } return $sp885b69; } }