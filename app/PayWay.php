<?php
namespace App; use App\Library\Helper; use Illuminate\Database\Eloquent\Model; class PayWay extends Model { protected $guarded = array(); protected $casts = array('channels' => 'array'); const ENABLED_DISABLED = 0; const ENABLED_PC = 1; const ENABLED_MOBILE = 2; const ENABLED_ALL = 3; const TYPE_SHOP = 1; const TYPE_API = 2; public function getPayByWeight() { $spb5d933 = $sp63187e = 0; $sp6cefe2 = array(); $sp4a6f27 = array(); foreach ($this->channels as $spc90bf2) { $sp4a6f27[] = intval($spc90bf2[0]); } $sp9a2ed8 = \App\Pay::gets()->filter(function ($sp243273) use($sp4a6f27) { return in_array($sp243273->id, $sp4a6f27); }); $sp05f4d3 = array(); foreach ($sp9a2ed8 as $sp673c07) { $sp05f4d3[$sp673c07->id] = $sp673c07; } foreach ($this->channels as $spc90bf2) { $sp9a7ae4 = intval($spc90bf2[0]); $sp00994e = intval($spc90bf2[1]); if ($sp00994e && isset($sp05f4d3[$sp9a7ae4]) && $sp05f4d3[$sp9a7ae4]->enabled > 0) { $spb5d933 += $sp00994e; $sp64f4a4 = $sp63187e + $sp00994e; $sp6cefe2[] = array('min' => $sp63187e, 'max' => $sp64f4a4, 'pay_id' => $sp9a7ae4); $sp63187e = $sp64f4a4; } } if ($spb5d933 <= 0) { return null; } $sp7f6fdd = mt_rand(0, $spb5d933 - 1); foreach ($sp6cefe2 as $sp2ba5d4) { if ($sp2ba5d4['min'] <= $sp7f6fdd && $sp7f6fdd < $sp2ba5d4['max']) { return $sp05f4d3[$sp2ba5d4['pay_id']]; } } return null; } public static function gets($spf3d3c9, $sp6ec03a = null) { $sp6c3275 = self::query(); if ($sp6ec03a !== null) { $sp6c3275->where($sp6ec03a); } $spdb31f8 = $sp6c3275->orderBy('sort')->get(array('name', 'img', 'channels')); $spad1171 = array(); foreach ($spdb31f8 as $sp820ff7) { $sp243273 = $sp820ff7->getPayByWeight(); if ($sp243273) { $sp243273->setAttribute('name', $sp820ff7->name); $sp243273->setAttribute('img', $sp820ff7->img); $sp243273->setVisible(array('id', 'name', 'img', 'fee')); $spad1171[] = $sp243273; } } return $spad1171; } }