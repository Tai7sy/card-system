<?php
namespace App; use App\Library\Helper; use Illuminate\Database\Eloquent\Model; class PayWay extends Model { protected $guarded = array(); protected $casts = array('channels' => 'array'); const ENABLED_DISABLED = 0; const ENABLED_PC = 1; const ENABLED_MOBILE = 2; const ENABLED_ALL = 3; const TYPE_SHOP = 1; const TYPE_API = 2; public function getPayByWeight() { $spf26c0c = $sp10708d = 0; $spb2a53d = array(); $sp70cf7b = array(); foreach ($this->channels as $spe4455f) { $sp70cf7b[] = intval($spe4455f[0]); } $speca7c2 = \App\Pay::gets()->filter(function ($sp5c2227) use($sp70cf7b) { return in_array($sp5c2227->id, $sp70cf7b); }); $spcaaa6f = array(); foreach ($speca7c2 as $sp5fb1ba) { $spcaaa6f[$sp5fb1ba->id] = $sp5fb1ba; } foreach ($this->channels as $spe4455f) { $sp6c5379 = intval($spe4455f[0]); $spb8b731 = intval($spe4455f[1]); if ($spb8b731 && isset($spcaaa6f[$sp6c5379]) && $spcaaa6f[$sp6c5379]->enabled > 0) { $spf26c0c += $spb8b731; $sp1ef605 = $sp10708d + $spb8b731; $spb2a53d[] = array('min' => $sp10708d, 'max' => $sp1ef605, 'pay_id' => $sp6c5379); $sp10708d = $sp1ef605; } } if ($spf26c0c <= 0) { return null; } $spf0b2d4 = mt_rand(0, $spf26c0c - 1); foreach ($spb2a53d as $sp1d5a39) { if ($sp1d5a39['min'] <= $spf0b2d4 && $spf0b2d4 < $sp1d5a39['max']) { return $spcaaa6f[$sp1d5a39['pay_id']]; } } return null; } public static function gets($sp216502, $sp1a03a2 = null) { $spbec213 = self::query(); if ($sp1a03a2 !== null) { $spbec213->where($sp1a03a2); } $sp351f91 = $spbec213->orderBy('sort')->get(array('name', 'img', 'channels')); $sp6ab41e = array(); foreach ($sp351f91 as $spe4f665) { $sp5c2227 = $spe4f665->getPayByWeight(); if ($sp5c2227) { $sp5c2227->setAttribute('name', $spe4f665->name); $sp5c2227->setAttribute('img', $spe4f665->img); $sp5c2227->setVisible(array('id', 'name', 'img', 'fee')); $sp6ab41e[] = $sp5c2227; } } return $sp6ab41e; } }