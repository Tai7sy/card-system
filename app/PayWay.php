<?php
namespace App; use App\Library\Helper; use Illuminate\Database\Eloquent\Model; class PayWay extends Model { protected $guarded = array(); protected $casts = array('channels' => 'array'); const ENABLED_DISABLED = 0; const ENABLED_PC = 1; const ENABLED_MOBILE = 2; const ENABLED_ALL = 3; const TYPE_SHOP = 1; const TYPE_API = 2; public function getPayByWeight() { $sp051e12 = $spc741e0 = 0; $spa234f8 = array(); $spb19a2c = array(); foreach ($this->channels as $sp442f8b) { $spb19a2c[] = intval($sp442f8b[0]); } $spc616b0 = \App\Pay::gets()->filter(function ($sp74e49b) use($spb19a2c) { return in_array($sp74e49b->id, $spb19a2c); }); $sp7c372d = array(); foreach ($spc616b0 as $spaa2c41) { $sp7c372d[$spaa2c41->id] = $spaa2c41; } foreach ($this->channels as $sp442f8b) { $sp6cc800 = intval($sp442f8b[0]); $sp5f04b7 = intval($sp442f8b[1]); if ($sp5f04b7 && isset($sp7c372d[$sp6cc800]) && $sp7c372d[$sp6cc800]->enabled > 0) { $sp051e12 += $sp5f04b7; $spfa0f25 = $spc741e0 + $sp5f04b7; $spa234f8[] = array('min' => $spc741e0, 'max' => $spfa0f25, 'pay_id' => $sp6cc800); $spc741e0 = $spfa0f25; } } if ($sp051e12 <= 0) { return null; } $sp5b2f32 = mt_rand(0, $sp051e12 - 1); foreach ($spa234f8 as $sp733d8e) { if ($sp733d8e['min'] <= $sp5b2f32 && $sp5b2f32 < $sp733d8e['max']) { return $sp7c372d[$sp733d8e['pay_id']]; } } return null; } public static function gets($sp0a324a, $spb63421 = null) { $spc64cdd = self::query(); if ($spb63421 !== null) { $spc64cdd->where($spb63421); } $spbee511 = $spc64cdd->orderBy('sort')->get(array('name', 'img', 'channels')); $sp8fdcaf = array(); foreach ($spbee511 as $sp0fb774) { $sp74e49b = $sp0fb774->getPayByWeight(); if ($sp74e49b) { $sp74e49b->setAttribute('name', $sp0fb774->name); $sp74e49b->setAttribute('img', $sp0fb774->img); $sp74e49b->setVisible(array('id', 'name', 'img', 'fee')); $sp8fdcaf[] = $sp74e49b; } } return $sp8fdcaf; } }