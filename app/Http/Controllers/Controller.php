<?php
namespace App\Http\Controllers; use App\System; use App\Library\Geetest; use Illuminate\Foundation\Bus\DispatchesJobs; use Illuminate\Http\Response; use Illuminate\Routing\Controller as BaseController; use Illuminate\Foundation\Validation\ValidatesRequests; use Illuminate\Foundation\Auth\Access\AuthorizesRequests; use Illuminate\Http\Request; use Illuminate\Support\Facades\Auth; class Controller extends BaseController { use AuthorizesRequests, DispatchesJobs, ValidatesRequests; public function getCaptcha() { $spe0fb8c = System::_get('vcode_driver'); if ($spe0fb8c === 'code') { return response(array()); } elseif ($spe0fb8c === 'geetest') { return response(Geetest\API::get()); } elseif ($spe0fb8c === 'recaptcha') { } return response(array(), Response::HTTP_NOT_IMPLEMENTED); } function validateCaptcha(Request $spccbfb6) { $spe0fb8c = System::_get('vcode_driver'); if ($spe0fb8c === 'code') { $this->validate($spccbfb6, array('captcha.key' => 'required|string', 'captcha.code' => 'required|captcha_api:' . $spccbfb6->input('captcha.key'))); } elseif ($spe0fb8c === 'geetest') { $this->validate($spccbfb6, array('captcha.a' => 'required|string', 'captcha.b' => 'required|string', 'captcha.c' => 'required|string', 'captcha.d' => 'required|string')); if (!Geetest\API::verify($spccbfb6->input('captcha.a'), $spccbfb6->input('captcha.b'), $spccbfb6->input('captcha.c'), $spccbfb6->input('captcha.d'))) { throw \Illuminate\Validation\ValidationException::withMessages(array('captcha' => array(trans('validation.captcha')))); } } elseif ($spe0fb8c === 'recaptcha') { $this->validate($spccbfb6, array('captcha.t' => 'required|string')); } } function authQuery(Request $spccbfb6, $sp2bc3c4, $sp8e4317 = 'user_id', $sp01ca09 = 'user_id') { return $sp2bc3c4::where($sp8e4317, \Auth::id()); } protected function getUserId(Request $spccbfb6, $sp01ca09 = 'user_id') { return \Auth::id(); } protected function getUserIdOrFail(Request $spccbfb6, $sp01ca09 = 'user_id') { $spe58da5 = self::getUserId($spccbfb6, $sp01ca09); if ($spe58da5) { return $spe58da5; } else { throw new \Exception('参数缺少 ' . $sp01ca09); } } protected function getUser(Request $spccbfb6) { return \Auth::getUser(); } protected function checkIsInMaintain() { if (System::_getInt('maintain') === 1) { $spb36cc0 = System::_get('maintain_info'); echo view('message', array('title' => '维护中', 'message' => $spb36cc0)); die; } } protected function msg($sp9a4064, $spde5190 = null, $spa83cec = null) { return view('message', array('message' => $sp9a4064, 'title' => $spde5190, 'exception' => $spa83cec)); } }