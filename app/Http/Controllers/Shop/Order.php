<?php
namespace App\Http\Controllers\Shop; use Carbon\Carbon; use Illuminate\Database\Eloquent\Relations\Relation; use Illuminate\Http\Request; use App\Http\Controllers\Controller; use App\Library\Response; use App\Library\Geetest; use Illuminate\Support\Facades\Cookie; class Order extends Controller { function get(Request $sp26e527) { if (\App\System::_getInt('vcode_shop_search') === 1) { $this->validateCaptcha($sp26e527); } $spcfdf85 = \App\Order::where('created_at', '>=', (new Carbon())->addDay(-\App\System::_getInt('order_query_day', 30))); $spa0789d = $sp26e527->post('type', ''); if ($spa0789d === 'cookie') { $sp5fb842 = Cookie::get('customer'); if (strlen($sp5fb842) !== 32) { return Response::success(); } $spcfdf85->where('customer', $sp5fb842); } elseif ($spa0789d === 'order_no') { $spf82521 = $sp26e527->post('order_no', ''); if (strlen($spf82521) !== 19) { return Response::success(); } $spcfdf85->where('order_no', $spf82521); } elseif ($spa0789d === 'contact') { $spc5e5ef = $sp26e527->post('contact', ''); if (strlen($spc5e5ef) < 6) { return Response::success(); } $spcfdf85->where('contact', $spc5e5ef); } else { return Response::fail(trans('shop.search_type.required')); } $spce3cfb = array('id', 'created_at', 'order_no', 'contact', 'status', 'send_status', 'count', 'paid'); if (1) { $spce3cfb[] = 'product_name'; $spce3cfb[] = 'contact'; $spce3cfb[] = 'contact_ext'; } $spccc256 = $spcfdf85->orderBy('id', 'DESC')->get($spce3cfb); $spbf4529 = ''; return Response::success(array('list' => $spccc256, 'msg' => count($spccc256) ? $spbf4529 : '')); } }