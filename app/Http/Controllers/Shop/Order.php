<?php
namespace App\Http\Controllers\Shop; use Carbon\Carbon; use Illuminate\Database\Eloquent\Relations\Relation; use Illuminate\Http\Request; use App\Http\Controllers\Controller; use App\Library\Response; use App\Library\Geetest; use Illuminate\Support\Facades\Cookie; class Order extends Controller { function get(Request $spccbfb6) { if (\App\System::_getInt('vcode_shop_search') === 1) { $this->validateCaptcha($spccbfb6); } $sp479bde = \App\Order::where('created_at', '>=', (new Carbon())->addDay(-\App\System::_getInt('order_query_day', 30))); $sp55be16 = $spccbfb6->post('type', ''); if ($sp55be16 === 'cookie') { $spd3051c = Cookie::get('customer'); if (strlen($spd3051c) !== 32) { return Response::success(); } $sp479bde->where('customer', $spd3051c); } elseif ($sp55be16 === 'order_no') { $spebe6f4 = $spccbfb6->post('order_no', ''); if (strlen($spebe6f4) !== 19) { return Response::success(); } $sp479bde->where('order_no', $spebe6f4); } elseif ($sp55be16 === 'contact') { $sp74c357 = $spccbfb6->post('contact', ''); if (strlen($sp74c357) < 6) { return Response::success(); } $sp479bde->where('contact', $sp74c357); } else { return Response::fail('请选择查询类型'); } $sp7b52d9 = array('id', 'created_at', 'order_no', 'contact', 'status', 'send_status', 'count', 'paid'); if (1) { $sp7b52d9[] = 'product_name'; $sp7b52d9[] = 'contact'; $sp7b52d9[] = 'contact_ext'; } $sp7d3bbd = $sp479bde->orderBy('id', 'DESC')->get($sp7b52d9); $sp429f14 = ''; return Response::success(array('list' => $sp7d3bbd, 'msg' => count($sp7d3bbd) ? $sp429f14 : '')); } }